<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<meta name="msvalidate.01" content="DF5FE493CC759E62BFE073BEA8EFD472" />
<title>Go语言基础 | Kennem&#39;s Blog</title>
<meta name="keywords" content="GoLang">
<meta name="description" content="Go语言基础">
<meta name="author" content="ShowGuan">
<link rel="canonical" href="https://kennems.github.io/posts/tech/go-1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.62a7eeae50111b169accaf54360fa68001ac13582e542f2b7f808927f82c7b28.css" integrity="sha256-YqfurlARGxaazK9UNg&#43;mgAGsE1guVC8rf4CJJ/gseyg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kennems.github.io/img/sun.png">
<link rel="apple-touch-icon" href="https://kennems.github.io/img/sun.png">
<link rel="mask-icon" href="https://kennems.github.io/img/sun.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://kennems.github.io/posts/tech/go-1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>


<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/code-new-roman">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

<meta property="og:url" content="https://kennems.github.io/posts/tech/go-1/">
  <meta property="og:site_name" content="Kennem&#39;s Blog">
  <meta property="og:title" content="Go语言基础">
  <meta property="og:description" content="Go语言基础">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-25T15:37:01+08:00">
    <meta property="article:modified_time" content="2025-01-25T15:37:01+08:00">
    <meta property="article:tag" content="GoLang">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go语言基础">
<meta name="twitter:description" content="Go语言基础">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚文章",
      "item": "https://kennems.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "💻技术",
      "item": "https://kennems.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Go语言基础",
      "item": "https://kennems.github.io/posts/tech/go-1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go语言基础",
  "name": "Go语言基础",
  "description": "Go语言基础",
  "keywords": [
    "GoLang"
  ],
  "articleBody": "Go语言基础 1. Go语言概述 高性能：适合并发编程，支持高并发、高性能场景。 简洁语法：Go的语法简洁，快速上手，去除了复杂的面向对象特性，保留了函数式编程的一些优势。 丰富标准库：内建强大的标准库，支持网络、文件操作、并发等。 静态链接：生成独立的可执行文件，无需依赖外部库，简化部署。 跨平台：支持Linux、Windows、macOS等多个平台。 垃圾回收：自动管理内存，减少开发人员的负担。 2. 环境搭建 Go安装：官方安装指南 推荐IDE：VSCode、GoLand，或者Gitpod等云开发环境。 Go Module go.mod：用于管理 Go 项目的依赖，记录模块路径、Go 版本和所依赖的包及其版本。\ngo.sum：用于记录每个依赖包的校验和，确保依赖包的完整性与安全性。\n命令行工具 1、go run 无需生成二进制文件，适合用于快速测试和调试\ngo run [arguments] 可以传递多个文件名来运行多个Go源文件\ngo run file1.go file2.go 2、go build 编译代码生成二进制文件的工具，编译原代码并生成可执行文件，可以在没有Go环境的机器上运行\ngo build 自定义可执行文件名 go build -o myapp main.go go build file1.go file2.go 构建一个包 go build 3、go install 与 go build 类似，区别在于 go install 会将生成的二进制文件安装到Go的GOPATH下（或者模块模式下会安装到GOBIN)。它通常用于将编译后的工具或应用程序安装到系统中。\ngo install 示例： 你可以使用 go install 安装一个命令行工具：\ngo install github.com/spf13/cobra@latest 会将 cobra 安装到你的 GOBIN 目录下，方便你在命令行中使用。\n4、go test go test 是 Go 提供的测试工具，可以自动化运行Go的单元测试。\ngo test 假设你有一个测试文件 main_test.go：\npackage main import \"testing\" func TestAdd(t *testing.T) { result := 1 + 2 if result != 3 { t.Errorf(\"期望 3，实际是 %d\", result) } } 你可以运行 go test 来运行这个测试：\ngo test 查看测试详细输出： 默认情况下，go test 会隐藏详细输出。如果你想查看详细信息，可以使用 -v 参数：\ngo test -v 运行特定的测试函数： 如果你只想运行特定的测试函数，可以使用 -run 参数：\ngo test -run TestAdd 5、go get go get 用于安装和更新 Go 包。如果你需要下载第三方库或者工具，可以使用 go get。\ngo get 示例： 下载并安装一个包：\ngo get github.com/spf13/cobra 如果你在模块模式下，go get 会自动更新 go.mod 文件。\n获取最新版本： 默认情况下，go get 会下载最新的稳定版本。如果你需要获取一个特定的版本，可以使用：\ngo get github.com/spf13/cobra@v1.2.3 6、go mod Go 1.11 以后引入了模块化（Module）系统，go mod 是 Go 语言中用于管理依赖的工具。以下是常见的 go mod 命令：\n6.1 go mod init 初始化一个新的 Go 模块，在当前目录创建 go.mod 文件：\ngo mod init 6.2 go mod tidy 清理模块文件，删除未使用的依赖，并且确保所有需要的依赖都在 go.mod 和 go.sum 文件中：\ngo mod tidy 6.3 go mod vendor 将所有依赖复制到本地 vendor 目录中，这对于某些需要离线构建的情况很有用：\ngo mod vendor 7、go fmt 与代码格式化 go fmt 是 Go 的代码格式化工具，它可以自动调整 Go 源代码的格式，使其符合 Go 的代码风格。通常在提交代码前运行，以保持代码风格一致。\n基本语法： go fmt 格式化整个包： go fmt ./... 3. Go基础语法 3.1 Hello World package main // 定义包名，main包是Go程序的入口 import \"fmt\" // 引入fmt包，用于格式化输入输出 // main函数是Go程序的入口 func main() { fmt.Println(\"Hello, World!\") // 输出Hello, World! } 3.2 变量声明与初始化 3.2.1 常规声明 var a = \"initial\" // 声明变量a，并初始化为\"initial\" var b, c int = 1, 2 // 同时声明b和c并初始化 var d = true // 自动推断d的类型为bool 3.2.2 使用:=简洁声明 e := 3.14 // :=用于声明并初始化变量，类型由编译器推断 3.2.3 空白标识符 var x, y int _, err := os.Open(\"file.txt\") // 通过空白标识符忽略某个返回值 3.3 控制结构 3.3.1 if-else语句 num := 9 if num \u003c 0 { fmt.Println(num, \"is negative\") // 如果num小于0，输出负数 } else if num \u003c 10 { fmt.Println(num, \"has 1 digit\") // 如果num小于10，输出1位数 } else { fmt.Println(num, \"has multiple digits\") // 否则输出多位数 } 3.3.2 switch语句 switch day := \"Monday\"; day { case \"Monday\": fmt.Println(\"Start of the week\") case \"Friday\": fmt.Println(\"End of the week\") default: fmt.Println(\"Midweek\") // 默认情况 } 3.3.3 for循环 // Go只有一个循环结构for，其他的如while都可以通过for实现 for i := 0; i \u003c 3; i++ { // 从0到2的循环 fmt.Println(i) // 输出循环的每个值 } 3.4 数组与切片 3.4.1 数组 var arr [5]int // 定义一个固定长度为5的数组 arr[0] = 10 // 给数组第一个元素赋值 fmt.Println(arr) // 输出整个数组 3.4.2 切片 // 切片是Go的一个灵活数据结构，不像数组大小固定 s := []string{\"a\", \"b\", \"c\"} s = append(s, \"d\") // append函数动态扩展切片 fmt.Println(s) // 输出切片 3.4.3 切片的创建 s := make([]int, 5) // 创建一个长度为5的切片 fmt.Println(s) // 输出: [0 0 0 0 0] 3.5 函数 3.5.1 基本函数 func add(a int, b int) int { // 函数声明，返回a+b的结果 return a + b } fmt.Println(add(1, 2)) // 调用函数并打印返回值 3.5.2 多返回值 func divide(a, b int) (int, int) { return a / b, a % b // 返回商和余数 } quotient, remainder := divide(10, 3) // 解构返回值 fmt.Println(quotient, remainder) 3.5.3 可变参数 func sum(nums ...int) int { // nums是一个整数切片 total := 0 for _, num := range nums { total += num } return total } fmt.Println(sum(1, 2, 3, 4)) // 传入多个参数 3.6 结构体与方法 3.6.1 结构体 type User struct { Name string Password string } u := User{\"wang\", \"password123\"} // 初始化结构体 fmt.Println(u) 3.6.2 方法 // 为User类型定义一个方法 func (u *User) ResetPassword(password string) { u.Password = password // 修改结构体实例的字段 } u.ResetPassword(\"newpassword\") // 调用方法修改Password字段 fmt.Println(u.Password) 3.7 错误处理 func findUser(users []User, name string) (*User, error) { for _, u := range users { if u.Name == name { return \u0026u, nil // 找到用户，返回指针和nil错误 } } return nil, fmt.Errorf(\"user not found\") // 没找到，返回错误 } u, err := findUser([]User{{\"wang\", \"1024\"}}, \"wang\") if err != nil { fmt.Println(err) // 打印错误 return } fmt.Println(u.Name) // 如果没有错误，打印用户信息 3.8 字符串操作 3.8.1 常用字符串函数 import \"strings\" str := \"Hello, World!\" fmt.Println(strings.Contains(str, \"World\")) // 检查字符串是否包含\"World\" fmt.Println(strings.ToUpper(str)) // 将字符串转换为大写 fmt.Println(strings.Split(str, \", \")) // 按指定分隔符切割字符串 3.9 JSON处理 3.9.1 编码与解码 import \"encoding/json\" type UserInfo struct { Name string `json:\"name\"` Age int `json:\"age\"` } a := UserInfo{Name: \"wang\", Age: 18} buf, err := json.Marshal(a) // 将结构体编码为JSON if err != nil { fmt.Println(\"Error encoding JSON:\", err) } fmt.Println(string(buf)) // 输出JSON字符串 var b UserInfo err = json.Unmarshal(buf, \u0026b) // 将JSON字符串解码为结构体 if err != nil { fmt.Println(\"Error decoding JSON:\", err) } fmt.Println(b) 3.10 时间与数字解析 3.10.1 时间操作 import \"time\" t := time.Now() // 获取当前时间 fmt.Println(t.Format(\"2006-01-02 15:04:05\")) // 格式化时间 3.10.2 字符串转数字 import \"strconv\" str := \"123\" n, err := strconv.Atoi(str) // 将字符串转为整数 if err != nil { fmt.Println(\"Error converting string to number:\", err) } fmt.Println(n) // 输出123 4. Go工程实践 4.1 猜数字游戏 import ( \"fmt\" \"math/rand\" \"time\" ) func main() { rand.Seed(time.Now().UnixNano()) // 使用时间戳作为随机数种子 secretNumber := rand.Intn(100) // 生成一个0到99之间的随机数 fmt.Println(\"Guess the secret number between 0 and 100!\") var guess int for { fmt.Print(\"Enter your guess: \") fmt.Scan(\u0026guess) // 读取用户输入的猜测值 if guess \u003c secretNumber { fmt.Println(\"Too low!\") } else if guess \u003e secretNumber { fmt.Println(\"Too high!\") } else { fmt.Println(\"You guessed it!\") break } } } 4.2 在线词典 import ( \"encoding/json\" \"fmt\" \"net/http\" ) func getDefinition(word string) { url := \"https://api.dictionaryapi.dev 好的，以下是我为你准备的关于 SOCKS5 代理服务器 的 Go 语言代码的详细注释版，力求保持代码的完整性并加上详细的解释。\nSOCKS5 代理服务器代码实现 1. SOCKS5 协议概述 1.1 SOCKS5 代理原理 SOCKS5 是一种代理协议，在网络中充当客户端与目标服务器之间的中介，允许客户端通过代理服务器访问远程资源，通常用于规避防火墙、提高安全性等。\n代理流程分为四个阶段：\n握手阶段：客户端向 SOCKS5 代理发送协议版本号及认证方式。 认证阶段：根据代理服务器的返回，进行相应的身份验证。 请求阶段：认证通过后，客户端向 SOCKS5 代理发送请求，要求建立与目标服务器的连接。 中继阶段：代理服务器转发客户端请求和目标服务器的响应，完成数据传输。 2. TCP Echo 服务器 首先，我们需要实现一个简单的 TCP Echo 服务器，处理从客户端发送的数据，并返回相同的数据。\n2.1 TCP Echo 服务器代码 package main import ( \"bufio\" \"fmt\" \"log\" \"net\" ) func main() { server, err := net.Listen(\"tcp\", \"127.0.0.1:1080\") // 监听本地1080端口 if err != nil { panic(err) // 如果监听失败，则程序崩溃 } for { client, err := server.Accept() // 接受来自客户端的连接 if err != nil { log.Printf(\"Accept failed %v\", err) continue } go process(client) // 启动一个新的goroutine处理该连接 } } // 处理连接的函数 func process(conn net.Conn) { defer conn.Close() // 函数退出时关闭连接，避免资源泄漏 reader := bufio.NewReader(conn) // 创建一个缓冲读取器，优化性能 for { b, err := reader.ReadByte() // 读取单个字节 if err != nil { break // 如果读取错误，则退出循环 } _, err = conn.Write([]byte{b}) // 将字节写回客户端 if err != nil { break // 如果写入错误，则退出循环 } } } 2.2 代码说明： net.Listen：在本地创建一个监听指定端口的服务器（这里是 127.0.0.1:1080）。 Accept：接受客户端连接请求并返回一个连接对象。 process：启动一个新的 goroutine 来处理客户端的请求。bufio.NewReader 用于提高从网络连接读取数据的效率。 conn.Write：将客户端输入的字节数据发送回去，形成“echo”响应。 2.3 测试方法： 可以使用 nc（netcat）工具来测试：\nnc 127.0.0.1 1080 在终端中输入任意字符，TCP Echo 服务器将返回相同的字符。\n3. SOCKS5 代理认证实现 3.1 定义常量 const socks5Ver = 0x05 // SOCKS5 协议版本 const cmdBind = 0x01 // 绑定命令 const atypIPV4 = 0x01 // IPv4 地址类型 const atypeHOST = 0x03 // 主机名类型 const atypeIPV6 = 0x04 // IPv6 地址类型 3.2 认证函数 func auth(reader *bufio.Reader, conn net.Conn) (err error) { // 读取 SOCKS5 协议版本 ver, err := reader.ReadByte() if err != nil { return fmt.Errorf(\"read ver failed:%w\", err) } if ver != socks5Ver { return fmt.Errorf(\"not supported ver: %v\", ver) } // 读取认证方法的数量 methodSize, err := reader.ReadByte() if err != nil { return fmt.Errorf(\"read methodSize failed:%w\", err) } // 读取所有认证方法 method := make([]byte, methodSize) _, err = io.ReadFull(reader, method) if err != nil { return fmt.Errorf(\"read method failed:%w\", err) } // 打印协议版本与认证方法 log.Panicln(\"ver\", ver, \"method\", method) // 返回不需要认证的响应 _, err = conn.Write([]byte{socks5Ver, 0x00}) // 0x00 表示无需认证 if err != nil { return fmt.Errorf(\"write failed:%w\", err) } return nil } 3.3 代码说明： ReadByte：逐字节读取协议中的数据，例如版本号和认证方法的数量。 io.ReadFull：确保将指定长度的数据完全读取。 conn.Write：向客户端返回响应，表示认证成功。 4. SOCKS5 请求阶段 在请求阶段，代理服务器接收到客户端发来的连接请求，并解析其中的目标地址和端口信息。\n4.1 连接请求解析 func connect(reader *bufio.Reader, conn net.Conn) (err error) { ver, err := reader.ReadByte() // 读取版本号 if err != nil { return fmt.Errorf(\"read ver failed:%w\", err) } cmd, err := reader.ReadByte() // 读取命令类型 if err != nil { return fmt.Errorf(\"read cmd failed:%w\", err) } rsv, err := reader.ReadByte() // 保留字段，忽略 if err != nil { return fmt.Errorf(\"read rsv failed:%w\", err) } atyp, err := reader.ReadByte() // 地址类型 if err != nil { return fmt.Errorf(\"read atyp failed:%w\", err) } var addr string switch atyp { case atypIPV4: addr = readIPV4(reader) // 读取IPv4地址 case atypeHOST: addr = readHost(reader) // 读取主机名 case atypeIPV6: addr = readIPV6(reader) // 读取IPv6地址 } // 读取端口 port := readPort(reader) log.Printf(\"Connecting to %s:%d\", addr, port) // 打印目标地址和端口 return nil } 4.2 代码说明： cmd：检查请求类型，SOCKS5 代理服务器通常只处理 CONNECT 请求。 atyp：根据目标地址类型（IPv4、主机名、IPv6）分别处理。 readIPV4/readHost/readIPV6/readPort：读取不同地址类型的数据。 5. SOCKS5 中继阶段 在中继阶段，代理服务器通过双向数据转发来实现代理服务，直到数据传输结束或发生错误。\n5.1 数据转发 func relay(reader *bufio.Reader, conn net.Conn, targetConn net.Conn, ctx context.Context) { go io.Copy(targetConn, conn) // 从客户端读取数据并发送到目标服务器 go io.Copy(conn, targetConn) // 从目标服务器读取数据并发送到客户端 \u003c-ctx.Done() // 等待任意一个数据转发完成或发生错误 } 5.2 代码说明： io.Copy：标准库提供的用于数据转发的函数。 ctx.Done()：使用 context 来控制数据传输的终止条件。当 context 被取消时，数据传输终止。 6. 最终测试 测试时，可以通过在浏览器中设置 SOCKS5 代理，或者使用 curl 命令来进行请求：\ncurl --socks5 127.0.0.1:1080 http://example.com 在测试时，代理服务器将转发请求，最终浏览器或工具可以通过 SOCKS5 代理成功访问目标服务器。\n",
  "wordCount" : "4135",
  "inLanguage": "zh",
  "datePublished": "2025-01-25T15:37:01+08:00",
  "dateModified": "2025-01-25T15:37:01+08:00",
  "author":{
    "@type": "Person",
    "name": "ShowGuan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kennems.github.io/posts/tech/go-1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kennem's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kennems.github.io/img/sun.png"
    }
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kennems.github.io/" accesskey="h" title="Kennem&#39;s Blog (Alt + H)">
                <img src="https://kennems.github.io/img/sun.png" alt="" aria-label="logo"
                    height="35">Kennem&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://kennems.github.io/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/archives" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/categories" title="🗂️分类">
                    <span>🗂️分类</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://kennems.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://kennems.github.io/posts/">📚文章</a>&nbsp;»&nbsp;<a href="https://kennems.github.io/posts/tech/">💻技术</a></div>
    <h1 class="post-title entry-hint-parent">
      Go语言基础
    </h1>
    <div class="post-description">
      Go语言基础
    </div>
    <div class="post-meta"><span title='2025-01-25 15:37:01 +0800 CST'>2025-01-25</span>&nbsp;·&nbsp;9 分钟&nbsp;·&nbsp;4135 字&nbsp;·&nbsp;updated:&nbsp;2025-01-25&nbsp;·&nbsp;ShowGuan

</div>
    
     <div class="post-password">
        
    </div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#go%e8%af%ad%e8%a8%80%e5%9f%ba%e7%a1%80" aria-label="Go语言基础">Go语言基础</a><ul>
                            
                    <li>
                        <a href="#1-go%e8%af%ad%e8%a8%80%e6%a6%82%e8%bf%b0" aria-label="1. Go语言概述">1. Go语言概述</a></li>
                    <li>
                        <a href="#2-%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" aria-label="2. 环境搭建">2. 环境搭建</a><ul>
                            
                    <li>
                        <a href="#go-module" aria-label="Go Module">Go Module</a></li>
                    <li>
                        <a href="#%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%b7%a5%e5%85%b7" aria-label="命令行工具">命令行工具</a></li>
                    <li>
                        <a href="#1go-run" aria-label="1、go run">1、<code>go run</code></a></li>
                    <li>
                        <a href="#2go-build" aria-label="2、go build">2、<code>go build</code></a><ul>
                            
                    <li>
                        <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6%e5%90%8d" aria-label="自定义可执行文件名">自定义可执行文件名</a></li>
                    <li>
                        <a href="#%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%8c%85" aria-label="构建一个包">构建一个包</a></li></ul>
                    </li>
                    <li>
                        <a href="#3go-install" aria-label="3、go install">3、<code>go install</code></a><ul>
                            
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b" aria-label="示例：">示例：</a></li></ul>
                    </li>
                    <li>
                        <a href="#4go-test" aria-label="4、go test">4、<code>go test</code></a><ul>
                            
                    <li>
                        <a href="#%e6%9f%a5%e7%9c%8b%e6%b5%8b%e8%af%95%e8%af%a6%e7%bb%86%e8%be%93%e5%87%ba" aria-label="查看测试详细输出：">查看测试详细输出：</a></li>
                    <li>
                        <a href="#%e8%bf%90%e8%a1%8c%e7%89%b9%e5%ae%9a%e7%9a%84%e6%b5%8b%e8%af%95%e5%87%bd%e6%95%b0" aria-label="运行特定的测试函数：">运行特定的测试函数：</a></li></ul>
                    </li>
                    <li>
                        <a href="#5go-get" aria-label="5、go get">5、<code>go get</code></a><ul>
                            
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b-1" aria-label="示例：">示例：</a></li>
                    <li>
                        <a href="#%e8%8e%b7%e5%8f%96%e6%9c%80%e6%96%b0%e7%89%88%e6%9c%ac" aria-label="获取最新版本：">获取最新版本：</a></li></ul>
                    </li>
                    <li>
                        <a href="#6go-mod" aria-label="6、go mod">6、<code>go mod</code></a><ul>
                            
                    <li>
                        <a href="#61-go-mod-init" aria-label="6.1 go mod init">6.1 <code>go mod init</code></a></li>
                    <li>
                        <a href="#62-go-mod-tidy" aria-label="6.2 go mod tidy">6.2 <code>go mod tidy</code></a></li>
                    <li>
                        <a href="#63-go-mod-vendor" aria-label="6.3 go mod vendor">6.3 <code>go mod vendor</code></a></li></ul>
                    </li>
                    <li>
                        <a href="#7go-fmt-%e4%b8%8e%e4%bb%a3%e7%a0%81%e6%a0%bc%e5%bc%8f%e5%8c%96" aria-label="7、go fmt 与代码格式化">7、<code>go fmt</code> 与代码格式化</a><ul>
                            
                    <li>
                        <a href="#%e5%9f%ba%e6%9c%ac%e8%af%ad%e6%b3%95" aria-label="基本语法：">基本语法：</a></li>
                    <li>
                        <a href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e6%95%b4%e4%b8%aa%e5%8c%85" aria-label="格式化整个包：">格式化整个包：</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#3-go%e5%9f%ba%e7%a1%80%e8%af%ad%e6%b3%95" aria-label="3. Go基础语法">3. Go基础语法</a><ul>
                            
                    <li>
                        <a href="#31-hello-world" aria-label="3.1 Hello World">3.1 Hello World</a></li>
                    <li>
                        <a href="#32-%e5%8f%98%e9%87%8f%e5%a3%b0%e6%98%8e%e4%b8%8e%e5%88%9d%e5%a7%8b%e5%8c%96" aria-label="3.2 变量声明与初始化">3.2 变量声明与初始化</a><ul>
                            
                    <li>
                        <a href="#321-%e5%b8%b8%e8%a7%84%e5%a3%b0%e6%98%8e" aria-label="3.2.1 常规声明">3.2.1 常规声明</a></li>
                    <li>
                        <a href="#322-%e4%bd%bf%e7%94%a8%e7%ae%80%e6%b4%81%e5%a3%b0%e6%98%8e" aria-label="3.2.2 使用:=简洁声明">3.2.2 使用<code>:=</code>简洁声明</a></li>
                    <li>
                        <a href="#323-%e7%a9%ba%e7%99%bd%e6%a0%87%e8%af%86%e7%ac%a6" aria-label="3.2.3 空白标识符">3.2.3 空白标识符</a></li></ul>
                    </li>
                    <li>
                        <a href="#33-%e6%8e%a7%e5%88%b6%e7%bb%93%e6%9e%84" aria-label="3.3 控制结构">3.3 控制结构</a><ul>
                            
                    <li>
                        <a href="#331-if-else%e8%af%ad%e5%8f%a5" aria-label="3.3.1 if-else语句">3.3.1 if-else语句</a></li>
                    <li>
                        <a href="#332-switch%e8%af%ad%e5%8f%a5" aria-label="3.3.2 switch语句">3.3.2 switch语句</a></li>
                    <li>
                        <a href="#333-for%e5%be%aa%e7%8e%af" aria-label="3.3.3 for循环">3.3.3 for循环</a></li></ul>
                    </li>
                    <li>
                        <a href="#34-%e6%95%b0%e7%bb%84%e4%b8%8e%e5%88%87%e7%89%87" aria-label="3.4 数组与切片">3.4 数组与切片</a><ul>
                            
                    <li>
                        <a href="#341-%e6%95%b0%e7%bb%84" aria-label="3.4.1 数组">3.4.1 数组</a></li>
                    <li>
                        <a href="#342-%e5%88%87%e7%89%87" aria-label="3.4.2 切片">3.4.2 切片</a></li>
                    <li>
                        <a href="#343-%e5%88%87%e7%89%87%e7%9a%84%e5%88%9b%e5%bb%ba" aria-label="3.4.3 切片的创建">3.4.3 切片的创建</a></li></ul>
                    </li>
                    <li>
                        <a href="#35-%e5%87%bd%e6%95%b0" aria-label="3.5 函数">3.5 函数</a><ul>
                            
                    <li>
                        <a href="#351-%e5%9f%ba%e6%9c%ac%e5%87%bd%e6%95%b0" aria-label="3.5.1 基本函数">3.5.1 基本函数</a></li>
                    <li>
                        <a href="#352-%e5%a4%9a%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="3.5.2 多返回值">3.5.2 多返回值</a></li>
                    <li>
                        <a href="#353-%e5%8f%af%e5%8f%98%e5%8f%82%e6%95%b0" aria-label="3.5.3 可变参数">3.5.3 可变参数</a></li></ul>
                    </li>
                    <li>
                        <a href="#36-%e7%bb%93%e6%9e%84%e4%bd%93%e4%b8%8e%e6%96%b9%e6%b3%95" aria-label="3.6 结构体与方法">3.6 结构体与方法</a><ul>
                            
                    <li>
                        <a href="#361-%e7%bb%93%e6%9e%84%e4%bd%93" aria-label="3.6.1 结构体">3.6.1 结构体</a></li>
                    <li>
                        <a href="#362-%e6%96%b9%e6%b3%95" aria-label="3.6.2 方法">3.6.2 方法</a></li></ul>
                    </li>
                    <li>
                        <a href="#37-%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="3.7 错误处理">3.7 错误处理</a></li>
                    <li>
                        <a href="#38-%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%93%8d%e4%bd%9c" aria-label="3.8 字符串操作">3.8 字符串操作</a><ul>
                            
                    <li>
                        <a href="#381-%e5%b8%b8%e7%94%a8%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0" aria-label="3.8.1 常用字符串函数">3.8.1 常用字符串函数</a></li></ul>
                    </li>
                    <li>
                        <a href="#39-json%e5%a4%84%e7%90%86" aria-label="3.9 JSON处理">3.9 JSON处理</a><ul>
                            
                    <li>
                        <a href="#391-%e7%bc%96%e7%a0%81%e4%b8%8e%e8%a7%a3%e7%a0%81" aria-label="3.9.1 编码与解码">3.9.1 编码与解码</a></li></ul>
                    </li>
                    <li>
                        <a href="#310-%e6%97%b6%e9%97%b4%e4%b8%8e%e6%95%b0%e5%ad%97%e8%a7%a3%e6%9e%90" aria-label="3.10 时间与数字解析">3.10 时间与数字解析</a><ul>
                            
                    <li>
                        <a href="#3101-%e6%97%b6%e9%97%b4%e6%93%8d%e4%bd%9c" aria-label="3.10.1 时间操作">3.10.1 时间操作</a></li>
                    <li>
                        <a href="#3102-%e5%ad%97%e7%ac%a6%e4%b8%b2%e8%bd%ac%e6%95%b0%e5%ad%97" aria-label="3.10.2 字符串转数字">3.10.2 字符串转数字</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#4-go%e5%b7%a5%e7%a8%8b%e5%ae%9e%e8%b7%b5" aria-label="4. Go工程实践">4. Go工程实践</a><ul>
                            
                    <li>
                        <a href="#41-%e7%8c%9c%e6%95%b0%e5%ad%97%e6%b8%b8%e6%88%8f" aria-label="4.1 猜数字游戏">4.1 猜数字游戏</a></li>
                    <li>
                        <a href="#42-%e5%9c%a8%e7%ba%bf%e8%af%8d%e5%85%b8" aria-label="4.2 在线词典">4.2 在线词典</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#socks5-%e4%bb%a3%e7%90%86%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" aria-label="SOCKS5 代理服务器代码实现">SOCKS5 代理服务器代码实现</a><ul>
                            
                    <li>
                        <a href="#1-socks5-%e5%8d%8f%e8%ae%ae%e6%a6%82%e8%bf%b0" aria-label="1. SOCKS5 协议概述">1. SOCKS5 协议概述</a><ul>
                            
                    <li>
                        <a href="#11-socks5-%e4%bb%a3%e7%90%86%e5%8e%9f%e7%90%86" aria-label="1.1 SOCKS5 代理原理">1.1 SOCKS5 代理原理</a></li></ul>
                    </li>
                    <li>
                        <a href="#2-tcp-echo-%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="2. TCP Echo 服务器">2. TCP Echo 服务器</a><ul>
                            
                    <li>
                        <a href="#21-tcp-echo-%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bb%a3%e7%a0%81" aria-label="2.1 TCP Echo 服务器代码">2.1 TCP Echo 服务器代码</a></li>
                    <li>
                        <a href="#22-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="2.2 代码说明：">2.2 代码说明：</a></li>
                    <li>
                        <a href="#23-%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95" aria-label="2.3 测试方法：">2.3 测试方法：</a></li></ul>
                    </li>
                    <li>
                        <a href="#3-socks5-%e4%bb%a3%e7%90%86%e8%ae%a4%e8%af%81%e5%ae%9e%e7%8e%b0" aria-label="3. SOCKS5 代理认证实现">3. SOCKS5 代理认证实现</a><ul>
                            
                    <li>
                        <a href="#31-%e5%ae%9a%e4%b9%89%e5%b8%b8%e9%87%8f" aria-label="3.1 定义常量">3.1 定义常量</a></li>
                    <li>
                        <a href="#32-%e8%ae%a4%e8%af%81%e5%87%bd%e6%95%b0" aria-label="3.2 认证函数">3.2 认证函数</a></li>
                    <li>
                        <a href="#33-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="3.3 代码说明：">3.3 代码说明：</a></li></ul>
                    </li>
                    <li>
                        <a href="#4-socks5-%e8%af%b7%e6%b1%82%e9%98%b6%e6%ae%b5" aria-label="4. SOCKS5 请求阶段">4. SOCKS5 请求阶段</a><ul>
                            
                    <li>
                        <a href="#41-%e8%bf%9e%e6%8e%a5%e8%af%b7%e6%b1%82%e8%a7%a3%e6%9e%90" aria-label="4.1 连接请求解析">4.1 连接请求解析</a></li>
                    <li>
                        <a href="#42-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="4.2 代码说明：">4.2 代码说明：</a></li></ul>
                    </li>
                    <li>
                        <a href="#5-socks5-%e4%b8%ad%e7%bb%a7%e9%98%b6%e6%ae%b5" aria-label="5. SOCKS5 中继阶段">5. SOCKS5 中继阶段</a><ul>
                            
                    <li>
                        <a href="#51-%e6%95%b0%e6%8d%ae%e8%bd%ac%e5%8f%91" aria-label="5.1 数据转发">5.1 数据转发</a></li>
                    <li>
                        <a href="#52-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="5.2 代码说明：">5.2 代码说明：</a></li></ul>
                    </li>
                    <li>
                        <a href="#6-%e6%9c%80%e7%bb%88%e6%b5%8b%e8%af%95" aria-label="6. 最终测试">6. 最终测试</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="go语言基础">Go语言基础<a hidden class="anchor" aria-hidden="true" href="#go语言基础">#</a></h1>
<h2 id="1-go语言概述">1. Go语言概述<a hidden class="anchor" aria-hidden="true" href="#1-go语言概述">#</a></h2>
<ul>
<li><strong>高性能</strong>：适合并发编程，支持高并发、高性能场景。</li>
<li><strong>简洁语法</strong>：Go的语法简洁，快速上手，去除了复杂的面向对象特性，保留了函数式编程的一些优势。</li>
<li><strong>丰富标准库</strong>：内建强大的标准库，支持网络、文件操作、并发等。</li>
<li><strong>静态链接</strong>：生成独立的可执行文件，无需依赖外部库，简化部署。</li>
<li><strong>跨平台</strong>：支持Linux、Windows、macOS等多个平台。</li>
<li><strong>垃圾回收</strong>：自动管理内存，减少开发人员的负担。</li>
</ul>
<h2 id="2-环境搭建">2. 环境搭建<a hidden class="anchor" aria-hidden="true" href="#2-环境搭建">#</a></h2>
<ul>
<li><strong>Go安装</strong>：<a href="https://golang.org/doc/install">官方安装指南</a></li>
<li><strong>推荐IDE</strong>：VSCode、GoLand，或者Gitpod等云开发环境。</li>
</ul>
<h3 id="go-module">Go Module<a hidden class="anchor" aria-hidden="true" href="#go-module">#</a></h3>
<p><strong><code>go.mod</code></strong>：用于管理 Go 项目的依赖，记录模块路径、Go 版本和所依赖的包及其版本。</p>
<p><strong><code>go.sum</code></strong>：用于记录每个依赖包的校验和，确保依赖包的完整性与安全性。</p>
<h3 id="命令行工具">命令行工具<a hidden class="anchor" aria-hidden="true" href="#命令行工具">#</a></h3>
<h3 id="1go-run">1、<code>go run</code><a hidden class="anchor" aria-hidden="true" href="#1go-run">#</a></h3>
<p>无需生成二进制文件，适合用于快速测试和调试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run &lt;filename.go&gt; <span style="color:#f92672">[</span>arguments<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>可以传递多个文件名来运行多个Go源文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run file1.go file2.go
</span></span></code></pre></div><h3 id="2go-build">2、<code>go build</code><a hidden class="anchor" aria-hidden="true" href="#2go-build">#</a></h3>
<p>编译代码生成二进制文件的工具，编译原代码并生成可执行文件，可以在没有Go环境的机器上运行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build &lt;filename.go&gt;
</span></span></code></pre></div><h4 id="自定义可执行文件名">自定义可执行文件名<a hidden class="anchor" aria-hidden="true" href="#自定义可执行文件名">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build -o myapp main.go
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build file1.go file2.go
</span></span></code></pre></div><h4 id="构建一个包">构建一个包<a hidden class="anchor" aria-hidden="true" href="#构建一个包">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build
</span></span></code></pre></div><h3 id="3go-install">3、<code>go install</code><a hidden class="anchor" aria-hidden="true" href="#3go-install">#</a></h3>
<p>与 <code>go build</code> 类似，区别在于 <code>go install</code> 会将生成的二进制文件安装到Go的<code>GOPATH</code>下（或者模块模式下会安装到<code>GOBIN</code>)。它通常用于将编译后的工具或应用程序安装到系统中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go install &lt;package&gt;
</span></span></code></pre></div><h4 id="示例">示例：<a hidden class="anchor" aria-hidden="true" href="#示例">#</a></h4>
<p>你可以使用 <code>go install</code> 安装一个命令行工具：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go install github.com/spf13/cobra@latest
</span></span></code></pre></div><p>会将 <code>cobra</code> 安装到你的 <code>GOBIN</code> 目录下，方便你在命令行中使用。</p>
<h3 id="4go-test">4、<code>go test</code><a hidden class="anchor" aria-hidden="true" href="#4go-test">#</a></h3>
<p><code>go test</code> 是 Go 提供的测试工具，可以自动化运行Go的单元测试。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test &lt;package&gt;
</span></span></code></pre></div><p>假设你有一个测试文件 <code>main_test.go</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>package main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import <span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func TestAdd<span style="color:#f92672">(</span>t *testing.T<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    result :<span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> + <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> result !<span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        t.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;期望 3，实际是 %d&#34;</span>, result<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>你可以运行 <code>go test</code> 来运行这个测试：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test
</span></span></code></pre></div><h4 id="查看测试详细输出">查看测试详细输出：<a hidden class="anchor" aria-hidden="true" href="#查看测试详细输出">#</a></h4>
<p>默认情况下，<code>go test</code> 会隐藏详细输出。如果你想查看详细信息，可以使用 <code>-v</code> 参数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test -v
</span></span></code></pre></div><h4 id="运行特定的测试函数">运行特定的测试函数：<a hidden class="anchor" aria-hidden="true" href="#运行特定的测试函数">#</a></h4>
<p>如果你只想运行特定的测试函数，可以使用 <code>-run</code> 参数：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test -run TestAdd
</span></span></code></pre></div><h3 id="5go-get">5、<code>go get</code><a hidden class="anchor" aria-hidden="true" href="#5go-get">#</a></h3>
<p><code>go get</code> 用于安装和更新 Go 包。如果你需要下载第三方库或者工具，可以使用 <code>go get</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get &lt;package&gt;
</span></span></code></pre></div><h4 id="示例-1">示例：<a hidden class="anchor" aria-hidden="true" href="#示例-1">#</a></h4>
<p>下载并安装一个包：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/spf13/cobra
</span></span></code></pre></div><p>如果你在模块模式下，<code>go get</code> 会自动更新 <code>go.mod</code> 文件。</p>
<h4 id="获取最新版本">获取最新版本：<a hidden class="anchor" aria-hidden="true" href="#获取最新版本">#</a></h4>
<p>默认情况下，<code>go get</code> 会下载最新的稳定版本。如果你需要获取一个特定的版本，可以使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/spf13/cobra@v1.2.3
</span></span></code></pre></div><h3 id="6go-mod">6、<code>go mod</code><a hidden class="anchor" aria-hidden="true" href="#6go-mod">#</a></h3>
<p>Go 1.11 以后引入了模块化（Module）系统，<code>go mod</code> 是 Go 语言中用于管理依赖的工具。以下是常见的 <code>go mod</code> 命令：</p>
<h4 id="61-go-mod-init">6.1 <code>go mod init</code><a hidden class="anchor" aria-hidden="true" href="#61-go-mod-init">#</a></h4>
<p>初始化一个新的 Go 模块，在当前目录创建 <code>go.mod</code> 文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go mod init &lt;module-name&gt;
</span></span></code></pre></div><h4 id="62-go-mod-tidy">6.2 <code>go mod tidy</code><a hidden class="anchor" aria-hidden="true" href="#62-go-mod-tidy">#</a></h4>
<p>清理模块文件，删除未使用的依赖，并且确保所有需要的依赖都在 <code>go.mod</code> 和 <code>go.sum</code> 文件中：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go mod tidy
</span></span></code></pre></div><h4 id="63-go-mod-vendor">6.3 <code>go mod vendor</code><a hidden class="anchor" aria-hidden="true" href="#63-go-mod-vendor">#</a></h4>
<p>将所有依赖复制到本地 <code>vendor</code> 目录中，这对于某些需要离线构建的情况很有用：</p>
<pre tabindex="0"><code>go mod vendor
</code></pre><h3 id="7go-fmt-与代码格式化">7、<code>go fmt</code> 与代码格式化<a hidden class="anchor" aria-hidden="true" href="#7go-fmt-与代码格式化">#</a></h3>
<p><code>go fmt</code> 是 Go 的代码格式化工具，它可以自动调整 Go 源代码的格式，使其符合 Go 的代码风格。通常在提交代码前运行，以保持代码风格一致。</p>
<h4 id="基本语法">基本语法：<a hidden class="anchor" aria-hidden="true" href="#基本语法">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go fmt &lt;filename.go&gt;
</span></span></code></pre></div><h4 id="格式化整个包">格式化整个包：<a hidden class="anchor" aria-hidden="true" href="#格式化整个包">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go fmt ./...
</span></span></code></pre></div><h2 id="3-go基础语法">3. Go基础语法<a hidden class="anchor" aria-hidden="true" href="#3-go基础语法">#</a></h2>
<h3 id="31-hello-world">3.1 Hello World<a hidden class="anchor" aria-hidden="true" href="#31-hello-world">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span> <span style="color:#75715e">// 定义包名，main包是Go程序的入口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span> <span style="color:#75715e">// 引入fmt包，用于格式化输入输出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// main函数是Go程序的入口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>) <span style="color:#75715e">// 输出Hello, World!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="32-变量声明与初始化">3.2 变量声明与初始化<a hidden class="anchor" aria-hidden="true" href="#32-变量声明与初始化">#</a></h3>
<h4 id="321-常规声明">3.2.1 常规声明<a hidden class="anchor" aria-hidden="true" href="#321-常规声明">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> = <span style="color:#e6db74">&#34;initial&#34;</span> <span style="color:#75715e">// 声明变量a，并初始化为&#34;initial&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span> <span style="color:#75715e">// 同时声明b和c并初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> = <span style="color:#66d9ef">true</span> <span style="color:#75715e">// 自动推断d的类型为bool
</span></span></span></code></pre></div><h4 id="322-使用简洁声明">3.2.2 使用<code>:=</code>简洁声明<a hidden class="anchor" aria-hidden="true" href="#322-使用简洁声明">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">3.14</span> <span style="color:#75715e">// :=用于声明并初始化变量，类型由编译器推断
</span></span></span></code></pre></div><h4 id="323-空白标识符">3.2.3 空白标识符<a hidden class="anchor" aria-hidden="true" href="#323-空白标识符">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;file.txt&#34;</span>) <span style="color:#75715e">// 通过空白标识符忽略某个返回值
</span></span></span></code></pre></div><h3 id="33-控制结构">3.3 控制结构<a hidden class="anchor" aria-hidden="true" href="#33-控制结构">#</a></h3>
<h4 id="331-if-else语句">3.3.1 if-else语句<a hidden class="anchor" aria-hidden="true" href="#331-if-else语句">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">num</span> &lt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;is negative&#34;</span>) <span style="color:#75715e">// 如果num小于0，输出负数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">num</span> &lt; <span style="color:#ae81ff">10</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;has 1 digit&#34;</span>) <span style="color:#75715e">// 如果num小于10，输出1位数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;has multiple digits&#34;</span>) <span style="color:#75715e">// 否则输出多位数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h4 id="332-switch语句">3.3.2 switch语句<a hidden class="anchor" aria-hidden="true" href="#332-switch语句">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">day</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;Monday&#34;</span>; <span style="color:#a6e22e">day</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Monday&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Start of the week&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Friday&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;End of the week&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Midweek&#34;</span>) <span style="color:#75715e">// 默认情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h4 id="333-for循环">3.3.3 for循环<a hidden class="anchor" aria-hidden="true" href="#333-for循环">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Go只有一个循环结构for，其他的如while都可以通过for实现
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">3</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> { <span style="color:#75715e">// 从0到2的循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">i</span>) <span style="color:#75715e">// 输出循环的每个值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="34-数组与切片">3.4 数组与切片<a hidden class="anchor" aria-hidden="true" href="#34-数组与切片">#</a></h3>
<h4 id="341-数组">3.4.1 数组<a hidden class="anchor" aria-hidden="true" href="#341-数组">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">arr</span> [<span style="color:#ae81ff">5</span>]<span style="color:#66d9ef">int</span> <span style="color:#75715e">// 定义一个固定长度为5的数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">10</span>    <span style="color:#75715e">// 给数组第一个元素赋值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">arr</span>) <span style="color:#75715e">// 输出整个数组
</span></span></span></code></pre></div><h4 id="342-切片">3.4.2 切片<a hidden class="anchor" aria-hidden="true" href="#342-切片">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 切片是Go的一个灵活数据结构，不像数组大小固定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s</span> = append(<span style="color:#a6e22e">s</span>, <span style="color:#e6db74">&#34;d&#34;</span>) <span style="color:#75715e">// append函数动态扩展切片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>) <span style="color:#75715e">// 输出切片
</span></span></span></code></pre></div><h4 id="343-切片的创建">3.4.3 切片的创建<a hidden class="anchor" aria-hidden="true" href="#343-切片的创建">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">5</span>) <span style="color:#75715e">// 创建一个长度为5的切片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>) <span style="color:#75715e">// 输出: [0 0 0 0 0]
</span></span></span></code></pre></div><h3 id="35-函数">3.5 函数<a hidden class="anchor" aria-hidden="true" href="#35-函数">#</a></h3>
<h4 id="351-基本函数">3.5.1 基本函数<a hidden class="anchor" aria-hidden="true" href="#351-基本函数">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">a</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> { <span style="color:#75715e">// 函数声明，返回a+b的结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#75715e">// 调用函数并打印返回值
</span></span></span></code></pre></div><h4 id="352-多返回值">3.5.2 多返回值<a hidden class="anchor" aria-hidden="true" href="#352-多返回值">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">divide</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) (<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">a</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">b</span> <span style="color:#75715e">// 返回商和余数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">quotient</span>, <span style="color:#a6e22e">remainder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">divide</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">3</span>) <span style="color:#75715e">// 解构返回值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">quotient</span>, <span style="color:#a6e22e">remainder</span>)
</span></span></code></pre></div><h4 id="353-可变参数">3.5.3 可变参数<a hidden class="anchor" aria-hidden="true" href="#353-可变参数">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">nums</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> { <span style="color:#75715e">// nums是一个整数切片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nums</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">num</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">total</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">sum</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>)) <span style="color:#75715e">// 传入多个参数
</span></span></span></code></pre></div><h3 id="36-结构体与方法">3.6 结构体与方法<a hidden class="anchor" aria-hidden="true" href="#36-结构体与方法">#</a></h3>
<h4 id="361-结构体">3.6.1 结构体<a hidden class="anchor" aria-hidden="true" href="#361-结构体">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#e6db74">&#34;password123&#34;</span>} <span style="color:#75715e">// 初始化结构体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>)
</span></span></code></pre></div><h4 id="362-方法">3.6.2 方法<a hidden class="anchor" aria-hidden="true" href="#362-方法">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 为User类型定义一个方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">ResetPassword</span>(<span style="color:#a6e22e">password</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Password</span> = <span style="color:#a6e22e">password</span> <span style="color:#75715e">// 修改结构体实例的字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">ResetPassword</span>(<span style="color:#e6db74">&#34;newpassword&#34;</span>) <span style="color:#75715e">// 调用方法修改Password字段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Password</span>)
</span></span></code></pre></div><h3 id="37-错误处理">3.7 错误处理<a hidden class="anchor" aria-hidden="true" href="#37-错误处理">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">findUser</span>(<span style="color:#a6e22e">users</span> []<span style="color:#a6e22e">User</span>, <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">u</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">users</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">name</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">u</span>, <span style="color:#66d9ef">nil</span> <span style="color:#75715e">// 找到用户，返回指针和nil错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;user not found&#34;</span>) <span style="color:#75715e">// 没找到，返回错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">findUser</span>([]<span style="color:#a6e22e">User</span>{{<span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#e6db74">&#34;1024&#34;</span>}}, <span style="color:#e6db74">&#34;wang&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>) <span style="color:#75715e">// 打印错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Name</span>) <span style="color:#75715e">// 如果没有错误，打印用户信息
</span></span></span></code></pre></div><h3 id="38-字符串操作">3.8 字符串操作<a hidden class="anchor" aria-hidden="true" href="#38-字符串操作">#</a></h3>
<h4 id="381-常用字符串函数">3.8.1 常用字符串函数<a hidden class="anchor" aria-hidden="true" href="#381-常用字符串函数">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;Hello, World!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#34;World&#34;</span>)) <span style="color:#75715e">// 检查字符串是否包含&#34;World&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">ToUpper</span>(<span style="color:#a6e22e">str</span>)) <span style="color:#75715e">// 将字符串转换为大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#34;, &#34;</span>)) <span style="color:#75715e">// 按指定分隔符切割字符串
</span></span></span></code></pre></div><h3 id="39-json处理">3.9 JSON处理<a hidden class="anchor" aria-hidden="true" href="#39-json处理">#</a></h3>
<h4 id="391-编码与解码">3.9.1 编码与解码<a hidden class="anchor" aria-hidden="true" href="#391-编码与解码">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UserInfo</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>    <span style="color:#e6db74">`json:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">UserInfo</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">buf</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">a</span>) <span style="color:#75715e">// 将结构体编码为JSON
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error encoding JSON:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(string(<span style="color:#a6e22e">buf</span>)) <span style="color:#75715e">// 输出JSON字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#a6e22e">UserInfo</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">buf</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">b</span>) <span style="color:#75715e">// 将JSON字符串解码为结构体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error decoding JSON:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)
</span></span></code></pre></div><h3 id="310-时间与数字解析">3.10 时间与数字解析<a hidden class="anchor" aria-hidden="true" href="#310-时间与数字解析">#</a></h3>
<h4 id="3101-时间操作">3.10.1 时间操作<a hidden class="anchor" aria-hidden="true" href="#3101-时间操作">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>() <span style="color:#75715e">// 获取当前时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>)) <span style="color:#75715e">// 格式化时间
</span></span></span></code></pre></div><h4 id="3102-字符串转数字">3.10.2 字符串转数字<a hidden class="anchor" aria-hidden="true" href="#3102-字符串转数字">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;strconv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">str</span>) <span style="color:#75715e">// 将字符串转为整数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error converting string to number:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">n</span>) <span style="color:#75715e">// 输出123
</span></span></span></code></pre></div><h2 id="4-go工程实践">4. Go工程实践<a hidden class="anchor" aria-hidden="true" href="#4-go工程实践">#</a></h2>
<h3 id="41-猜数字游戏">4.1 猜数字游戏<a hidden class="anchor" aria-hidden="true" href="#41-猜数字游戏">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>()) <span style="color:#75715e">// 使用时间戳作为随机数种子
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">secretNumber</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">100</span>)  <span style="color:#75715e">// 生成一个0到99之间的随机数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Guess the secret number between 0 and 100!&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">guess</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#e6db74">&#34;Enter your guess: &#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">guess</span>) <span style="color:#75715e">// 读取用户输入的猜测值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">guess</span> &lt; <span style="color:#a6e22e">secretNumber</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Too low!&#34;</span>)
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">guess</span> &gt; <span style="color:#a6e22e">secretNumber</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Too high!&#34;</span>)
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;You guessed it!&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="42-在线词典">4.2 在线词典<a hidden class="anchor" aria-hidden="true" href="#42-在线词典">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">getDefinition</span>(<span style="color:#a6e22e">word</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">url</span> <span style="color:#f92672">:=</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">https</span>:<span style="color:#75715e">//api.dictionaryapi.dev
</span></span></span></code></pre></div><p>好的，以下是我为你准备的关于 <strong>SOCKS5 代理服务器</strong> 的 Go 语言代码的详细注释版，力求保持代码的完整性并加上详细的解释。</p>
<hr>
<h1 id="socks5-代理服务器代码实现">SOCKS5 代理服务器代码实现<a hidden class="anchor" aria-hidden="true" href="#socks5-代理服务器代码实现">#</a></h1>
<h2 id="1-socks5-协议概述">1. SOCKS5 协议概述<a hidden class="anchor" aria-hidden="true" href="#1-socks5-协议概述">#</a></h2>
<h3 id="11-socks5-代理原理">1.1 SOCKS5 代理原理<a hidden class="anchor" aria-hidden="true" href="#11-socks5-代理原理">#</a></h3>
<p>SOCKS5 是一种代理协议，在网络中充当客户端与目标服务器之间的中介，允许客户端通过代理服务器访问远程资源，通常用于规避防火墙、提高安全性等。</p>
<p><strong>代理流程分为四个阶段：</strong></p>
<ol>
<li><strong>握手阶段</strong>：客户端向 SOCKS5 代理发送协议版本号及认证方式。</li>
<li><strong>认证阶段</strong>：根据代理服务器的返回，进行相应的身份验证。</li>
<li><strong>请求阶段</strong>：认证通过后，客户端向 SOCKS5 代理发送请求，要求建立与目标服务器的连接。</li>
<li><strong>中继阶段</strong>：代理服务器转发客户端请求和目标服务器的响应，完成数据传输。</li>
</ol>
<hr>
<h2 id="2-tcp-echo-服务器">2. TCP Echo 服务器<a hidden class="anchor" aria-hidden="true" href="#2-tcp-echo-服务器">#</a></h2>
<p>首先，我们需要实现一个简单的 TCP Echo 服务器，处理从客户端发送的数据，并返回相同的数据。</p>
<h3 id="21-tcp-echo-服务器代码">2.1 TCP Echo 服务器代码<a hidden class="anchor" aria-hidden="true" href="#21-tcp-echo-服务器代码">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bufio&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">server</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;127.0.0.1:1080&#34;</span>) <span style="color:#75715e">// 监听本地1080端口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        panic(<span style="color:#a6e22e">err</span>) <span style="color:#75715e">// 如果监听失败，则程序崩溃
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Accept</span>() <span style="color:#75715e">// 接受来自客户端的连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Accept failed %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">client</span>) <span style="color:#75715e">// 启动一个新的goroutine处理该连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 处理连接的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()  <span style="color:#75715e">// 函数退出时关闭连接，避免资源泄漏
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">conn</span>) <span style="color:#75715e">// 创建一个缓冲读取器，优化性能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>() <span style="color:#75715e">// 读取单个字节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span> <span style="color:#75715e">// 如果读取错误，则退出循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">b</span>}) <span style="color:#75715e">// 将字节写回客户端
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span> <span style="color:#75715e">// 如果写入错误，则退出循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="22-代码说明">2.2 代码说明：<a hidden class="anchor" aria-hidden="true" href="#22-代码说明">#</a></h3>
<ul>
<li><strong>net.Listen</strong>：在本地创建一个监听指定端口的服务器（这里是 <code>127.0.0.1:1080</code>）。</li>
<li><strong>Accept</strong>：接受客户端连接请求并返回一个连接对象。</li>
<li><strong>process</strong>：启动一个新的 goroutine 来处理客户端的请求。<code>bufio.NewReader</code> 用于提高从网络连接读取数据的效率。</li>
<li><strong>conn.Write</strong>：将客户端输入的字节数据发送回去，形成“echo”响应。</li>
</ul>
<h3 id="23-测试方法">2.3 测试方法：<a hidden class="anchor" aria-hidden="true" href="#23-测试方法">#</a></h3>
<p>可以使用 <code>nc</code>（netcat）工具来测试：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc 127.0.0.1 <span style="color:#ae81ff">1080</span>
</span></span></code></pre></div><p>在终端中输入任意字符，TCP Echo 服务器将返回相同的字符。</p>
<hr>
<h2 id="3-socks5-代理认证实现">3. SOCKS5 代理认证实现<a hidden class="anchor" aria-hidden="true" href="#3-socks5-代理认证实现">#</a></h2>
<h3 id="31-定义常量">3.1 定义常量<a hidden class="anchor" aria-hidden="true" href="#31-定义常量">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">socks5Ver</span> = <span style="color:#ae81ff">0x05</span> <span style="color:#75715e">// SOCKS5 协议版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cmdBind</span> = <span style="color:#ae81ff">0x01</span>   <span style="color:#75715e">// 绑定命令
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">atypIPV4</span> = <span style="color:#ae81ff">0x01</span>  <span style="color:#75715e">// IPv4 地址类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">atypeHOST</span> = <span style="color:#ae81ff">0x03</span> <span style="color:#75715e">// 主机名类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">atypeIPV6</span> = <span style="color:#ae81ff">0x04</span> <span style="color:#75715e">// IPv6 地址类型
</span></span></span></code></pre></div><h3 id="32-认证函数">3.2 认证函数<a hidden class="anchor" aria-hidden="true" href="#32-认证函数">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">auth</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取 SOCKS5 协议版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ver</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read ver failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ver</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">socks5Ver</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;not supported ver: %v&#34;</span>, <span style="color:#a6e22e">ver</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取认证方法的数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">methodSize</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read methodSize failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取所有认证方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">method</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">methodSize</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">method</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read method failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 打印协议版本与认证方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Panicln</span>(<span style="color:#e6db74">&#34;ver&#34;</span>, <span style="color:#a6e22e">ver</span>, <span style="color:#e6db74">&#34;method&#34;</span>, <span style="color:#a6e22e">method</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 返回不需要认证的响应
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">socks5Ver</span>, <span style="color:#ae81ff">0x00</span>}) <span style="color:#75715e">// 0x00 表示无需认证
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;write failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="33-代码说明">3.3 代码说明：<a hidden class="anchor" aria-hidden="true" href="#33-代码说明">#</a></h3>
<ul>
<li><strong>ReadByte</strong>：逐字节读取协议中的数据，例如版本号和认证方法的数量。</li>
<li><strong>io.ReadFull</strong>：确保将指定长度的数据完全读取。</li>
<li><strong>conn.Write</strong>：向客户端返回响应，表示认证成功。</li>
</ul>
<hr>
<h2 id="4-socks5-请求阶段">4. SOCKS5 请求阶段<a hidden class="anchor" aria-hidden="true" href="#4-socks5-请求阶段">#</a></h2>
<p>在请求阶段，代理服务器接收到客户端发来的连接请求，并解析其中的目标地址和端口信息。</p>
<h3 id="41-连接请求解析">4.1 连接请求解析<a hidden class="anchor" aria-hidden="true" href="#41-连接请求解析">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">connect</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ver</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>() <span style="color:#75715e">// 读取版本号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read ver failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cmd</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>() <span style="color:#75715e">// 读取命令类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read cmd failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rsv</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>() <span style="color:#75715e">// 保留字段，忽略
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read rsv failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">atyp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>() <span style="color:#75715e">// 地址类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read atyp failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">addr</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">atyp</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypIPV4</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readIPV4</span>(<span style="color:#a6e22e">reader</span>) <span style="color:#75715e">// 读取IPv4地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypeHOST</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readHost</span>(<span style="color:#a6e22e">reader</span>) <span style="color:#75715e">// 读取主机名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypeIPV6</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readIPV6</span>(<span style="color:#a6e22e">reader</span>) <span style="color:#75715e">// 读取IPv6地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 读取端口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">port</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">readPort</span>(<span style="color:#a6e22e">reader</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Connecting to %s:%d&#34;</span>, <span style="color:#a6e22e">addr</span>, <span style="color:#a6e22e">port</span>) <span style="color:#75715e">// 打印目标地址和端口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="42-代码说明">4.2 代码说明：<a hidden class="anchor" aria-hidden="true" href="#42-代码说明">#</a></h3>
<ul>
<li><strong>cmd</strong>：检查请求类型，SOCKS5 代理服务器通常只处理 <code>CONNECT</code> 请求。</li>
<li><strong>atyp</strong>：根据目标地址类型（IPv4、主机名、IPv6）分别处理。</li>
<li><strong>readIPV4/readHost/readIPV6/readPort</strong>：读取不同地址类型的数据。</li>
</ul>
<hr>
<h2 id="5-socks5-中继阶段">5. SOCKS5 中继阶段<a hidden class="anchor" aria-hidden="true" href="#5-socks5-中继阶段">#</a></h2>
<p>在中继阶段，代理服务器通过双向数据转发来实现代理服务，直到数据传输结束或发生错误。</p>
<h3 id="51-数据转发">5.1 数据转发<a hidden class="anchor" aria-hidden="true" href="#51-数据转发">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">relay</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#a6e22e">targetConn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">targetConn</span>, <span style="color:#a6e22e">conn</span>) <span style="color:#75715e">// 从客户端读取数据并发送到目标服务器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">targetConn</span>) <span style="color:#75715e">// 从目标服务器读取数据并发送到客户端
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Done</span>() <span style="color:#75715e">// 等待任意一个数据转发完成或发生错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="52-代码说明">5.2 代码说明：<a hidden class="anchor" aria-hidden="true" href="#52-代码说明">#</a></h3>
<ul>
<li><strong>io.Copy</strong>：标准库提供的用于数据转发的函数。</li>
<li><strong>ctx.Done()</strong>：使用 <code>context</code> 来控制数据传输的终止条件。当 <code>context</code> 被取消时，数据传输终止。</li>
</ul>
<hr>
<h2 id="6-最终测试">6. 最终测试<a hidden class="anchor" aria-hidden="true" href="#6-最终测试">#</a></h2>
<p>测试时，可以通过在浏览器中设置 SOCKS5 代理，或者使用 <code>curl</code> 命令来进行请求：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl --socks5 127.0.0.1:1080 http://example.com
</span></span></code></pre></div><p>在测试时，代理服务器将转发请求，最终浏览器或工具可以通过 SOCKS5 代理成功访问目标服务器。</p>
<hr>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kennems.github.io/tags/golang/">GoLang</a></li>
    </ul>
        
    
    <ul id="categories">
      
        <li><a href="https://kennems.github.io/categories/go">Go</a> </li>
      
    </ul>
    
    
<nav class="paginav">
  <a class="prev" href="https://kennems.github.io/posts/tech/go-4/">
    <span class="title">« 上一页</span>
    <br>
    <span>Go 内存管理与编译器优化</span>
  </a>
  <a class="next" href="https://kennems.github.io/posts/tech/leetcode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98202501/">
    <span class="title">下一页 »</span>
    <br>
    <span>LeetCode每日一题（202501）</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://kennems.github.io/">Kennem&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<footer class="footer">
    <script async src="https://busuanzi.sukap.cn/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        Visitors: <span id="busuanzi_value_page_uv"></span>
        Views: <span id="busuanzi_value_page_pv"></span>

        
    </span>
</footer>



</body>

</html>
