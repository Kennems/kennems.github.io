<!DOCTYPE html>
<html lang="zh" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<meta name="msvalidate.01" content="DF5FE493CC759E62BFE073BEA8EFD472" />
<title>Goè¯­è¨€åŸºç¡€ | Kennem&#39;s Blog</title>
<meta name="keywords" content="GoLang">
<meta name="description" content="Goè¯­è¨€åŸºç¡€">
<meta name="author" content="ShowGuan">
<link rel="canonical" href="https://kennems.github.io/posts/tech/go-1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3fd442ca7ec81a7af0b27f3b9117add72bfa97e4a27ff155b8d3426818d63f9b.css" integrity="sha256-P9RCyn7IGnrwsn87kRet1yv6l&#43;Sif/FVuNNCaBjWP5s=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kennems.github.io/img/sun.png">
<link rel="apple-touch-icon" href="https://kennems.github.io/img/sun.png">
<link rel="mask-icon" href="https://kennems.github.io/img/sun.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://kennems.github.io/posts/tech/go-1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>



<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/code-new-roman">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<meta property="og:url" content="https://kennems.github.io/posts/tech/go-1/">
  <meta property="og:site_name" content="Kennem&#39;s Blog">
  <meta property="og:title" content="Goè¯­è¨€åŸºç¡€">
  <meta property="og:description" content="Goè¯­è¨€åŸºç¡€">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-25T10:00:01+08:00">
    <meta property="article:modified_time" content="2025-11-02T10:00:01+08:00">
    <meta property="article:tag" content="GoLang">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Goè¯­è¨€åŸºç¡€">
<meta name="twitter:description" content="Goè¯­è¨€åŸºç¡€">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://kennems.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ’»æŠ€æœ¯",
      "item": "https://kennems.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Goè¯­è¨€åŸºç¡€",
      "item": "https://kennems.github.io/posts/tech/go-1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Goè¯­è¨€åŸºç¡€",
  "name": "Goè¯­è¨€åŸºç¡€",
  "description": "Goè¯­è¨€åŸºç¡€",
  "keywords": [
    "GoLang"
  ],
  "articleBody": "Goè¯­è¨€åŸºç¡€ 1. Goè¯­è¨€æ¦‚è¿° é«˜æ€§èƒ½ï¼šé€‚åˆå¹¶å‘ç¼–ç¨‹ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜æ€§èƒ½åœºæ™¯ã€‚ ç®€æ´è¯­æ³•ï¼šGoçš„è¯­æ³•ç®€æ´ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼Œå»é™¤äº†å¤æ‚çš„é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œä¿ç•™äº†å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›ä¼˜åŠ¿ã€‚ ä¸°å¯Œæ ‡å‡†åº“ï¼šå†…å»ºå¼ºå¤§çš„æ ‡å‡†åº“ï¼Œæ”¯æŒç½‘ç»œã€æ–‡ä»¶æ“ä½œã€å¹¶å‘ç­‰ã€‚ é™æ€é“¾æ¥ï¼šç”Ÿæˆç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨åº“ï¼Œç®€åŒ–éƒ¨ç½²ã€‚ è·¨å¹³å°ï¼šæ”¯æŒLinuxã€Windowsã€macOSç­‰å¤šä¸ªå¹³å°ã€‚ åƒåœ¾å›æ”¶ï¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå‡å°‘å¼€å‘äººå‘˜çš„è´Ÿæ‹…ã€‚ 2. ç¯å¢ƒæ­å»º Goå®‰è£…ï¼šå®˜æ–¹å®‰è£…æŒ‡å— æ¨èIDEï¼šVSCodeã€GoLandï¼Œæˆ–è€…Gitpodç­‰äº‘å¼€å‘ç¯å¢ƒã€‚ Go Module go.modï¼šç”¨äºç®¡ç† Go é¡¹ç›®çš„ä¾èµ–ï¼Œè®°å½•æ¨¡å—è·¯å¾„ã€Go ç‰ˆæœ¬å’Œæ‰€ä¾èµ–çš„åŒ…åŠå…¶ç‰ˆæœ¬ã€‚\ngo.sumï¼šç”¨äºè®°å½•æ¯ä¸ªä¾èµ–åŒ…çš„æ ¡éªŒå’Œï¼Œç¡®ä¿ä¾èµ–åŒ…çš„å®Œæ•´æ€§ä¸å®‰å…¨æ€§ã€‚\nå‘½ä»¤è¡Œå·¥å…· 1ã€go run æ— éœ€ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€‚åˆç”¨äºå¿«é€Ÿæµ‹è¯•å’Œè°ƒè¯•\ngo run [arguments] å¯ä»¥ä¼ é€’å¤šä¸ªæ–‡ä»¶åæ¥è¿è¡Œå¤šä¸ªGoæºæ–‡ä»¶\ngo run file1.go file2.go 2ã€go build ç¼–è¯‘ä»£ç ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶çš„å·¥å…·ï¼Œç¼–è¯‘åŸä»£ç å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥åœ¨æ²¡æœ‰Goç¯å¢ƒçš„æœºå™¨ä¸Šè¿è¡Œ\ngo build è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å go build -o myapp main.go go build file1.go file2.go æ„å»ºä¸€ä¸ªåŒ… go build 3ã€go install ä¸ go build ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº go install ä¼šå°†ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åˆ°Goçš„GOPATHä¸‹ï¼ˆæˆ–è€…æ¨¡å—æ¨¡å¼ä¸‹ä¼šå®‰è£…åˆ°GOBIN)ã€‚å®ƒé€šå¸¸ç”¨äºå°†ç¼–è¯‘åçš„å·¥å…·æˆ–åº”ç”¨ç¨‹åºå®‰è£…åˆ°ç³»ç»Ÿä¸­ã€‚\ngo install ç¤ºä¾‹ï¼š ä½ å¯ä»¥ä½¿ç”¨ go install å®‰è£…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š\ngo install github.com/spf13/cobra@latest ä¼šå°† cobra å®‰è£…åˆ°ä½ çš„ GOBIN ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ã€‚\n4ã€go test go test æ˜¯ Go æä¾›çš„æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–è¿è¡ŒGoçš„å•å…ƒæµ‹è¯•ã€‚\ngo test å‡è®¾ä½ æœ‰ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ main_test.goï¼š\npackage main import \"testing\" func TestAdd(t *testing.T) { result := 1 + 2 if result != 3 { t.Errorf(\"æœŸæœ› 3ï¼Œå®é™…æ˜¯ %d\", result) } } ä½ å¯ä»¥è¿è¡Œ go test æ¥è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼š\ngo test æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡ºï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œgo test ä¼šéšè—è¯¦ç»†è¾“å‡ºã€‚å¦‚æœä½ æƒ³æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ -v å‚æ•°ï¼š\ngo test -v è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼š å¦‚æœä½ åªæƒ³è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ -run å‚æ•°ï¼š\ngo test -run TestAdd 5ã€go get go get ç”¨äºå®‰è£…å’Œæ›´æ–° Go åŒ…ã€‚å¦‚æœä½ éœ€è¦ä¸‹è½½ç¬¬ä¸‰æ–¹åº“æˆ–è€…å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ go getã€‚\ngo get ç¤ºä¾‹ï¼š ä¸‹è½½å¹¶å®‰è£…ä¸€ä¸ªåŒ…ï¼š\ngo get github.com/spf13/cobra å¦‚æœä½ åœ¨æ¨¡å—æ¨¡å¼ä¸‹ï¼Œgo get ä¼šè‡ªåŠ¨æ›´æ–° go.mod æ–‡ä»¶ã€‚\nè·å–æœ€æ–°ç‰ˆæœ¬ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œgo get ä¼šä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚å¦‚æœä½ éœ€è¦è·å–ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ï¼š\ngo get github.com/spf13/cobra@v1.2.3 6ã€go mod Go 1.11 ä»¥åå¼•å…¥äº†æ¨¡å—åŒ–ï¼ˆModuleï¼‰ç³»ç»Ÿï¼Œgo mod æ˜¯ Go è¯­è¨€ä¸­ç”¨äºç®¡ç†ä¾èµ–çš„å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„ go mod å‘½ä»¤ï¼š\n6.1 go mod init åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Go æ¨¡å—ï¼Œåœ¨å½“å‰ç›®å½•åˆ›å»º go.mod æ–‡ä»¶ï¼š\ngo mod init 6.2 go mod tidy æ¸…ç†æ¨¡å—æ–‡ä»¶ï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä¾èµ–ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€æœ‰éœ€è¦çš„ä¾èµ–éƒ½åœ¨ go.mod å’Œ go.sum æ–‡ä»¶ä¸­ï¼š\ngo mod tidy 6.3 go mod vendor å°†æ‰€æœ‰ä¾èµ–å¤åˆ¶åˆ°æœ¬åœ° vendor ç›®å½•ä¸­ï¼Œè¿™å¯¹äºæŸäº›éœ€è¦ç¦»çº¿æ„å»ºçš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼š\ngo mod vendor 7ã€go fmt ä¸ä»£ç æ ¼å¼åŒ– go fmt æ˜¯ Go çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è°ƒæ•´ Go æºä»£ç çš„æ ¼å¼ï¼Œä½¿å…¶ç¬¦åˆ Go çš„ä»£ç é£æ ¼ã€‚é€šå¸¸åœ¨æäº¤ä»£ç å‰è¿è¡Œï¼Œä»¥ä¿æŒä»£ç é£æ ¼ä¸€è‡´ã€‚\nåŸºæœ¬è¯­æ³•ï¼š go fmt æ ¼å¼åŒ–æ•´ä¸ªåŒ…ï¼š go fmt ./... 3. GoåŸºç¡€è¯­æ³• 3.1 Hello World package main // å®šä¹‰åŒ…åï¼ŒmainåŒ…æ˜¯Goç¨‹åºçš„å…¥å£ import \"fmt\" // å¼•å…¥fmtåŒ…ï¼Œç”¨äºæ ¼å¼åŒ–è¾“å…¥è¾“å‡º // mainå‡½æ•°æ˜¯Goç¨‹åºçš„å…¥å£ func main() { fmt.Println(\"Hello, World!\") // è¾“å‡ºHello, World! } 3.2 å˜é‡å£°æ˜ä¸åˆå§‹åŒ– 3.2.1 å¸¸è§„å£°æ˜ var a = \"initial\" // å£°æ˜å˜é‡aï¼Œå¹¶åˆå§‹åŒ–ä¸º\"initial\" var b, c int = 1, 2 // åŒæ—¶å£°æ˜bå’Œcå¹¶åˆå§‹åŒ– var d = true // è‡ªåŠ¨æ¨æ–­dçš„ç±»å‹ä¸ºbool 3.2.2 ä½¿ç”¨:=ç®€æ´å£°æ˜ e := 3.14 // :=ç”¨äºå£°æ˜å¹¶åˆå§‹åŒ–å˜é‡ï¼Œç±»å‹ç”±ç¼–è¯‘å™¨æ¨æ–­ 3.2.3 ç©ºç™½æ ‡è¯†ç¬¦ var x, y int _, err := os.Open(\"file.txt\") // é€šè¿‡ç©ºç™½æ ‡è¯†ç¬¦å¿½ç•¥æŸä¸ªè¿”å›å€¼ 3.3 æ§åˆ¶ç»“æ„ 3.3.1 if-elseè¯­å¥ num := 9 if num \u003c 0 { fmt.Println(num, \"is negative\") // å¦‚æœnumå°äº0ï¼Œè¾“å‡ºè´Ÿæ•° } else if num \u003c 10 { fmt.Println(num, \"has 1 digit\") // å¦‚æœnumå°äº10ï¼Œè¾“å‡º1ä½æ•° } else { fmt.Println(num, \"has multiple digits\") // å¦åˆ™è¾“å‡ºå¤šä½æ•° } 3.3.2 switchè¯­å¥ switch day := \"Monday\"; day { case \"Monday\": fmt.Println(\"Start of the week\") case \"Friday\": fmt.Println(\"End of the week\") default: fmt.Println(\"Midweek\") // é»˜è®¤æƒ…å†µ } 3.3.3 forå¾ªç¯ // Goåªæœ‰ä¸€ä¸ªå¾ªç¯ç»“æ„forï¼Œå…¶ä»–çš„å¦‚whileéƒ½å¯ä»¥é€šè¿‡forå®ç° for i := 0; i \u003c 3; i++ { // ä»0åˆ°2çš„å¾ªç¯ fmt.Println(i) // è¾“å‡ºå¾ªç¯çš„æ¯ä¸ªå€¼ } 3.4 æ•°ç»„ä¸åˆ‡ç‰‡ 3.4.1 æ•°ç»„ var arr [5]int // å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º5çš„æ•°ç»„ arr[0] = 10 // ç»™æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ fmt.Println(arr) // è¾“å‡ºæ•´ä¸ªæ•°ç»„ 3.4.2 åˆ‡ç‰‡ // åˆ‡ç‰‡æ˜¯Goçš„ä¸€ä¸ªçµæ´»æ•°æ®ç»“æ„ï¼Œä¸åƒæ•°ç»„å¤§å°å›ºå®š s := []string{\"a\", \"b\", \"c\"} s = append(s, \"d\") // appendå‡½æ•°åŠ¨æ€æ‰©å±•åˆ‡ç‰‡ fmt.Println(s) // è¾“å‡ºåˆ‡ç‰‡ 3.4.3 åˆ‡ç‰‡çš„åˆ›å»º s := make([]int, 5) // åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º5çš„åˆ‡ç‰‡ fmt.Println(s) // è¾“å‡º: [0 0 0 0 0] 3.5 å‡½æ•° 3.5.1 åŸºæœ¬å‡½æ•° func add(a int, b int) int { // å‡½æ•°å£°æ˜ï¼Œè¿”å›a+bçš„ç»“æœ return a + b } fmt.Println(add(1, 2)) // è°ƒç”¨å‡½æ•°å¹¶æ‰“å°è¿”å›å€¼ 3.5.2 å¤šè¿”å›å€¼ func divide(a, b int) (int, int) { return a / b, a % b // è¿”å›å•†å’Œä½™æ•° } quotient, remainder := divide(10, 3) // è§£æ„è¿”å›å€¼ fmt.Println(quotient, remainder) 3.5.3 å¯å˜å‚æ•° func sum(nums ...int) int { // numsæ˜¯ä¸€ä¸ªæ•´æ•°åˆ‡ç‰‡ total := 0 for _, num := range nums { total += num } return total } fmt.Println(sum(1, 2, 3, 4)) // ä¼ å…¥å¤šä¸ªå‚æ•° 3.6 ç»“æ„ä½“ä¸æ–¹æ³• 3.6.1 ç»“æ„ä½“ type User struct { Name string Password string } u := User{\"wang\", \"password123\"} // åˆå§‹åŒ–ç»“æ„ä½“ fmt.Println(u) 3.6.2 æ–¹æ³• // ä¸ºUserç±»å‹å®šä¹‰ä¸€ä¸ªæ–¹æ³• func (u *User) ResetPassword(password string) { u.Password = password // ä¿®æ”¹ç»“æ„ä½“å®ä¾‹çš„å­—æ®µ } u.ResetPassword(\"newpassword\") // è°ƒç”¨æ–¹æ³•ä¿®æ”¹Passwordå­—æ®µ fmt.Println(u.Password) 3.7 é”™è¯¯å¤„ç† func findUser(users []User, name string) (*User, error) { for _, u := range users { if u.Name == name { return \u0026u, nil // æ‰¾åˆ°ç”¨æˆ·ï¼Œè¿”å›æŒ‡é’ˆå’Œnilé”™è¯¯ } } return nil, fmt.Errorf(\"user not found\") // æ²¡æ‰¾åˆ°ï¼Œè¿”å›é”™è¯¯ } u, err := findUser([]User{{\"wang\", \"1024\"}}, \"wang\") if err != nil { fmt.Println(err) // æ‰“å°é”™è¯¯ return } fmt.Println(u.Name) // å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ‰“å°ç”¨æˆ·ä¿¡æ¯ 3.8 å­—ç¬¦ä¸²æ“ä½œ 3.8.1 å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•° import \"strings\" str := \"Hello, World!\" fmt.Println(strings.Contains(str, \"World\")) // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«\"World\" fmt.Println(strings.ToUpper(str)) // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ fmt.Println(strings.Split(str, \", \")) // æŒ‰æŒ‡å®šåˆ†éš”ç¬¦åˆ‡å‰²å­—ç¬¦ä¸² 3.9 JSONå¤„ç† 3.9.1 ç¼–ç ä¸è§£ç  import \"encoding/json\" type UserInfo struct { Name string `json:\"name\"` Age int `json:\"age\"` } a := UserInfo{Name: \"wang\", Age: 18} buf, err := json.Marshal(a) // å°†ç»“æ„ä½“ç¼–ç ä¸ºJSON if err != nil { fmt.Println(\"Error encoding JSON:\", err) } fmt.Println(string(buf)) // è¾“å‡ºJSONå­—ç¬¦ä¸² var b UserInfo err = json.Unmarshal(buf, \u0026b) // å°†JSONå­—ç¬¦ä¸²è§£ç ä¸ºç»“æ„ä½“ if err != nil { fmt.Println(\"Error decoding JSON:\", err) } fmt.Println(b) 3.10 æ—¶é—´ä¸æ•°å­—è§£æ 3.10.1 æ—¶é—´æ“ä½œ import \"time\" t := time.Now() // è·å–å½“å‰æ—¶é—´ fmt.Println(t.Format(\"2006-01-02 15:04:05\")) // æ ¼å¼åŒ–æ—¶é—´ 3.10.2 å­—ç¬¦ä¸²è½¬æ•°å­— import \"strconv\" str := \"123\" n, err := strconv.Atoi(str) // å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•´æ•° if err != nil { fmt.Println(\"Error converting string to number:\", err) } fmt.Println(n) // è¾“å‡º123 3.11 æ¥å£ Go çš„æ¥å£ï¼ˆinterfaceï¼‰é€šè¿‡æ–¹æ³•é›†åˆå®šä¹‰è¡Œä¸ºã€‚åªè¦ä¸€ä¸ªç±»å‹æ‹¥æœ‰æ¥å£è¦æ±‚çš„å…¨éƒ¨æ–¹æ³•ï¼Œå®ƒå°±è‡ªåŠ¨å®ç°è¯¥æ¥å£ï¼Œæ— éœ€æ˜¾å¼å£°æ˜ã€‚\næ¥å£çš„å…¸å‹ç”¨é€”æ˜¯ï¼š è§£è€¦ä¾èµ–ã€æ–¹ä¾¿æµ‹è¯•ã€å®ç°å¤šæ€ã€‚\n3.11.1 æ¥å£å®šä¹‰ ä½¿ç”¨ type å®šä¹‰æ¥å£ï¼Œæ¥å£ä¸­åªåŒ…å«æ–¹æ³•ç­¾åï¼š\ntype DB interface { Query(sql string) string } ä»»ä½•ç±»å‹åªè¦å®ç°äº† Query æ–¹æ³•ï¼Œå°±è‡ªåŠ¨å®ç°äº† DB æ¥å£ã€‚\n3.11.2 å®ç°æ¥å£ï¼ˆéšå¼å®ç°ï¼‰ æ— éœ€å†™â€œimplementsâ€ã€‚ç»“æ„ä½“åªè¦æä¾›åŒåæ–¹æ³•å³å¯ï¼š\ntype MySQL struct{} func (m MySQL) Query(sql string) string { return \"real data\" } ç°åœ¨ MySQL å°±å®ç°äº† DBã€‚\n3.11.3 ä½¿ç”¨æ¥å£ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼‰ å‡½æ•°ä¾èµ–æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“å®ç°ï¼š\nfunc FetchUser(db DB) string { return db.Query(\"SELECT * FROM user\") } è°ƒç”¨æ—¶å¯ä»¥ä¼ å…¥ä»»ä½•å®ç°äº† DB çš„å¯¹è±¡ï¼š\nmysql := MySQL{} fmt.Println(FetchUser(mysql)) 3.11.4 ä½¿ç”¨æ¥å£è¿›è¡Œ Mock æµ‹è¯• æ¥å£æœ€é‡è¦çš„ä»·å€¼ä¹‹ä¸€æ˜¯ï¼š åœ¨æµ‹è¯•ä¸­è½»æ¾æ›¿æ¢ä¾èµ–ã€‚\nç¤ºä¾‹ï¼šåˆ›å»º Mock å®ç°\ntype MockDB struct{} func (m MockDB) Query(sql string) string { return \"fake data\" } æµ‹è¯•æ—¶æ›¿æ¢çœŸå®æ•°æ®åº“ï¼š\nmock := MockDB{} fmt.Println(FetchUser(mock)) // è¾“å‡º fake data è¿™æ ·å¯ä»¥é¿å…ä¾èµ–çœŸå®æ•°æ®åº“ï¼Œæå‡æµ‹è¯•æ•ˆç‡ã€‚\n4. Goå·¥ç¨‹å®è·µ 4.1 çŒœæ•°å­—æ¸¸æˆ import ( \"fmt\" \"math/rand\" \"time\" ) func main() { rand.Seed(time.Now().UnixNano()) // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºéšæœºæ•°ç§å­ secretNumber := rand.Intn(100) // ç”Ÿæˆä¸€ä¸ª0åˆ°99ä¹‹é—´çš„éšæœºæ•° fmt.Println(\"Guess the secret number between 0 and 100!\") var guess int for { fmt.Print(\"Enter your guess: \") fmt.Scan(\u0026guess) // è¯»å–ç”¨æˆ·è¾“å…¥çš„çŒœæµ‹å€¼ if guess \u003c secretNumber { fmt.Println(\"Too low!\") } else if guess \u003e secretNumber { fmt.Println(\"Too high!\") } else { fmt.Println(\"You guessed it!\") break } } } 4.2 åœ¨çº¿è¯å…¸ package main import ( \"bytes\" \"encoding/json\" \"fmt\" \"io/ioutil\" \"log\" \"net/http\" \"os\" ) type DictRequest struct { TransType string `json:\"trans_type\"` Source string `json:\"source\"` UserID string `json:\"user_id\"` } type DictResponse struct { Rc int `json:\"rc\"` Wiki struct { KnownInLaguages int `json:\"known_in_laguages\"` Description struct { Source string `json:\"source\"` Target interface{} `json:\"target\"` } `json:\"description\"` ID string `json:\"id\"` Item struct { Source string `json:\"source\"` Target string `json:\"target\"` } `json:\"item\"` ImageURL string `json:\"image_url\"` IsSubject string `json:\"is_subject\"` Sitelink string `json:\"sitelink\"` } `json:\"wiki\"` Dictionary struct { Prons struct { EnUs string `json:\"en-us\"` En string `json:\"en\"` } `json:\"prons\"` Explanations []string `json:\"explanations\"` Synonym []string `json:\"synonym\"` Antonym []string `json:\"antonym\"` WqxExample [][]string `json:\"wqx_example\"` Entry string `json:\"entry\"` Type string `json:\"type\"` Related []interface{} `json:\"related\"` Source string `json:\"source\"` } `json:\"dictionary\"` } func query(word string) { client := \u0026http.Client{} request := DictRequest{TransType: \"en2zh\", Source: word} buf, err := json.Marshal(request) if err != nil { log.Fatal(err) } var data = bytes.NewReader(buf) req, err := http.NewRequest(\"POST\", \"https://api.interpreter.caiyunai.com/v1/dict\", data) if err != nil { log.Fatal(err) } req.Header.Set(\"Connection\", \"keep-alive\") req.Header.Set(\"DNT\", \"1\") req.Header.Set(\"os-version\", \"\") req.Header.Set(\"sec-ch-ua-mobile\", \"?0\") req.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36\") req.Header.Set(\"app-name\", \"xy\") req.Header.Set(\"Content-Type\", \"application/json;charset=UTF-8\") req.Header.Set(\"Accept\", \"application/json, text/plain, */*\") req.Header.Set(\"device-id\", \"\") req.Header.Set(\"os-type\", \"web\") req.Header.Set(\"X-Authorization\", \"token:xxx\") req.Header.Set(\"Origin\", \"https://fanyi.caiyunapp.com\") req.Header.Set(\"Sec-Fetch-Site\", \"cross-site\") req.Header.Set(\"Sec-Fetch-Mode\", \"cors\") req.Header.Set(\"Sec-Fetch-Dest\", \"empty\") req.Header.Set(\"Referer\", \"https://fanyi.caiyunapp.com/\") req.Header.Set(\"Accept-Language\", \"zh-CN,zh;q=0.9\") req.Header.Set(\"Cookie\", \"_ym_uid=16456948721020430059; _ym_d=1645694872\") resp, err := client.Do(req) if err != nil { log.Fatal(err) } defer resp.Body.Close() bodyText, err := ioutil.ReadAll(resp.Body) if err != nil { log.Fatal(err) } if resp.StatusCode != 200 { log.Fatal(\"bad StatusCode:\", resp.StatusCode, \"body\", string(bodyText)) } var dictResponse DictResponse err = json.Unmarshal(bodyText, \u0026dictResponse) if err != nil { log.Fatal(err) } fmt.Println(word, \"UK:\", dictResponse.Dictionary.Prons.En, \"US:\", dictResponse.Dictionary.Prons.EnUs) for _, item := range dictResponse.Dictionary.Explanations { fmt.Println(item) } } func main() { if len(os.Args) != 2 { fmt.Fprintf(os.Stderr, `usage: simpleDict WORD example: simpleDict hello `) os.Exit(1) } word := os.Args[1] query(word) } ken@Ken:/mnt/d/Go/go-demo/02-Goè¯­è¨€çš„å®æˆ˜æ¡ˆä¾‹/02-simpledict/v4$ ./simpledict hello hello UK: [ËˆheËˆlÉ™u] US: [hÉ™Ëˆlo] int.å–‚;å“ˆç½— n.å¼•äººæ³¨æ„çš„å‘¼å£° v.å‘äººå‘¼(å–‚) 4.3 SOCKS5 ä»£ç†æœåŠ¡å™¨ä»£ç å®ç° 1. SOCKS5 åè®®æ¦‚è¿° 1.1 SOCKS5 ä»£ç†åŸç† SOCKS5 æ˜¯ä¸€ç§ä»£ç†åè®®ï¼Œåœ¨ç½‘ç»œä¸­å……å½“å®¢æˆ·ç«¯ä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­ä»‹ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®è¿œç¨‹èµ„æºï¼Œé€šå¸¸ç”¨äºè§„é¿é˜²ç«å¢™ã€æé«˜å®‰å…¨æ€§ç­‰ã€‚\nä»£ç†æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š\næ¡æ‰‹é˜¶æ®µï¼šå®¢æˆ·ç«¯å‘ SOCKS5 ä»£ç†å‘é€åè®®ç‰ˆæœ¬å·åŠè®¤è¯æ–¹å¼ã€‚ è®¤è¯é˜¶æ®µï¼šæ ¹æ®ä»£ç†æœåŠ¡å™¨çš„è¿”å›ï¼Œè¿›è¡Œç›¸åº”çš„èº«ä»½éªŒè¯ã€‚ è¯·æ±‚é˜¶æ®µï¼šè®¤è¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯å‘ SOCKS5 ä»£ç†å‘é€è¯·æ±‚ï¼Œè¦æ±‚å»ºç«‹ä¸ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥ã€‚ ä¸­ç»§é˜¶æ®µï¼šä»£ç†æœåŠ¡å™¨è½¬å‘å®¢æˆ·ç«¯è¯·æ±‚å’Œç›®æ ‡æœåŠ¡å™¨çš„å“åº”ï¼Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚ 2. TCP Echo æœåŠ¡å™¨ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç®€å•çš„ TCP Echo æœåŠ¡å™¨ï¼Œå¤„ç†ä»å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶è¿”å›ç›¸åŒçš„æ•°æ®ã€‚\n2.1 TCP Echo æœåŠ¡å™¨ä»£ç  package main import ( \"bufio\" \"fmt\" \"net\" ) func main() { server, err := net.Listen(\"tcp\", \"127.0.0.1:1080\") if err != nil { panic(err) } for { client, err := server.Accept() if err != nil { fmt.Errorf(\"accept error: %w\", err) continue } go process(client) } } func process(conn net.Conn) { defer conn.Close() reader := bufio.NewReader(conn) for { buf, err := reader.ReadByte() if err != nil { fmt.Errorf(\"read buf error: %w\", err) return } _, err = conn.Write([]byte{buf}) if err != nil { fmt.Errorf(\"write buf back error: %w\", err) return } } } 2.2 ä»£ç è¯´æ˜ï¼š net.Listenï¼šåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªç›‘å¬æŒ‡å®šç«¯å£çš„æœåŠ¡å™¨ï¼ˆè¿™é‡Œæ˜¯ 127.0.0.1:1080ï¼‰ã€‚ Acceptï¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªè¿æ¥å¯¹è±¡ã€‚ processï¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚bufio.NewReader ç”¨äºæé«˜ä»ç½‘ç»œè¿æ¥è¯»å–æ•°æ®çš„æ•ˆç‡ã€‚ conn.Writeï¼šå°†å®¢æˆ·ç«¯è¾“å…¥çš„å­—èŠ‚æ•°æ®å‘é€å›å»ï¼Œå½¢æˆâ€œechoâ€å“åº”ã€‚ 2.3 æµ‹è¯•æ–¹æ³•ï¼š å¯ä»¥ä½¿ç”¨ ncï¼ˆnetcatï¼‰å·¥å…·æ¥æµ‹è¯•ï¼š\nnc 127.0.0.1 1080 åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»»æ„å­—ç¬¦ï¼ŒTCP Echo æœåŠ¡å™¨å°†è¿”å›ç›¸åŒçš„å­—ç¬¦ã€‚\n3. SOCKS5 ä»£ç†è®¤è¯å®ç° 3.1 ä»£ç  package main import ( \"bufio\" \"context\" \"fmt\" \"io\" \"log\" \"net\" \"time\" ) const ( socks5Ver = 0x05 cmdConnect = 0x01 atypeIPV4 = 0x01 atypeHOST = 0x03 atypeIPV6 = 0x04 ) func main() { addr := \"127.0.0.1:1080\" listener, err := net.Listen(\"tcp\", addr) if err != nil { log.Fatalf(\"listen failed: %v\", err) } defer listener.Close() log.Println(\"SOCKS5 server listening on\", addr) for { client, err := listener.Accept() if err != nil { log.Println(\"accept failed:\", err) continue } go handleClient(client) } } func handleClient(conn net.Conn) { defer conn.Close() reader := bufio.NewReader(conn) // 1ï¸âƒ£ è®¤è¯é˜¶æ®µ if err := auth(reader, conn); err != nil { log.Println(\"auth failed:\", err) return } log.Println(\"auth success from\", conn.RemoteAddr()) // 2ï¸âƒ£ CONNECT è¯·æ±‚ if err := connect(reader, conn); err != nil { log.Println(\"connect failed:\", err) return } } func auth(reader *bufio.Reader, conn net.Conn) error { ver, err := reader.ReadByte() if err != nil { return fmt.Errorf(\"read ver failed:%w\", err) } if ver != socks5Ver { return fmt.Errorf(\"unsupported ver:%d\", ver) } methodSize, err := reader.ReadByte() if err != nil { return fmt.Errorf(\"read method size failed:%w\", err) } method := make([]byte, methodSize) if _, err = io.ReadFull(reader, method); err != nil { return fmt.Errorf(\"read method failed:%w\", err) } // å›å¤æ— éœ€è®¤è¯ _, err = conn.Write([]byte{socks5Ver, 0x00}) return err } func connect(reader *bufio.Reader, conn net.Conn) error { ver, _ := reader.ReadByte() cmd, _ := reader.ReadByte() rsv, _ := reader.ReadByte() if ver != socks5Ver || cmd != cmdConnect || rsv != 0x00 { return fmt.Errorf(\"invalid header\") } atype, _ := reader.ReadByte() var addr string switch atype { case atypeIPV4: addr = readIPV4(reader) case atypeHOST: addr = readHost(reader) case atypeIPV6: addr = readIPV6(reader) default: return fmt.Errorf(\"unknown atype %v\", atype) } port := readPort(reader) targetAddr := fmt.Sprintf(\"%s:%d\", addr, port) // ğŸ”— è¿æ¥ç›®æ ‡æœåŠ¡å™¨ target, err := net.Dial(\"tcp\", targetAddr) if err != nil { conn.Write([]byte{socks5Ver, 0x01, 0x00, atypeIPV4, 0, 0, 0, 0, 0, 0}) return fmt.Errorf(\"connect to target failed: %v\", err) } defer target.Close() // å›å¤æˆåŠŸ conn.Write([]byte{socks5Ver, 0x00, 0x00, atypeIPV4, 0, 0, 0, 0, 0, 0}) // ğŸ” å¼€å§‹è½¬å‘ ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second) defer cancel() relay(reader, conn, target, ctx) return nil } func readIPV4(reader *bufio.Reader) string { buf := make([]byte, 4) io.ReadFull(reader, buf) return fmt.Sprintf(\"%d.%d.%d.%d\", buf[0], buf[1], buf[2], buf[3]) } func readHost(reader *bufio.Reader) string { l, _ := reader.ReadByte() buf := make([]byte, l) io.ReadFull(reader, buf) return string(buf) } func readIPV6(reader *bufio.Reader) string { buf := make([]byte, 16) io.ReadFull(reader, buf) return fmt.Sprintf(\"%x\", buf) } func readPort(reader *bufio.Reader) uint16 { buf := make([]byte, 2) io.ReadFull(reader, buf) return (uint16(buf[0]) \u003c\u003c 8) | uint16(buf[1]) } func relay(reader *bufio.Reader, conn net.Conn, targetConn net.Conn, ctx context.Context) { go io.Copy(targetConn, conn) io.Copy(conn, targetConn) \u003c-ctx.Done() } 3.2 ä»£ç è¯´æ˜ï¼š main()ï¼šå¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ 127.0.0.1:1080ï¼Œæ¯æœ‰æ–°è¿æ¥å°±åˆ›å»ºä¸€ä¸ªåç¨‹å¤„ç†ã€‚\nhandleClient()ï¼šå¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼ŒåŒ…æ‹¬è®¤è¯å’Œå»ºç«‹è½¬å‘ã€‚\nauth()ï¼šæ‰§è¡Œ SOCKS5 è®¤è¯ï¼Œè¿™é‡Œå›ºå®šè¿”å›â€œæ— éœ€è®¤è¯â€ã€‚\nconnect()ï¼šè§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå»ºç«‹åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ TCP è¿æ¥ã€‚\nrelay()ï¼šåœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®è½¬å‘ã€‚\nreadIPV4/readHost/readIPV6/readPort()ï¼šè´Ÿè´£è§£æä¸åŒæ ¼å¼çš„åœ°å€ã€‚\n3.3 æœ€ç»ˆæµ‹è¯• æµ‹è¯•æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸­è®¾ç½® SOCKS5 ä»£ç†ï¼Œæˆ–è€…ä½¿ç”¨ curl å‘½ä»¤æ¥è¿›è¡Œè¯·æ±‚ï¼š\ncurl --socks5-hostname 127.0.0.1:1080 http://example.com 4.4 æ¶ˆæ¯ç³»ç»Ÿ ç”±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ„å»ºçš„ç®€æ˜“æ¶ˆæ¯ç³»ç»Ÿ\nmain.go package main func main() { server := NewServer(\"127.0.0.1\", 8889) server.Start() } server.go package main import ( \"fmt\" \"io\" \"net\" \"sync\" \"time\" ) type Server struct { Ip string Port int OnlineMap map[string]*User mapLock sync.RWMutex Message chan string } func NewServer(ip string, port int) *Server { server := \u0026Server{ Ip: ip, Port: port, OnlineMap: make(map[string]*User), Message: make(chan string), } return server } func (this *Server) BroadCast(user *User, msg string) { sendMsg := \"[\" + user.Addr + \"]\" + user.Name + \":\" + \" msg: \" + msg this.Message \u003c- sendMsg fmt.Printf(\" å¹¿æ’­å‘é€æˆåŠŸ %s \\n\", sendMsg) } func (this *Server) MessageListener() { for { msg := \u003c-this.Message this.mapLock.Lock() for _, client := range this.OnlineMap { client.C \u003c- msg } this.mapLock.Unlock() } } func (this *Server) Handler(conn net.Conn) { //fmt.Println(\"é“¾æ¥å»ºç«‹æˆåŠŸ\") //defer conn.Close() user := NewUser(conn, this) user.Online() isLive := make(chan bool) go func() { buf := make([]byte, 4096) for { n, err := conn.Read(buf) if n == 0 { user.Offline() return } if err != nil \u0026\u0026 err != io.EOF { fmt.Println(\"conn.Read err:\", err) return } // å»é™¤ \\n user.DoMessage(string(buf[:n-1])) isLive \u003c- true } }() // å½“å‰handleré˜»å¡ for { select { case \u003c-isLive: { } case \u003c-time.After(time.Second * 60): { user.SendMsg(\"ä½ è¢«è¸¢äº†\") close(user.C) conn.Close() fmt.Printf(\"ç”¨æˆ· %s è¢«è¸¢äº† \\n\", user.Name) // é€€å‡ºå½“å‰handler return // runtime.Goexit() } } } } func (this *Server) Start() { // socket listen listener, err := net.Listen(\"tcp\", fmt.Sprintf(\"%s:%d\", this.Ip, this.Port)) if err != nil { fmt.Println(\"net.Listen err:\", err) return } // close listener defer listener.Close() go this.MessageListener() // accept for { conn, err := listener.Accept() if err != nil { fmt.Println(\"listener.Accept err:\", err) continue } else { fmt.Println(\"é“¾æ¥å»ºç«‹æˆåŠŸ\") } // do handler go this.Handler(conn) } } client.go package main import ( \"bufio\" \"flag\" \"fmt\" \"io\" \"net\" \"os\" \"strings\" ) type Client struct { ServerIp string ServerPort int Name string conn net.Conn flag int } var reader *bufio.Reader func NewClient(serverIp string, serverPort int) *Client { client := \u0026Client{ ServerIp: serverIp, ServerPort: serverPort, flag: 9999, } conn, err := net.Dial(\"tcp\", fmt.Sprintf(\"%s:%d\", serverIp, serverPort)) if err != nil { fmt.Println(\"net.Dial error:\", err) return nil } client.conn = conn return client } func (client *Client) DealResponse() { io.Copy(os.Stdout, client.conn) } func (client *Client) menu() bool { var flag int fmt.Println(\"1ã€å…¬èŠæ¨¡å¼\") fmt.Println(\"2ã€ç§èŠæ¨¡å¼\") fmt.Println(\"3ã€æ›´æ–°ç”¨æˆ·å\") fmt.Println(\"0ã€é€€å‡º\") fmt.Scanln(\u0026flag) if flag \u003e= 0 \u0026\u0026 flag \u003c= 3 { client.flag = flag return true } else { fmt.Println(\"è¾“å…¥æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥\") return false } } func (client *Client) UpdateName() bool { fmt.Println(\"è¯·è¾“å…¥ç”¨æˆ·å:\") client.Name, _ = reader.ReadString('\\n') client.Name = strings.TrimSpace(client.Name) sendMsg := \"rename|\" + client.Name + \"\\n\" _, err := client.conn.Write([]byte(sendMsg)) if err != nil { fmt.Println(\"UpdateName error:\", err) return false } return true } func (client *Client) PublicChat() { var chatMsg string fmt.Println(\"è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:\") chatMsg, _ = reader.ReadString('\\n') chatMsg = strings.TrimSpace(chatMsg) for chatMsg != \"exit\" { if len(chatMsg) != 0 { sendMsg := chatMsg + \"\\n\" _, err := client.conn.Write([]byte(sendMsg)) if err != nil { fmt.Println(\"write error:\", err) break } } chatMsg = \"\" fmt.Println(\"è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:\") chatMsg, _ = reader.ReadString('\\n') chatMsg = strings.TrimSpace(chatMsg) } } func (client *Client) selectUsers() { sendMsg := \"who\\n\" _, err := client.conn.Write([]byte(sendMsg)) if err != nil { fmt.Println(\"selectUsers error:\", err) } } func (client *Client) PrivateChat() { var remoteName string var chatMsg string client.selectUsers() fmt.Println(\"è¯·è¾“å…¥èŠå¤©å¯¹è±¡çš„ç”¨æˆ·åï¼Œ exité€€å‡º\") remoteName, _ = reader.ReadString('\\n') remoteName = strings.TrimSpace(remoteName) for remoteName != \"exit\" { fmt.Println(\"è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:\") chatMsg, _ = reader.ReadString('\\n') chatMsg = strings.TrimSpace(chatMsg) for chatMsg != \"exit\" { if len(chatMsg) != 0 { sendMsg := \"to|\" + remoteName + \"|\" + chatMsg + \"\\n\" _, err := client.conn.Write([]byte(sendMsg)) if err != nil { fmt.Println(\"write error:\", err) break } } chatMsg = \"\" fmt.Println(\"è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:\") chatMsg, _ = reader.ReadString('\\n') chatMsg = strings.TrimSpace(chatMsg) } client.selectUsers() fmt.Println(\"è¯·è¾“å…¥èŠå¤©å¯¹è±¡ï¼Œexité€€å‡º\") remoteName, _ = reader.ReadString('\\n') remoteName = strings.TrimSpace(remoteName) } } func (client *Client) Run() { for client.flag != 0 { for client.menu() != true { } switch client.flag { case 1: client.PublicChat() break case 2: fmt.Println(\"ç§èŠæ¨¡å¼\") client.PrivateChat() break case 3: client.UpdateName() break } } } var serverIp string var serverPort int func init() { flag.StringVar(\u0026serverIp, \"ip\", \"127.0.0.1\", \"set server ip\") flag.IntVar(\u0026serverPort, \"port\", 8889, \"set server port\") } func main() { // å‘½ä»¤è¡Œè§£æ flag.Parse() reader = bufio.NewReader(os.Stdin) // åˆå§‹åŒ–å…¨å±€ reader client := NewClient(serverIp, serverPort) if client == nil { fmt.Println(\"Connect to the server successfully\") return } go client.DealResponse() fmt.Println(\"Connect to the server success\") client.Run() } user.go package main import ( \"net\" \"strings\" ) type User struct { Name string Addr string C chan string conn net.Conn server *Server } func NewUser(conn net.Conn, server *Server) *User { userAddr := conn.RemoteAddr().String() user := \u0026User{ Name: userAddr, Addr: userAddr, C: make(chan string), conn: conn, server: server, } go user.ListenMessage() return user } func (this *User) Online() { // ç”¨æˆ·ä¸Šçº¿ï¼Œ å°†ç”¨æˆ·åŠ åˆ°onlineMapä¸­ this.server.mapLock.Lock() this.server.OnlineMap[this.Name] = this this.server.mapLock.Unlock() this.server.BroadCast(this, \"å·²ä¸Šçº¿\") } func (this *User) Offline() { this.server.mapLock.Lock() delete(this.server.OnlineMap, this.Name) this.server.mapLock.Unlock() this.server.BroadCast(this, \"å·²ä¸‹çº¿\") } func (this *User) SendMsg(msg string) { this.conn.Write([]byte(msg)) } func (this *User) DoMessage(msg string) { if msg == \"who\" { this.server.mapLock.Lock() for _, user := range this.server.OnlineMap { onlineMsg := \"[\" + user.Addr + \"]\" + user.Name + \":\" + \"åœ¨çº¿ã€‚ã€‚ã€‚\\n\" this.SendMsg(onlineMsg) } this.server.mapLock.Unlock() } else if len(msg) \u003e 7 \u0026\u0026 msg[:7] == \"rename|\" { newName := strings.Split(msg, \"|\")[1] _, ok := this.server.OnlineMap[newName] if ok { this.SendMsg(\"å½“å‰ç”¨æˆ·åè¢«ä½¿ç”¨\\n\") } else { this.server.mapLock.Lock() delete(this.server.OnlineMap, this.Name) this.server.OnlineMap[newName] = this this.server.mapLock.Unlock() this.Name = newName this.SendMsg(\"æ‚¨å·²æ›´æ–°ç”¨æˆ·å\" + newName + \"\\n\") } } else if len(msg) \u003e 4 \u0026\u0026 msg[:3] == \"to|\" { remoteName := strings.Split(msg, \"|\")[1] if remoteName == \"\" { this.SendMsg(\"æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®ï¼Œ è¯·ä½¿ç”¨ \\\"to|å¼ ä¸‰|ä½ å¥½å•Š\\\" æ ¼å¼ã€‚ \\n\") return } remoteUser, ok := this.server.OnlineMap[remoteName] if !ok { this.SendMsg(\"è¯¥ç”¨æˆ·ä¸å­˜åœ¨\\n\") return } content := strings.Split(msg, \"|\")[2] if content == \"\" { this.SendMsg(\"æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®ï¼Œ è¯·ä½¿ç”¨ \\\"to|å¼ ä¸‰|ä½ å¥½å•Š\\\" å½¢å¼å‘é€æ¶ˆæ¯ã€‚ \\n\") return } remoteUser.SendMsg(this.Name + \"å¯¹ä½ è¯´ï¼š\" + content + \"\\n\") } else { this.server.BroadCast(this, msg) } } func (this *User) ListenMessage() { for { msg := \u003c-this.C this.conn.Write([]byte(msg + \"\\n\")) } } ",
  "wordCount" : "6310",
  "inLanguage": "zh",
  "datePublished": "2025-01-25T10:00:01+08:00",
  "dateModified": "2025-11-02T10:00:01+08:00",
  "author":{
    "@type": "Person",
    "name": "ShowGuan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kennems.github.io/posts/tech/go-1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kennem's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kennems.github.io/img/sun.png"
    }
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kennems.github.io/" accesskey="h" title="Kennem&#39;s Blog (Alt + H)">
                <img src="https://kennems.github.io/img/sun.png" alt="" aria-label="logo"
                    height="35">Kennem&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://kennems.github.io/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/archives" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/categories" title="ğŸ—‚ï¸åˆ†ç±»">
                    <span>ğŸ—‚ï¸åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://kennems.github.io/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://kennems.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://kennems.github.io/posts/tech/">ğŸ’»æŠ€æœ¯</a></div>
    <h1 class="post-title entry-hint-parent">
      Goè¯­è¨€åŸºç¡€
    </h1>
    <div class="post-description">
      Goè¯­è¨€åŸºç¡€
    </div>
    <div class="post-meta"><span title='2025-01-25 10:00:01 +0800 CST'>2025-01-25</span>&nbsp;Â·&nbsp;<span>13 åˆ†é’Ÿ</span>&nbsp;Â·&nbsp;<span>6310 å­—</span>&nbsp;Â·&nbsp;updated:&nbsp;2025-11-02&nbsp;Â·&nbsp;<span>ShowGuan</span>

</div>
    
     <div class="post-password">
        
    </div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#go%e8%af%ad%e8%a8%80%e5%9f%ba%e7%a1%80" aria-label="Goè¯­è¨€åŸºç¡€">Goè¯­è¨€åŸºç¡€</a><ul>
                            
                    <li>
                        <a href="#1-go%e8%af%ad%e8%a8%80%e6%a6%82%e8%bf%b0" aria-label="1. Goè¯­è¨€æ¦‚è¿°">1. Goè¯­è¨€æ¦‚è¿°</a></li>
                    <li>
                        <a href="#2-%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" aria-label="2. ç¯å¢ƒæ­å»º">2. ç¯å¢ƒæ­å»º</a><ul>
                            
                    <li>
                        <a href="#go-module" aria-label="Go Module">Go Module</a></li>
                    <li>
                        <a href="#%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%b7%a5%e5%85%b7" aria-label="å‘½ä»¤è¡Œå·¥å…·">å‘½ä»¤è¡Œå·¥å…·</a></li>
                    <li>
                        <a href="#1go-run" aria-label="1ã€go run">1ã€<code>go run</code></a></li>
                    <li>
                        <a href="#2go-build" aria-label="2ã€go build">2ã€<code>go build</code></a><ul>
                            
                    <li>
                        <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6%e5%90%8d" aria-label="è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å">è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å</a></li>
                    <li>
                        <a href="#%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%8c%85" aria-label="æ„å»ºä¸€ä¸ªåŒ…">æ„å»ºä¸€ä¸ªåŒ…</a></li></ul>
                    </li>
                    <li>
                        <a href="#3go-install" aria-label="3ã€go install">3ã€<code>go install</code></a><ul>
                            
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b" aria-label="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</a></li></ul>
                    </li>
                    <li>
                        <a href="#4go-test" aria-label="4ã€go test">4ã€<code>go test</code></a><ul>
                            
                    <li>
                        <a href="#%e6%9f%a5%e7%9c%8b%e6%b5%8b%e8%af%95%e8%af%a6%e7%bb%86%e8%be%93%e5%87%ba" aria-label="æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡ºï¼š">æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡ºï¼š</a></li>
                    <li>
                        <a href="#%e8%bf%90%e8%a1%8c%e7%89%b9%e5%ae%9a%e7%9a%84%e6%b5%8b%e8%af%95%e5%87%bd%e6%95%b0" aria-label="è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼š">è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼š</a></li></ul>
                    </li>
                    <li>
                        <a href="#5go-get" aria-label="5ã€go get">5ã€<code>go get</code></a><ul>
                            
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b-1" aria-label="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</a></li>
                    <li>
                        <a href="#%e8%8e%b7%e5%8f%96%e6%9c%80%e6%96%b0%e7%89%88%e6%9c%ac" aria-label="è·å–æœ€æ–°ç‰ˆæœ¬ï¼š">è·å–æœ€æ–°ç‰ˆæœ¬ï¼š</a></li></ul>
                    </li>
                    <li>
                        <a href="#6go-mod" aria-label="6ã€go mod">6ã€<code>go mod</code></a><ul>
                            
                    <li>
                        <a href="#61-go-mod-init" aria-label="6.1 go mod init">6.1 <code>go mod init</code></a></li>
                    <li>
                        <a href="#62-go-mod-tidy" aria-label="6.2 go mod tidy">6.2 <code>go mod tidy</code></a></li>
                    <li>
                        <a href="#63-go-mod-vendor" aria-label="6.3 go mod vendor">6.3 <code>go mod vendor</code></a></li></ul>
                    </li>
                    <li>
                        <a href="#7go-fmt-%e4%b8%8e%e4%bb%a3%e7%a0%81%e6%a0%bc%e5%bc%8f%e5%8c%96" aria-label="7ã€go fmt ä¸ä»£ç æ ¼å¼åŒ–">7ã€<code>go fmt</code> ä¸ä»£ç æ ¼å¼åŒ–</a><ul>
                            
                    <li>
                        <a href="#%e5%9f%ba%e6%9c%ac%e8%af%ad%e6%b3%95" aria-label="åŸºæœ¬è¯­æ³•ï¼š">åŸºæœ¬è¯­æ³•ï¼š</a></li>
                    <li>
                        <a href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e6%95%b4%e4%b8%aa%e5%8c%85" aria-label="æ ¼å¼åŒ–æ•´ä¸ªåŒ…ï¼š">æ ¼å¼åŒ–æ•´ä¸ªåŒ…ï¼š</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#3-go%e5%9f%ba%e7%a1%80%e8%af%ad%e6%b3%95" aria-label="3. GoåŸºç¡€è¯­æ³•">3. GoåŸºç¡€è¯­æ³•</a><ul>
                            
                    <li>
                        <a href="#31-hello-world" aria-label="3.1 Hello World">3.1 Hello World</a></li>
                    <li>
                        <a href="#32-%e5%8f%98%e9%87%8f%e5%a3%b0%e6%98%8e%e4%b8%8e%e5%88%9d%e5%a7%8b%e5%8c%96" aria-label="3.2 å˜é‡å£°æ˜ä¸åˆå§‹åŒ–">3.2 å˜é‡å£°æ˜ä¸åˆå§‹åŒ–</a><ul>
                            
                    <li>
                        <a href="#321-%e5%b8%b8%e8%a7%84%e5%a3%b0%e6%98%8e" aria-label="3.2.1 å¸¸è§„å£°æ˜">3.2.1 å¸¸è§„å£°æ˜</a></li>
                    <li>
                        <a href="#322-%e4%bd%bf%e7%94%a8%e7%ae%80%e6%b4%81%e5%a3%b0%e6%98%8e" aria-label="3.2.2 ä½¿ç”¨:=ç®€æ´å£°æ˜">3.2.2 ä½¿ç”¨<code>:=</code>ç®€æ´å£°æ˜</a></li>
                    <li>
                        <a href="#323-%e7%a9%ba%e7%99%bd%e6%a0%87%e8%af%86%e7%ac%a6" aria-label="3.2.3 ç©ºç™½æ ‡è¯†ç¬¦">3.2.3 ç©ºç™½æ ‡è¯†ç¬¦</a></li></ul>
                    </li>
                    <li>
                        <a href="#33-%e6%8e%a7%e5%88%b6%e7%bb%93%e6%9e%84" aria-label="3.3 æ§åˆ¶ç»“æ„">3.3 æ§åˆ¶ç»“æ„</a><ul>
                            
                    <li>
                        <a href="#331-if-else%e8%af%ad%e5%8f%a5" aria-label="3.3.1 if-elseè¯­å¥">3.3.1 if-elseè¯­å¥</a></li>
                    <li>
                        <a href="#332-switch%e8%af%ad%e5%8f%a5" aria-label="3.3.2 switchè¯­å¥">3.3.2 switchè¯­å¥</a></li>
                    <li>
                        <a href="#333-for%e5%be%aa%e7%8e%af" aria-label="3.3.3 forå¾ªç¯">3.3.3 forå¾ªç¯</a></li></ul>
                    </li>
                    <li>
                        <a href="#34-%e6%95%b0%e7%bb%84%e4%b8%8e%e5%88%87%e7%89%87" aria-label="3.4 æ•°ç»„ä¸åˆ‡ç‰‡">3.4 æ•°ç»„ä¸åˆ‡ç‰‡</a><ul>
                            
                    <li>
                        <a href="#341-%e6%95%b0%e7%bb%84" aria-label="3.4.1 æ•°ç»„">3.4.1 æ•°ç»„</a></li>
                    <li>
                        <a href="#342-%e5%88%87%e7%89%87" aria-label="3.4.2 åˆ‡ç‰‡">3.4.2 åˆ‡ç‰‡</a></li>
                    <li>
                        <a href="#343-%e5%88%87%e7%89%87%e7%9a%84%e5%88%9b%e5%bb%ba" aria-label="3.4.3 åˆ‡ç‰‡çš„åˆ›å»º">3.4.3 åˆ‡ç‰‡çš„åˆ›å»º</a></li></ul>
                    </li>
                    <li>
                        <a href="#35-%e5%87%bd%e6%95%b0" aria-label="3.5 å‡½æ•°">3.5 å‡½æ•°</a><ul>
                            
                    <li>
                        <a href="#351-%e5%9f%ba%e6%9c%ac%e5%87%bd%e6%95%b0" aria-label="3.5.1 åŸºæœ¬å‡½æ•°">3.5.1 åŸºæœ¬å‡½æ•°</a></li>
                    <li>
                        <a href="#352-%e5%a4%9a%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="3.5.2 å¤šè¿”å›å€¼">3.5.2 å¤šè¿”å›å€¼</a></li>
                    <li>
                        <a href="#353-%e5%8f%af%e5%8f%98%e5%8f%82%e6%95%b0" aria-label="3.5.3 å¯å˜å‚æ•°">3.5.3 å¯å˜å‚æ•°</a></li></ul>
                    </li>
                    <li>
                        <a href="#36-%e7%bb%93%e6%9e%84%e4%bd%93%e4%b8%8e%e6%96%b9%e6%b3%95" aria-label="3.6 ç»“æ„ä½“ä¸æ–¹æ³•">3.6 ç»“æ„ä½“ä¸æ–¹æ³•</a><ul>
                            
                    <li>
                        <a href="#361-%e7%bb%93%e6%9e%84%e4%bd%93" aria-label="3.6.1 ç»“æ„ä½“">3.6.1 ç»“æ„ä½“</a></li>
                    <li>
                        <a href="#362-%e6%96%b9%e6%b3%95" aria-label="3.6.2 æ–¹æ³•">3.6.2 æ–¹æ³•</a></li></ul>
                    </li>
                    <li>
                        <a href="#37-%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="3.7 é”™è¯¯å¤„ç†">3.7 é”™è¯¯å¤„ç†</a></li>
                    <li>
                        <a href="#38-%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%93%8d%e4%bd%9c" aria-label="3.8 å­—ç¬¦ä¸²æ“ä½œ">3.8 å­—ç¬¦ä¸²æ“ä½œ</a><ul>
                            
                    <li>
                        <a href="#381-%e5%b8%b8%e7%94%a8%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0" aria-label="3.8.1 å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°">3.8.1 å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°</a></li></ul>
                    </li>
                    <li>
                        <a href="#39-json%e5%a4%84%e7%90%86" aria-label="3.9 JSONå¤„ç†">3.9 JSONå¤„ç†</a><ul>
                            
                    <li>
                        <a href="#391-%e7%bc%96%e7%a0%81%e4%b8%8e%e8%a7%a3%e7%a0%81" aria-label="3.9.1 ç¼–ç ä¸è§£ç ">3.9.1 ç¼–ç ä¸è§£ç </a></li></ul>
                    </li>
                    <li>
                        <a href="#310-%e6%97%b6%e9%97%b4%e4%b8%8e%e6%95%b0%e5%ad%97%e8%a7%a3%e6%9e%90" aria-label="3.10 æ—¶é—´ä¸æ•°å­—è§£æ">3.10 æ—¶é—´ä¸æ•°å­—è§£æ</a><ul>
                            
                    <li>
                        <a href="#3101-%e6%97%b6%e9%97%b4%e6%93%8d%e4%bd%9c" aria-label="3.10.1 æ—¶é—´æ“ä½œ">3.10.1 æ—¶é—´æ“ä½œ</a></li>
                    <li>
                        <a href="#3102-%e5%ad%97%e7%ac%a6%e4%b8%b2%e8%bd%ac%e6%95%b0%e5%ad%97" aria-label="3.10.2 å­—ç¬¦ä¸²è½¬æ•°å­—">3.10.2 å­—ç¬¦ä¸²è½¬æ•°å­—</a></li></ul>
                    </li>
                    <li>
                        <a href="#311-%e6%8e%a5%e5%8f%a3" aria-label="3.11 æ¥å£"><strong>3.11 æ¥å£</strong></a><ul>
                            
                    <li>
                        <a href="#3111-%e6%8e%a5%e5%8f%a3%e5%ae%9a%e4%b9%89" aria-label="3.11.1 æ¥å£å®šä¹‰"><strong>3.11.1 æ¥å£å®šä¹‰</strong></a></li>
                    <li>
                        <a href="#3112-%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3%e9%9a%90%e5%bc%8f%e5%ae%9e%e7%8e%b0" aria-label="3.11.2 å®ç°æ¥å£ï¼ˆéšå¼å®ç°ï¼‰"><strong>3.11.2 å®ç°æ¥å£ï¼ˆéšå¼å®ç°ï¼‰</strong></a></li>
                    <li>
                        <a href="#3113-%e4%bd%bf%e7%94%a8%e6%8e%a5%e5%8f%a3%e9%9d%a2%e5%90%91%e6%8e%a5%e5%8f%a3%e7%bc%96%e7%a8%8b" aria-label="3.11.3 ä½¿ç”¨æ¥å£ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼‰"><strong>3.11.3 ä½¿ç”¨æ¥å£ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼‰</strong></a></li>
                    <li>
                        <a href="#3114-%e4%bd%bf%e7%94%a8%e6%8e%a5%e5%8f%a3%e8%bf%9b%e8%a1%8c-mock-%e6%b5%8b%e8%af%95" aria-label="3.11.4 ä½¿ç”¨æ¥å£è¿›è¡Œ Mock æµ‹è¯•"><strong>3.11.4 ä½¿ç”¨æ¥å£è¿›è¡Œ Mock æµ‹è¯•</strong></a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#4-go%e5%b7%a5%e7%a8%8b%e5%ae%9e%e8%b7%b5" aria-label="4. Goå·¥ç¨‹å®è·µ">4. Goå·¥ç¨‹å®è·µ</a><ul>
                            
                    <li>
                        <a href="#41-%e7%8c%9c%e6%95%b0%e5%ad%97%e6%b8%b8%e6%88%8f" aria-label="4.1 çŒœæ•°å­—æ¸¸æˆ">4.1 çŒœæ•°å­—æ¸¸æˆ</a></li>
                    <li>
                        <a href="#42-%e5%9c%a8%e7%ba%bf%e8%af%8d%e5%85%b8" aria-label="4.2 åœ¨çº¿è¯å…¸">4.2 åœ¨çº¿è¯å…¸</a></li>
                    <li>
                        <a href="#43-socks5-%e4%bb%a3%e7%90%86%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" aria-label="4.3 SOCKS5 ä»£ç†æœåŠ¡å™¨ä»£ç å®ç°">4.3 SOCKS5 ä»£ç†æœåŠ¡å™¨ä»£ç å®ç°</a><ul>
                            
                    <li>
                        <a href="#1-socks5-%e5%8d%8f%e8%ae%ae%e6%a6%82%e8%bf%b0" aria-label="1. SOCKS5 åè®®æ¦‚è¿°">1. SOCKS5 åè®®æ¦‚è¿°</a><ul>
                            
                    <li>
                        <a href="#11-socks5-%e4%bb%a3%e7%90%86%e5%8e%9f%e7%90%86" aria-label="1.1 SOCKS5 ä»£ç†åŸç†">1.1 SOCKS5 ä»£ç†åŸç†</a></li></ul>
                    </li>
                    <li>
                        <a href="#2-tcp-echo-%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="2. TCP Echo æœåŠ¡å™¨">2. TCP Echo æœåŠ¡å™¨</a><ul>
                            
                    <li>
                        <a href="#21-tcp-echo-%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bb%a3%e7%a0%81" aria-label="2.1 TCP Echo æœåŠ¡å™¨ä»£ç ">2.1 TCP Echo æœåŠ¡å™¨ä»£ç </a></li>
                    <li>
                        <a href="#22-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="2.2 ä»£ç è¯´æ˜ï¼š">2.2 ä»£ç è¯´æ˜ï¼š</a></li>
                    <li>
                        <a href="#23-%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95" aria-label="2.3 æµ‹è¯•æ–¹æ³•ï¼š">2.3 æµ‹è¯•æ–¹æ³•ï¼š</a></li></ul>
                    </li>
                    <li>
                        <a href="#3-socks5-%e4%bb%a3%e7%90%86%e8%ae%a4%e8%af%81%e5%ae%9e%e7%8e%b0" aria-label="3. SOCKS5 ä»£ç†è®¤è¯å®ç°">3. SOCKS5 ä»£ç†è®¤è¯å®ç°</a><ul>
                            
                    <li>
                        <a href="#31-%e4%bb%a3%e7%a0%81" aria-label="3.1 ä»£ç ">3.1 ä»£ç </a></li>
                    <li>
                        <a href="#32-%e4%bb%a3%e7%a0%81%e8%af%b4%e6%98%8e" aria-label="3.2 ä»£ç è¯´æ˜ï¼š">3.2 ä»£ç è¯´æ˜ï¼š</a></li>
                    <li>
                        <a href="#33-%e6%9c%80%e7%bb%88%e6%b5%8b%e8%af%95" aria-label="3.3 æœ€ç»ˆæµ‹è¯•">3.3 æœ€ç»ˆæµ‹è¯•</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#44-%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f" aria-label="4.4 æ¶ˆæ¯ç³»ç»Ÿ">4.4 æ¶ˆæ¯ç³»ç»Ÿ</a><ul>
                            
                    <li>
                        <a href="#maingo" aria-label="main.go">main.go</a></li>
                    <li>
                        <a href="#servergo" aria-label="server.go">server.go</a></li>
                    <li>
                        <a href="#clientgo" aria-label="client.go">client.go</a></li>
                    <li>
                        <a href="#usergo" aria-label="user.go">user.go</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="goè¯­è¨€åŸºç¡€">Goè¯­è¨€åŸºç¡€<a hidden class="anchor" aria-hidden="true" href="#goè¯­è¨€åŸºç¡€">#</a></h1>
<h2 id="1-goè¯­è¨€æ¦‚è¿°">1. Goè¯­è¨€æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#1-goè¯­è¨€æ¦‚è¿°">#</a></h2>
<ul>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šé€‚åˆå¹¶å‘ç¼–ç¨‹ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜æ€§èƒ½åœºæ™¯ã€‚</li>
<li><strong>ç®€æ´è¯­æ³•</strong>ï¼šGoçš„è¯­æ³•ç®€æ´ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼Œå»é™¤äº†å¤æ‚çš„é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œä¿ç•™äº†å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›ä¼˜åŠ¿ã€‚</li>
<li><strong>ä¸°å¯Œæ ‡å‡†åº“</strong>ï¼šå†…å»ºå¼ºå¤§çš„æ ‡å‡†åº“ï¼Œæ”¯æŒç½‘ç»œã€æ–‡ä»¶æ“ä½œã€å¹¶å‘ç­‰ã€‚</li>
<li><strong>é™æ€é“¾æ¥</strong>ï¼šç”Ÿæˆç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨åº“ï¼Œç®€åŒ–éƒ¨ç½²ã€‚</li>
<li><strong>è·¨å¹³å°</strong>ï¼šæ”¯æŒLinuxã€Windowsã€macOSç­‰å¤šä¸ªå¹³å°ã€‚</li>
<li><strong>åƒåœ¾å›æ”¶</strong>ï¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå‡å°‘å¼€å‘äººå‘˜çš„è´Ÿæ‹…ã€‚</li>
</ul>
<h2 id="2-ç¯å¢ƒæ­å»º">2. ç¯å¢ƒæ­å»º<a hidden class="anchor" aria-hidden="true" href="#2-ç¯å¢ƒæ­å»º">#</a></h2>
<ul>
<li><strong>Goå®‰è£…</strong>ï¼š<a href="https://golang.org/doc/install">å®˜æ–¹å®‰è£…æŒ‡å—</a></li>
<li><strong>æ¨èIDE</strong>ï¼šVSCodeã€GoLandï¼Œæˆ–è€…Gitpodç­‰äº‘å¼€å‘ç¯å¢ƒã€‚</li>
</ul>
<h3 id="go-module">Go Module<a hidden class="anchor" aria-hidden="true" href="#go-module">#</a></h3>
<p><strong><code>go.mod</code></strong>ï¼šç”¨äºç®¡ç† Go é¡¹ç›®çš„ä¾èµ–ï¼Œè®°å½•æ¨¡å—è·¯å¾„ã€Go ç‰ˆæœ¬å’Œæ‰€ä¾èµ–çš„åŒ…åŠå…¶ç‰ˆæœ¬ã€‚</p>
<p><strong><code>go.sum</code></strong>ï¼šç”¨äºè®°å½•æ¯ä¸ªä¾èµ–åŒ…çš„æ ¡éªŒå’Œï¼Œç¡®ä¿ä¾èµ–åŒ…çš„å®Œæ•´æ€§ä¸å®‰å…¨æ€§ã€‚</p>
<h3 id="å‘½ä»¤è¡Œå·¥å…·">å‘½ä»¤è¡Œå·¥å…·<a hidden class="anchor" aria-hidden="true" href="#å‘½ä»¤è¡Œå·¥å…·">#</a></h3>
<h3 id="1go-run">1ã€<code>go run</code><a hidden class="anchor" aria-hidden="true" href="#1go-run">#</a></h3>
<p>æ— éœ€ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€‚åˆç”¨äºå¿«é€Ÿæµ‹è¯•å’Œè°ƒè¯•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run &lt;filename.go&gt; <span style="color:#f92672">[</span>arguments<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>å¯ä»¥ä¼ é€’å¤šä¸ªæ–‡ä»¶åæ¥è¿è¡Œå¤šä¸ªGoæºæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run file1.go file2.go
</span></span></code></pre></div><h3 id="2go-build">2ã€<code>go build</code><a hidden class="anchor" aria-hidden="true" href="#2go-build">#</a></h3>
<p>ç¼–è¯‘ä»£ç ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶çš„å·¥å…·ï¼Œç¼–è¯‘åŸä»£ç å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥åœ¨æ²¡æœ‰Goç¯å¢ƒçš„æœºå™¨ä¸Šè¿è¡Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build &lt;filename.go&gt;
</span></span></code></pre></div><h4 id="è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å">è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build -o myapp main.go
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build file1.go file2.go
</span></span></code></pre></div><h4 id="æ„å»ºä¸€ä¸ªåŒ…">æ„å»ºä¸€ä¸ªåŒ…<a hidden class="anchor" aria-hidden="true" href="#æ„å»ºä¸€ä¸ªåŒ…">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build
</span></span></code></pre></div><h3 id="3go-install">3ã€<code>go install</code><a hidden class="anchor" aria-hidden="true" href="#3go-install">#</a></h3>
<p>ä¸ <code>go build</code> ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº <code>go install</code> ä¼šå°†ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åˆ°Goçš„<code>GOPATH</code>ä¸‹ï¼ˆæˆ–è€…æ¨¡å—æ¨¡å¼ä¸‹ä¼šå®‰è£…åˆ°<code>GOBIN</code>)ã€‚å®ƒé€šå¸¸ç”¨äºå°†ç¼–è¯‘åçš„å·¥å…·æˆ–åº”ç”¨ç¨‹åºå®‰è£…åˆ°ç³»ç»Ÿä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go install &lt;package&gt;
</span></span></code></pre></div><h4 id="ç¤ºä¾‹">ç¤ºä¾‹ï¼š<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹">#</a></h4>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>go install</code> å®‰è£…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go install github.com/spf13/cobra@latest
</span></span></code></pre></div><p>ä¼šå°† <code>cobra</code> å®‰è£…åˆ°ä½ çš„ <code>GOBIN</code> ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ã€‚</p>
<h3 id="4go-test">4ã€<code>go test</code><a hidden class="anchor" aria-hidden="true" href="#4go-test">#</a></h3>
<p><code>go test</code> æ˜¯ Go æä¾›çš„æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–è¿è¡ŒGoçš„å•å…ƒæµ‹è¯•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test &lt;package&gt;
</span></span></code></pre></div><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ <code>main_test.go</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>package main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import <span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func TestAdd<span style="color:#f92672">(</span>t *testing.T<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    result :<span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> + <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> result !<span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        t.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;æœŸæœ› 3ï¼Œå®é™…æ˜¯ %d&#34;</span>, result<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä½ å¯ä»¥è¿è¡Œ <code>go test</code> æ¥è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test
</span></span></code></pre></div><h4 id="æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡º">æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡ºï¼š<a hidden class="anchor" aria-hidden="true" href="#æŸ¥çœ‹æµ‹è¯•è¯¦ç»†è¾“å‡º">#</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>go test</code> ä¼šéšè—è¯¦ç»†è¾“å‡ºã€‚å¦‚æœä½ æƒ³æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>-v</code> å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test -v
</span></span></code></pre></div><h4 id="è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°">è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼š<a hidden class="anchor" aria-hidden="true" href="#è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°">#</a></h4>
<p>å¦‚æœä½ åªæƒ³è¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>-run</code> å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test -run TestAdd
</span></span></code></pre></div><h3 id="5go-get">5ã€<code>go get</code><a hidden class="anchor" aria-hidden="true" href="#5go-get">#</a></h3>
<p><code>go get</code> ç”¨äºå®‰è£…å’Œæ›´æ–° Go åŒ…ã€‚å¦‚æœä½ éœ€è¦ä¸‹è½½ç¬¬ä¸‰æ–¹åº“æˆ–è€…å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ <code>go get</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get &lt;package&gt;
</span></span></code></pre></div><h4 id="ç¤ºä¾‹-1">ç¤ºä¾‹ï¼š<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹-1">#</a></h4>
<p>ä¸‹è½½å¹¶å®‰è£…ä¸€ä¸ªåŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/spf13/cobra
</span></span></code></pre></div><p>å¦‚æœä½ åœ¨æ¨¡å—æ¨¡å¼ä¸‹ï¼Œ<code>go get</code> ä¼šè‡ªåŠ¨æ›´æ–° <code>go.mod</code> æ–‡ä»¶ã€‚</p>
<h4 id="è·å–æœ€æ–°ç‰ˆæœ¬">è·å–æœ€æ–°ç‰ˆæœ¬ï¼š<a hidden class="anchor" aria-hidden="true" href="#è·å–æœ€æ–°ç‰ˆæœ¬">#</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>go get</code> ä¼šä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚å¦‚æœä½ éœ€è¦è·å–ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/spf13/cobra@v1.2.3
</span></span></code></pre></div><h3 id="6go-mod">6ã€<code>go mod</code><a hidden class="anchor" aria-hidden="true" href="#6go-mod">#</a></h3>
<p>Go 1.11 ä»¥åå¼•å…¥äº†æ¨¡å—åŒ–ï¼ˆModuleï¼‰ç³»ç»Ÿï¼Œ<code>go mod</code> æ˜¯ Go è¯­è¨€ä¸­ç”¨äºç®¡ç†ä¾èµ–çš„å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„ <code>go mod</code> å‘½ä»¤ï¼š</p>
<h4 id="61-go-mod-init">6.1 <code>go mod init</code><a hidden class="anchor" aria-hidden="true" href="#61-go-mod-init">#</a></h4>
<p>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Go æ¨¡å—ï¼Œåœ¨å½“å‰ç›®å½•åˆ›å»º <code>go.mod</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go mod init &lt;module-name&gt;
</span></span></code></pre></div><h4 id="62-go-mod-tidy">6.2 <code>go mod tidy</code><a hidden class="anchor" aria-hidden="true" href="#62-go-mod-tidy">#</a></h4>
<p>æ¸…ç†æ¨¡å—æ–‡ä»¶ï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä¾èµ–ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€æœ‰éœ€è¦çš„ä¾èµ–éƒ½åœ¨ <code>go.mod</code> å’Œ <code>go.sum</code> æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go mod tidy
</span></span></code></pre></div><h4 id="63-go-mod-vendor">6.3 <code>go mod vendor</code><a hidden class="anchor" aria-hidden="true" href="#63-go-mod-vendor">#</a></h4>
<p>å°†æ‰€æœ‰ä¾èµ–å¤åˆ¶åˆ°æœ¬åœ° <code>vendor</code> ç›®å½•ä¸­ï¼Œè¿™å¯¹äºæŸäº›éœ€è¦ç¦»çº¿æ„å»ºçš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>go mod vendor
</span></span></code></pre></div><h3 id="7go-fmt-ä¸ä»£ç æ ¼å¼åŒ–">7ã€<code>go fmt</code> ä¸ä»£ç æ ¼å¼åŒ–<a hidden class="anchor" aria-hidden="true" href="#7go-fmt-ä¸ä»£ç æ ¼å¼åŒ–">#</a></h3>
<p><code>go fmt</code> æ˜¯ Go çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è°ƒæ•´ Go æºä»£ç çš„æ ¼å¼ï¼Œä½¿å…¶ç¬¦åˆ Go çš„ä»£ç é£æ ¼ã€‚é€šå¸¸åœ¨æäº¤ä»£ç å‰è¿è¡Œï¼Œä»¥ä¿æŒä»£ç é£æ ¼ä¸€è‡´ã€‚</p>
<h4 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•ï¼š<a hidden class="anchor" aria-hidden="true" href="#åŸºæœ¬è¯­æ³•">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go fmt &lt;filename.go&gt;
</span></span></code></pre></div><h4 id="æ ¼å¼åŒ–æ•´ä¸ªåŒ…">æ ¼å¼åŒ–æ•´ä¸ªåŒ…ï¼š<a hidden class="anchor" aria-hidden="true" href="#æ ¼å¼åŒ–æ•´ä¸ªåŒ…">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go fmt ./...
</span></span></code></pre></div><h2 id="3-goåŸºç¡€è¯­æ³•">3. GoåŸºç¡€è¯­æ³•<a hidden class="anchor" aria-hidden="true" href="#3-goåŸºç¡€è¯­æ³•">#</a></h2>
<h3 id="31-hello-world">3.1 Hello World<a hidden class="anchor" aria-hidden="true" href="#31-hello-world">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span> <span style="color:#75715e">// å®šä¹‰åŒ…åï¼ŒmainåŒ…æ˜¯Goç¨‹åºçš„å…¥å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span> <span style="color:#75715e">// å¼•å…¥fmtåŒ…ï¼Œç”¨äºæ ¼å¼åŒ–è¾“å…¥è¾“å‡º</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// mainå‡½æ•°æ˜¯Goç¨‹åºçš„å…¥å£</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>) <span style="color:#75715e">// è¾“å‡ºHello, World!</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="32-å˜é‡å£°æ˜ä¸åˆå§‹åŒ–">3.2 å˜é‡å£°æ˜ä¸åˆå§‹åŒ–<a hidden class="anchor" aria-hidden="true" href="#32-å˜é‡å£°æ˜ä¸åˆå§‹åŒ–">#</a></h3>
<h4 id="321-å¸¸è§„å£°æ˜">3.2.1 å¸¸è§„å£°æ˜<a hidden class="anchor" aria-hidden="true" href="#321-å¸¸è§„å£°æ˜">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> = <span style="color:#e6db74">&#34;initial&#34;</span> <span style="color:#75715e">// å£°æ˜å˜é‡aï¼Œå¹¶åˆå§‹åŒ–ä¸º&#34;initial&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span> <span style="color:#75715e">// åŒæ—¶å£°æ˜bå’Œcå¹¶åˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> = <span style="color:#66d9ef">true</span> <span style="color:#75715e">// è‡ªåŠ¨æ¨æ–­dçš„ç±»å‹ä¸ºbool</span>
</span></span></code></pre></div><h4 id="322-ä½¿ç”¨ç®€æ´å£°æ˜">3.2.2 ä½¿ç”¨<code>:=</code>ç®€æ´å£°æ˜<a hidden class="anchor" aria-hidden="true" href="#322-ä½¿ç”¨ç®€æ´å£°æ˜">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">3.14</span> <span style="color:#75715e">// :=ç”¨äºå£°æ˜å¹¶åˆå§‹åŒ–å˜é‡ï¼Œç±»å‹ç”±ç¼–è¯‘å™¨æ¨æ–­</span>
</span></span></code></pre></div><h4 id="323-ç©ºç™½æ ‡è¯†ç¬¦">3.2.3 ç©ºç™½æ ‡è¯†ç¬¦<a hidden class="anchor" aria-hidden="true" href="#323-ç©ºç™½æ ‡è¯†ç¬¦">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;file.txt&#34;</span>) <span style="color:#75715e">// é€šè¿‡ç©ºç™½æ ‡è¯†ç¬¦å¿½ç•¥æŸä¸ªè¿”å›å€¼</span>
</span></span></code></pre></div><h3 id="33-æ§åˆ¶ç»“æ„">3.3 æ§åˆ¶ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#33-æ§åˆ¶ç»“æ„">#</a></h3>
<h4 id="331-if-elseè¯­å¥">3.3.1 if-elseè¯­å¥<a hidden class="anchor" aria-hidden="true" href="#331-if-elseè¯­å¥">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">num</span> &lt; <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;is negative&#34;</span>) <span style="color:#75715e">// å¦‚æœnumå°äº0ï¼Œè¾“å‡ºè´Ÿæ•°</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">num</span> &lt; <span style="color:#ae81ff">10</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;has 1 digit&#34;</span>) <span style="color:#75715e">// å¦‚æœnumå°äº10ï¼Œè¾“å‡º1ä½æ•°</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">num</span>, <span style="color:#e6db74">&#34;has multiple digits&#34;</span>) <span style="color:#75715e">// å¦åˆ™è¾“å‡ºå¤šä½æ•°</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="332-switchè¯­å¥">3.3.2 switchè¯­å¥<a hidden class="anchor" aria-hidden="true" href="#332-switchè¯­å¥">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">day</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;Monday&#34;</span>; <span style="color:#a6e22e">day</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Monday&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Start of the week&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Friday&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;End of the week&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Midweek&#34;</span>) <span style="color:#75715e">// é»˜è®¤æƒ…å†µ</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="333-forå¾ªç¯">3.3.3 forå¾ªç¯<a hidden class="anchor" aria-hidden="true" href="#333-forå¾ªç¯">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Goåªæœ‰ä¸€ä¸ªå¾ªç¯ç»“æ„forï¼Œå…¶ä»–çš„å¦‚whileéƒ½å¯ä»¥é€šè¿‡forå®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">3</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> { <span style="color:#75715e">// ä»0åˆ°2çš„å¾ªç¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">i</span>) <span style="color:#75715e">// è¾“å‡ºå¾ªç¯çš„æ¯ä¸ªå€¼</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="34-æ•°ç»„ä¸åˆ‡ç‰‡">3.4 æ•°ç»„ä¸åˆ‡ç‰‡<a hidden class="anchor" aria-hidden="true" href="#34-æ•°ç»„ä¸åˆ‡ç‰‡">#</a></h3>
<h4 id="341-æ•°ç»„">3.4.1 æ•°ç»„<a hidden class="anchor" aria-hidden="true" href="#341-æ•°ç»„">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">arr</span> [<span style="color:#ae81ff">5</span>]<span style="color:#66d9ef">int</span> <span style="color:#75715e">// å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º5çš„æ•°ç»„</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">10</span>    <span style="color:#75715e">// ç»™æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">arr</span>) <span style="color:#75715e">// è¾“å‡ºæ•´ä¸ªæ•°ç»„</span>
</span></span></code></pre></div><h4 id="342-åˆ‡ç‰‡">3.4.2 åˆ‡ç‰‡<a hidden class="anchor" aria-hidden="true" href="#342-åˆ‡ç‰‡">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// åˆ‡ç‰‡æ˜¯Goçš„ä¸€ä¸ªçµæ´»æ•°æ®ç»“æ„ï¼Œä¸åƒæ•°ç»„å¤§å°å›ºå®š</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s</span> = append(<span style="color:#a6e22e">s</span>, <span style="color:#e6db74">&#34;d&#34;</span>) <span style="color:#75715e">// appendå‡½æ•°åŠ¨æ€æ‰©å±•åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>) <span style="color:#75715e">// è¾“å‡ºåˆ‡ç‰‡</span>
</span></span></code></pre></div><h4 id="343-åˆ‡ç‰‡çš„åˆ›å»º">3.4.3 åˆ‡ç‰‡çš„åˆ›å»º<a hidden class="anchor" aria-hidden="true" href="#343-åˆ‡ç‰‡çš„åˆ›å»º">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">5</span>) <span style="color:#75715e">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º5çš„åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>) <span style="color:#75715e">// è¾“å‡º: [0 0 0 0 0]</span>
</span></span></code></pre></div><h3 id="35-å‡½æ•°">3.5 å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#35-å‡½æ•°">#</a></h3>
<h4 id="351-åŸºæœ¬å‡½æ•°">3.5.1 åŸºæœ¬å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#351-åŸºæœ¬å‡½æ•°">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">a</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> { <span style="color:#75715e">// å‡½æ•°å£°æ˜ï¼Œè¿”å›a+bçš„ç»“æœ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#75715e">// è°ƒç”¨å‡½æ•°å¹¶æ‰“å°è¿”å›å€¼</span>
</span></span></code></pre></div><h4 id="352-å¤šè¿”å›å€¼">3.5.2 å¤šè¿”å›å€¼<a hidden class="anchor" aria-hidden="true" href="#352-å¤šè¿”å›å€¼">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">divide</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) (<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">a</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">b</span> <span style="color:#75715e">// è¿”å›å•†å’Œä½™æ•°</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">quotient</span>, <span style="color:#a6e22e">remainder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">divide</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">3</span>) <span style="color:#75715e">// è§£æ„è¿”å›å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">quotient</span>, <span style="color:#a6e22e">remainder</span>)
</span></span></code></pre></div><h4 id="353-å¯å˜å‚æ•°">3.5.3 å¯å˜å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#353-å¯å˜å‚æ•°">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">nums</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> { <span style="color:#75715e">// numsæ˜¯ä¸€ä¸ªæ•´æ•°åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nums</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">num</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">total</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">sum</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>)) <span style="color:#75715e">// ä¼ å…¥å¤šä¸ªå‚æ•°</span>
</span></span></code></pre></div><h3 id="36-ç»“æ„ä½“ä¸æ–¹æ³•">3.6 ç»“æ„ä½“ä¸æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#36-ç»“æ„ä½“ä¸æ–¹æ³•">#</a></h3>
<h4 id="361-ç»“æ„ä½“">3.6.1 ç»“æ„ä½“<a hidden class="anchor" aria-hidden="true" href="#361-ç»“æ„ä½“">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#e6db74">&#34;password123&#34;</span>} <span style="color:#75715e">// åˆå§‹åŒ–ç»“æ„ä½“</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>)
</span></span></code></pre></div><h4 id="362-æ–¹æ³•">3.6.2 æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#362-æ–¹æ³•">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ä¸ºUserç±»å‹å®šä¹‰ä¸€ä¸ªæ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">ResetPassword</span>(<span style="color:#a6e22e">password</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Password</span> = <span style="color:#a6e22e">password</span> <span style="color:#75715e">// ä¿®æ”¹ç»“æ„ä½“å®ä¾‹çš„å­—æ®µ</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">ResetPassword</span>(<span style="color:#e6db74">&#34;newpassword&#34;</span>) <span style="color:#75715e">// è°ƒç”¨æ–¹æ³•ä¿®æ”¹Passwordå­—æ®µ</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Password</span>)
</span></span></code></pre></div><h3 id="37-é”™è¯¯å¤„ç†">3.7 é”™è¯¯å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#37-é”™è¯¯å¤„ç†">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">findUser</span>(<span style="color:#a6e22e">users</span> []<span style="color:#a6e22e">User</span>, <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">u</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">users</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">name</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">u</span>, <span style="color:#66d9ef">nil</span> <span style="color:#75715e">// æ‰¾åˆ°ç”¨æˆ·ï¼Œè¿”å›æŒ‡é’ˆå’Œnilé”™è¯¯</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;user not found&#34;</span>) <span style="color:#75715e">// æ²¡æ‰¾åˆ°ï¼Œè¿”å›é”™è¯¯</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">findUser</span>([]<span style="color:#a6e22e">User</span>{{<span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#e6db74">&#34;1024&#34;</span>}}, <span style="color:#e6db74">&#34;wang&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>) <span style="color:#75715e">// æ‰“å°é”™è¯¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Name</span>) <span style="color:#75715e">// å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ‰“å°ç”¨æˆ·ä¿¡æ¯</span>
</span></span></code></pre></div><h3 id="38-å­—ç¬¦ä¸²æ“ä½œ">3.8 å­—ç¬¦ä¸²æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#38-å­—ç¬¦ä¸²æ“ä½œ">#</a></h3>
<h4 id="381-å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°">3.8.1 å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#381-å¸¸ç”¨å­—ç¬¦ä¸²å‡½æ•°">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;Hello, World!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#34;World&#34;</span>)) <span style="color:#75715e">// æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«&#34;World&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">ToUpper</span>(<span style="color:#a6e22e">str</span>)) <span style="color:#75715e">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">str</span>, <span style="color:#e6db74">&#34;, &#34;</span>)) <span style="color:#75715e">// æŒ‰æŒ‡å®šåˆ†éš”ç¬¦åˆ‡å‰²å­—ç¬¦ä¸²</span>
</span></span></code></pre></div><h3 id="39-jsonå¤„ç†">3.9 JSONå¤„ç†<a hidden class="anchor" aria-hidden="true" href="#39-jsonå¤„ç†">#</a></h3>
<h4 id="391-ç¼–ç ä¸è§£ç ">3.9.1 ç¼–ç ä¸è§£ç <a hidden class="anchor" aria-hidden="true" href="#391-ç¼–ç ä¸è§£ç ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UserInfo</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>    <span style="color:#e6db74">`json:&#34;age&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">UserInfo</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">buf</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">a</span>) <span style="color:#75715e">// å°†ç»“æ„ä½“ç¼–ç ä¸ºJSON</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error encoding JSON:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(string(<span style="color:#a6e22e">buf</span>)) <span style="color:#75715e">// è¾“å‡ºJSONå­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#a6e22e">UserInfo</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">buf</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">b</span>) <span style="color:#75715e">// å°†JSONå­—ç¬¦ä¸²è§£ç ä¸ºç»“æ„ä½“</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error decoding JSON:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)
</span></span></code></pre></div><h3 id="310-æ—¶é—´ä¸æ•°å­—è§£æ">3.10 æ—¶é—´ä¸æ•°å­—è§£æ<a hidden class="anchor" aria-hidden="true" href="#310-æ—¶é—´ä¸æ•°å­—è§£æ">#</a></h3>
<h4 id="3101-æ—¶é—´æ“ä½œ">3.10.1 æ—¶é—´æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#3101-æ—¶é—´æ“ä½œ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>() <span style="color:#75715e">// è·å–å½“å‰æ—¶é—´</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>)) <span style="color:#75715e">// æ ¼å¼åŒ–æ—¶é—´</span>
</span></span></code></pre></div><h4 id="3102-å­—ç¬¦ä¸²è½¬æ•°å­—">3.10.2 å­—ç¬¦ä¸²è½¬æ•°å­—<a hidden class="anchor" aria-hidden="true" href="#3102-å­—ç¬¦ä¸²è½¬æ•°å­—">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;strconv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">str</span>) <span style="color:#75715e">// å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Error converting string to number:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">n</span>) <span style="color:#75715e">// è¾“å‡º123</span>
</span></span></code></pre></div><h3 id="311-æ¥å£"><strong>3.11 æ¥å£</strong><a hidden class="anchor" aria-hidden="true" href="#311-æ¥å£">#</a></h3>
<p>Go çš„æ¥å£ï¼ˆinterfaceï¼‰é€šè¿‡<strong>æ–¹æ³•é›†åˆ</strong>å®šä¹‰è¡Œä¸ºã€‚åªè¦ä¸€ä¸ªç±»å‹æ‹¥æœ‰æ¥å£è¦æ±‚çš„å…¨éƒ¨æ–¹æ³•ï¼Œå®ƒå°±<strong>è‡ªåŠ¨å®ç°</strong>è¯¥æ¥å£ï¼Œæ— éœ€æ˜¾å¼å£°æ˜ã€‚</p>
<p>æ¥å£çš„å…¸å‹ç”¨é€”æ˜¯ï¼š
<strong>è§£è€¦ä¾èµ–ã€æ–¹ä¾¿æµ‹è¯•ã€å®ç°å¤šæ€ã€‚</strong></p>
<hr>
<h4 id="3111-æ¥å£å®šä¹‰"><strong>3.11.1 æ¥å£å®šä¹‰</strong><a hidden class="anchor" aria-hidden="true" href="#3111-æ¥å£å®šä¹‰">#</a></h4>
<p>ä½¿ç”¨ <code>type</code> å®šä¹‰æ¥å£ï¼Œæ¥å£ä¸­åªåŒ…å«æ–¹æ³•ç­¾åï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DB</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">sql</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»»ä½•ç±»å‹åªè¦å®ç°äº† <code>Query</code> æ–¹æ³•ï¼Œå°±è‡ªåŠ¨å®ç°äº† <code>DB</code> æ¥å£ã€‚</p>
<hr>
<h4 id="3112-å®ç°æ¥å£éšå¼å®ç°"><strong>3.11.2 å®ç°æ¥å£ï¼ˆéšå¼å®ç°ï¼‰</strong><a hidden class="anchor" aria-hidden="true" href="#3112-å®ç°æ¥å£éšå¼å®ç°">#</a></h4>
<p>æ— éœ€å†™â€œimplementsâ€ã€‚ç»“æ„ä½“åªè¦æä¾›åŒåæ–¹æ³•å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MySQL</span> <span style="color:#66d9ef">struct</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">MySQL</span>) <span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">sql</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;real data&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç°åœ¨ <code>MySQL</code> å°±å®ç°äº† <code>DB</code>ã€‚</p>
<hr>
<h4 id="3113-ä½¿ç”¨æ¥å£é¢å‘æ¥å£ç¼–ç¨‹"><strong>3.11.3 ä½¿ç”¨æ¥å£ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼‰</strong><a hidden class="anchor" aria-hidden="true" href="#3113-ä½¿ç”¨æ¥å£é¢å‘æ¥å£ç¼–ç¨‹">#</a></h4>
<p>å‡½æ•°ä¾èµ–æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">FetchUser</span>(<span style="color:#a6e22e">db</span> <span style="color:#a6e22e">DB</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;SELECT * FROM user&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è°ƒç”¨æ—¶å¯ä»¥ä¼ å…¥ä»»ä½•å®ç°äº† <code>DB</code> çš„å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">mysql</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">MySQL</span>{}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">FetchUser</span>(<span style="color:#a6e22e">mysql</span>))
</span></span></code></pre></div><hr>
<h4 id="3114-ä½¿ç”¨æ¥å£è¿›è¡Œ-mock-æµ‹è¯•"><strong>3.11.4 ä½¿ç”¨æ¥å£è¿›è¡Œ Mock æµ‹è¯•</strong><a hidden class="anchor" aria-hidden="true" href="#3114-ä½¿ç”¨æ¥å£è¿›è¡Œ-mock-æµ‹è¯•">#</a></h4>
<p>æ¥å£æœ€é‡è¦çš„ä»·å€¼ä¹‹ä¸€æ˜¯ï¼š
<strong>åœ¨æµ‹è¯•ä¸­è½»æ¾æ›¿æ¢ä¾èµ–ã€‚</strong></p>
<p>ç¤ºä¾‹ï¼šåˆ›å»º Mock å®ç°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MockDB</span> <span style="color:#66d9ef">struct</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">MockDB</span>) <span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">sql</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;fake data&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æµ‹è¯•æ—¶æ›¿æ¢çœŸå®æ•°æ®åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">mock</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">MockDB</span>{}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">FetchUser</span>(<span style="color:#a6e22e">mock</span>)) <span style="color:#75715e">// è¾“å‡º fake data</span>
</span></span></code></pre></div><p>è¿™æ ·å¯ä»¥é¿å…ä¾èµ–çœŸå®æ•°æ®åº“ï¼Œæå‡æµ‹è¯•æ•ˆç‡ã€‚</p>
<h2 id="4-goå·¥ç¨‹å®è·µ">4. Goå·¥ç¨‹å®è·µ<a hidden class="anchor" aria-hidden="true" href="#4-goå·¥ç¨‹å®è·µ">#</a></h2>
<h3 id="41-çŒœæ•°å­—æ¸¸æˆ">4.1 çŒœæ•°å­—æ¸¸æˆ<a hidden class="anchor" aria-hidden="true" href="#41-çŒœæ•°å­—æ¸¸æˆ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>()) <span style="color:#75715e">// ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºéšæœºæ•°ç§å­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">secretNumber</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">100</span>)  <span style="color:#75715e">// ç”Ÿæˆä¸€ä¸ª0åˆ°99ä¹‹é—´çš„éšæœºæ•°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Guess the secret number between 0 and 100!&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">guess</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#e6db74">&#34;Enter your guess: &#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">guess</span>) <span style="color:#75715e">// è¯»å–ç”¨æˆ·è¾“å…¥çš„çŒœæµ‹å€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">guess</span> &lt; <span style="color:#a6e22e">secretNumber</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Too low!&#34;</span>)
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">guess</span> &gt; <span style="color:#a6e22e">secretNumber</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Too high!&#34;</span>)
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;You guessed it!&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="42-åœ¨çº¿è¯å…¸">4.2 åœ¨çº¿è¯å…¸<a hidden class="anchor" aria-hidden="true" href="#42-åœ¨çº¿è¯å…¸">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io/ioutil&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DictRequest</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">TransType</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;trans_type&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Source</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">UserID</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;user_id&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DictResponse</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Rc</span>   <span style="color:#66d9ef">int</span> <span style="color:#e6db74">`json:&#34;rc&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Wiki</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">KnownInLaguages</span> <span style="color:#66d9ef">int</span> <span style="color:#e6db74">`json:&#34;known_in_laguages&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Description</span>     <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Source</span> <span style="color:#66d9ef">string</span>      <span style="color:#e6db74">`json:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Target</span> <span style="color:#66d9ef">interface</span>{} <span style="color:#e6db74">`json:&#34;target&#34;`</span>
</span></span><span style="display:flex;"><span>		} <span style="color:#e6db74">`json:&#34;description&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ID</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;id&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Item</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Source</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Target</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;target&#34;`</span>
</span></span><span style="display:flex;"><span>		} <span style="color:#e6db74">`json:&#34;item&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ImageURL</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;image_url&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">IsSubject</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;is_subject&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Sitelink</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;sitelink&#34;`</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#e6db74">`json:&#34;wiki&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Dictionary</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Prons</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">EnUs</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;en-us&#34;`</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">En</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;en&#34;`</span>
</span></span><span style="display:flex;"><span>		} <span style="color:#e6db74">`json:&#34;prons&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Explanations</span> []<span style="color:#66d9ef">string</span>      <span style="color:#e6db74">`json:&#34;explanations&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Synonym</span>      []<span style="color:#66d9ef">string</span>      <span style="color:#e6db74">`json:&#34;synonym&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Antonym</span>      []<span style="color:#66d9ef">string</span>      <span style="color:#e6db74">`json:&#34;antonym&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">WqxExample</span>   [][]<span style="color:#66d9ef">string</span>    <span style="color:#e6db74">`json:&#34;wqx_example&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Entry</span>        <span style="color:#66d9ef">string</span>        <span style="color:#e6db74">`json:&#34;entry&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Type</span>         <span style="color:#66d9ef">string</span>        <span style="color:#e6db74">`json:&#34;type&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Related</span>      []<span style="color:#66d9ef">interface</span>{} <span style="color:#e6db74">`json:&#34;related&#34;`</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Source</span>       <span style="color:#66d9ef">string</span>        <span style="color:#e6db74">`json:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#e6db74">`json:&#34;dictionary&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">word</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Client</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">request</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">DictRequest</span>{<span style="color:#a6e22e">TransType</span>: <span style="color:#e6db74">&#34;en2zh&#34;</span>, <span style="color:#a6e22e">Source</span>: <span style="color:#a6e22e">word</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buf</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">request</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> = <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">NewRequest</span>(<span style="color:#e6db74">&#34;POST&#34;</span>, <span style="color:#e6db74">&#34;https://api.interpreter.caiyunai.com/v1/dict&#34;</span>, <span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Connection&#34;</span>, <span style="color:#e6db74">&#34;keep-alive&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;DNT&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;os-version&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;sec-ch-ua-mobile&#34;</span>, <span style="color:#e6db74">&#34;?0&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;app-name&#34;</span>, <span style="color:#e6db74">&#34;xy&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;application/json;charset=UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Accept&#34;</span>, <span style="color:#e6db74">&#34;application/json, text/plain, */*&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;device-id&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;os-type&#34;</span>, <span style="color:#e6db74">&#34;web&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;X-Authorization&#34;</span>, <span style="color:#e6db74">&#34;token:xxx&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Origin&#34;</span>, <span style="color:#e6db74">&#34;https://fanyi.caiyunapp.com&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Sec-Fetch-Site&#34;</span>, <span style="color:#e6db74">&#34;cross-site&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Sec-Fetch-Mode&#34;</span>, <span style="color:#e6db74">&#34;cors&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Sec-Fetch-Dest&#34;</span>, <span style="color:#e6db74">&#34;empty&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Referer&#34;</span>, <span style="color:#e6db74">&#34;https://fanyi.caiyunapp.com/&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Accept-Language&#34;</span>, <span style="color:#e6db74">&#34;zh-CN,zh;q=0.9&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Cookie&#34;</span>, <span style="color:#e6db74">&#34;_ym_uid=16456948721020430059; _ym_d=1645694872&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#a6e22e">req</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">bodyText</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">StatusCode</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;bad StatusCode:&#34;</span>, <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">StatusCode</span>, <span style="color:#e6db74">&#34;body&#34;</span>, string(<span style="color:#a6e22e">bodyText</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dictResponse</span> <span style="color:#a6e22e">DictResponse</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">bodyText</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">dictResponse</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">word</span>, <span style="color:#e6db74">&#34;UK:&#34;</span>, <span style="color:#a6e22e">dictResponse</span>.<span style="color:#a6e22e">Dictionary</span>.<span style="color:#a6e22e">Prons</span>.<span style="color:#a6e22e">En</span>, <span style="color:#e6db74">&#34;US:&#34;</span>, <span style="color:#a6e22e">dictResponse</span>.<span style="color:#a6e22e">Dictionary</span>.<span style="color:#a6e22e">Prons</span>.<span style="color:#a6e22e">EnUs</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">dictResponse</span>.<span style="color:#a6e22e">Dictionary</span>.<span style="color:#a6e22e">Explanations</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">item</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">`usage: simpleDict WORD
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">example: simpleDict hello
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		`</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">word</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">word</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ken@Ken:/mnt/d/Go/go-demo/02-Goè¯­è¨€çš„å®æˆ˜æ¡ˆä¾‹/02-simpledict/v4$ ./simpledict hello
</span></span><span style="display:flex;"><span>hello UK: <span style="color:#f92672">[</span>ËˆheËˆlÉ™u<span style="color:#f92672">]</span> US: <span style="color:#f92672">[</span>hÉ™Ëˆlo<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>int.å–‚;å“ˆç½—
</span></span><span style="display:flex;"><span>n.å¼•äººæ³¨æ„çš„å‘¼å£°
</span></span><span style="display:flex;"><span>v.å‘äººå‘¼<span style="color:#f92672">(</span>å–‚<span style="color:#f92672">)</span>
</span></span></code></pre></div><hr>
<h3 id="43-socks5-ä»£ç†æœåŠ¡å™¨ä»£ç å®ç°">4.3 SOCKS5 ä»£ç†æœåŠ¡å™¨ä»£ç å®ç°<a hidden class="anchor" aria-hidden="true" href="#43-socks5-ä»£ç†æœåŠ¡å™¨ä»£ç å®ç°">#</a></h3>
<h4 id="1-socks5-åè®®æ¦‚è¿°">1. SOCKS5 åè®®æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#1-socks5-åè®®æ¦‚è¿°">#</a></h4>
<h5 id="11-socks5-ä»£ç†åŸç†">1.1 SOCKS5 ä»£ç†åŸç†<a hidden class="anchor" aria-hidden="true" href="#11-socks5-ä»£ç†åŸç†">#</a></h5>
<p>SOCKS5 æ˜¯ä¸€ç§ä»£ç†åè®®ï¼Œåœ¨ç½‘ç»œä¸­å……å½“å®¢æˆ·ç«¯ä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­ä»‹ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®è¿œç¨‹èµ„æºï¼Œé€šå¸¸ç”¨äºè§„é¿é˜²ç«å¢™ã€æé«˜å®‰å…¨æ€§ç­‰ã€‚</p>
<p><strong>ä»£ç†æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</strong></p>
<ol>
<li><strong>æ¡æ‰‹é˜¶æ®µ</strong>ï¼šå®¢æˆ·ç«¯å‘ SOCKS5 ä»£ç†å‘é€åè®®ç‰ˆæœ¬å·åŠè®¤è¯æ–¹å¼ã€‚</li>
<li><strong>è®¤è¯é˜¶æ®µ</strong>ï¼šæ ¹æ®ä»£ç†æœåŠ¡å™¨çš„è¿”å›ï¼Œè¿›è¡Œç›¸åº”çš„èº«ä»½éªŒè¯ã€‚</li>
<li><strong>è¯·æ±‚é˜¶æ®µ</strong>ï¼šè®¤è¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯å‘ SOCKS5 ä»£ç†å‘é€è¯·æ±‚ï¼Œè¦æ±‚å»ºç«‹ä¸ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥ã€‚</li>
<li><strong>ä¸­ç»§é˜¶æ®µ</strong>ï¼šä»£ç†æœåŠ¡å™¨è½¬å‘å®¢æˆ·ç«¯è¯·æ±‚å’Œç›®æ ‡æœåŠ¡å™¨çš„å“åº”ï¼Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚</li>
</ol>
<hr>
<h4 id="2-tcp-echo-æœåŠ¡å™¨">2. TCP Echo æœåŠ¡å™¨<a hidden class="anchor" aria-hidden="true" href="#2-tcp-echo-æœåŠ¡å™¨">#</a></h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç®€å•çš„ TCP Echo æœåŠ¡å™¨ï¼Œå¤„ç†ä»å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶è¿”å›ç›¸åŒçš„æ•°æ®ã€‚</p>
<h5 id="21-tcp-echo-æœåŠ¡å™¨ä»£ç ">2.1 TCP Echo æœåŠ¡å™¨ä»£ç <a hidden class="anchor" aria-hidden="true" href="#21-tcp-echo-æœåŠ¡å™¨ä»£ç ">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;bufio&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">server</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;127.0.0.1:1080&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Accept</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;accept error: %w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">client</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">buf</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read buf error: %w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">buf</span>})
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;write buf back error: %w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="22-ä»£ç è¯´æ˜">2.2 ä»£ç è¯´æ˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#22-ä»£ç è¯´æ˜">#</a></h5>
<ul>
<li><strong>net.Listen</strong>ï¼šåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªç›‘å¬æŒ‡å®šç«¯å£çš„æœåŠ¡å™¨ï¼ˆè¿™é‡Œæ˜¯ <code>127.0.0.1:1080</code>ï¼‰ã€‚</li>
<li><strong>Accept</strong>ï¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªè¿æ¥å¯¹è±¡ã€‚</li>
<li><strong>process</strong>ï¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚<code>bufio.NewReader</code> ç”¨äºæé«˜ä»ç½‘ç»œè¿æ¥è¯»å–æ•°æ®çš„æ•ˆç‡ã€‚</li>
<li><strong>conn.Write</strong>ï¼šå°†å®¢æˆ·ç«¯è¾“å…¥çš„å­—èŠ‚æ•°æ®å‘é€å›å»ï¼Œå½¢æˆâ€œechoâ€å“åº”ã€‚</li>
</ul>
<h5 id="23-æµ‹è¯•æ–¹æ³•">2.3 æµ‹è¯•æ–¹æ³•ï¼š<a hidden class="anchor" aria-hidden="true" href="#23-æµ‹è¯•æ–¹æ³•">#</a></h5>
<p>å¯ä»¥ä½¿ç”¨ <code>nc</code>ï¼ˆnetcatï¼‰å·¥å…·æ¥æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc 127.0.0.1 <span style="color:#ae81ff">1080</span>
</span></span></code></pre></div><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»»æ„å­—ç¬¦ï¼ŒTCP Echo æœåŠ¡å™¨å°†è¿”å›ç›¸åŒçš„å­—ç¬¦ã€‚</p>
<hr>
<h4 id="3-socks5-ä»£ç†è®¤è¯å®ç°">3. SOCKS5 ä»£ç†è®¤è¯å®ç°<a hidden class="anchor" aria-hidden="true" href="#3-socks5-ä»£ç†è®¤è¯å®ç°">#</a></h4>
<h5 id="31-ä»£ç ">3.1 ä»£ç <a hidden class="anchor" aria-hidden="true" href="#31-ä»£ç ">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;bufio&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">socks5Ver</span>  = <span style="color:#ae81ff">0x05</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmdConnect</span> = <span style="color:#ae81ff">0x01</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">atypeIPV4</span>  = <span style="color:#ae81ff">0x01</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">atypeHOST</span>  = <span style="color:#ae81ff">0x03</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">atypeIPV6</span>  = <span style="color:#ae81ff">0x04</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">addr</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;127.0.0.1:1080&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">listener</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">addr</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;listen failed: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;SOCKS5 server listening on&#34;</span>, <span style="color:#a6e22e">addr</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Accept</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;accept failed:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">handleClient</span>(<span style="color:#a6e22e">client</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">handleClient</span>(<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">reader</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 1ï¸âƒ£ è®¤è¯é˜¶æ®µ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">auth</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">conn</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;auth failed:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;auth success from&#34;</span>, <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">RemoteAddr</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 2ï¸âƒ£ CONNECT è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">connect</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">conn</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;connect failed:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">auth</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ver</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read ver failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ver</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">socks5Ver</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;unsupported ver:%d&#34;</span>, <span style="color:#a6e22e">ver</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">methodSize</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read method size failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">method</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">methodSize</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">method</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read method failed:%w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// å›å¤æ— éœ€è®¤è¯</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">socks5Ver</span>, <span style="color:#ae81ff">0x00</span>})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">connect</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ver</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmd</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rsv</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ver</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">socks5Ver</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">cmd</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">cmdConnect</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">rsv</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x00</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;invalid header&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">atype</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">addr</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">atype</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypeIPV4</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readIPV4</span>(<span style="color:#a6e22e">reader</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypeHOST</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readHost</span>(<span style="color:#a6e22e">reader</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">atypeIPV6</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">addr</span> = <span style="color:#a6e22e">readIPV6</span>(<span style="color:#a6e22e">reader</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;unknown atype %v&#34;</span>, <span style="color:#a6e22e">atype</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">port</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">readPort</span>(<span style="color:#a6e22e">reader</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">targetAddr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%s:%d&#34;</span>, <span style="color:#a6e22e">addr</span>, <span style="color:#a6e22e">port</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ğŸ”— è¿æ¥ç›®æ ‡æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">targetAddr</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">socks5Ver</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#a6e22e">atypeIPV4</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>})
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;connect to target failed: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// å›å¤æˆåŠŸ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#a6e22e">socks5Ver</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#a6e22e">atypeIPV4</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ğŸ” å¼€å§‹è½¬å‘</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">cancel</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithTimeout</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cancel</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">relay</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">ctx</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readIPV4</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d.%d.%d.%d&#34;</span>, <span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">1</span>], <span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">2</span>], <span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readHost</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadByte</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">l</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> string(<span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readIPV6</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readPort</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">uint16</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">ReadFull</span>(<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> (uint16(<span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>) | uint16(<span style="color:#a6e22e">buf</span>[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">relay</span>(<span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#a6e22e">targetConn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">targetConn</span>, <span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">targetConn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="32-ä»£ç è¯´æ˜">3.2 ä»£ç è¯´æ˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#32-ä»£ç è¯´æ˜">#</a></h5>
<p><strong>main()</strong>ï¼šå¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ <code>127.0.0.1:1080</code>ï¼Œæ¯æœ‰æ–°è¿æ¥å°±åˆ›å»ºä¸€ä¸ªåç¨‹å¤„ç†ã€‚</p>
<p><strong>handleClient()</strong>ï¼šå¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼ŒåŒ…æ‹¬è®¤è¯å’Œå»ºç«‹è½¬å‘ã€‚</p>
<p><strong>auth()</strong>ï¼šæ‰§è¡Œ SOCKS5 è®¤è¯ï¼Œè¿™é‡Œå›ºå®šè¿”å›â€œæ— éœ€è®¤è¯â€ã€‚</p>
<p><strong>connect()</strong>ï¼šè§£æå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å–ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå»ºç«‹åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ TCP è¿æ¥ã€‚</p>
<p><strong>relay()</strong>ï¼šåœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®è½¬å‘ã€‚</p>
<p><strong>readIPV4/readHost/readIPV6/readPort()</strong>ï¼šè´Ÿè´£è§£æä¸åŒæ ¼å¼çš„åœ°å€ã€‚</p>
<h5 id="33-æœ€ç»ˆæµ‹è¯•">3.3 æœ€ç»ˆæµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#33-æœ€ç»ˆæµ‹è¯•">#</a></h5>
<p>æµ‹è¯•æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸­è®¾ç½® SOCKS5 ä»£ç†ï¼Œæˆ–è€…ä½¿ç”¨ <code>curl</code> å‘½ä»¤æ¥è¿›è¡Œè¯·æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl --socks5-hostname 127.0.0.1:1080 http://example.com
</span></span></code></pre></div><h3 id="44-æ¶ˆæ¯ç³»ç»Ÿ">4.4 æ¶ˆæ¯ç³»ç»Ÿ<a hidden class="anchor" aria-hidden="true" href="#44-æ¶ˆæ¯ç³»ç»Ÿ">#</a></h3>
<p>ç”±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ„å»ºçš„ç®€æ˜“æ¶ˆæ¯ç³»ç»Ÿ</p>
<h4 id="maingo">main.go<a hidden class="anchor" aria-hidden="true" href="#maingo">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">server</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewServer</span>(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">8889</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Start</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="servergo">server.go<a hidden class="anchor" aria-hidden="true" href="#servergo">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Server</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Ip</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Port</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">OnlineMap</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mapLock</span>   <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Message</span>   <span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewServer</span>(<span style="color:#a6e22e">ip</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">port</span> <span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">server</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Server</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Ip</span>:        <span style="color:#a6e22e">ip</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Port</span>:      <span style="color:#a6e22e">port</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">OnlineMap</span>: make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Message</span>:   make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">string</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">BroadCast</span>(<span style="color:#a6e22e">user</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>, <span style="color:#a6e22e">msg</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sendMsg</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Addr</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; msg: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msg</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Message</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sendMsg</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34; å¹¿æ’­å‘é€æˆåŠŸ %s \n&#34;</span>, <span style="color:#a6e22e">sendMsg</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">MessageListener</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">msg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">OnlineMap</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">C</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">msg</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//fmt.Println(&#34;é“¾æ¥å»ºç«‹æˆåŠŸ&#34;)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//defer conn.Close()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewUser</span>(<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">this</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Online</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">isLive</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">bool</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#ae81ff">4096</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">buf</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Offline</span>()
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">EOF</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;conn.Read err:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// å»é™¤ \n</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">DoMessage</span>(string(<span style="color:#a6e22e">buf</span>[:<span style="color:#a6e22e">n</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">isLive</span> <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// å½“å‰handleré˜»å¡</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">isLive</span>:
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">After</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>):
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;ä½ è¢«è¸¢äº†&#34;</span>)
</span></span><span style="display:flex;"><span>				close(<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">C</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;ç”¨æˆ· %s è¢«è¸¢äº† \n&#34;</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">// é€€å‡ºå½“å‰handler</span>
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span> <span style="color:#75715e">// runtime.Goexit()</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">Start</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// socket listen</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">listener</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%s:%d&#34;</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ip</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Port</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;net.Listen err:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// close listener</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">MessageListener</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// accept</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">listener</span>.<span style="color:#a6e22e">Accept</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;listener.Accept err:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;é“¾æ¥å»ºç«‹æˆåŠŸ&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// do handler</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="clientgo">client.go<a hidden class="anchor" aria-hidden="true" href="#clientgo">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;bufio&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Client</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ServerIp</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ServerPort</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>       <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>       <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>       <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">Reader</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">serverIp</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">serverPort</span> <span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Client</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ServerIp</span>:   <span style="color:#a6e22e">serverIp</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ServerPort</span>: <span style="color:#a6e22e">serverPort</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">flag</span>:       <span style="color:#ae81ff">9999</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%s:%d&#34;</span>, <span style="color:#a6e22e">serverIp</span>, <span style="color:#a6e22e">serverPort</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;net.Dial error:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span> = <span style="color:#a6e22e">conn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">client</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">DealResponse</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">menu</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">flag</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;1ã€å…¬èŠæ¨¡å¼&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;2ã€ç§èŠæ¨¡å¼&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;3ã€æ›´æ–°ç”¨æˆ·å&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;0ã€é€€å‡º&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Scanln</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">flag</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">3</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">flag</span> = <span style="color:#a6e22e">flag</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¾“å…¥æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">UpdateName</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥ç”¨æˆ·å:&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sendMsg</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;rename|&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">sendMsg</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;UpdateName error:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">PublicChat</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">chatMsg</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">chatMsg</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">chatMsg</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;exit&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">chatMsg</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">sendMsg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">sendMsg</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;write error:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">chatMsg</span> = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">chatMsg</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">chatMsg</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">chatMsg</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">selectUsers</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sendMsg</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;who\n&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">sendMsg</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;selectUsers error:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">PrivateChat</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">remoteName</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">selectUsers</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å¯¹è±¡çš„ç”¨æˆ·åï¼Œ exité€€å‡º&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">remoteName</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">remoteName</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">remoteName</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">remoteName</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;exit&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">chatMsg</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">chatMsg</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">chatMsg</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;exit&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">chatMsg</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">sendMsg</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;to|&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">remoteName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;|&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">chatMsg</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">sendMsg</span>))
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;write error:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">chatMsg</span> = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼Œexité€€å‡º:&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">chatMsg</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">chatMsg</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">chatMsg</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">selectUsers</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è¯·è¾“å…¥èŠå¤©å¯¹è±¡ï¼Œexité€€å‡º&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">remoteName</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">ReadString</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">remoteName</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(<span style="color:#a6e22e">remoteName</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">Run</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">flag</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">menu</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">true</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">flag</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">PublicChat</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;ç§èŠæ¨¡å¼&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">PrivateChat</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">UpdateName</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">serverIp</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">serverPort</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">serverIp</span>, <span style="color:#e6db74">&#34;ip&#34;</span>, <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#e6db74">&#34;set server ip&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">IntVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">serverPort</span>, <span style="color:#e6db74">&#34;port&#34;</span>, <span style="color:#ae81ff">8889</span>, <span style="color:#e6db74">&#34;set server port&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// å‘½ä»¤è¡Œè§£æ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">reader</span> = <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdin</span>) <span style="color:#75715e">// åˆå§‹åŒ–å…¨å±€ reader</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">serverIp</span>, <span style="color:#a6e22e">serverPort</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Connect to the server successfully&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">DealResponse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Connect to the server success&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Run</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="usergo">user.go<a hidden class="anchor" aria-hidden="true" href="#usergo">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Addr</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">C</span>    <span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">server</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewUser</span>(<span style="color:#a6e22e">conn</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#a6e22e">server</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">userAddr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">RemoteAddr</span>().<span style="color:#a6e22e">String</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>: <span style="color:#a6e22e">userAddr</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Addr</span>: <span style="color:#a6e22e">userAddr</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">C</span>:    make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">string</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">conn</span>: <span style="color:#a6e22e">conn</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">server</span>: <span style="color:#a6e22e">server</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">ListenMessage</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">user</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">Online</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ç”¨æˆ·ä¸Šçº¿ï¼Œ å°†ç”¨æˆ·åŠ åˆ°onlineMapä¸­</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>[<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Name</span>] = <span style="color:#a6e22e">this</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">BroadCast</span>(<span style="color:#a6e22e">this</span>, <span style="color:#e6db74">&#34;å·²ä¸Šçº¿&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">Offline</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>	delete(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">BroadCast</span>(<span style="color:#a6e22e">this</span>, <span style="color:#e6db74">&#34;å·²ä¸‹çº¿&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">SendMsg</span>(<span style="color:#a6e22e">msg</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">msg</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">DoMessage</span>(<span style="color:#a6e22e">msg</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;who&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">onlineMsg</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Addr</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;åœ¨çº¿ã€‚ã€‚ã€‚\n&#34;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#a6e22e">onlineMsg</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">msg</span>) &gt; <span style="color:#ae81ff">7</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">msg</span>[:<span style="color:#ae81ff">7</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;rename|&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">newName</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">msg</span>, <span style="color:#e6db74">&#34;|&#34;</span>)[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>[<span style="color:#a6e22e">newName</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;å½“å‰ç”¨æˆ·åè¢«ä½¿ç”¨\n&#34;</span>)
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Lock</span>()
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Name</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>[<span style="color:#a6e22e">newName</span>] = <span style="color:#a6e22e">this</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">mapLock</span>.<span style="color:#a6e22e">Unlock</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#a6e22e">newName</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;æ‚¨å·²æ›´æ–°ç”¨æˆ·å&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">newName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">msg</span>) &gt; <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">msg</span>[:<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;to|&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">remoteName</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">msg</span>, <span style="color:#e6db74">&#34;|&#34;</span>)[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">remoteName</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®ï¼Œ è¯·ä½¿ç”¨ \&#34;to|å¼ ä¸‰|ä½ å¥½å•Š\&#34; æ ¼å¼ã€‚ \n&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">remoteUser</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">OnlineMap</span>[<span style="color:#a6e22e">remoteName</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;è¯¥ç”¨æˆ·ä¸å­˜åœ¨\n&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">content</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">msg</span>, <span style="color:#e6db74">&#34;|&#34;</span>)[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#e6db74">&#34;æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®ï¼Œ è¯·ä½¿ç”¨ \&#34;to|å¼ ä¸‰|ä½ å¥½å•Š\&#34; å½¢å¼å‘é€æ¶ˆæ¯ã€‚ \n&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">remoteUser</span>.<span style="color:#a6e22e">SendMsg</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;å¯¹ä½ è¯´ï¼š&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">BroadCast</span>(<span style="color:#a6e22e">this</span>, <span style="color:#a6e22e">msg</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">ListenMessage</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">msg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#a6e22e">msg</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kennems.github.io/tags/golang/">GoLang</a></li>
    </ul>
        
    
    <ul id="categories">
      
        <li><a href="https://kennems.github.io/categories/go">Go</a> </li>
      
    </ul>
    
    
<nav class="paginav">
  <a class="prev" href="https://kennems.github.io/posts/tech/leetcode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98202501/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>LeetCodeæ¯æ—¥ä¸€é¢˜ï¼ˆ202501ï¼‰</span>
  </a>
  <a class="next" href="https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A15/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>é»‘é©¬å¤´æ¡ï¼ˆ5ï¼‰</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://kennems.github.io/">Kennem&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<footer class="footer">
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container">
    ğŸ‘¤ Visitors: <span id="busuanzi_value_site_uv"></span>
    ğŸ‘€ Views: <span id="busuanzi_value_site_pv"></span>
  </span>
</footer>



</body>

</html>
