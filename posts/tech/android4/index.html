<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<meta name="msvalidate.01" content="DF5FE493CC759E62BFE073BEA8EFD472" />
<title>Android（4） | Kennem&#39;s Blog</title>
<meta name="keywords" content="Android">
<meta name="description" content="Android学习笔记">
<meta name="author" content="ShowGuan">
<link rel="canonical" href="https://kennems.github.io/posts/tech/android4/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1a7bc7e6d01b82c8ca2b2e53cfcf7e33d2fd9058f6b28245f94da0d91447c6a0.css" integrity="sha256-GnvH5tAbgsjKKy5Tz89&#43;M9L9kFj2soJF&#43;U2g2RRHxqA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kennems.github.io/img/sun.png">
<link rel="apple-touch-icon" href="https://kennems.github.io/img/sun.png">
<link rel="mask-icon" href="https://kennems.github.io/img/sun.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://kennems.github.io/posts/tech/android4/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>


<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/code-new-roman">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

<meta property="og:url" content="https://kennems.github.io/posts/tech/android4/">
  <meta property="og:site_name" content="Kennem&#39;s Blog">
  <meta property="og:title" content="Android（4）">
  <meta property="og:description" content="Android学习笔记">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T22:30:13+08:00">
    <meta property="article:modified_time" content="2024-06-29T22:20:13+08:00">
    <meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android（4）">
<meta name="twitter:description" content="Android学习笔记">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚文章",
      "item": "https://kennems.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "💻技术",
      "item": "https://kennems.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Android（4）",
      "item": "https://kennems.github.io/posts/tech/android4/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Android（4）",
  "name": "Android（4）",
  "description": "Android学习笔记",
  "keywords": [
    "Android"
  ],
  "articleBody": "Android（4） 就算是最低的15x15都已经不错了，以后还有时间去学，上了研究生也没人能保证你有15x15的收入\n内容提供者(ContentProvider) CountentProvider为App存取内部数据提供统一的外部接口，让不同的应用之间得以共享数据\nUri 通用资源标识符 Universal Resource Identifer， 代表数据操作的地址，每一个ContentProvider都会有唯一的地址。ContentProvider使用的Uri语法结构如下：\ncontent://authority/data_path/id content://是通用前缀，表示该Uri用于ContentProvider定位资源。 authority是授权者名称，用来确定具体由哪一个ContentProvider提供资源。因此一般anthority都由类的小写全称组成，以保证唯一性。 data_path是数据路径，用来确定请求的是哪个数据集 id是数据编号，用来请求单条数据。如果是多条这个字段忽略。 server内容提供程序 UserInfoProvider.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 package com.showguan.chapter07_server.provider; import android.content.ContentProvider; import android.content.ContentValues; import android.content.UriMatcher; import android.database.Cursor; import android.database.sqlite.SQLiteDatabase; import android.net.Uri; import android.util.Log; import com.showguan.chapter07_server.database.UserDBHelper; public class UserInfoProvider extends ContentProvider { private static String TAG = \"Kennem\"; private UserDBHelper dbHelper; private static final int USER = 1; private static final int USERS = 2; private static final UriMatcher URI_MATCHER = new UriMatcher(UriMatcher.NO_MATCH); static { URI_MATCHER.addURI(UserInfoContent.AUTHORITIES, \"/user/#\", USER); URI_MATCHER.addURI(UserInfoContent.AUTHORITIES, \"/user\", USERS); } @Override public boolean onCreate() { // TODO: Implement this to initialize your content provider on startup. Log.d(TAG, \"ContentProvider onCreate: \"); dbHelper = UserDBHelper.getInstance(getContext()); return true; } @Override public Uri insert(Uri uri, ContentValues values) { if (URI_MATCHER.match(uri) == USERS) { SQLiteDatabase db = dbHelper.getWritableDatabase(); db.insert(UserDBHelper.TABLE_NAME, null, values); } return uri; } @Override public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) { if (URI_MATCHER.match(uri) == USERS) { Log.d(TAG, \"UserInfoProvider query: \"); SQLiteDatabase db = dbHelper.getReadableDatabase(); Cursor cursor = db.query(UserDBHelper.TABLE_NAME, projection, selection, selectionArgs, null, null, null); return cursor; } return null; } @Override public int delete(Uri uri, String selection, String[] selectionArgs) { int count = 0; switch (URI_MATCHER.match(uri)) { case USER: String id = uri.getLastPathSegment(); SQLiteDatabase db1 = dbHelper.getWritableDatabase(); count = db1.delete(UserDBHelper.TABLE_NAME, \"_id = ?\", new String[]{id}); db1.close(); break; case USERS: SQLiteDatabase db2 = dbHelper.getWritableDatabase(); count = db2.delete(UserDBHelper.TABLE_NAME, selection, selectionArgs); db2.close(); break; } return count; } @Override public String getType(Uri uri) { // TODO: Implement this to handle requests for the MIME type of the data // at the given URI. throw new UnsupportedOperationException(\"Not yet implemented\"); } @Override public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) { // TODO: Implement this to handle requests to update one or more rows. throw new UnsupportedOperationException(\"Not yet implemented\"); } } UserInfoContent.java 定义常量 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package com.showguan.chapter07_server.provider; import android.net.Uri; import android.provider.BaseColumns; public class UserInfoContent implements BaseColumns { public static final String AUTHORITIES = \"com.showguan.chapter07_server.provider.UserInfoProvider\"; public static final Uri CONTENT_URI = Uri.parse(\"content://\" + AUTHORITIES + \"/user\"); public static final String USER_NAME = \"name\"; public static final String USER_AGE = \"age\"; public static final String USER_HEIGHT = \"height\"; public static final String USER_WEIGHT = \"weight\"; public static final String USER_MARRIED = \"married\"; } UserDBHelper.java创建表 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 package com.showguan.chapter07_server.database; import android.content.ContentValues; import android.content.Context; import android.database.Cursor; import android.database.sqlite.SQLiteDatabase; import android.database.sqlite.SQLiteOpenHelper; import androidx.annotation.Nullable; import java.util.ArrayList; import java.util.List; public class UserDBHelper extends SQLiteOpenHelper { public static final String DB_NAME = \"user.db\"; public static final String TABLE_NAME = \"user_info\"; private static final int DB_VERSION = 2; private static UserDBHelper mHelper = null; private SQLiteDatabase mRDB = null; private SQLiteDatabase mWDB = null; private UserDBHelper(@Nullable Context context) { super(context, DB_NAME, null, DB_VERSION); } public static UserDBHelper getInstance(Context context) { if (mHelper == null) { mHelper = new UserDBHelper(context); } return mHelper; } @Override public void onCreate(SQLiteDatabase db) { String sql = \"CREATE TABLE IF NOT EXISTS \" + TABLE_NAME + \" (\" + \"_id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,\" + \" name VARCHAR NOT NULL,\" + \" age INTEGER NOT NULL,\" + \" height LONG NOT NULL,\" + \" weight FLOAT NOT NULL,\" + \" married INTEGER NOT NULL);\"; db.execSQL(sql); } @Override public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) { } } client接受数据端 首先在Manifest中添加如下，表示需要访问的内容提供者的包\nContentWriteActivity.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 package com.showguan.chapter07_client; public class ContentWriteActivity extends AppCompatActivity implements View.OnClickListener { private static String TAG = \"Kennem\"; private EditText et_name; private EditText et_age; private EditText et_height; private EditText et_weight; private CheckBox ck_isMarried; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_content_write); et_name = findViewById(R.id.et_name); et_age = findViewById(R.id.et_age); et_height = findViewById(R.id.et_height); et_weight = findViewById(R.id.et_weight); ck_isMarried = findViewById(R.id.ck_isMarried); findViewById(R.id.btn_read).setOnClickListener(this); findViewById(R.id.btn_write).setOnClickListener(this); findViewById(R.id.btn_delete).setOnClickListener(this); } @SuppressLint(\"Range\") @Override public void onClick(View v) { if(v.getId() == R.id.btn_write){ ContentValues values = new ContentValues(); values.put(UserInfoContent.USER_NAME, et_name.getText().toString()); values.put(UserInfoContent.USER_AGE, et_age.getText().toString()); values.put(UserInfoContent.USER_HEIGHT, et_height.getText().toString()); values.put(UserInfoContent.USER_WEIGHT, et_weight.getText().toString()); values.put(UserInfoContent.USER_MARRIED, ck_isMarried.isChecked()); getContentResolver().insert(UserInfoContent.CONTENT_URI, values); ToastUtil.show(this, \"保存成功！\"); } else if (v.getId() == R.id.btn_read) { Cursor cursor = getContentResolver().query(UserInfoContent.CONTENT_URI, null, null, null, null); if (cursor != null) { while(cursor.moveToNext()){ User info = new User(); info.setId(cursor.getInt(cursor.getColumnIndex(UserInfoContent._ID))); info.setAge(cursor.getInt(cursor.getColumnIndex(UserInfoContent.USER_AGE))); info.setName(cursor.getString(cursor.getColumnIndex(UserInfoContent.USER_NAME))); info.setHeight(cursor.getFloat(cursor.getColumnIndex(UserInfoContent.USER_HEIGHT))); info.setWeight(cursor.getFloat(cursor.getColumnIndex(UserInfoContent.USER_WEIGHT))); info.setMarried(cursor.getInt(cursor.getColumnIndex(UserInfoContent.USER_MARRIED)) == 1); Log.d(TAG, info.toString()); } cursor.close(); } } else if (v.getId() == R.id.btn_delete) { // 根据id删除单条 // Uri uri = ContentUris.withAppendedId(UserInfoContent.CONTENT_URI, 1); // int count = getContentResolver().delete(uri, null, null); //根据名称删除多条 int count = getContentResolver().delete(UserInfoContent.CONTENT_URI, \"name = ?\", new String[]{et_name.getText().toString()}); if(count \u003e 0){ ToastUtil.show(this, \"删除成功\"); }else{ ToastUtil.show(this, \"删除失败，不存在名为\" + et_name.getText().toString() + \"的用户！\"); } } } } 通过Uri格式删除一个用户 1 2 3 // 根据id删除单条 Uri uri = ContentUris.withAppendedId(UserInfoContent.CONTENT_URI, 1); int count = getContentResolver().delete(uri, null, null); 动态申请权限 步骤：\n检查App是否开启了指定权限 调用ContextCompat的checkSelfPermission方法 请求系统弹窗，以便用户选择是否开启权限 调用ActivityCompat的requestPermission方法，即可命令系统自动弹出权限申请窗口。 判断用户的权限选择结果 重写活动页面的权限请求回调方法onRequestPermissionResult， 在该方法内部处理用户的权限选择结果。 懒汉式获取权限 首先添加按钮事件监听： 1 2 3 4 5 6 7 8 @Override public void onClick(View v) { if (v.getId() == R.id.btn_contacts) { PermissionUtil.checkPermission(this, PERMISSIONS_CONTACTS, REQUEST_CODE_CONTACTS); } else if (v.getId() == R.id.btn_sms) { PermissionUtil.checkPermission(this, PERMISSIONS_SMS, REQUEST_CODE_SMS); } } 在工具类中判断是否有没有获取到的权限，申请获取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public static boolean checkPermission(Activity act, String[] permissions, int requestCode){ if(Build.VERSION.SDK_INT \u003e= Build.VERSION_CODES.M){ int check = PackageManager.PERMISSION_GRANTED; for (String permission : permissions) { check = ContextCompat.checkSelfPermission(act, permission); if(check != PackageManager.PERMISSION_GRANTED){ break; } } if(check != PackageManager.PERMISSION_GRANTED){ ActivityCompat.requestPermissions(act, permissions, requestCode); return false; } } return true; } 其中ActivityCompat.requestPermissions方法的参数在onRequestPermissionsResult中返回 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @Override public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) { super.onRequestPermissionsResult(requestCode, permissions, grantResults); switch (requestCode) { case REQUEST_CODE_CONTACTS: for (int grantResult : grantResults) { Log.d(TAG, String.valueOf(grantResult)); } if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"通讯录权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; case REQUEST_CODE_SMS: if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"短信收发权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; } } PermissionLazyActivity.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 package com.showguan.chapter07_client; import android.Manifest; import android.content.Intent; import android.net.Uri; import android.os.Bundle; import android.provider.Settings; import android.util.Log; import android.view.View; import androidx.activity.EdgeToEdge; import androidx.annotation.NonNull; import androidx.appcompat.app.AppCompatActivity; import androidx.core.graphics.Insets; import androidx.core.view.ViewCompat; import androidx.core.view.WindowInsetsCompat; import com.showguan.chapter07_client.util.PermissionUtil; import com.showguan.chapter07_client.util.ToastUtil; public class PermissionLazyActivity extends AppCompatActivity implements View.OnClickListener { private static String TAG = \"Kennem\"; private static final String[] PERMISSIONS_CONTACTS = new String[]{ android.Manifest.permission.READ_CONTACTS, android.Manifest.permission.WRITE_CONTACTS }; private static final String[] PERMISSIONS_SMS = new String[]{ Manifest.permission.SEND_SMS, Manifest.permission.READ_SMS }; private static final int REQUEST_CODE_CONTACTS = 1; private static final int REQUEST_CODE_SMS = 2; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_permission_lazy); findViewById(R.id.btn_contacts).setOnClickListener(this); findViewById(R.id.btn_sms).setOnClickListener(this); } @Override public void onClick(View v) { if (v.getId() == R.id.btn_contacts) { PermissionUtil.checkPermission(this, PERMISSIONS_CONTACTS, REQUEST_CODE_CONTACTS); } else if (v.getId() == R.id.btn_sms) { PermissionUtil.checkPermission(this, PERMISSIONS_SMS, REQUEST_CODE_SMS); } } @Override public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) { super.onRequestPermissionsResult(requestCode, permissions, grantResults); switch (requestCode) { case REQUEST_CODE_CONTACTS: for (int grantResult : grantResults) { Log.d(TAG, String.valueOf(grantResult)); } if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"通讯录权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; case REQUEST_CODE_SMS: if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"短信收发权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; } } private void jumpToSettings() { Intent intent = new Intent(); intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS); intent.setData(Uri.fromParts(\"package\", getPackageName(), null)); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); startActivity(intent); } } 跳转到系统权限设计界面： 1 2 3 4 5 6 7 private void jumpToSettings() { Intent intent = new Intent(); intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS); intent.setData(Uri.fromParts(\"package\", getPackageName(), null)); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); startActivity(intent); } 饿汉式获取权限 PermissionHungryActivity.java 不同于懒汉式，创建时即申请全部权限\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 package com.showguan.chapter07_client; import android.Manifest; import android.content.Intent; import android.content.pm.PackageManager; import android.net.Uri; import android.os.Bundle; import android.provider.Settings; import android.util.Log; import android.view.View; import androidx.activity.EdgeToEdge; import androidx.annotation.NonNull; import androidx.appcompat.app.AppCompatActivity; import androidx.core.graphics.Insets; import androidx.core.view.ViewCompat; import androidx.core.view.WindowInsetsCompat; import com.showguan.chapter07_client.util.PermissionUtil; import com.showguan.chapter07_client.util.ToastUtil; public class PermissionHungryActivity extends AppCompatActivity implements View.OnClickListener { private static String TAG = \"Kennem\"; private static final String[] PERMISSIONS_ALL = new String[]{ android.Manifest.permission.READ_CONTACTS, android.Manifest.permission.WRITE_CONTACTS, android.Manifest.permission.SEND_SMS, Manifest.permission.READ_SMS }; private static final int REQUEST_CODE_ALL = 1; private static final int REQUEST_CODE_CONTACTS = 2; private static final int REQUEST_CODE_SMS = 3; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_permission_lazy); findViewById(R.id.btn_contacts).setOnClickListener(this); findViewById(R.id.btn_sms).setOnClickListener(this); PermissionUtil.checkPermission(this, PERMISSIONS_ALL, REQUEST_CODE_ALL); } @Override public void onClick(View v) { if (v.getId() == R.id.btn_contacts) { PermissionUtil.checkPermission(this, new String[]{PERMISSIONS_ALL[0], PERMISSIONS_ALL[1]}, REQUEST_CODE_CONTACTS); } else if (v.getId() == R.id.btn_sms) { PermissionUtil.checkPermission(this, new String[]{PERMISSIONS_ALL[2], PERMISSIONS_ALL[3]}, REQUEST_CODE_SMS); } } @Override public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) { super.onRequestPermissionsResult(requestCode, permissions, grantResults); switch (requestCode) { case REQUEST_CODE_ALL: if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"所有权限获取成功！\"); } else { for (int i = 0; i \u003c grantResults.length; i++) { if (grantResults[i] != PackageManager.PERMISSION_GRANTED) { switch (permissions[i]) { case Manifest.permission.READ_CONTACTS: case Manifest.permission.WRITE_CONTACTS: ToastUtil.show(this, \"获取通讯录读写权限失败\"); jumpToSettings(); return; case Manifest.permission.SEND_SMS: case Manifest.permission.READ_SMS: ToastUtil.show(this, \"获取短信读写权限失败\"); jumpToSettings(); return; } } } } break; case REQUEST_CODE_CONTACTS: for (int grantResult : grantResults) { Log.d(TAG, String.valueOf(grantResult)); } if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"通讯录权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; case REQUEST_CODE_SMS: if (PermissionUtil.checkGranted(grantResults)) { Log.d(TAG, \"短信收发权限获取成功\"); } else { ToastUtil.show(this, \"获取权限失败!\"); jumpToSettings(); } break; } } private void jumpToSettings() { Intent intent = new Intent(); intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS); intent.setData(Uri.fromParts(\"package\", getPackageName(), null)); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); startActivity(intent); } } 添加联系人 添加用户到通讯录，读取所有联系人信息到logcat中。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 package com.showguan.chapter07_client; public class ContactAddActivity extends AppCompatActivity implements View.OnClickListener { private static String TAG = \"Kennem\"; private TextView et_name; private TextView et_phone; private TextView et_email; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_contact_add); et_name = findViewById(R.id.et_name); et_phone = findViewById(R.id.et_phone); et_email = findViewById(R.id.et_email); findViewById(R.id.btn_read).setOnClickListener(this); findViewById(R.id.btn_write).setOnClickListener(this); } @Override public void onClick(View v) { if (v.getId() == R.id.btn_write) { // 创建一个联系人对象 Contact contact = new Contact(); contact.name = et_name.getText().toString(); contact.phone = et_phone.getText().toString(); contact.email = et_email.getText().toString(); //addContacts(getContentResolver(), contact); //批处理方式，每一次操作都是一个ContentProviderOperation， 构建一个操作集合，然后一次性执行 // 好处：要么全部成功，要么全部失败，保证了事务的一致性 addFullContacts(getContentResolver(), contact); } else if (v.getId() == R.id.btn_read) { readPhoneContact(getContentResolver()); } } @SuppressLint(\"Range\") // 禁用范围警告，因为我们手动处理列索引 private void readPhoneContact(ContentResolver resolver) { // 查询RawContacts表，获取所有联系人的_raw_contact_id Cursor cursor = resolver.query( ContactsContract.RawContacts.CONTENT_URI, new String[]{ContactsContract.RawContacts._ID}, // 只查询_raw_contact_id列 null, // 无筛选条件 null, // 无筛选条件参数 null // 无排序 ); // 遍历查询结果 while (cursor.moveToNext()) { // 获取当前记录的raw_contact_id int rawContactId = cursor.getInt(0); // 构建用于查询联系人的Data URI Uri uri = Uri.parse(\"content://com.android.contacts/contacts/\" + rawContactId + \"/data\"); // 查询Data表，获取与当前联系人相关的所有数据 Cursor dataCursor = resolver.query( uri, new String[]{Contacts.Data.MIMETYPE, Contacts.Data.DATA1, Contacts.Data.DATA2}, // 查询MIME类型和数据列 null, // 无筛选条件 null, // 无筛选条件参数 null // 无排序 ); // 创建一个Contact对象用于存储查询结果 Contact contact = new Contact(); // 遍历查询结果 while (dataCursor.moveToNext()) { // 获取当前记录的DATA1列的值 String data1 = dataCursor.getString(dataCursor.getColumnIndex(Contacts.Data.DATA1)); // 获取当前记录的MIMETYPE列的值 String mimeType = dataCursor.getString(dataCursor.getColumnIndex(Contacts.Data.MIMETYPE)); // 根据MIME类型，将数据存储到相应的Contact属性中 switch (mimeType) { case CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE: // 如果MIME类型是StructuredName，则将data1赋值给contact的name属性 contact.name = data1; break; case CommonDataKinds.Phone.CONTENT_ITEM_TYPE: // 如果MIME类型是Phone，则将data1赋值给contact的phone属性 contact.phone = data1; break; case CommonDataKinds.Email.CONTENT_ITEM_TYPE: // 如果MIME类型是Email，则将data1赋值给contact的email属性 contact.email = data1; break; } } // 关闭Data表的查询结果游标 dataCursor.close(); // 如果contact的name属性不为空，则输出联系人姓名到日志 if (contact.name != null) { Log.d(TAG, contact.name); } } // 关闭RawContacts表的查询结果游标 cursor.close(); } // 往手机通讯录一次性添加一个联系人信息（包括主记录，姓名，电话号码，电子邮箱） // 事务性，要么全部成功，要么全部失败 private void addFullContacts(ContentResolver contentResolver, Contact contact) { // 创建一个插入联系人主记录的内容操作器 ContentProviderOperation op_main = ContentProviderOperation // 设置操作类型为插入 .newInsert(ContactsContract.RawContacts.CONTENT_URI) // 设置插入的ACCOUNT_NAME为null，表示使用默认账户 .withValue(ContactsContract.RawContacts.ACCOUNT_NAME, null) // 构建操作 .build(); // 创建一个插入联系人姓名的内容操作器 ContentProviderOperation op_name = ContentProviderOperation // 设置操作类型为插入 .newInsert(ContactsContract.Data.CONTENT_URI) // 设置引用的RAW_CONTACT_ID为前一个操作生成的ID .withValueBackReference(Contacts.Data.RAW_CONTACT_ID, 0) // 设置数据的MIME类型为StructuredName（联系人的名字） .withValue(Contacts.Data.MIMETYPE, CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE) // 设置联系人的名字 .withValue(Contacts.Data.DATA1, contact.name) // 构建操作 .build(); // 创建一个插入联系人电话号码的内容操作器 ContentProviderOperation op_phone = ContentProviderOperation // 设置操作类型为插入 .newInsert(ContactsContract.Data.CONTENT_URI) // 设置引用的RAW_CONTACT_ID为前一个操作生成的ID .withValueBackReference(Contacts.Data.RAW_CONTACT_ID, 0) // 设置数据的MIME类型为Phone（联系人的电话） .withValue(Contacts.Data.MIMETYPE, CommonDataKinds.Phone.CONTENT_ITEM_TYPE) // 设置联系人的电话号码 .withValue(Contacts.Data.DATA1, contact.phone) // 设置电话号码的类型为Mobile（手机） .withValue(Contacts.Data.DATA2, CommonDataKinds.Phone.TYPE_MOBILE) // 构建操作 .build(); // 创建一个插入联系人电子邮箱的内容操作器 ContentProviderOperation op_email = ContentProviderOperation // 设置操作类型为插入 .newInsert(ContactsContract.Data.CONTENT_URI) // 设置引用的RAW_CONTACT_ID为前一个操作生成的ID .withValueBackReference(Contacts.Data.RAW_CONTACT_ID, 0) // 设置数据的MIME类型为Email（联系人的邮箱） .withValue(Contacts.Data.MIMETYPE, CommonDataKinds.Email.CONTENT_ITEM_TYPE) // 设置联系人的电子邮箱地址 .withValue(Contacts.Data.DATA1, contact.email) // 设置电子邮箱的类型为Mobile（手机邮箱） .withValue(Contacts.Data.DATA2, CommonDataKinds.Email.TYPE_MOBILE) // 构建操作 .build(); // 创建一个操作列表，用于批量执行所有操作 ArrayList\u003cContentProviderOperation\u003e operations = new ArrayList\u003c\u003e(); // 将插入主记录的操作添加到操作列表 operations.add(op_main); // 将插入姓名的操作添加到操作列表 operations.add(op_name); // 将插入电话号码的操作添加到操作列表 operations.add(op_phone); // 将插入电子邮箱的操作添加到操作列表 operations.add(op_email); try { // 执行批量操作，将所有数据插入联系人数据库 contentResolver.applyBatch(ContactsContract.AUTHORITY, operations); } catch (OperationApplicationException e) { // 捕获OperationApplicationException异常并抛出RuntimeException throw new RuntimeException(e); } catch (RemoteException e) { // 捕获RemoteException异常并抛出RuntimeException throw new RuntimeException(e); } } private void addContacts(ContentResolver resolver, Contact contact) { // 创建一个ContentValues对象，用于存储新联系人数据 ContentValues values = new ContentValues(); // 插入一个空的RawContact记录，返回该记录的URI Uri uri = resolver.insert(ContactsContract.RawContacts.CONTENT_URI, values); // 解析出新插入记录的ID long rawContactId = ContentUris.parseId(uri); // 创建一个ContentValues对象，用于存储联系人的名字数据 ContentValues name = new ContentValues(); // 设置RAW_CONTACT_ID，表示该数据属于哪个联系人 name.put(Contacts.Data.RAW_CONTACT_ID, rawContactId); // 设置数据的MIME类型为StructuredName（联系人的名字） name.put(Contacts.Data.MIMETYPE, CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE); // 设置联系人的名字 name.put(Contacts.Data.DATA1, contact.name); // 将联系人的名字数据插入到Data表中 resolver.insert(ContactsContract.Data.CONTENT_URI, name); // 创建一个ContentValues对象，用于存储联系人的电话号码数据 ContentValues phone = new ContentValues(); // 设置RAW_CONTACT_ID，表示该数据属于哪个联系人 phone.put(Contacts.Data.RAW_CONTACT_ID, rawContactId); // 设置数据的MIME类型为Phone（联系人的电话） phone.put(Contacts.Data.MIMETYPE, CommonDataKinds.Phone.CONTENT_ITEM_TYPE); // 设置联系人的电话号码 phone.put(Contacts.Data.DATA1, contact.phone); // 设置电话号码的类型为Mobile（手机） phone.put(Contacts.Data.DATA2, CommonDataKinds.Phone.TYPE_MOBILE); // 将联系人的电话号码数据插入到Data表中 resolver.insert(ContactsContract.Data.CONTENT_URI, phone); // 创建一个ContentValues对象，用于存储联系人的邮箱数据 ContentValues email = new ContentValues(); // 设置RAW_CONTACT_ID，表示该数据属于哪个联系人 email.put(Contacts.Data.RAW_CONTACT_ID, rawContactId); // 设置数据的MIME类型为Email（联系人的邮箱） email.put(Contacts.Data.MIMETYPE, CommonDataKinds.Email.CONTENT_ITEM_TYPE); // 设置联系人的邮箱地址（此处错误，应该是contact.email，而不是contact.phone） email.put(Contacts.Data.DATA1, contact.email); // 纠正了原来的错误 // 设置邮箱地址的类型为Work（工作邮箱） email.put(Contacts.Data.DATA2, CommonDataKinds.Email.TYPE_WORK); // 将联系人的邮箱数据插入到Data表中 resolver.insert(ContactsContract.Data.CONTENT_URI, email); } private void addContact(ContentResolver resolver, Contact contact) { ContentValues values = new ContentValues(); Uri uri = resolver.insert(ContactsContract.RawContacts.CONTENT_URI, values); long rawDataId = ContentUris.parseId(uri); } } 发送短信 Java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 package com.showguan.chapter07_client; // 定义包名 public class SentMmsActivity extends AppCompatActivity implements View.OnClickListener { // 定义SentMmsActivity类，继承AppCompatActivity，实现View.OnClickListener接口 private static String TAG = \"Kennem\"; // 定义TAG用于日志 private ActivityResultLauncher\u003cIntent\u003e mResultLauncher; // 定义ActivityResultLauncher变量 private EditText et_phone_number; // 定义EditText变量用于电话号码输入 private EditText et_title; // 定义EditText变量用于标题输入 private EditText et_desc; // 定义EditText变量用于描述输入 private Uri picUri; // 定义Uri变量用于存储图片URI @Override protected void onCreate(Bundle savedInstanceState) { // onCreate方法，Activity创建时调用 super.onCreate(savedInstanceState); // 调用父类onCreate方法 setContentView(R.layout.activity_sent_mms); // 设置布局文件 ImageView iv_add_pic = findViewById(R.id.iv_add_pic); // 获取ImageView用于添加图片 findViewById(R.id.btn_send).setOnClickListener(this); // 设置发送按钮的点击监听 iv_add_pic.setOnClickListener(this); // 设置添加图片按钮的点击监听 et_phone_number = findViewById(R.id.et_phone_number); // 获取EditText用于电话号码输入 et_title = findViewById(R.id.et_title); // 获取EditText用于标题输入 et_desc = findViewById(R.id.et_desc); // 获取EditText用于描述输入 mResultLauncher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), result -\u003e { // 注册Activity结果启动器 if(result.getResultCode() == RESULT_OK){ // 检查结果码是否为RESULT_OK Intent intent = result.getData(); // 获取结果数据 picUri = intent.getData(); // 获取图片URI if(picUri != null){ // 如果URI不为空 iv_add_pic.setImageURI(picUri); // 设置ImageView显示图片 Log.d(TAG, picUri.toString()); // 打印图片URI到日志 } } }); } @Override public void onClick(View v) { // onClick方法，处理点击事件 if(v.getId() == R.id.iv_add_pic){ // 如果点击的是添加图片按钮 Intent intent = new Intent(Intent.ACTION_GET_CONTENT); // 创建Intent用于选择内容 intent.setType(\"image/*\"); // 设置选择类型为图片 mResultLauncher.launch(intent); // 启动选择图片的Activity } else if (v.getId() == R.id.btn_send) { // 如果点击的是发送按钮 sendMms(et_phone_number.getText().toString(), // 调用sendMms方法发送MMS et_title.getText().toString(), // 获取标题文本 et_desc.getText().toString()); // 获取描述文本 } } private void sendMms(String phone, String title, String desc) { // sendMms方法，用于发送MMS Intent intent = new Intent(Intent.ACTION_SEND); // 创建发送Intent intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); // 添加新任务标志 intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); // 添加URI读权限标志 intent.putExtra(\"address\", phone); // 设置电话号码 intent.putExtra(\"subject\", title); // 设置标题 intent.putExtra(\"sms_body\", desc); // 设置描述 intent.putExtra(Intent.EXTRA_STREAM, picUri); // 添加图片URI intent.setType(\"image/*\"); // 设置类型为图片 startActivity(intent); // 启动发送MMS的Activity ToastUtil.show(this, \"从在弹窗中选择信息或短信应用\"); // 显示提示信息 } } FileProvider指定获取图片路径并发送短信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 package com.showguan.chapter07_client; // 定义包名 public class ProvideMmsActivity extends AppCompatActivity { // 定义ProvideMmsActivity类，继承AppCompatActivity private static String TAG = \"Kennem\"; // 定义TAG用于日志 private List\u003cImageInfo\u003e mImageList = new ArrayList\u003c\u003e(); // 定义用于存储图片信息的列表 private GridLayout gl_appendix; // 定义GridLayout用于显示图片 private static final String[] PERMISSION_STORAGE = new String[]{ // 定义存储权限数组 Manifest.permission.READ_EXTERNAL_STORAGE, }; private static final int PERMISSION_STORAGE_CODE = 1; // 定义存储权限请求码 private EditText et_phone_number; // 定义EditText用于输入电话号码 private EditText et_message; // 定义EditText用于输入消息 private EditText et_title; // 定义EditText用于输入标题 @Override protected void onCreate(Bundle savedInstanceState) { // onCreate方法，Activity创建时调用 super.onCreate(savedInstanceState); // 调用父类onCreate方法 setContentView(R.layout.activity_provide_mms); // 设置布局文件 gl_appendix = findViewById(R.id.gl_appendix); // 获取GridLayout用于显示图片 et_title = findViewById(R.id.et_title); // 获取EditText用于输入标题 et_message = findViewById(R.id.et_message); // 获取EditText用于输入消息 et_phone_number = findViewById(R.id.et_phone_number); // 获取EditText用于输入电话号码 MediaScannerConnection.scanFile( // 调用MediaScannerConnection扫描文件 this, new String[]{Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS).toString()}, // 扫描下载目录 null, null ); if (PermissionUtil.checkPermission(this, PERMISSION_STORAGE, PERMISSION_STORAGE_CODE)) { // 检查存储权限 loadImageList(); // 加载图片列表 showImageGrid(); // 显示图片网格 } } @Override public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) { // 权限请求结果回调 super.onRequestPermissionsResult(requestCode, permissions, grantResults); // 调用父类方法 if (requestCode == PERMISSION_STORAGE_CODE) { // 判断请求码是否为存储权限 if (PermissionUtil.checkGranted(grantResults)) { // 检查权限是否被授予 loadImageList(); // 加载图片列表 showImageGrid(); // 显示图片网格 } } } private void showImageGrid() { // 显示图片网格的方法 gl_appendix.removeAllViews(); // 移除所有视图 for (ImageInfo image : mImageList) { // 遍历图片列表 ImageView imageView = new ImageView(this); // 创建ImageView Bitmap bitmap = BitmapFactory.decodeFile(image.path); // 解码图片文件 imageView.setImageBitmap(bitmap); // 设置图片 imageView.setScaleType(ImageView.ScaleType.FIT_CENTER); // 设置缩放类型 int px = Utils.dip2px(this, 110); // 将110dp转换为px ViewGroup.LayoutParams params = new ViewGroup.LayoutParams(px, px); // 创建布局参数 imageView.setLayoutParams(params); // 设置布局参数 int padding = Utils.dip2px(this, 5); // 将5dp转换为px imageView.setPadding(padding, padding, padding, padding); // 设置内边距 imageView.setOnClickListener(v -\u003e { // 设置点击监听器 sendMms(et_phone_number.getText().toString(), // 获取输入的电话号码 et_title.getText().toString(), // 获取输入的标题 et_message.getText().toString(), // 获取输入的消息 image.path); // 获取图片路径 }); gl_appendix.addView(imageView); // 将ImageView添加到GridLayout } } private void sendMms(String phone, String title, String desc, String path) { // 发送MMS的方法 Uri uri = Uri.parse(path); // 将路径解析为Uri // 兼容Android 7.0 把访问文件的Uri方式改为FileProvider if (Build.VERSION.SDK_INT \u003e= Build.VERSION_CODES.N) { // 判断是否为Android 7.0及以上 uri = FileProvider.getUriForFile(this, getString(R.string.file_Provider), new File(path)); // 使用FileProvider获取Uri Log.d(TAG, String.format(\"FileProvider Uri : %s\", uri.toString())); // 打印FileProvider的Uri } Intent intent = new Intent(Intent.ACTION_SEND); // 创建发送Intent intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); // 添加新任务标志 intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); // 添加读取URI权限标志 intent.putExtra(\"address\", phone); // 设置电话号码 intent.putExtra(\"subject\", title); // 设置标题 intent.putExtra(\"sms_body\", desc); // 设置消息内容 intent.putExtra(Intent.EXTRA_STREAM, uri); // 添加图片Uri intent.setType(\"image/*\"); // 设置类型为图片 startActivity(intent); // 启动Activity ToastUtil.show(this, \"从在弹窗中选择信息或短信应用\"); // 显示提示信息 } @SuppressLint(\"Range\") private void loadImageList() { // 加载图片列表的方法 String[] columns = new String[]{ // 定义要查询的列 MediaStore.Images.Media._ID, MediaStore.Images.Media.TITLE, MediaStore.Images.Media.SIZE, MediaStore.Images.Media.DATA }; Cursor cursor = getContentResolver().query( // 查询图片媒体库 MediaStore.Images.Media.EXTERNAL_CONTENT_URI, // 查询外部图片URI columns, // 查询的列 \"_size \u003c 307200\", // 查询条件：大小小于300KB null, // 查询参数 \"_size DESC\"); // 排序方式：按大小降序 int count = 0; // 定义计数器 if (cursor != null) { // 如果游标不为空 while (cursor.moveToNext() \u0026\u0026 count \u003c 6) { // 遍历查询结果，最多6个 ImageInfo image = new ImageInfo(); // 创建ImageInfo对象 image.id = cursor.getLong(cursor.getColumnIndex(MediaStore.Images.Media._ID)); // 获取图片ID image.name = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.TITLE)); // 获取图片标题 image.size = cursor.getLong(cursor.getColumnIndex(MediaStore.Images.Media.SIZE)); // 获取图片大小 image.path = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DATA)); // 获取图片路径 if (FileUtil.checkFileUri(this, image.path)) { // 检查文件URI是否有效 count += 1; // 增加计数 mImageList.add(image); // 将图片信息添加到列表 } Log.d(TAG, image.toString()); // 打印图片信息 } } } } xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 ",
  "wordCount" : "8625",
  "inLanguage": "zh",
  "datePublished": "2024-06-26T22:30:13+08:00",
  "dateModified": "2024-06-29T22:20:13+08:00",
  "author":{
    "@type": "Person",
    "name": "ShowGuan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kennems.github.io/posts/tech/android4/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kennem's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kennems.github.io/img/sun.png"
    }
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kennems.github.io/" accesskey="h" title="Kennem&#39;s Blog (Alt + H)">
                <img src="https://kennems.github.io/img/sun.png" alt="" aria-label="logo"
                    height="35">Kennem&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://kennems.github.io/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/archives" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/categories" title="🗂️分类">
                    <span>🗂️分类</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://kennems.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://kennems.github.io/posts/">📚文章</a>&nbsp;»&nbsp;<a href="https://kennems.github.io/posts/tech/">💻技术</a></div>
    <h1 class="post-title entry-hint-parent">
      Android（4）
    </h1>
    <div class="post-description">
      Android学习笔记
    </div>
    <div class="post-meta"><span title='2024-06-26 22:30:13 +0800 CST'>2024-06-26</span>&nbsp;·&nbsp;18 分钟&nbsp;·&nbsp;8625 字&nbsp;·&nbsp;updated:&nbsp;2024-06-29&nbsp;·&nbsp;ShowGuan

</div>
    
     <div class="post-password">
        
    </div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#android4" aria-label="Android（4）">Android（4）</a><ul>
                            
                    <li>
                        <a href="#%e5%86%85%e5%ae%b9%e6%8f%90%e4%be%9b%e8%80%85contentprovider" aria-label="内容提供者(ContentProvider)">内容提供者(ContentProvider)</a><ul>
                            
                    <li>
                        <a href="#server%e5%86%85%e5%ae%b9%e6%8f%90%e4%be%9b%e7%a8%8b%e5%ba%8f" aria-label="server内容提供程序">server内容提供程序</a><ul>
                            
                    <li>
                        <a href="#userinfoproviderjava" aria-label="UserInfoProvider.java">UserInfoProvider.java</a></li>
                    <li>
                        <a href="#userinfocontentjava-%e5%ae%9a%e4%b9%89%e5%b8%b8%e9%87%8f" aria-label="UserInfoContent.java 定义常量">UserInfoContent.java 定义常量</a></li>
                    <li>
                        <a href="#userdbhelperjava%e5%88%9b%e5%bb%ba%e8%a1%a8" aria-label="UserDBHelper.java创建表">UserDBHelper.java创建表</a></li></ul>
                    </li>
                    <li>
                        <a href="#client%e6%8e%a5%e5%8f%97%e6%95%b0%e6%8d%ae%e7%ab%af" aria-label="client接受数据端">client接受数据端</a><ul>
                            
                    <li>
                        <a href="#contentwriteactivityjava" aria-label="ContentWriteActivity.java">ContentWriteActivity.java</a></li>
                    <li>
                        <a href="#%e9%80%9a%e8%bf%87uri%e6%a0%bc%e5%bc%8f%e5%88%a0%e9%99%a4%e4%b8%80%e4%b8%aa%e7%94%a8%e6%88%b7" aria-label="通过Uri格式删除一个用户">通过Uri格式删除一个用户</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e5%8a%a8%e6%80%81%e7%94%b3%e8%af%b7%e6%9d%83%e9%99%90" aria-label="动态申请权限">动态申请权限</a><ul>
                            
                    <li>
                        <a href="#%e6%87%92%e6%b1%89%e5%bc%8f%e8%8e%b7%e5%8f%96%e6%9d%83%e9%99%90" aria-label="懒汉式获取权限">懒汉式获取权限</a><ul>
                            
                    <li>
                        <a href="#%e9%a6%96%e5%85%88%e6%b7%bb%e5%8a%a0%e6%8c%89%e9%92%ae%e4%ba%8b%e4%bb%b6%e7%9b%91%e5%90%ac" aria-label="首先添加按钮事件监听：">首先添加按钮事件监听：</a></li>
                    <li>
                        <a href="#%e5%9c%a8%e5%b7%a5%e5%85%b7%e7%b1%bb%e4%b8%ad%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e6%9c%89%e6%b2%a1%e6%9c%89%e8%8e%b7%e5%8f%96%e5%88%b0%e7%9a%84%e6%9d%83%e9%99%90%e7%94%b3%e8%af%b7%e8%8e%b7%e5%8f%96" aria-label="在工具类中判断是否有没有获取到的权限，申请获取">在工具类中判断是否有没有获取到的权限，申请获取</a></li>
                    <li>
                        <a href="#%e5%85%b6%e4%b8%adactivitycompatrequestpermissions%e6%96%b9%e6%b3%95%e7%9a%84%e5%8f%82%e6%95%b0%e5%9c%a8onrequestpermissionsresult%e4%b8%ad%e8%bf%94%e5%9b%9e" aria-label="其中ActivityCompat.requestPermissions方法的参数在onRequestPermissionsResult中返回">其中<code>ActivityCompat.requestPermissions</code>方法的参数在<code>onRequestPermissionsResult</code>中返回</a></li>
                    <li>
                        <a href="#permissionlazyactivityjava" aria-label="PermissionLazyActivity.java">PermissionLazyActivity.java</a></li>
                    <li>
                        <a href="#%e8%b7%b3%e8%bd%ac%e5%88%b0%e7%b3%bb%e7%bb%9f%e6%9d%83%e9%99%90%e8%ae%be%e8%ae%a1%e7%95%8c%e9%9d%a2" aria-label="跳转到系统权限设计界面：">跳转到系统权限设计界面：</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e9%a5%bf%e6%b1%89%e5%bc%8f%e8%8e%b7%e5%8f%96%e6%9d%83%e9%99%90" aria-label="饿汉式获取权限">饿汉式获取权限</a><ul>
                            
                    <li>
                        <a href="#permissionhungryactivityjava" aria-label="PermissionHungryActivity.java">PermissionHungryActivity.java</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e6%b7%bb%e5%8a%a0%e8%81%94%e7%b3%bb%e4%ba%ba" aria-label="添加联系人">添加联系人</a></li>
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e7%9f%ad%e4%bf%a1" aria-label="发送短信">发送短信</a><ul>
                            
                    <li>
                        <a href="#java" aria-label="Java">Java</a></li></ul>
                    </li>
                    <li>
                        <a href="#fileprovider%e6%8c%87%e5%ae%9a%e8%8e%b7%e5%8f%96%e5%9b%be%e7%89%87%e8%b7%af%e5%be%84%e5%b9%b6%e5%8f%91%e9%80%81%e7%9f%ad%e4%bf%a1" aria-label="FileProvider指定获取图片路径并发送短信">FileProvider指定获取图片路径并发送短信</a><ul>
                            
                    <li>
                        <a href="#xml" aria-label="xml">xml</a></li></ul>
                    </li>
                    <li>
                        <a href="#fileprovider-%e5%ae%89%e8%a3%85apk" aria-label="FileProvider 安装apk">FileProvider 安装apk</a><ul>
                            
                    <li>
                        <a href="#java-1" aria-label="Java">Java</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="android4">Android（4）<a hidden class="anchor" aria-hidden="true" href="#android4">#</a></h1>
<p>就算是最低的15x15都已经不错了，以后还有时间去学，上了研究生也没人能保证你有15x15的收入</p>
<h2 id="内容提供者contentprovider">内容提供者(ContentProvider)<a hidden class="anchor" aria-hidden="true" href="#内容提供者contentprovider">#</a></h2>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/content_provider.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/content_provider.gif" alt="content_provider"  />
        </a>
    </div>
</p>
<p>CountentProvider为App存取内部数据提供统一的外部接口，让不同的应用之间得以共享数据</p>
<p>Uri 通用资源标识符 Universal Resource Identifer， 代表数据操作的地址，每一个ContentProvider都会有唯一的地址。ContentProvider使用的Uri语法结构如下：</p>
<ul>
<li><code>content://authority/data_path/id</code></li>
<li><code>content://</code>是通用前缀，表示该Uri用于ContentProvider定位资源。</li>
<li><code>authority</code>是授权者名称，用来确定具体由哪一个ContentProvider提供资源。因此一般anthority都由类的小写全称组成，以保证唯一性。</li>
<li><code>data_path</code>是数据路径，用来确定请求的是哪个数据集</li>
<li><code>id</code>是数据编号，用来请求单条数据。<strong>如果是多条这个字段忽略</strong>。</li>
</ul>
<h3 id="server内容提供程序">server内容提供程序<a hidden class="anchor" aria-hidden="true" href="#server内容提供程序">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214055877.png">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214055877.png" alt="image-20240627214055877"  />
        </a>
    </div>
</p>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214117171.png">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214117171.png" alt="image-20240627214117171"  />
        </a>
    </div>
</p>
<h4 id="userinfoproviderjava">UserInfoProvider.java<a hidden class="anchor" aria-hidden="true" href="#userinfoproviderjava">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1"> 1</a>
</span><span class="lnt" id="hl-0-2"><a class="lnlinks" href="#hl-0-2"> 2</a>
</span><span class="lnt" id="hl-0-3"><a class="lnlinks" href="#hl-0-3"> 3</a>
</span><span class="lnt" id="hl-0-4"><a class="lnlinks" href="#hl-0-4"> 4</a>
</span><span class="lnt" id="hl-0-5"><a class="lnlinks" href="#hl-0-5"> 5</a>
</span><span class="lnt" id="hl-0-6"><a class="lnlinks" href="#hl-0-6"> 6</a>
</span><span class="lnt" id="hl-0-7"><a class="lnlinks" href="#hl-0-7"> 7</a>
</span><span class="lnt" id="hl-0-8"><a class="lnlinks" href="#hl-0-8"> 8</a>
</span><span class="lnt" id="hl-0-9"><a class="lnlinks" href="#hl-0-9"> 9</a>
</span><span class="lnt" id="hl-0-10"><a class="lnlinks" href="#hl-0-10">10</a>
</span><span class="lnt" id="hl-0-11"><a class="lnlinks" href="#hl-0-11">11</a>
</span><span class="lnt" id="hl-0-12"><a class="lnlinks" href="#hl-0-12">12</a>
</span><span class="lnt" id="hl-0-13"><a class="lnlinks" href="#hl-0-13">13</a>
</span><span class="lnt" id="hl-0-14"><a class="lnlinks" href="#hl-0-14">14</a>
</span><span class="lnt" id="hl-0-15"><a class="lnlinks" href="#hl-0-15">15</a>
</span><span class="lnt" id="hl-0-16"><a class="lnlinks" href="#hl-0-16">16</a>
</span><span class="lnt" id="hl-0-17"><a class="lnlinks" href="#hl-0-17">17</a>
</span><span class="lnt" id="hl-0-18"><a class="lnlinks" href="#hl-0-18">18</a>
</span><span class="lnt" id="hl-0-19"><a class="lnlinks" href="#hl-0-19">19</a>
</span><span class="lnt" id="hl-0-20"><a class="lnlinks" href="#hl-0-20">20</a>
</span><span class="lnt" id="hl-0-21"><a class="lnlinks" href="#hl-0-21">21</a>
</span><span class="lnt" id="hl-0-22"><a class="lnlinks" href="#hl-0-22">22</a>
</span><span class="lnt" id="hl-0-23"><a class="lnlinks" href="#hl-0-23">23</a>
</span><span class="lnt" id="hl-0-24"><a class="lnlinks" href="#hl-0-24">24</a>
</span><span class="lnt" id="hl-0-25"><a class="lnlinks" href="#hl-0-25">25</a>
</span><span class="lnt" id="hl-0-26"><a class="lnlinks" href="#hl-0-26">26</a>
</span><span class="lnt" id="hl-0-27"><a class="lnlinks" href="#hl-0-27">27</a>
</span><span class="lnt" id="hl-0-28"><a class="lnlinks" href="#hl-0-28">28</a>
</span><span class="lnt" id="hl-0-29"><a class="lnlinks" href="#hl-0-29">29</a>
</span><span class="lnt" id="hl-0-30"><a class="lnlinks" href="#hl-0-30">30</a>
</span><span class="lnt" id="hl-0-31"><a class="lnlinks" href="#hl-0-31">31</a>
</span><span class="lnt" id="hl-0-32"><a class="lnlinks" href="#hl-0-32">32</a>
</span><span class="lnt" id="hl-0-33"><a class="lnlinks" href="#hl-0-33">33</a>
</span><span class="lnt" id="hl-0-34"><a class="lnlinks" href="#hl-0-34">34</a>
</span><span class="lnt" id="hl-0-35"><a class="lnlinks" href="#hl-0-35">35</a>
</span><span class="lnt" id="hl-0-36"><a class="lnlinks" href="#hl-0-36">36</a>
</span><span class="lnt" id="hl-0-37"><a class="lnlinks" href="#hl-0-37">37</a>
</span><span class="lnt" id="hl-0-38"><a class="lnlinks" href="#hl-0-38">38</a>
</span><span class="lnt" id="hl-0-39"><a class="lnlinks" href="#hl-0-39">39</a>
</span><span class="lnt" id="hl-0-40"><a class="lnlinks" href="#hl-0-40">40</a>
</span><span class="lnt" id="hl-0-41"><a class="lnlinks" href="#hl-0-41">41</a>
</span><span class="lnt" id="hl-0-42"><a class="lnlinks" href="#hl-0-42">42</a>
</span><span class="lnt" id="hl-0-43"><a class="lnlinks" href="#hl-0-43">43</a>
</span><span class="lnt" id="hl-0-44"><a class="lnlinks" href="#hl-0-44">44</a>
</span><span class="lnt" id="hl-0-45"><a class="lnlinks" href="#hl-0-45">45</a>
</span><span class="lnt" id="hl-0-46"><a class="lnlinks" href="#hl-0-46">46</a>
</span><span class="lnt" id="hl-0-47"><a class="lnlinks" href="#hl-0-47">47</a>
</span><span class="lnt" id="hl-0-48"><a class="lnlinks" href="#hl-0-48">48</a>
</span><span class="lnt" id="hl-0-49"><a class="lnlinks" href="#hl-0-49">49</a>
</span><span class="lnt" id="hl-0-50"><a class="lnlinks" href="#hl-0-50">50</a>
</span><span class="lnt" id="hl-0-51"><a class="lnlinks" href="#hl-0-51">51</a>
</span><span class="lnt" id="hl-0-52"><a class="lnlinks" href="#hl-0-52">52</a>
</span><span class="lnt" id="hl-0-53"><a class="lnlinks" href="#hl-0-53">53</a>
</span><span class="lnt" id="hl-0-54"><a class="lnlinks" href="#hl-0-54">54</a>
</span><span class="lnt" id="hl-0-55"><a class="lnlinks" href="#hl-0-55">55</a>
</span><span class="lnt" id="hl-0-56"><a class="lnlinks" href="#hl-0-56">56</a>
</span><span class="lnt" id="hl-0-57"><a class="lnlinks" href="#hl-0-57">57</a>
</span><span class="lnt" id="hl-0-58"><a class="lnlinks" href="#hl-0-58">58</a>
</span><span class="lnt" id="hl-0-59"><a class="lnlinks" href="#hl-0-59">59</a>
</span><span class="lnt" id="hl-0-60"><a class="lnlinks" href="#hl-0-60">60</a>
</span><span class="lnt" id="hl-0-61"><a class="lnlinks" href="#hl-0-61">61</a>
</span><span class="lnt" id="hl-0-62"><a class="lnlinks" href="#hl-0-62">62</a>
</span><span class="lnt" id="hl-0-63"><a class="lnlinks" href="#hl-0-63">63</a>
</span><span class="lnt" id="hl-0-64"><a class="lnlinks" href="#hl-0-64">64</a>
</span><span class="lnt" id="hl-0-65"><a class="lnlinks" href="#hl-0-65">65</a>
</span><span class="lnt" id="hl-0-66"><a class="lnlinks" href="#hl-0-66">66</a>
</span><span class="lnt" id="hl-0-67"><a class="lnlinks" href="#hl-0-67">67</a>
</span><span class="lnt" id="hl-0-68"><a class="lnlinks" href="#hl-0-68">68</a>
</span><span class="lnt" id="hl-0-69"><a class="lnlinks" href="#hl-0-69">69</a>
</span><span class="lnt" id="hl-0-70"><a class="lnlinks" href="#hl-0-70">70</a>
</span><span class="lnt" id="hl-0-71"><a class="lnlinks" href="#hl-0-71">71</a>
</span><span class="lnt" id="hl-0-72"><a class="lnlinks" href="#hl-0-72">72</a>
</span><span class="lnt" id="hl-0-73"><a class="lnlinks" href="#hl-0-73">73</a>
</span><span class="lnt" id="hl-0-74"><a class="lnlinks" href="#hl-0-74">74</a>
</span><span class="lnt" id="hl-0-75"><a class="lnlinks" href="#hl-0-75">75</a>
</span><span class="lnt" id="hl-0-76"><a class="lnlinks" href="#hl-0-76">76</a>
</span><span class="lnt" id="hl-0-77"><a class="lnlinks" href="#hl-0-77">77</a>
</span><span class="lnt" id="hl-0-78"><a class="lnlinks" href="#hl-0-78">78</a>
</span><span class="lnt" id="hl-0-79"><a class="lnlinks" href="#hl-0-79">79</a>
</span><span class="lnt" id="hl-0-80"><a class="lnlinks" href="#hl-0-80">80</a>
</span><span class="lnt" id="hl-0-81"><a class="lnlinks" href="#hl-0-81">81</a>
</span><span class="lnt" id="hl-0-82"><a class="lnlinks" href="#hl-0-82">82</a>
</span><span class="lnt" id="hl-0-83"><a class="lnlinks" href="#hl-0-83">83</a>
</span><span class="lnt" id="hl-0-84"><a class="lnlinks" href="#hl-0-84">84</a>
</span><span class="lnt" id="hl-0-85"><a class="lnlinks" href="#hl-0-85">85</a>
</span><span class="lnt" id="hl-0-86"><a class="lnlinks" href="#hl-0-86">86</a>
</span><span class="lnt" id="hl-0-87"><a class="lnlinks" href="#hl-0-87">87</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_server.provider</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.ContentProvider</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.ContentValues</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.UriMatcher</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.database.Cursor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.database.sqlite.SQLiteDatabase</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.net.Uri</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.util.Log</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.showguan.chapter07_server.database.UserDBHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserInfoProvider</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ContentProvider</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserDBHelper</span><span class="w"> </span><span class="n">dbHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">USERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UriMatcher</span><span class="w"> </span><span class="n">URI_MATCHER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UriMatcher</span><span class="p">(</span><span class="n">UriMatcher</span><span class="p">.</span><span class="na">NO_MATCH</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">URI_MATCHER</span><span class="p">.</span><span class="na">addURI</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">AUTHORITIES</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;/user/#&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">USER</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">URI_MATCHER</span><span class="p">.</span><span class="na">addURI</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">AUTHORITIES</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;/user&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">USERS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// TODO: Implement this to initialize your content provider on startup.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;ContentProvider onCreate: &#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">dbHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserDBHelper</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getContext</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">URI_MATCHER</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USERS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbHelper</span><span class="p">.</span><span class="na">getWritableDatabase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">db</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">UserDBHelper</span><span class="p">.</span><span class="na">TABLE_NAME</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">uri</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Cursor</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">projection</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">selectionArgs</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sortOrder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">URI_MATCHER</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USERS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;UserInfoProvider query: &#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbHelper</span><span class="p">.</span><span class="na">getReadableDatabase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Cursor</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">UserDBHelper</span><span class="p">.</span><span class="na">TABLE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">projection</span><span class="p">,</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">selectionArgs</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cursor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">selectionArgs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">URI_MATCHER</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">USER</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">getLastPathSegment</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbHelper</span><span class="p">.</span><span class="na">getWritableDatabase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db1</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">UserDBHelper</span><span class="p">.</span><span class="na">TABLE_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;_id = ?&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">id</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">db1</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">USERS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbHelper</span><span class="p">.</span><span class="na">getWritableDatabase</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db2</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">UserDBHelper</span><span class="p">.</span><span class="na">TABLE_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">selectionArgs</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">db2</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getType</span><span class="p">(</span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// TODO: Implement this to handle requests for the MIME type of the data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// at the given URI.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&#34;Not yet implemented&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">selectionArgs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// TODO: Implement this to handle requests to update one or more rows.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&#34;Not yet implemented&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="userinfocontentjava-定义常量">UserInfoContent.java 定义常量<a hidden class="anchor" aria-hidden="true" href="#userinfocontentjava-定义常量">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1"> 1</a>
</span><span class="lnt" id="hl-1-2"><a class="lnlinks" href="#hl-1-2"> 2</a>
</span><span class="lnt" id="hl-1-3"><a class="lnlinks" href="#hl-1-3"> 3</a>
</span><span class="lnt" id="hl-1-4"><a class="lnlinks" href="#hl-1-4"> 4</a>
</span><span class="lnt" id="hl-1-5"><a class="lnlinks" href="#hl-1-5"> 5</a>
</span><span class="lnt" id="hl-1-6"><a class="lnlinks" href="#hl-1-6"> 6</a>
</span><span class="lnt" id="hl-1-7"><a class="lnlinks" href="#hl-1-7"> 7</a>
</span><span class="lnt" id="hl-1-8"><a class="lnlinks" href="#hl-1-8"> 8</a>
</span><span class="lnt" id="hl-1-9"><a class="lnlinks" href="#hl-1-9"> 9</a>
</span><span class="lnt" id="hl-1-10"><a class="lnlinks" href="#hl-1-10">10</a>
</span><span class="lnt" id="hl-1-11"><a class="lnlinks" href="#hl-1-11">11</a>
</span><span class="lnt" id="hl-1-12"><a class="lnlinks" href="#hl-1-12">12</a>
</span><span class="lnt" id="hl-1-13"><a class="lnlinks" href="#hl-1-13">13</a>
</span><span class="lnt" id="hl-1-14"><a class="lnlinks" href="#hl-1-14">14</a>
</span><span class="lnt" id="hl-1-15"><a class="lnlinks" href="#hl-1-15">15</a>
</span><span class="lnt" id="hl-1-16"><a class="lnlinks" href="#hl-1-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_server.provider</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.net.Uri</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.provider.BaseColumns</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserInfoContent</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BaseColumns</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">AUTHORITIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;com.showguan.chapter07_server.provider.UserInfoProvider&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">CONTENT_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&#34;content://&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AUTHORITIES</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/user&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">USER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;name&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">USER_AGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;age&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">USER_HEIGHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;height&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">USER_WEIGHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;weight&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">USER_MARRIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;married&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="userdbhelperjava创建表">UserDBHelper.java创建表<a hidden class="anchor" aria-hidden="true" href="#userdbhelperjava创建表">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-2-1"><a class="lnlinks" href="#hl-2-1"> 1</a>
</span><span class="lnt" id="hl-2-2"><a class="lnlinks" href="#hl-2-2"> 2</a>
</span><span class="lnt" id="hl-2-3"><a class="lnlinks" href="#hl-2-3"> 3</a>
</span><span class="lnt" id="hl-2-4"><a class="lnlinks" href="#hl-2-4"> 4</a>
</span><span class="lnt" id="hl-2-5"><a class="lnlinks" href="#hl-2-5"> 5</a>
</span><span class="lnt" id="hl-2-6"><a class="lnlinks" href="#hl-2-6"> 6</a>
</span><span class="lnt" id="hl-2-7"><a class="lnlinks" href="#hl-2-7"> 7</a>
</span><span class="lnt" id="hl-2-8"><a class="lnlinks" href="#hl-2-8"> 8</a>
</span><span class="lnt" id="hl-2-9"><a class="lnlinks" href="#hl-2-9"> 9</a>
</span><span class="lnt" id="hl-2-10"><a class="lnlinks" href="#hl-2-10">10</a>
</span><span class="lnt" id="hl-2-11"><a class="lnlinks" href="#hl-2-11">11</a>
</span><span class="lnt" id="hl-2-12"><a class="lnlinks" href="#hl-2-12">12</a>
</span><span class="lnt" id="hl-2-13"><a class="lnlinks" href="#hl-2-13">13</a>
</span><span class="lnt" id="hl-2-14"><a class="lnlinks" href="#hl-2-14">14</a>
</span><span class="lnt" id="hl-2-15"><a class="lnlinks" href="#hl-2-15">15</a>
</span><span class="lnt" id="hl-2-16"><a class="lnlinks" href="#hl-2-16">16</a>
</span><span class="lnt" id="hl-2-17"><a class="lnlinks" href="#hl-2-17">17</a>
</span><span class="lnt" id="hl-2-18"><a class="lnlinks" href="#hl-2-18">18</a>
</span><span class="lnt" id="hl-2-19"><a class="lnlinks" href="#hl-2-19">19</a>
</span><span class="lnt" id="hl-2-20"><a class="lnlinks" href="#hl-2-20">20</a>
</span><span class="lnt" id="hl-2-21"><a class="lnlinks" href="#hl-2-21">21</a>
</span><span class="lnt" id="hl-2-22"><a class="lnlinks" href="#hl-2-22">22</a>
</span><span class="lnt" id="hl-2-23"><a class="lnlinks" href="#hl-2-23">23</a>
</span><span class="lnt" id="hl-2-24"><a class="lnlinks" href="#hl-2-24">24</a>
</span><span class="lnt" id="hl-2-25"><a class="lnlinks" href="#hl-2-25">25</a>
</span><span class="lnt" id="hl-2-26"><a class="lnlinks" href="#hl-2-26">26</a>
</span><span class="lnt" id="hl-2-27"><a class="lnlinks" href="#hl-2-27">27</a>
</span><span class="lnt" id="hl-2-28"><a class="lnlinks" href="#hl-2-28">28</a>
</span><span class="lnt" id="hl-2-29"><a class="lnlinks" href="#hl-2-29">29</a>
</span><span class="lnt" id="hl-2-30"><a class="lnlinks" href="#hl-2-30">30</a>
</span><span class="lnt" id="hl-2-31"><a class="lnlinks" href="#hl-2-31">31</a>
</span><span class="lnt" id="hl-2-32"><a class="lnlinks" href="#hl-2-32">32</a>
</span><span class="lnt" id="hl-2-33"><a class="lnlinks" href="#hl-2-33">33</a>
</span><span class="lnt" id="hl-2-34"><a class="lnlinks" href="#hl-2-34">34</a>
</span><span class="lnt" id="hl-2-35"><a class="lnlinks" href="#hl-2-35">35</a>
</span><span class="lnt" id="hl-2-36"><a class="lnlinks" href="#hl-2-36">36</a>
</span><span class="lnt" id="hl-2-37"><a class="lnlinks" href="#hl-2-37">37</a>
</span><span class="lnt" id="hl-2-38"><a class="lnlinks" href="#hl-2-38">38</a>
</span><span class="lnt" id="hl-2-39"><a class="lnlinks" href="#hl-2-39">39</a>
</span><span class="lnt" id="hl-2-40"><a class="lnlinks" href="#hl-2-40">40</a>
</span><span class="lnt" id="hl-2-41"><a class="lnlinks" href="#hl-2-41">41</a>
</span><span class="lnt" id="hl-2-42"><a class="lnlinks" href="#hl-2-42">42</a>
</span><span class="lnt" id="hl-2-43"><a class="lnlinks" href="#hl-2-43">43</a>
</span><span class="lnt" id="hl-2-44"><a class="lnlinks" href="#hl-2-44">44</a>
</span><span class="lnt" id="hl-2-45"><a class="lnlinks" href="#hl-2-45">45</a>
</span><span class="lnt" id="hl-2-46"><a class="lnlinks" href="#hl-2-46">46</a>
</span><span class="lnt" id="hl-2-47"><a class="lnlinks" href="#hl-2-47">47</a>
</span><span class="lnt" id="hl-2-48"><a class="lnlinks" href="#hl-2-48">48</a>
</span><span class="lnt" id="hl-2-49"><a class="lnlinks" href="#hl-2-49">49</a>
</span><span class="lnt" id="hl-2-50"><a class="lnlinks" href="#hl-2-50">50</a>
</span><span class="lnt" id="hl-2-51"><a class="lnlinks" href="#hl-2-51">51</a>
</span><span class="lnt" id="hl-2-52"><a class="lnlinks" href="#hl-2-52">52</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_server.database</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.ContentValues</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Context</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.database.Cursor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.database.sqlite.SQLiteDatabase</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.database.sqlite.SQLiteOpenHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.Nullable</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserDBHelper</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SQLiteOpenHelper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DB_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user.db&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TABLE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user_info&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DB_VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">UserDBHelper</span><span class="w"> </span><span class="n">mHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">mRDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">mWDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">UserDBHelper</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">DB_NAME</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">DB_VERSION</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">UserDBHelper</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mHelper</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserDBHelper</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;CREATE TABLE IF NOT EXISTS &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TABLE_NAME</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; (&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;_id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34; name VARCHAR NOT NULL,&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34; age INTEGER NOT NULL,&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34; height LONG NOT NULL,&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34; weight FLOAT NOT NULL,&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34; married INTEGER NOT NULL);&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">db</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onUpgrade</span><span class="p">(</span><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">oldVersion</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="client接受数据端">client接受数据端<a hidden class="anchor" aria-hidden="true" href="#client接受数据端">#</a></h3>
<p>首先在Manifest中添加如下，表示需要访问的内容提供者的包</p>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214757246.png">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240627214757246.png" alt="image-20240627214757246"  />
        </a>
    </div>
</p>
<h4 id="contentwriteactivityjava">ContentWriteActivity.java<a hidden class="anchor" aria-hidden="true" href="#contentwriteactivityjava">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-3-1"><a class="lnlinks" href="#hl-3-1"> 1</a>
</span><span class="lnt" id="hl-3-2"><a class="lnlinks" href="#hl-3-2"> 2</a>
</span><span class="lnt" id="hl-3-3"><a class="lnlinks" href="#hl-3-3"> 3</a>
</span><span class="lnt" id="hl-3-4"><a class="lnlinks" href="#hl-3-4"> 4</a>
</span><span class="lnt" id="hl-3-5"><a class="lnlinks" href="#hl-3-5"> 5</a>
</span><span class="lnt" id="hl-3-6"><a class="lnlinks" href="#hl-3-6"> 6</a>
</span><span class="lnt" id="hl-3-7"><a class="lnlinks" href="#hl-3-7"> 7</a>
</span><span class="lnt" id="hl-3-8"><a class="lnlinks" href="#hl-3-8"> 8</a>
</span><span class="lnt" id="hl-3-9"><a class="lnlinks" href="#hl-3-9"> 9</a>
</span><span class="lnt" id="hl-3-10"><a class="lnlinks" href="#hl-3-10">10</a>
</span><span class="lnt" id="hl-3-11"><a class="lnlinks" href="#hl-3-11">11</a>
</span><span class="lnt" id="hl-3-12"><a class="lnlinks" href="#hl-3-12">12</a>
</span><span class="lnt" id="hl-3-13"><a class="lnlinks" href="#hl-3-13">13</a>
</span><span class="lnt" id="hl-3-14"><a class="lnlinks" href="#hl-3-14">14</a>
</span><span class="lnt" id="hl-3-15"><a class="lnlinks" href="#hl-3-15">15</a>
</span><span class="lnt" id="hl-3-16"><a class="lnlinks" href="#hl-3-16">16</a>
</span><span class="lnt" id="hl-3-17"><a class="lnlinks" href="#hl-3-17">17</a>
</span><span class="lnt" id="hl-3-18"><a class="lnlinks" href="#hl-3-18">18</a>
</span><span class="lnt" id="hl-3-19"><a class="lnlinks" href="#hl-3-19">19</a>
</span><span class="lnt" id="hl-3-20"><a class="lnlinks" href="#hl-3-20">20</a>
</span><span class="lnt" id="hl-3-21"><a class="lnlinks" href="#hl-3-21">21</a>
</span><span class="lnt" id="hl-3-22"><a class="lnlinks" href="#hl-3-22">22</a>
</span><span class="lnt" id="hl-3-23"><a class="lnlinks" href="#hl-3-23">23</a>
</span><span class="lnt" id="hl-3-24"><a class="lnlinks" href="#hl-3-24">24</a>
</span><span class="lnt" id="hl-3-25"><a class="lnlinks" href="#hl-3-25">25</a>
</span><span class="lnt" id="hl-3-26"><a class="lnlinks" href="#hl-3-26">26</a>
</span><span class="lnt" id="hl-3-27"><a class="lnlinks" href="#hl-3-27">27</a>
</span><span class="lnt" id="hl-3-28"><a class="lnlinks" href="#hl-3-28">28</a>
</span><span class="lnt" id="hl-3-29"><a class="lnlinks" href="#hl-3-29">29</a>
</span><span class="lnt" id="hl-3-30"><a class="lnlinks" href="#hl-3-30">30</a>
</span><span class="lnt" id="hl-3-31"><a class="lnlinks" href="#hl-3-31">31</a>
</span><span class="lnt" id="hl-3-32"><a class="lnlinks" href="#hl-3-32">32</a>
</span><span class="lnt" id="hl-3-33"><a class="lnlinks" href="#hl-3-33">33</a>
</span><span class="lnt" id="hl-3-34"><a class="lnlinks" href="#hl-3-34">34</a>
</span><span class="lnt" id="hl-3-35"><a class="lnlinks" href="#hl-3-35">35</a>
</span><span class="lnt" id="hl-3-36"><a class="lnlinks" href="#hl-3-36">36</a>
</span><span class="lnt" id="hl-3-37"><a class="lnlinks" href="#hl-3-37">37</a>
</span><span class="lnt" id="hl-3-38"><a class="lnlinks" href="#hl-3-38">38</a>
</span><span class="lnt" id="hl-3-39"><a class="lnlinks" href="#hl-3-39">39</a>
</span><span class="lnt" id="hl-3-40"><a class="lnlinks" href="#hl-3-40">40</a>
</span><span class="lnt" id="hl-3-41"><a class="lnlinks" href="#hl-3-41">41</a>
</span><span class="lnt" id="hl-3-42"><a class="lnlinks" href="#hl-3-42">42</a>
</span><span class="lnt" id="hl-3-43"><a class="lnlinks" href="#hl-3-43">43</a>
</span><span class="lnt" id="hl-3-44"><a class="lnlinks" href="#hl-3-44">44</a>
</span><span class="lnt" id="hl-3-45"><a class="lnlinks" href="#hl-3-45">45</a>
</span><span class="lnt" id="hl-3-46"><a class="lnlinks" href="#hl-3-46">46</a>
</span><span class="lnt" id="hl-3-47"><a class="lnlinks" href="#hl-3-47">47</a>
</span><span class="lnt" id="hl-3-48"><a class="lnlinks" href="#hl-3-48">48</a>
</span><span class="lnt" id="hl-3-49"><a class="lnlinks" href="#hl-3-49">49</a>
</span><span class="lnt" id="hl-3-50"><a class="lnlinks" href="#hl-3-50">50</a>
</span><span class="lnt" id="hl-3-51"><a class="lnlinks" href="#hl-3-51">51</a>
</span><span class="lnt" id="hl-3-52"><a class="lnlinks" href="#hl-3-52">52</a>
</span><span class="lnt" id="hl-3-53"><a class="lnlinks" href="#hl-3-53">53</a>
</span><span class="lnt" id="hl-3-54"><a class="lnlinks" href="#hl-3-54">54</a>
</span><span class="lnt" id="hl-3-55"><a class="lnlinks" href="#hl-3-55">55</a>
</span><span class="lnt" id="hl-3-56"><a class="lnlinks" href="#hl-3-56">56</a>
</span><span class="lnt" id="hl-3-57"><a class="lnlinks" href="#hl-3-57">57</a>
</span><span class="lnt" id="hl-3-58"><a class="lnlinks" href="#hl-3-58">58</a>
</span><span class="lnt" id="hl-3-59"><a class="lnlinks" href="#hl-3-59">59</a>
</span><span class="lnt" id="hl-3-60"><a class="lnlinks" href="#hl-3-60">60</a>
</span><span class="lnt" id="hl-3-61"><a class="lnlinks" href="#hl-3-61">61</a>
</span><span class="lnt" id="hl-3-62"><a class="lnlinks" href="#hl-3-62">62</a>
</span><span class="lnt" id="hl-3-63"><a class="lnlinks" href="#hl-3-63">63</a>
</span><span class="lnt" id="hl-3-64"><a class="lnlinks" href="#hl-3-64">64</a>
</span><span class="lnt" id="hl-3-65"><a class="lnlinks" href="#hl-3-65">65</a>
</span><span class="lnt" id="hl-3-66"><a class="lnlinks" href="#hl-3-66">66</a>
</span><span class="lnt" id="hl-3-67"><a class="lnlinks" href="#hl-3-67">67</a>
</span><span class="lnt" id="hl-3-68"><a class="lnlinks" href="#hl-3-68">68</a>
</span><span class="lnt" id="hl-3-69"><a class="lnlinks" href="#hl-3-69">69</a>
</span><span class="lnt" id="hl-3-70"><a class="lnlinks" href="#hl-3-70">70</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ContentWriteActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_age</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_height</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_weight</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CheckBox</span><span class="w"> </span><span class="n">ck_isMarried</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_content_write</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_age</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_height</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_weight</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ck_isMarried</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">ck_isMarried</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_read</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_write</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_delete</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&#34;Range&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_write</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">values</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">et_name</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">values</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_AGE</span><span class="p">,</span><span class="w"> </span><span class="n">et_age</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">values</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_HEIGHT</span><span class="p">,</span><span class="w"> </span><span class="n">et_height</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">values</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_WEIGHT</span><span class="p">,</span><span class="w"> </span><span class="n">et_weight</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">values</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_MARRIED</span><span class="p">,</span><span class="w"> </span><span class="n">ck_isMarried</span><span class="p">.</span><span class="na">isChecked</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">getContentResolver</span><span class="p">().</span><span class="na">insert</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;保存成功！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_read</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Cursor</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getContentResolver</span><span class="p">().</span><span class="na">query</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cursor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">while</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">moveToNext</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">User</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">_ID</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_AGE</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_NAME</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setHeight</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getFloat</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_HEIGHT</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setWeight</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getFloat</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_WEIGHT</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setMarried</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">USER_MARRIED</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">cursor</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_delete</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 根据id删除单条</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//            Uri uri = ContentUris.withAppendedId(UserInfoContent.CONTENT_URI, 1);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//            int count = getContentResolver().delete(uri, null, null);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//根据名称删除多条</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getContentResolver</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;name = ?&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">et_name</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">()});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;删除成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;删除失败，不存在名为&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">et_name</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;的用户！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="通过uri格式删除一个用户">通过Uri格式删除一个用户<a hidden class="anchor" aria-hidden="true" href="#通过uri格式删除一个用户">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-4-1"><a class="lnlinks" href="#hl-4-1">1</a>
</span><span class="lnt" id="hl-4-2"><a class="lnlinks" href="#hl-4-2">2</a>
</span><span class="lnt" id="hl-4-3"><a class="lnlinks" href="#hl-4-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 根据id删除单条</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentUris</span><span class="p">.</span><span class="na">withAppendedId</span><span class="p">(</span><span class="n">UserInfoContent</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getContentResolver</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="动态申请权限">动态申请权限<a hidden class="anchor" aria-hidden="true" href="#动态申请权限">#</a></h2>
<p>步骤：</p>
<ol>
<li>检查App是否开启了指定权限
<ul>
<li>调用<code>ContextCompat</code>的<code>checkSelfPermission</code>方法</li>
</ul>
</li>
<li>请求系统弹窗，以便用户选择是否开启权限
<ul>
<li>调用<code>ActivityCompat</code>的<code>requestPermission</code>方法，即可命令系统自动弹出权限申请窗口。</li>
</ul>
</li>
<li>判断用户的权限选择结果
<ul>
<li>重写活动页面的权限请求回调方法<code>onRequestPermissionResult</code>， 在该方法内部处理用户的权限选择结果。</li>
</ul>
</li>
</ol>
<h3 id="懒汉式获取权限">懒汉式获取权限<a hidden class="anchor" aria-hidden="true" href="#懒汉式获取权限">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/permission_lazy.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/permission_lazy.gif" alt="permission_lazy"  />
        </a>
    </div>
</p>
<h4 id="首先添加按钮事件监听">首先添加按钮事件监听：<a hidden class="anchor" aria-hidden="true" href="#首先添加按钮事件监听">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-5-1"><a class="lnlinks" href="#hl-5-1">1</a>
</span><span class="lnt" id="hl-5-2"><a class="lnlinks" href="#hl-5-2">2</a>
</span><span class="lnt" id="hl-5-3"><a class="lnlinks" href="#hl-5-3">3</a>
</span><span class="lnt" id="hl-5-4"><a class="lnlinks" href="#hl-5-4">4</a>
</span><span class="lnt" id="hl-5-5"><a class="lnlinks" href="#hl-5-5">5</a>
</span><span class="lnt" id="hl-5-6"><a class="lnlinks" href="#hl-5-6">6</a>
</span><span class="lnt" id="hl-5-7"><a class="lnlinks" href="#hl-5-7">7</a>
</span><span class="lnt" id="hl-5-8"><a class="lnlinks" href="#hl-5-8">8</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_contacts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_CONTACTS</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_sms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_SMS</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="在工具类中判断是否有没有获取到的权限申请获取">在工具类中判断是否有没有获取到的权限，申请获取<a hidden class="anchor" aria-hidden="true" href="#在工具类中判断是否有没有获取到的权限申请获取">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-6-1"><a class="lnlinks" href="#hl-6-1"> 1</a>
</span><span class="lnt" id="hl-6-2"><a class="lnlinks" href="#hl-6-2"> 2</a>
</span><span class="lnt" id="hl-6-3"><a class="lnlinks" href="#hl-6-3"> 3</a>
</span><span class="lnt" id="hl-6-4"><a class="lnlinks" href="#hl-6-4"> 4</a>
</span><span class="lnt" id="hl-6-5"><a class="lnlinks" href="#hl-6-5"> 5</a>
</span><span class="lnt" id="hl-6-6"><a class="lnlinks" href="#hl-6-6"> 6</a>
</span><span class="lnt" id="hl-6-7"><a class="lnlinks" href="#hl-6-7"> 7</a>
</span><span class="lnt" id="hl-6-8"><a class="lnlinks" href="#hl-6-8"> 8</a>
</span><span class="lnt" id="hl-6-9"><a class="lnlinks" href="#hl-6-9"> 9</a>
</span><span class="lnt" id="hl-6-10"><a class="lnlinks" href="#hl-6-10">10</a>
</span><span class="lnt" id="hl-6-11"><a class="lnlinks" href="#hl-6-11">11</a>
</span><span class="lnt" id="hl-6-12"><a class="lnlinks" href="#hl-6-12">12</a>
</span><span class="lnt" id="hl-6-13"><a class="lnlinks" href="#hl-6-13">13</a>
</span><span class="lnt" id="hl-6-14"><a class="lnlinks" href="#hl-6-14">14</a>
</span><span class="lnt" id="hl-6-15"><a class="lnlinks" href="#hl-6-15">15</a>
</span><span class="lnt" id="hl-6-16"><a class="lnlinks" href="#hl-6-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkPermission</span><span class="p">(</span><span class="n">Activity</span><span class="w"> </span><span class="n">act</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">M</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">permissions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContextCompat</span><span class="p">.</span><span class="na">checkSelfPermission</span><span class="p">(</span><span class="n">act</span><span class="p">,</span><span class="w"> </span><span class="n">permission</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ActivityCompat</span><span class="p">.</span><span class="na">requestPermissions</span><span class="p">(</span><span class="n">act</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">requestCode</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="其中activitycompatrequestpermissions方法的参数在onrequestpermissionsresult中返回">其中<code>ActivityCompat.requestPermissions</code>方法的参数在<code>onRequestPermissionsResult</code>中返回<a hidden class="anchor" aria-hidden="true" href="#其中activitycompatrequestpermissions方法的参数在onrequestpermissionsresult中返回">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-7-1"><a class="lnlinks" href="#hl-7-1"> 1</a>
</span><span class="lnt" id="hl-7-2"><a class="lnlinks" href="#hl-7-2"> 2</a>
</span><span class="lnt" id="hl-7-3"><a class="lnlinks" href="#hl-7-3"> 3</a>
</span><span class="lnt" id="hl-7-4"><a class="lnlinks" href="#hl-7-4"> 4</a>
</span><span class="lnt" id="hl-7-5"><a class="lnlinks" href="#hl-7-5"> 5</a>
</span><span class="lnt" id="hl-7-6"><a class="lnlinks" href="#hl-7-6"> 6</a>
</span><span class="lnt" id="hl-7-7"><a class="lnlinks" href="#hl-7-7"> 7</a>
</span><span class="lnt" id="hl-7-8"><a class="lnlinks" href="#hl-7-8"> 8</a>
</span><span class="lnt" id="hl-7-9"><a class="lnlinks" href="#hl-7-9"> 9</a>
</span><span class="lnt" id="hl-7-10"><a class="lnlinks" href="#hl-7-10">10</a>
</span><span class="lnt" id="hl-7-11"><a class="lnlinks" href="#hl-7-11">11</a>
</span><span class="lnt" id="hl-7-12"><a class="lnlinks" href="#hl-7-12">12</a>
</span><span class="lnt" id="hl-7-13"><a class="lnlinks" href="#hl-7-13">13</a>
</span><span class="lnt" id="hl-7-14"><a class="lnlinks" href="#hl-7-14">14</a>
</span><span class="lnt" id="hl-7-15"><a class="lnlinks" href="#hl-7-15">15</a>
</span><span class="lnt" id="hl-7-16"><a class="lnlinks" href="#hl-7-16">16</a>
</span><span class="lnt" id="hl-7-17"><a class="lnlinks" href="#hl-7-17">17</a>
</span><span class="lnt" id="hl-7-18"><a class="lnlinks" href="#hl-7-18">18</a>
</span><span class="lnt" id="hl-7-19"><a class="lnlinks" href="#hl-7-19">19</a>
</span><span class="lnt" id="hl-7-20"><a class="lnlinks" href="#hl-7-20">20</a>
</span><span class="lnt" id="hl-7-21"><a class="lnlinks" href="#hl-7-21">21</a>
</span><span class="lnt" id="hl-7-22"><a class="lnlinks" href="#hl-7-22">22</a>
</span><span class="lnt" id="hl-7-23"><a class="lnlinks" href="#hl-7-23">23</a>
</span><span class="lnt" id="hl-7-24"><a class="lnlinks" href="#hl-7-24">24</a>
</span><span class="lnt" id="hl-7-25"><a class="lnlinks" href="#hl-7-25">25</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">grantResult</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">grantResult</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;通讯录权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;短信收发权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="permissionlazyactivityjava">PermissionLazyActivity.java<a hidden class="anchor" aria-hidden="true" href="#permissionlazyactivityjava">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-8-1"><a class="lnlinks" href="#hl-8-1"> 1</a>
</span><span class="lnt" id="hl-8-2"><a class="lnlinks" href="#hl-8-2"> 2</a>
</span><span class="lnt" id="hl-8-3"><a class="lnlinks" href="#hl-8-3"> 3</a>
</span><span class="lnt" id="hl-8-4"><a class="lnlinks" href="#hl-8-4"> 4</a>
</span><span class="lnt" id="hl-8-5"><a class="lnlinks" href="#hl-8-5"> 5</a>
</span><span class="lnt" id="hl-8-6"><a class="lnlinks" href="#hl-8-6"> 6</a>
</span><span class="lnt" id="hl-8-7"><a class="lnlinks" href="#hl-8-7"> 7</a>
</span><span class="lnt" id="hl-8-8"><a class="lnlinks" href="#hl-8-8"> 8</a>
</span><span class="lnt" id="hl-8-9"><a class="lnlinks" href="#hl-8-9"> 9</a>
</span><span class="lnt" id="hl-8-10"><a class="lnlinks" href="#hl-8-10">10</a>
</span><span class="lnt" id="hl-8-11"><a class="lnlinks" href="#hl-8-11">11</a>
</span><span class="lnt" id="hl-8-12"><a class="lnlinks" href="#hl-8-12">12</a>
</span><span class="lnt" id="hl-8-13"><a class="lnlinks" href="#hl-8-13">13</a>
</span><span class="lnt" id="hl-8-14"><a class="lnlinks" href="#hl-8-14">14</a>
</span><span class="lnt" id="hl-8-15"><a class="lnlinks" href="#hl-8-15">15</a>
</span><span class="lnt" id="hl-8-16"><a class="lnlinks" href="#hl-8-16">16</a>
</span><span class="lnt" id="hl-8-17"><a class="lnlinks" href="#hl-8-17">17</a>
</span><span class="lnt" id="hl-8-18"><a class="lnlinks" href="#hl-8-18">18</a>
</span><span class="lnt" id="hl-8-19"><a class="lnlinks" href="#hl-8-19">19</a>
</span><span class="lnt" id="hl-8-20"><a class="lnlinks" href="#hl-8-20">20</a>
</span><span class="lnt" id="hl-8-21"><a class="lnlinks" href="#hl-8-21">21</a>
</span><span class="lnt" id="hl-8-22"><a class="lnlinks" href="#hl-8-22">22</a>
</span><span class="lnt" id="hl-8-23"><a class="lnlinks" href="#hl-8-23">23</a>
</span><span class="lnt" id="hl-8-24"><a class="lnlinks" href="#hl-8-24">24</a>
</span><span class="lnt" id="hl-8-25"><a class="lnlinks" href="#hl-8-25">25</a>
</span><span class="lnt" id="hl-8-26"><a class="lnlinks" href="#hl-8-26">26</a>
</span><span class="lnt" id="hl-8-27"><a class="lnlinks" href="#hl-8-27">27</a>
</span><span class="lnt" id="hl-8-28"><a class="lnlinks" href="#hl-8-28">28</a>
</span><span class="lnt" id="hl-8-29"><a class="lnlinks" href="#hl-8-29">29</a>
</span><span class="lnt" id="hl-8-30"><a class="lnlinks" href="#hl-8-30">30</a>
</span><span class="lnt" id="hl-8-31"><a class="lnlinks" href="#hl-8-31">31</a>
</span><span class="lnt" id="hl-8-32"><a class="lnlinks" href="#hl-8-32">32</a>
</span><span class="lnt" id="hl-8-33"><a class="lnlinks" href="#hl-8-33">33</a>
</span><span class="lnt" id="hl-8-34"><a class="lnlinks" href="#hl-8-34">34</a>
</span><span class="lnt" id="hl-8-35"><a class="lnlinks" href="#hl-8-35">35</a>
</span><span class="lnt" id="hl-8-36"><a class="lnlinks" href="#hl-8-36">36</a>
</span><span class="lnt" id="hl-8-37"><a class="lnlinks" href="#hl-8-37">37</a>
</span><span class="lnt" id="hl-8-38"><a class="lnlinks" href="#hl-8-38">38</a>
</span><span class="lnt" id="hl-8-39"><a class="lnlinks" href="#hl-8-39">39</a>
</span><span class="lnt" id="hl-8-40"><a class="lnlinks" href="#hl-8-40">40</a>
</span><span class="lnt" id="hl-8-41"><a class="lnlinks" href="#hl-8-41">41</a>
</span><span class="lnt" id="hl-8-42"><a class="lnlinks" href="#hl-8-42">42</a>
</span><span class="lnt" id="hl-8-43"><a class="lnlinks" href="#hl-8-43">43</a>
</span><span class="lnt" id="hl-8-44"><a class="lnlinks" href="#hl-8-44">44</a>
</span><span class="lnt" id="hl-8-45"><a class="lnlinks" href="#hl-8-45">45</a>
</span><span class="lnt" id="hl-8-46"><a class="lnlinks" href="#hl-8-46">46</a>
</span><span class="lnt" id="hl-8-47"><a class="lnlinks" href="#hl-8-47">47</a>
</span><span class="lnt" id="hl-8-48"><a class="lnlinks" href="#hl-8-48">48</a>
</span><span class="lnt" id="hl-8-49"><a class="lnlinks" href="#hl-8-49">49</a>
</span><span class="lnt" id="hl-8-50"><a class="lnlinks" href="#hl-8-50">50</a>
</span><span class="lnt" id="hl-8-51"><a class="lnlinks" href="#hl-8-51">51</a>
</span><span class="lnt" id="hl-8-52"><a class="lnlinks" href="#hl-8-52">52</a>
</span><span class="lnt" id="hl-8-53"><a class="lnlinks" href="#hl-8-53">53</a>
</span><span class="lnt" id="hl-8-54"><a class="lnlinks" href="#hl-8-54">54</a>
</span><span class="lnt" id="hl-8-55"><a class="lnlinks" href="#hl-8-55">55</a>
</span><span class="lnt" id="hl-8-56"><a class="lnlinks" href="#hl-8-56">56</a>
</span><span class="lnt" id="hl-8-57"><a class="lnlinks" href="#hl-8-57">57</a>
</span><span class="lnt" id="hl-8-58"><a class="lnlinks" href="#hl-8-58">58</a>
</span><span class="lnt" id="hl-8-59"><a class="lnlinks" href="#hl-8-59">59</a>
</span><span class="lnt" id="hl-8-60"><a class="lnlinks" href="#hl-8-60">60</a>
</span><span class="lnt" id="hl-8-61"><a class="lnlinks" href="#hl-8-61">61</a>
</span><span class="lnt" id="hl-8-62"><a class="lnlinks" href="#hl-8-62">62</a>
</span><span class="lnt" id="hl-8-63"><a class="lnlinks" href="#hl-8-63">63</a>
</span><span class="lnt" id="hl-8-64"><a class="lnlinks" href="#hl-8-64">64</a>
</span><span class="lnt" id="hl-8-65"><a class="lnlinks" href="#hl-8-65">65</a>
</span><span class="lnt" id="hl-8-66"><a class="lnlinks" href="#hl-8-66">66</a>
</span><span class="lnt" id="hl-8-67"><a class="lnlinks" href="#hl-8-67">67</a>
</span><span class="lnt" id="hl-8-68"><a class="lnlinks" href="#hl-8-68">68</a>
</span><span class="lnt" id="hl-8-69"><a class="lnlinks" href="#hl-8-69">69</a>
</span><span class="lnt" id="hl-8-70"><a class="lnlinks" href="#hl-8-70">70</a>
</span><span class="lnt" id="hl-8-71"><a class="lnlinks" href="#hl-8-71">71</a>
</span><span class="lnt" id="hl-8-72"><a class="lnlinks" href="#hl-8-72">72</a>
</span><span class="lnt" id="hl-8-73"><a class="lnlinks" href="#hl-8-73">73</a>
</span><span class="lnt" id="hl-8-74"><a class="lnlinks" href="#hl-8-74">74</a>
</span><span class="lnt" id="hl-8-75"><a class="lnlinks" href="#hl-8-75">75</a>
</span><span class="lnt" id="hl-8-76"><a class="lnlinks" href="#hl-8-76">76</a>
</span><span class="lnt" id="hl-8-77"><a class="lnlinks" href="#hl-8-77">77</a>
</span><span class="lnt" id="hl-8-78"><a class="lnlinks" href="#hl-8-78">78</a>
</span><span class="lnt" id="hl-8-79"><a class="lnlinks" href="#hl-8-79">79</a>
</span><span class="lnt" id="hl-8-80"><a class="lnlinks" href="#hl-8-80">80</a>
</span><span class="lnt" id="hl-8-81"><a class="lnlinks" href="#hl-8-81">81</a>
</span><span class="lnt" id="hl-8-82"><a class="lnlinks" href="#hl-8-82">82</a>
</span><span class="lnt" id="hl-8-83"><a class="lnlinks" href="#hl-8-83">83</a>
</span><span class="lnt" id="hl-8-84"><a class="lnlinks" href="#hl-8-84">84</a>
</span><span class="lnt" id="hl-8-85"><a class="lnlinks" href="#hl-8-85">85</a>
</span><span class="lnt" id="hl-8-86"><a class="lnlinks" href="#hl-8-86">86</a>
</span><span class="lnt" id="hl-8-87"><a class="lnlinks" href="#hl-8-87">87</a>
</span><span class="lnt" id="hl-8-88"><a class="lnlinks" href="#hl-8-88">88</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.Manifest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Intent</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.net.Uri</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Bundle</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.provider.Settings</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.util.Log</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.view.View</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.activity.EdgeToEdge</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.NonNull</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.graphics.Insets</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.view.ViewCompat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.view.WindowInsetsCompat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client.util.PermissionUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client.util.ToastUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PermissionLazyActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">PERMISSIONS_CONTACTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_CONTACTS</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_CONTACTS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">PERMISSIONS_SMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">SEND_SMS</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_SMS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_permission_lazy</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_contacts</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_sms</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_contacts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_CONTACTS</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_sms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_SMS</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">grantResult</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">grantResult</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;通讯录权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;短信收发权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">jumpToSettings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setAction</span><span class="p">(</span><span class="n">Settings</span><span class="p">.</span><span class="na">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="na">fromParts</span><span class="p">(</span><span class="s">&#34;package&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">getPackageName</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="跳转到系统权限设计界面">跳转到系统权限设计界面：<a hidden class="anchor" aria-hidden="true" href="#跳转到系统权限设计界面">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-9-1"><a class="lnlinks" href="#hl-9-1">1</a>
</span><span class="lnt" id="hl-9-2"><a class="lnlinks" href="#hl-9-2">2</a>
</span><span class="lnt" id="hl-9-3"><a class="lnlinks" href="#hl-9-3">3</a>
</span><span class="lnt" id="hl-9-4"><a class="lnlinks" href="#hl-9-4">4</a>
</span><span class="lnt" id="hl-9-5"><a class="lnlinks" href="#hl-9-5">5</a>
</span><span class="lnt" id="hl-9-6"><a class="lnlinks" href="#hl-9-6">6</a>
</span><span class="lnt" id="hl-9-7"><a class="lnlinks" href="#hl-9-7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">jumpToSettings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setAction</span><span class="p">(</span><span class="n">Settings</span><span class="p">.</span><span class="na">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="na">fromParts</span><span class="p">(</span><span class="s">&#34;package&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">getPackageName</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="饿汉式获取权限">饿汉式获取权限<a hidden class="anchor" aria-hidden="true" href="#饿汉式获取权限">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/permission_hungry.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/permission_hungry.gif" alt="permission_hungry"  />
        </a>
    </div>
</p>
<h4 id="permissionhungryactivityjava">PermissionHungryActivity.java<a hidden class="anchor" aria-hidden="true" href="#permissionhungryactivityjava">#</a></h4>
<p>不同于懒汉式，创建时即申请全部权限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-10-1"><a class="lnlinks" href="#hl-10-1">  1</a>
</span><span class="lnt" id="hl-10-2"><a class="lnlinks" href="#hl-10-2">  2</a>
</span><span class="lnt" id="hl-10-3"><a class="lnlinks" href="#hl-10-3">  3</a>
</span><span class="lnt" id="hl-10-4"><a class="lnlinks" href="#hl-10-4">  4</a>
</span><span class="lnt" id="hl-10-5"><a class="lnlinks" href="#hl-10-5">  5</a>
</span><span class="lnt" id="hl-10-6"><a class="lnlinks" href="#hl-10-6">  6</a>
</span><span class="lnt" id="hl-10-7"><a class="lnlinks" href="#hl-10-7">  7</a>
</span><span class="lnt" id="hl-10-8"><a class="lnlinks" href="#hl-10-8">  8</a>
</span><span class="lnt" id="hl-10-9"><a class="lnlinks" href="#hl-10-9">  9</a>
</span><span class="lnt" id="hl-10-10"><a class="lnlinks" href="#hl-10-10"> 10</a>
</span><span class="lnt" id="hl-10-11"><a class="lnlinks" href="#hl-10-11"> 11</a>
</span><span class="lnt" id="hl-10-12"><a class="lnlinks" href="#hl-10-12"> 12</a>
</span><span class="lnt" id="hl-10-13"><a class="lnlinks" href="#hl-10-13"> 13</a>
</span><span class="lnt" id="hl-10-14"><a class="lnlinks" href="#hl-10-14"> 14</a>
</span><span class="lnt" id="hl-10-15"><a class="lnlinks" href="#hl-10-15"> 15</a>
</span><span class="lnt" id="hl-10-16"><a class="lnlinks" href="#hl-10-16"> 16</a>
</span><span class="lnt" id="hl-10-17"><a class="lnlinks" href="#hl-10-17"> 17</a>
</span><span class="lnt" id="hl-10-18"><a class="lnlinks" href="#hl-10-18"> 18</a>
</span><span class="lnt" id="hl-10-19"><a class="lnlinks" href="#hl-10-19"> 19</a>
</span><span class="lnt" id="hl-10-20"><a class="lnlinks" href="#hl-10-20"> 20</a>
</span><span class="lnt" id="hl-10-21"><a class="lnlinks" href="#hl-10-21"> 21</a>
</span><span class="lnt" id="hl-10-22"><a class="lnlinks" href="#hl-10-22"> 22</a>
</span><span class="lnt" id="hl-10-23"><a class="lnlinks" href="#hl-10-23"> 23</a>
</span><span class="lnt" id="hl-10-24"><a class="lnlinks" href="#hl-10-24"> 24</a>
</span><span class="lnt" id="hl-10-25"><a class="lnlinks" href="#hl-10-25"> 25</a>
</span><span class="lnt" id="hl-10-26"><a class="lnlinks" href="#hl-10-26"> 26</a>
</span><span class="lnt" id="hl-10-27"><a class="lnlinks" href="#hl-10-27"> 27</a>
</span><span class="lnt" id="hl-10-28"><a class="lnlinks" href="#hl-10-28"> 28</a>
</span><span class="lnt" id="hl-10-29"><a class="lnlinks" href="#hl-10-29"> 29</a>
</span><span class="lnt" id="hl-10-30"><a class="lnlinks" href="#hl-10-30"> 30</a>
</span><span class="lnt" id="hl-10-31"><a class="lnlinks" href="#hl-10-31"> 31</a>
</span><span class="lnt" id="hl-10-32"><a class="lnlinks" href="#hl-10-32"> 32</a>
</span><span class="lnt" id="hl-10-33"><a class="lnlinks" href="#hl-10-33"> 33</a>
</span><span class="lnt" id="hl-10-34"><a class="lnlinks" href="#hl-10-34"> 34</a>
</span><span class="lnt" id="hl-10-35"><a class="lnlinks" href="#hl-10-35"> 35</a>
</span><span class="lnt" id="hl-10-36"><a class="lnlinks" href="#hl-10-36"> 36</a>
</span><span class="lnt" id="hl-10-37"><a class="lnlinks" href="#hl-10-37"> 37</a>
</span><span class="lnt" id="hl-10-38"><a class="lnlinks" href="#hl-10-38"> 38</a>
</span><span class="lnt" id="hl-10-39"><a class="lnlinks" href="#hl-10-39"> 39</a>
</span><span class="lnt" id="hl-10-40"><a class="lnlinks" href="#hl-10-40"> 40</a>
</span><span class="lnt" id="hl-10-41"><a class="lnlinks" href="#hl-10-41"> 41</a>
</span><span class="lnt" id="hl-10-42"><a class="lnlinks" href="#hl-10-42"> 42</a>
</span><span class="lnt" id="hl-10-43"><a class="lnlinks" href="#hl-10-43"> 43</a>
</span><span class="lnt" id="hl-10-44"><a class="lnlinks" href="#hl-10-44"> 44</a>
</span><span class="lnt" id="hl-10-45"><a class="lnlinks" href="#hl-10-45"> 45</a>
</span><span class="lnt" id="hl-10-46"><a class="lnlinks" href="#hl-10-46"> 46</a>
</span><span class="lnt" id="hl-10-47"><a class="lnlinks" href="#hl-10-47"> 47</a>
</span><span class="lnt" id="hl-10-48"><a class="lnlinks" href="#hl-10-48"> 48</a>
</span><span class="lnt" id="hl-10-49"><a class="lnlinks" href="#hl-10-49"> 49</a>
</span><span class="lnt" id="hl-10-50"><a class="lnlinks" href="#hl-10-50"> 50</a>
</span><span class="lnt" id="hl-10-51"><a class="lnlinks" href="#hl-10-51"> 51</a>
</span><span class="lnt" id="hl-10-52"><a class="lnlinks" href="#hl-10-52"> 52</a>
</span><span class="lnt" id="hl-10-53"><a class="lnlinks" href="#hl-10-53"> 53</a>
</span><span class="lnt" id="hl-10-54"><a class="lnlinks" href="#hl-10-54"> 54</a>
</span><span class="lnt" id="hl-10-55"><a class="lnlinks" href="#hl-10-55"> 55</a>
</span><span class="lnt" id="hl-10-56"><a class="lnlinks" href="#hl-10-56"> 56</a>
</span><span class="lnt" id="hl-10-57"><a class="lnlinks" href="#hl-10-57"> 57</a>
</span><span class="lnt" id="hl-10-58"><a class="lnlinks" href="#hl-10-58"> 58</a>
</span><span class="lnt" id="hl-10-59"><a class="lnlinks" href="#hl-10-59"> 59</a>
</span><span class="lnt" id="hl-10-60"><a class="lnlinks" href="#hl-10-60"> 60</a>
</span><span class="lnt" id="hl-10-61"><a class="lnlinks" href="#hl-10-61"> 61</a>
</span><span class="lnt" id="hl-10-62"><a class="lnlinks" href="#hl-10-62"> 62</a>
</span><span class="lnt" id="hl-10-63"><a class="lnlinks" href="#hl-10-63"> 63</a>
</span><span class="lnt" id="hl-10-64"><a class="lnlinks" href="#hl-10-64"> 64</a>
</span><span class="lnt" id="hl-10-65"><a class="lnlinks" href="#hl-10-65"> 65</a>
</span><span class="lnt" id="hl-10-66"><a class="lnlinks" href="#hl-10-66"> 66</a>
</span><span class="lnt" id="hl-10-67"><a class="lnlinks" href="#hl-10-67"> 67</a>
</span><span class="lnt" id="hl-10-68"><a class="lnlinks" href="#hl-10-68"> 68</a>
</span><span class="lnt" id="hl-10-69"><a class="lnlinks" href="#hl-10-69"> 69</a>
</span><span class="lnt" id="hl-10-70"><a class="lnlinks" href="#hl-10-70"> 70</a>
</span><span class="lnt" id="hl-10-71"><a class="lnlinks" href="#hl-10-71"> 71</a>
</span><span class="lnt" id="hl-10-72"><a class="lnlinks" href="#hl-10-72"> 72</a>
</span><span class="lnt" id="hl-10-73"><a class="lnlinks" href="#hl-10-73"> 73</a>
</span><span class="lnt" id="hl-10-74"><a class="lnlinks" href="#hl-10-74"> 74</a>
</span><span class="lnt" id="hl-10-75"><a class="lnlinks" href="#hl-10-75"> 75</a>
</span><span class="lnt" id="hl-10-76"><a class="lnlinks" href="#hl-10-76"> 76</a>
</span><span class="lnt" id="hl-10-77"><a class="lnlinks" href="#hl-10-77"> 77</a>
</span><span class="lnt" id="hl-10-78"><a class="lnlinks" href="#hl-10-78"> 78</a>
</span><span class="lnt" id="hl-10-79"><a class="lnlinks" href="#hl-10-79"> 79</a>
</span><span class="lnt" id="hl-10-80"><a class="lnlinks" href="#hl-10-80"> 80</a>
</span><span class="lnt" id="hl-10-81"><a class="lnlinks" href="#hl-10-81"> 81</a>
</span><span class="lnt" id="hl-10-82"><a class="lnlinks" href="#hl-10-82"> 82</a>
</span><span class="lnt" id="hl-10-83"><a class="lnlinks" href="#hl-10-83"> 83</a>
</span><span class="lnt" id="hl-10-84"><a class="lnlinks" href="#hl-10-84"> 84</a>
</span><span class="lnt" id="hl-10-85"><a class="lnlinks" href="#hl-10-85"> 85</a>
</span><span class="lnt" id="hl-10-86"><a class="lnlinks" href="#hl-10-86"> 86</a>
</span><span class="lnt" id="hl-10-87"><a class="lnlinks" href="#hl-10-87"> 87</a>
</span><span class="lnt" id="hl-10-88"><a class="lnlinks" href="#hl-10-88"> 88</a>
</span><span class="lnt" id="hl-10-89"><a class="lnlinks" href="#hl-10-89"> 89</a>
</span><span class="lnt" id="hl-10-90"><a class="lnlinks" href="#hl-10-90"> 90</a>
</span><span class="lnt" id="hl-10-91"><a class="lnlinks" href="#hl-10-91"> 91</a>
</span><span class="lnt" id="hl-10-92"><a class="lnlinks" href="#hl-10-92"> 92</a>
</span><span class="lnt" id="hl-10-93"><a class="lnlinks" href="#hl-10-93"> 93</a>
</span><span class="lnt" id="hl-10-94"><a class="lnlinks" href="#hl-10-94"> 94</a>
</span><span class="lnt" id="hl-10-95"><a class="lnlinks" href="#hl-10-95"> 95</a>
</span><span class="lnt" id="hl-10-96"><a class="lnlinks" href="#hl-10-96"> 96</a>
</span><span class="lnt" id="hl-10-97"><a class="lnlinks" href="#hl-10-97"> 97</a>
</span><span class="lnt" id="hl-10-98"><a class="lnlinks" href="#hl-10-98"> 98</a>
</span><span class="lnt" id="hl-10-99"><a class="lnlinks" href="#hl-10-99"> 99</a>
</span><span class="lnt" id="hl-10-100"><a class="lnlinks" href="#hl-10-100">100</a>
</span><span class="lnt" id="hl-10-101"><a class="lnlinks" href="#hl-10-101">101</a>
</span><span class="lnt" id="hl-10-102"><a class="lnlinks" href="#hl-10-102">102</a>
</span><span class="lnt" id="hl-10-103"><a class="lnlinks" href="#hl-10-103">103</a>
</span><span class="lnt" id="hl-10-104"><a class="lnlinks" href="#hl-10-104">104</a>
</span><span class="lnt" id="hl-10-105"><a class="lnlinks" href="#hl-10-105">105</a>
</span><span class="lnt" id="hl-10-106"><a class="lnlinks" href="#hl-10-106">106</a>
</span><span class="lnt" id="hl-10-107"><a class="lnlinks" href="#hl-10-107">107</a>
</span><span class="lnt" id="hl-10-108"><a class="lnlinks" href="#hl-10-108">108</a>
</span><span class="lnt" id="hl-10-109"><a class="lnlinks" href="#hl-10-109">109</a>
</span><span class="lnt" id="hl-10-110"><a class="lnlinks" href="#hl-10-110">110</a>
</span><span class="lnt" id="hl-10-111"><a class="lnlinks" href="#hl-10-111">111</a>
</span><span class="lnt" id="hl-10-112"><a class="lnlinks" href="#hl-10-112">112</a>
</span><span class="lnt" id="hl-10-113"><a class="lnlinks" href="#hl-10-113">113</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.Manifest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Intent</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.pm.PackageManager</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.net.Uri</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Bundle</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.provider.Settings</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.util.Log</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.view.View</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.activity.EdgeToEdge</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.NonNull</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.graphics.Insets</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.view.ViewCompat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">androidx.core.view.WindowInsetsCompat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client.util.PermissionUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client.util.ToastUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PermissionHungryActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">PERMISSIONS_ALL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_CONTACTS</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_CONTACTS</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">SEND_SMS</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_SMS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE_ALL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_permission_lazy</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_contacts</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_sms</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_ALL</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE_ALL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_contacts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">PERMISSIONS_ALL</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_ALL</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_sms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">PERMISSIONS_ALL</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS_ALL</span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_ALL</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;所有权限获取成功！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">grantResults</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">grantResults</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">PERMISSION_GRANTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">permissions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="k">case</span><span class="w"> </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_CONTACTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="k">case</span><span class="w"> </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_CONTACTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取通讯录读写权限失败&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="k">case</span><span class="w"> </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">SEND_SMS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="k">case</span><span class="w"> </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_SMS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取短信读写权限失败&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_CONTACTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">grantResult</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">grantResult</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;通讯录权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">REQUEST_CODE_SMS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;短信收发权限获取成功&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;获取权限失败!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">jumpToSettings</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">jumpToSettings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setAction</span><span class="p">(</span><span class="n">Settings</span><span class="p">.</span><span class="na">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="na">fromParts</span><span class="p">(</span><span class="s">&#34;package&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">getPackageName</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="添加联系人">添加联系人<a hidden class="anchor" aria-hidden="true" href="#添加联系人">#</a></h2>
<p>添加用户到通讯录，读取所有联系人信息到logcat中。</p>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240628172028755.png">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240628172028755.png" alt="image-20240628172028755"  />
        </a>
    </div>
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-11-1"><a class="lnlinks" href="#hl-11-1">  1</a>
</span><span class="lnt" id="hl-11-2"><a class="lnlinks" href="#hl-11-2">  2</a>
</span><span class="lnt" id="hl-11-3"><a class="lnlinks" href="#hl-11-3">  3</a>
</span><span class="lnt" id="hl-11-4"><a class="lnlinks" href="#hl-11-4">  4</a>
</span><span class="lnt" id="hl-11-5"><a class="lnlinks" href="#hl-11-5">  5</a>
</span><span class="lnt" id="hl-11-6"><a class="lnlinks" href="#hl-11-6">  6</a>
</span><span class="lnt" id="hl-11-7"><a class="lnlinks" href="#hl-11-7">  7</a>
</span><span class="lnt" id="hl-11-8"><a class="lnlinks" href="#hl-11-8">  8</a>
</span><span class="lnt" id="hl-11-9"><a class="lnlinks" href="#hl-11-9">  9</a>
</span><span class="lnt" id="hl-11-10"><a class="lnlinks" href="#hl-11-10"> 10</a>
</span><span class="lnt" id="hl-11-11"><a class="lnlinks" href="#hl-11-11"> 11</a>
</span><span class="lnt" id="hl-11-12"><a class="lnlinks" href="#hl-11-12"> 12</a>
</span><span class="lnt" id="hl-11-13"><a class="lnlinks" href="#hl-11-13"> 13</a>
</span><span class="lnt" id="hl-11-14"><a class="lnlinks" href="#hl-11-14"> 14</a>
</span><span class="lnt" id="hl-11-15"><a class="lnlinks" href="#hl-11-15"> 15</a>
</span><span class="lnt" id="hl-11-16"><a class="lnlinks" href="#hl-11-16"> 16</a>
</span><span class="lnt" id="hl-11-17"><a class="lnlinks" href="#hl-11-17"> 17</a>
</span><span class="lnt" id="hl-11-18"><a class="lnlinks" href="#hl-11-18"> 18</a>
</span><span class="lnt" id="hl-11-19"><a class="lnlinks" href="#hl-11-19"> 19</a>
</span><span class="lnt" id="hl-11-20"><a class="lnlinks" href="#hl-11-20"> 20</a>
</span><span class="lnt" id="hl-11-21"><a class="lnlinks" href="#hl-11-21"> 21</a>
</span><span class="lnt" id="hl-11-22"><a class="lnlinks" href="#hl-11-22"> 22</a>
</span><span class="lnt" id="hl-11-23"><a class="lnlinks" href="#hl-11-23"> 23</a>
</span><span class="lnt" id="hl-11-24"><a class="lnlinks" href="#hl-11-24"> 24</a>
</span><span class="lnt" id="hl-11-25"><a class="lnlinks" href="#hl-11-25"> 25</a>
</span><span class="lnt" id="hl-11-26"><a class="lnlinks" href="#hl-11-26"> 26</a>
</span><span class="lnt" id="hl-11-27"><a class="lnlinks" href="#hl-11-27"> 27</a>
</span><span class="lnt" id="hl-11-28"><a class="lnlinks" href="#hl-11-28"> 28</a>
</span><span class="lnt" id="hl-11-29"><a class="lnlinks" href="#hl-11-29"> 29</a>
</span><span class="lnt" id="hl-11-30"><a class="lnlinks" href="#hl-11-30"> 30</a>
</span><span class="lnt" id="hl-11-31"><a class="lnlinks" href="#hl-11-31"> 31</a>
</span><span class="lnt" id="hl-11-32"><a class="lnlinks" href="#hl-11-32"> 32</a>
</span><span class="lnt" id="hl-11-33"><a class="lnlinks" href="#hl-11-33"> 33</a>
</span><span class="lnt" id="hl-11-34"><a class="lnlinks" href="#hl-11-34"> 34</a>
</span><span class="lnt" id="hl-11-35"><a class="lnlinks" href="#hl-11-35"> 35</a>
</span><span class="lnt" id="hl-11-36"><a class="lnlinks" href="#hl-11-36"> 36</a>
</span><span class="lnt" id="hl-11-37"><a class="lnlinks" href="#hl-11-37"> 37</a>
</span><span class="lnt" id="hl-11-38"><a class="lnlinks" href="#hl-11-38"> 38</a>
</span><span class="lnt" id="hl-11-39"><a class="lnlinks" href="#hl-11-39"> 39</a>
</span><span class="lnt" id="hl-11-40"><a class="lnlinks" href="#hl-11-40"> 40</a>
</span><span class="lnt" id="hl-11-41"><a class="lnlinks" href="#hl-11-41"> 41</a>
</span><span class="lnt" id="hl-11-42"><a class="lnlinks" href="#hl-11-42"> 42</a>
</span><span class="lnt" id="hl-11-43"><a class="lnlinks" href="#hl-11-43"> 43</a>
</span><span class="lnt" id="hl-11-44"><a class="lnlinks" href="#hl-11-44"> 44</a>
</span><span class="lnt" id="hl-11-45"><a class="lnlinks" href="#hl-11-45"> 45</a>
</span><span class="lnt" id="hl-11-46"><a class="lnlinks" href="#hl-11-46"> 46</a>
</span><span class="lnt" id="hl-11-47"><a class="lnlinks" href="#hl-11-47"> 47</a>
</span><span class="lnt" id="hl-11-48"><a class="lnlinks" href="#hl-11-48"> 48</a>
</span><span class="lnt" id="hl-11-49"><a class="lnlinks" href="#hl-11-49"> 49</a>
</span><span class="lnt" id="hl-11-50"><a class="lnlinks" href="#hl-11-50"> 50</a>
</span><span class="lnt" id="hl-11-51"><a class="lnlinks" href="#hl-11-51"> 51</a>
</span><span class="lnt" id="hl-11-52"><a class="lnlinks" href="#hl-11-52"> 52</a>
</span><span class="lnt" id="hl-11-53"><a class="lnlinks" href="#hl-11-53"> 53</a>
</span><span class="lnt" id="hl-11-54"><a class="lnlinks" href="#hl-11-54"> 54</a>
</span><span class="lnt" id="hl-11-55"><a class="lnlinks" href="#hl-11-55"> 55</a>
</span><span class="lnt" id="hl-11-56"><a class="lnlinks" href="#hl-11-56"> 56</a>
</span><span class="lnt" id="hl-11-57"><a class="lnlinks" href="#hl-11-57"> 57</a>
</span><span class="lnt" id="hl-11-58"><a class="lnlinks" href="#hl-11-58"> 58</a>
</span><span class="lnt" id="hl-11-59"><a class="lnlinks" href="#hl-11-59"> 59</a>
</span><span class="lnt" id="hl-11-60"><a class="lnlinks" href="#hl-11-60"> 60</a>
</span><span class="lnt" id="hl-11-61"><a class="lnlinks" href="#hl-11-61"> 61</a>
</span><span class="lnt" id="hl-11-62"><a class="lnlinks" href="#hl-11-62"> 62</a>
</span><span class="lnt" id="hl-11-63"><a class="lnlinks" href="#hl-11-63"> 63</a>
</span><span class="lnt" id="hl-11-64"><a class="lnlinks" href="#hl-11-64"> 64</a>
</span><span class="lnt" id="hl-11-65"><a class="lnlinks" href="#hl-11-65"> 65</a>
</span><span class="lnt" id="hl-11-66"><a class="lnlinks" href="#hl-11-66"> 66</a>
</span><span class="lnt" id="hl-11-67"><a class="lnlinks" href="#hl-11-67"> 67</a>
</span><span class="lnt" id="hl-11-68"><a class="lnlinks" href="#hl-11-68"> 68</a>
</span><span class="lnt" id="hl-11-69"><a class="lnlinks" href="#hl-11-69"> 69</a>
</span><span class="lnt" id="hl-11-70"><a class="lnlinks" href="#hl-11-70"> 70</a>
</span><span class="lnt" id="hl-11-71"><a class="lnlinks" href="#hl-11-71"> 71</a>
</span><span class="lnt" id="hl-11-72"><a class="lnlinks" href="#hl-11-72"> 72</a>
</span><span class="lnt" id="hl-11-73"><a class="lnlinks" href="#hl-11-73"> 73</a>
</span><span class="lnt" id="hl-11-74"><a class="lnlinks" href="#hl-11-74"> 74</a>
</span><span class="lnt" id="hl-11-75"><a class="lnlinks" href="#hl-11-75"> 75</a>
</span><span class="lnt" id="hl-11-76"><a class="lnlinks" href="#hl-11-76"> 76</a>
</span><span class="lnt" id="hl-11-77"><a class="lnlinks" href="#hl-11-77"> 77</a>
</span><span class="lnt" id="hl-11-78"><a class="lnlinks" href="#hl-11-78"> 78</a>
</span><span class="lnt" id="hl-11-79"><a class="lnlinks" href="#hl-11-79"> 79</a>
</span><span class="lnt" id="hl-11-80"><a class="lnlinks" href="#hl-11-80"> 80</a>
</span><span class="lnt" id="hl-11-81"><a class="lnlinks" href="#hl-11-81"> 81</a>
</span><span class="lnt" id="hl-11-82"><a class="lnlinks" href="#hl-11-82"> 82</a>
</span><span class="lnt" id="hl-11-83"><a class="lnlinks" href="#hl-11-83"> 83</a>
</span><span class="lnt" id="hl-11-84"><a class="lnlinks" href="#hl-11-84"> 84</a>
</span><span class="lnt" id="hl-11-85"><a class="lnlinks" href="#hl-11-85"> 85</a>
</span><span class="lnt" id="hl-11-86"><a class="lnlinks" href="#hl-11-86"> 86</a>
</span><span class="lnt" id="hl-11-87"><a class="lnlinks" href="#hl-11-87"> 87</a>
</span><span class="lnt" id="hl-11-88"><a class="lnlinks" href="#hl-11-88"> 88</a>
</span><span class="lnt" id="hl-11-89"><a class="lnlinks" href="#hl-11-89"> 89</a>
</span><span class="lnt" id="hl-11-90"><a class="lnlinks" href="#hl-11-90"> 90</a>
</span><span class="lnt" id="hl-11-91"><a class="lnlinks" href="#hl-11-91"> 91</a>
</span><span class="lnt" id="hl-11-92"><a class="lnlinks" href="#hl-11-92"> 92</a>
</span><span class="lnt" id="hl-11-93"><a class="lnlinks" href="#hl-11-93"> 93</a>
</span><span class="lnt" id="hl-11-94"><a class="lnlinks" href="#hl-11-94"> 94</a>
</span><span class="lnt" id="hl-11-95"><a class="lnlinks" href="#hl-11-95"> 95</a>
</span><span class="lnt" id="hl-11-96"><a class="lnlinks" href="#hl-11-96"> 96</a>
</span><span class="lnt" id="hl-11-97"><a class="lnlinks" href="#hl-11-97"> 97</a>
</span><span class="lnt" id="hl-11-98"><a class="lnlinks" href="#hl-11-98"> 98</a>
</span><span class="lnt" id="hl-11-99"><a class="lnlinks" href="#hl-11-99"> 99</a>
</span><span class="lnt" id="hl-11-100"><a class="lnlinks" href="#hl-11-100">100</a>
</span><span class="lnt" id="hl-11-101"><a class="lnlinks" href="#hl-11-101">101</a>
</span><span class="lnt" id="hl-11-102"><a class="lnlinks" href="#hl-11-102">102</a>
</span><span class="lnt" id="hl-11-103"><a class="lnlinks" href="#hl-11-103">103</a>
</span><span class="lnt" id="hl-11-104"><a class="lnlinks" href="#hl-11-104">104</a>
</span><span class="lnt" id="hl-11-105"><a class="lnlinks" href="#hl-11-105">105</a>
</span><span class="lnt" id="hl-11-106"><a class="lnlinks" href="#hl-11-106">106</a>
</span><span class="lnt" id="hl-11-107"><a class="lnlinks" href="#hl-11-107">107</a>
</span><span class="lnt" id="hl-11-108"><a class="lnlinks" href="#hl-11-108">108</a>
</span><span class="lnt" id="hl-11-109"><a class="lnlinks" href="#hl-11-109">109</a>
</span><span class="lnt" id="hl-11-110"><a class="lnlinks" href="#hl-11-110">110</a>
</span><span class="lnt" id="hl-11-111"><a class="lnlinks" href="#hl-11-111">111</a>
</span><span class="lnt" id="hl-11-112"><a class="lnlinks" href="#hl-11-112">112</a>
</span><span class="lnt" id="hl-11-113"><a class="lnlinks" href="#hl-11-113">113</a>
</span><span class="lnt" id="hl-11-114"><a class="lnlinks" href="#hl-11-114">114</a>
</span><span class="lnt" id="hl-11-115"><a class="lnlinks" href="#hl-11-115">115</a>
</span><span class="lnt" id="hl-11-116"><a class="lnlinks" href="#hl-11-116">116</a>
</span><span class="lnt" id="hl-11-117"><a class="lnlinks" href="#hl-11-117">117</a>
</span><span class="lnt" id="hl-11-118"><a class="lnlinks" href="#hl-11-118">118</a>
</span><span class="lnt" id="hl-11-119"><a class="lnlinks" href="#hl-11-119">119</a>
</span><span class="lnt" id="hl-11-120"><a class="lnlinks" href="#hl-11-120">120</a>
</span><span class="lnt" id="hl-11-121"><a class="lnlinks" href="#hl-11-121">121</a>
</span><span class="lnt" id="hl-11-122"><a class="lnlinks" href="#hl-11-122">122</a>
</span><span class="lnt" id="hl-11-123"><a class="lnlinks" href="#hl-11-123">123</a>
</span><span class="lnt" id="hl-11-124"><a class="lnlinks" href="#hl-11-124">124</a>
</span><span class="lnt" id="hl-11-125"><a class="lnlinks" href="#hl-11-125">125</a>
</span><span class="lnt" id="hl-11-126"><a class="lnlinks" href="#hl-11-126">126</a>
</span><span class="lnt" id="hl-11-127"><a class="lnlinks" href="#hl-11-127">127</a>
</span><span class="lnt" id="hl-11-128"><a class="lnlinks" href="#hl-11-128">128</a>
</span><span class="lnt" id="hl-11-129"><a class="lnlinks" href="#hl-11-129">129</a>
</span><span class="lnt" id="hl-11-130"><a class="lnlinks" href="#hl-11-130">130</a>
</span><span class="lnt" id="hl-11-131"><a class="lnlinks" href="#hl-11-131">131</a>
</span><span class="lnt" id="hl-11-132"><a class="lnlinks" href="#hl-11-132">132</a>
</span><span class="lnt" id="hl-11-133"><a class="lnlinks" href="#hl-11-133">133</a>
</span><span class="lnt" id="hl-11-134"><a class="lnlinks" href="#hl-11-134">134</a>
</span><span class="lnt" id="hl-11-135"><a class="lnlinks" href="#hl-11-135">135</a>
</span><span class="lnt" id="hl-11-136"><a class="lnlinks" href="#hl-11-136">136</a>
</span><span class="lnt" id="hl-11-137"><a class="lnlinks" href="#hl-11-137">137</a>
</span><span class="lnt" id="hl-11-138"><a class="lnlinks" href="#hl-11-138">138</a>
</span><span class="lnt" id="hl-11-139"><a class="lnlinks" href="#hl-11-139">139</a>
</span><span class="lnt" id="hl-11-140"><a class="lnlinks" href="#hl-11-140">140</a>
</span><span class="lnt" id="hl-11-141"><a class="lnlinks" href="#hl-11-141">141</a>
</span><span class="lnt" id="hl-11-142"><a class="lnlinks" href="#hl-11-142">142</a>
</span><span class="lnt" id="hl-11-143"><a class="lnlinks" href="#hl-11-143">143</a>
</span><span class="lnt" id="hl-11-144"><a class="lnlinks" href="#hl-11-144">144</a>
</span><span class="lnt" id="hl-11-145"><a class="lnlinks" href="#hl-11-145">145</a>
</span><span class="lnt" id="hl-11-146"><a class="lnlinks" href="#hl-11-146">146</a>
</span><span class="lnt" id="hl-11-147"><a class="lnlinks" href="#hl-11-147">147</a>
</span><span class="lnt" id="hl-11-148"><a class="lnlinks" href="#hl-11-148">148</a>
</span><span class="lnt" id="hl-11-149"><a class="lnlinks" href="#hl-11-149">149</a>
</span><span class="lnt" id="hl-11-150"><a class="lnlinks" href="#hl-11-150">150</a>
</span><span class="lnt" id="hl-11-151"><a class="lnlinks" href="#hl-11-151">151</a>
</span><span class="lnt" id="hl-11-152"><a class="lnlinks" href="#hl-11-152">152</a>
</span><span class="lnt" id="hl-11-153"><a class="lnlinks" href="#hl-11-153">153</a>
</span><span class="lnt" id="hl-11-154"><a class="lnlinks" href="#hl-11-154">154</a>
</span><span class="lnt" id="hl-11-155"><a class="lnlinks" href="#hl-11-155">155</a>
</span><span class="lnt" id="hl-11-156"><a class="lnlinks" href="#hl-11-156">156</a>
</span><span class="lnt" id="hl-11-157"><a class="lnlinks" href="#hl-11-157">157</a>
</span><span class="lnt" id="hl-11-158"><a class="lnlinks" href="#hl-11-158">158</a>
</span><span class="lnt" id="hl-11-159"><a class="lnlinks" href="#hl-11-159">159</a>
</span><span class="lnt" id="hl-11-160"><a class="lnlinks" href="#hl-11-160">160</a>
</span><span class="lnt" id="hl-11-161"><a class="lnlinks" href="#hl-11-161">161</a>
</span><span class="lnt" id="hl-11-162"><a class="lnlinks" href="#hl-11-162">162</a>
</span><span class="lnt" id="hl-11-163"><a class="lnlinks" href="#hl-11-163">163</a>
</span><span class="lnt" id="hl-11-164"><a class="lnlinks" href="#hl-11-164">164</a>
</span><span class="lnt" id="hl-11-165"><a class="lnlinks" href="#hl-11-165">165</a>
</span><span class="lnt" id="hl-11-166"><a class="lnlinks" href="#hl-11-166">166</a>
</span><span class="lnt" id="hl-11-167"><a class="lnlinks" href="#hl-11-167">167</a>
</span><span class="lnt" id="hl-11-168"><a class="lnlinks" href="#hl-11-168">168</a>
</span><span class="lnt" id="hl-11-169"><a class="lnlinks" href="#hl-11-169">169</a>
</span><span class="lnt" id="hl-11-170"><a class="lnlinks" href="#hl-11-170">170</a>
</span><span class="lnt" id="hl-11-171"><a class="lnlinks" href="#hl-11-171">171</a>
</span><span class="lnt" id="hl-11-172"><a class="lnlinks" href="#hl-11-172">172</a>
</span><span class="lnt" id="hl-11-173"><a class="lnlinks" href="#hl-11-173">173</a>
</span><span class="lnt" id="hl-11-174"><a class="lnlinks" href="#hl-11-174">174</a>
</span><span class="lnt" id="hl-11-175"><a class="lnlinks" href="#hl-11-175">175</a>
</span><span class="lnt" id="hl-11-176"><a class="lnlinks" href="#hl-11-176">176</a>
</span><span class="lnt" id="hl-11-177"><a class="lnlinks" href="#hl-11-177">177</a>
</span><span class="lnt" id="hl-11-178"><a class="lnlinks" href="#hl-11-178">178</a>
</span><span class="lnt" id="hl-11-179"><a class="lnlinks" href="#hl-11-179">179</a>
</span><span class="lnt" id="hl-11-180"><a class="lnlinks" href="#hl-11-180">180</a>
</span><span class="lnt" id="hl-11-181"><a class="lnlinks" href="#hl-11-181">181</a>
</span><span class="lnt" id="hl-11-182"><a class="lnlinks" href="#hl-11-182">182</a>
</span><span class="lnt" id="hl-11-183"><a class="lnlinks" href="#hl-11-183">183</a>
</span><span class="lnt" id="hl-11-184"><a class="lnlinks" href="#hl-11-184">184</a>
</span><span class="lnt" id="hl-11-185"><a class="lnlinks" href="#hl-11-185">185</a>
</span><span class="lnt" id="hl-11-186"><a class="lnlinks" href="#hl-11-186">186</a>
</span><span class="lnt" id="hl-11-187"><a class="lnlinks" href="#hl-11-187">187</a>
</span><span class="lnt" id="hl-11-188"><a class="lnlinks" href="#hl-11-188">188</a>
</span><span class="lnt" id="hl-11-189"><a class="lnlinks" href="#hl-11-189">189</a>
</span><span class="lnt" id="hl-11-190"><a class="lnlinks" href="#hl-11-190">190</a>
</span><span class="lnt" id="hl-11-191"><a class="lnlinks" href="#hl-11-191">191</a>
</span><span class="lnt" id="hl-11-192"><a class="lnlinks" href="#hl-11-192">192</a>
</span><span class="lnt" id="hl-11-193"><a class="lnlinks" href="#hl-11-193">193</a>
</span><span class="lnt" id="hl-11-194"><a class="lnlinks" href="#hl-11-194">194</a>
</span><span class="lnt" id="hl-11-195"><a class="lnlinks" href="#hl-11-195">195</a>
</span><span class="lnt" id="hl-11-196"><a class="lnlinks" href="#hl-11-196">196</a>
</span><span class="lnt" id="hl-11-197"><a class="lnlinks" href="#hl-11-197">197</a>
</span><span class="lnt" id="hl-11-198"><a class="lnlinks" href="#hl-11-198">198</a>
</span><span class="lnt" id="hl-11-199"><a class="lnlinks" href="#hl-11-199">199</a>
</span><span class="lnt" id="hl-11-200"><a class="lnlinks" href="#hl-11-200">200</a>
</span><span class="lnt" id="hl-11-201"><a class="lnlinks" href="#hl-11-201">201</a>
</span><span class="lnt" id="hl-11-202"><a class="lnlinks" href="#hl-11-202">202</a>
</span><span class="lnt" id="hl-11-203"><a class="lnlinks" href="#hl-11-203">203</a>
</span><span class="lnt" id="hl-11-204"><a class="lnlinks" href="#hl-11-204">204</a>
</span><span class="lnt" id="hl-11-205"><a class="lnlinks" href="#hl-11-205">205</a>
</span><span class="lnt" id="hl-11-206"><a class="lnlinks" href="#hl-11-206">206</a>
</span><span class="lnt" id="hl-11-207"><a class="lnlinks" href="#hl-11-207">207</a>
</span><span class="lnt" id="hl-11-208"><a class="lnlinks" href="#hl-11-208">208</a>
</span><span class="lnt" id="hl-11-209"><a class="lnlinks" href="#hl-11-209">209</a>
</span><span class="lnt" id="hl-11-210"><a class="lnlinks" href="#hl-11-210">210</a>
</span><span class="lnt" id="hl-11-211"><a class="lnlinks" href="#hl-11-211">211</a>
</span><span class="lnt" id="hl-11-212"><a class="lnlinks" href="#hl-11-212">212</a>
</span><span class="lnt" id="hl-11-213"><a class="lnlinks" href="#hl-11-213">213</a>
</span><span class="lnt" id="hl-11-214"><a class="lnlinks" href="#hl-11-214">214</a>
</span><span class="lnt" id="hl-11-215"><a class="lnlinks" href="#hl-11-215">215</a>
</span><span class="lnt" id="hl-11-216"><a class="lnlinks" href="#hl-11-216">216</a>
</span><span class="lnt" id="hl-11-217"><a class="lnlinks" href="#hl-11-217">217</a>
</span><span class="lnt" id="hl-11-218"><a class="lnlinks" href="#hl-11-218">218</a>
</span><span class="lnt" id="hl-11-219"><a class="lnlinks" href="#hl-11-219">219</a>
</span><span class="lnt" id="hl-11-220"><a class="lnlinks" href="#hl-11-220">220</a>
</span><span class="lnt" id="hl-11-221"><a class="lnlinks" href="#hl-11-221">221</a>
</span><span class="lnt" id="hl-11-222"><a class="lnlinks" href="#hl-11-222">222</a>
</span><span class="lnt" id="hl-11-223"><a class="lnlinks" href="#hl-11-223">223</a>
</span><span class="lnt" id="hl-11-224"><a class="lnlinks" href="#hl-11-224">224</a>
</span><span class="lnt" id="hl-11-225"><a class="lnlinks" href="#hl-11-225">225</a>
</span><span class="lnt" id="hl-11-226"><a class="lnlinks" href="#hl-11-226">226</a>
</span><span class="lnt" id="hl-11-227"><a class="lnlinks" href="#hl-11-227">227</a>
</span><span class="lnt" id="hl-11-228"><a class="lnlinks" href="#hl-11-228">228</a>
</span><span class="lnt" id="hl-11-229"><a class="lnlinks" href="#hl-11-229">229</a>
</span><span class="lnt" id="hl-11-230"><a class="lnlinks" href="#hl-11-230">230</a>
</span><span class="lnt" id="hl-11-231"><a class="lnlinks" href="#hl-11-231">231</a>
</span><span class="lnt" id="hl-11-232"><a class="lnlinks" href="#hl-11-232">232</a>
</span><span class="lnt" id="hl-11-233"><a class="lnlinks" href="#hl-11-233">233</a>
</span><span class="lnt" id="hl-11-234"><a class="lnlinks" href="#hl-11-234">234</a>
</span><span class="lnt" id="hl-11-235"><a class="lnlinks" href="#hl-11-235">235</a>
</span><span class="lnt" id="hl-11-236"><a class="lnlinks" href="#hl-11-236">236</a>
</span><span class="lnt" id="hl-11-237"><a class="lnlinks" href="#hl-11-237">237</a>
</span><span class="lnt" id="hl-11-238"><a class="lnlinks" href="#hl-11-238">238</a>
</span><span class="lnt" id="hl-11-239"><a class="lnlinks" href="#hl-11-239">239</a>
</span><span class="lnt" id="hl-11-240"><a class="lnlinks" href="#hl-11-240">240</a>
</span><span class="lnt" id="hl-11-241"><a class="lnlinks" href="#hl-11-241">241</a>
</span><span class="lnt" id="hl-11-242"><a class="lnlinks" href="#hl-11-242">242</a>
</span><span class="lnt" id="hl-11-243"><a class="lnlinks" href="#hl-11-243">243</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ContactAddActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">et_name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">et_phone</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">et_email</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_contact_add</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_phone</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_email</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_read</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_write</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_write</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 创建一个联系人对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contact</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">et_name</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contact</span><span class="p">.</span><span class="na">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">et_phone</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contact</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">et_email</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//addContacts(getContentResolver(), contact);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//批处理方式，每一次操作都是一个ContentProviderOperation， 构建一个操作集合，然后一次性执行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 好处：要么全部成功，要么全部失败，保证了事务的一致性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">addFullContacts</span><span class="p">(</span><span class="n">getContentResolver</span><span class="p">(),</span><span class="w"> </span><span class="n">contact</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_read</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">readPhoneContact</span><span class="p">(</span><span class="n">getContentResolver</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&#34;Range&#34;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 禁用范围警告，因为我们手动处理列索引</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">readPhoneContact</span><span class="p">(</span><span class="n">ContentResolver</span><span class="w"> </span><span class="n">resolver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 查询RawContacts表，获取所有联系人的_raw_contact_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Cursor</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolver</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">_ID</span><span class="p">},</span><span class="w"> </span><span class="c1">// 只查询_raw_contact_id列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// 无筛选条件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// 无筛选条件参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="w"> </span><span class="c1">// 无排序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 遍历查询结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">moveToNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 获取当前记录的raw_contact_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">rawContactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cursor</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 构建用于查询联系人的Data URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&#34;content://com.android.contacts/contacts/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rawContactId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/data&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 查询Data表，获取与当前联系人相关的所有数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Cursor</span><span class="w"> </span><span class="n">dataCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolver</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">uri</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA2</span><span class="p">},</span><span class="w"> </span><span class="c1">// 查询MIME类型和数据列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// 无筛选条件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// 无筛选条件参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kc">null</span><span class="w"> </span><span class="c1">// 无排序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 创建一个Contact对象用于存储查询结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contact</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 遍历查询结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">dataCursor</span><span class="p">.</span><span class="na">moveToNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 获取当前记录的DATA1列的值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">dataCursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 获取当前记录的MIMETYPE列的值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">dataCursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 根据MIME类型，将数据存储到相应的Contact属性中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mimeType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">StructuredName</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 如果MIME类型是StructuredName，则将data1赋值给contact的name属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Phone</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 如果MIME类型是Phone，则将data1赋值给contact的phone属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">contact</span><span class="p">.</span><span class="na">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">case</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Email</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// 如果MIME类型是Email，则将data1赋值给contact的email属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">contact</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 关闭Data表的查询结果游标</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">dataCursor</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 如果contact的name属性不为空，则输出联系人姓名到日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 关闭RawContacts表的查询结果游标</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">cursor</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 往手机通讯录一次性添加一个联系人信息（包括主记录，姓名，电话号码，电子邮箱）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 事务性，要么全部成功，要么全部失败</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addFullContacts</span><span class="p">(</span><span class="n">ContentResolver</span><span class="w"> </span><span class="n">contentResolver</span><span class="p">,</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个插入联系人主记录的内容操作器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentProviderOperation</span><span class="w"> </span><span class="n">op_main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentProviderOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置操作类型为插入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">newInsert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置插入的ACCOUNT_NAME为null，表示使用默认账户</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">ACCOUNT_NAME</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 构建操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个插入联系人姓名的内容操作器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentProviderOperation</span><span class="w"> </span><span class="n">op_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentProviderOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置操作类型为插入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">newInsert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置引用的RAW_CONTACT_ID为前一个操作生成的ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValueBackReference</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置数据的MIME类型为StructuredName（联系人的名字）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">StructuredName</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置联系人的名字</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 构建操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个插入联系人电话号码的内容操作器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentProviderOperation</span><span class="w"> </span><span class="n">op_phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentProviderOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置操作类型为插入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">newInsert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置引用的RAW_CONTACT_ID为前一个操作生成的ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValueBackReference</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置数据的MIME类型为Phone（联系人的电话）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Phone</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置联系人的电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">phone</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置电话号码的类型为Mobile（手机）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA2</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Phone</span><span class="p">.</span><span class="na">TYPE_MOBILE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 构建操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个插入联系人电子邮箱的内容操作器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentProviderOperation</span><span class="w"> </span><span class="n">op_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentProviderOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置操作类型为插入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">newInsert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置引用的RAW_CONTACT_ID为前一个操作生成的ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValueBackReference</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置数据的MIME类型为Email（联系人的邮箱）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Email</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置联系人的电子邮箱地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">email</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 设置电子邮箱的类型为Mobile（手机邮箱）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">withValue</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA2</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Email</span><span class="p">.</span><span class="na">TYPE_MOBILE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 构建操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个操作列表，用于批量执行所有操作</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ContentProviderOperation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将插入主记录的操作添加到操作列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">operations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">op_main</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将插入姓名的操作添加到操作列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">operations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">op_name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将插入电话号码的操作添加到操作列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">operations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">op_phone</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将插入电子邮箱的操作添加到操作列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">operations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">op_email</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 执行批量操作，将所有数据插入联系人数据库</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">contentResolver</span><span class="p">.</span><span class="na">applyBatch</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">AUTHORITY</span><span class="p">,</span><span class="w"> </span><span class="n">operations</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">OperationApplicationException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 捕获OperationApplicationException异常并抛出RuntimeException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 捕获RemoteException异常并抛出RuntimeException</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addContacts</span><span class="p">(</span><span class="n">ContentResolver</span><span class="w"> </span><span class="n">resolver</span><span class="p">,</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个ContentValues对象，用于存储新联系人数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 插入一个空的RawContact记录，返回该记录的URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolver</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 解析出新插入记录的ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">rawContactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentUris</span><span class="p">.</span><span class="na">parseId</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个ContentValues对象，用于存储联系人的名字数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置RAW_CONTACT_ID，表示该数据属于哪个联系人</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">rawContactId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置数据的MIME类型为StructuredName（联系人的名字）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">StructuredName</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置联系人的名字</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将联系人的名字数据插入到Data表中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resolver</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个ContentValues对象，用于存储联系人的电话号码数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置RAW_CONTACT_ID，表示该数据属于哪个联系人</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">phone</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">rawContactId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置数据的MIME类型为Phone（联系人的电话）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">phone</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Phone</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置联系人的电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">phone</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">phone</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置电话号码的类型为Mobile（手机）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">phone</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA2</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Phone</span><span class="p">.</span><span class="na">TYPE_MOBILE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将联系人的电话号码数据插入到Data表中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resolver</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建一个ContentValues对象，用于存储联系人的邮箱数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置RAW_CONTACT_ID，表示该数据属于哪个联系人</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">email</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">RAW_CONTACT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">rawContactId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置数据的MIME类型为Email（联系人的邮箱）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">email</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">MIMETYPE</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Email</span><span class="p">.</span><span class="na">CONTENT_ITEM_TYPE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置联系人的邮箱地址（此处错误，应该是contact.email，而不是contact.phone）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">email</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">email</span><span class="p">);</span><span class="w"> </span><span class="c1">// 纠正了原来的错误</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置邮箱地址的类型为Work（工作邮箱）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">email</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">DATA2</span><span class="p">,</span><span class="w"> </span><span class="n">CommonDataKinds</span><span class="p">.</span><span class="na">Email</span><span class="p">.</span><span class="na">TYPE_WORK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 将联系人的邮箱数据插入到Data表中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">resolver</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">Data</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addContact</span><span class="p">(</span><span class="n">ContentResolver</span><span class="w"> </span><span class="n">resolver</span><span class="p">,</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ContentValues</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContentValues</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolver</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">ContactsContract</span><span class="p">.</span><span class="na">RawContacts</span><span class="p">.</span><span class="na">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">rawDataId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentUris</span><span class="p">.</span><span class="na">parseId</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="发送短信">发送短信<a hidden class="anchor" aria-hidden="true" href="#发送短信">#</a></h2>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/sendSMS.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/sendSMS.gif" alt="sendSMS"  />
        </a>
    </div>
</p>
<h3 id="java">Java<a hidden class="anchor" aria-hidden="true" href="#java">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-12-1"><a class="lnlinks" href="#hl-12-1"> 1</a>
</span><span class="lnt" id="hl-12-2"><a class="lnlinks" href="#hl-12-2"> 2</a>
</span><span class="lnt" id="hl-12-3"><a class="lnlinks" href="#hl-12-3"> 3</a>
</span><span class="lnt" id="hl-12-4"><a class="lnlinks" href="#hl-12-4"> 4</a>
</span><span class="lnt" id="hl-12-5"><a class="lnlinks" href="#hl-12-5"> 5</a>
</span><span class="lnt" id="hl-12-6"><a class="lnlinks" href="#hl-12-6"> 6</a>
</span><span class="lnt" id="hl-12-7"><a class="lnlinks" href="#hl-12-7"> 7</a>
</span><span class="lnt" id="hl-12-8"><a class="lnlinks" href="#hl-12-8"> 8</a>
</span><span class="lnt" id="hl-12-9"><a class="lnlinks" href="#hl-12-9"> 9</a>
</span><span class="lnt" id="hl-12-10"><a class="lnlinks" href="#hl-12-10">10</a>
</span><span class="lnt" id="hl-12-11"><a class="lnlinks" href="#hl-12-11">11</a>
</span><span class="lnt" id="hl-12-12"><a class="lnlinks" href="#hl-12-12">12</a>
</span><span class="lnt" id="hl-12-13"><a class="lnlinks" href="#hl-12-13">13</a>
</span><span class="lnt" id="hl-12-14"><a class="lnlinks" href="#hl-12-14">14</a>
</span><span class="lnt" id="hl-12-15"><a class="lnlinks" href="#hl-12-15">15</a>
</span><span class="lnt" id="hl-12-16"><a class="lnlinks" href="#hl-12-16">16</a>
</span><span class="lnt" id="hl-12-17"><a class="lnlinks" href="#hl-12-17">17</a>
</span><span class="lnt" id="hl-12-18"><a class="lnlinks" href="#hl-12-18">18</a>
</span><span class="lnt" id="hl-12-19"><a class="lnlinks" href="#hl-12-19">19</a>
</span><span class="lnt" id="hl-12-20"><a class="lnlinks" href="#hl-12-20">20</a>
</span><span class="lnt" id="hl-12-21"><a class="lnlinks" href="#hl-12-21">21</a>
</span><span class="lnt" id="hl-12-22"><a class="lnlinks" href="#hl-12-22">22</a>
</span><span class="lnt" id="hl-12-23"><a class="lnlinks" href="#hl-12-23">23</a>
</span><span class="lnt" id="hl-12-24"><a class="lnlinks" href="#hl-12-24">24</a>
</span><span class="lnt" id="hl-12-25"><a class="lnlinks" href="#hl-12-25">25</a>
</span><span class="lnt" id="hl-12-26"><a class="lnlinks" href="#hl-12-26">26</a>
</span><span class="lnt" id="hl-12-27"><a class="lnlinks" href="#hl-12-27">27</a>
</span><span class="lnt" id="hl-12-28"><a class="lnlinks" href="#hl-12-28">28</a>
</span><span class="lnt" id="hl-12-29"><a class="lnlinks" href="#hl-12-29">29</a>
</span><span class="lnt" id="hl-12-30"><a class="lnlinks" href="#hl-12-30">30</a>
</span><span class="lnt" id="hl-12-31"><a class="lnlinks" href="#hl-12-31">31</a>
</span><span class="lnt" id="hl-12-32"><a class="lnlinks" href="#hl-12-32">32</a>
</span><span class="lnt" id="hl-12-33"><a class="lnlinks" href="#hl-12-33">33</a>
</span><span class="lnt" id="hl-12-34"><a class="lnlinks" href="#hl-12-34">34</a>
</span><span class="lnt" id="hl-12-35"><a class="lnlinks" href="#hl-12-35">35</a>
</span><span class="lnt" id="hl-12-36"><a class="lnlinks" href="#hl-12-36">36</a>
</span><span class="lnt" id="hl-12-37"><a class="lnlinks" href="#hl-12-37">37</a>
</span><span class="lnt" id="hl-12-38"><a class="lnlinks" href="#hl-12-38">38</a>
</span><span class="lnt" id="hl-12-39"><a class="lnlinks" href="#hl-12-39">39</a>
</span><span class="lnt" id="hl-12-40"><a class="lnlinks" href="#hl-12-40">40</a>
</span><span class="lnt" id="hl-12-41"><a class="lnlinks" href="#hl-12-41">41</a>
</span><span class="lnt" id="hl-12-42"><a class="lnlinks" href="#hl-12-42">42</a>
</span><span class="lnt" id="hl-12-43"><a class="lnlinks" href="#hl-12-43">43</a>
</span><span class="lnt" id="hl-12-44"><a class="lnlinks" href="#hl-12-44">44</a>
</span><span class="lnt" id="hl-12-45"><a class="lnlinks" href="#hl-12-45">45</a>
</span><span class="lnt" id="hl-12-46"><a class="lnlinks" href="#hl-12-46">46</a>
</span><span class="lnt" id="hl-12-47"><a class="lnlinks" href="#hl-12-47">47</a>
</span><span class="lnt" id="hl-12-48"><a class="lnlinks" href="#hl-12-48">48</a>
</span><span class="lnt" id="hl-12-49"><a class="lnlinks" href="#hl-12-49">49</a>
</span><span class="lnt" id="hl-12-50"><a class="lnlinks" href="#hl-12-50">50</a>
</span><span class="lnt" id="hl-12-51"><a class="lnlinks" href="#hl-12-51">51</a>
</span><span class="lnt" id="hl-12-52"><a class="lnlinks" href="#hl-12-52">52</a>
</span><span class="lnt" id="hl-12-53"><a class="lnlinks" href="#hl-12-53">53</a>
</span><span class="lnt" id="hl-12-54"><a class="lnlinks" href="#hl-12-54">54</a>
</span><span class="lnt" id="hl-12-55"><a class="lnlinks" href="#hl-12-55">55</a>
</span><span class="lnt" id="hl-12-56"><a class="lnlinks" href="#hl-12-56">56</a>
</span><span class="lnt" id="hl-12-57"><a class="lnlinks" href="#hl-12-57">57</a>
</span><span class="lnt" id="hl-12-58"><a class="lnlinks" href="#hl-12-58">58</a>
</span><span class="lnt" id="hl-12-59"><a class="lnlinks" href="#hl-12-59">59</a>
</span><span class="lnt" id="hl-12-60"><a class="lnlinks" href="#hl-12-60">60</a>
</span><span class="lnt" id="hl-12-61"><a class="lnlinks" href="#hl-12-61">61</a>
</span><span class="lnt" id="hl-12-62"><a class="lnlinks" href="#hl-12-62">62</a>
</span><span class="lnt" id="hl-12-63"><a class="lnlinks" href="#hl-12-63">63</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义包名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SentMmsActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 定义SentMmsActivity类，继承AppCompatActivity，实现View.OnClickListener接口</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义TAG用于日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ActivityResultLauncher</span><span class="o">&lt;</span><span class="n">Intent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mResultLauncher</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义ActivityResultLauncher变量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_phone_number</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText变量用于电话号码输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_title</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText变量用于标题输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_desc</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText变量用于描述输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">picUri</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义Uri变量用于存储图片URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// onCreate方法，Activity创建时调用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w"> </span><span class="c1">// 调用父类onCreate方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_sent_mms</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置布局文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ImageView</span><span class="w"> </span><span class="n">iv_add_pic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">iv_add_pic</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取ImageView用于添加图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_send</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置发送按钮的点击监听</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">iv_add_pic</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置添加图片按钮的点击监听</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_phone_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_phone_number</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于电话号码输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_title</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于标题输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_desc</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于描述输入</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mResultLauncher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">registerForActivityResult</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ActivityResultContracts</span><span class="p">.</span><span class="na">StartActivityForResult</span><span class="p">(),</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 注册Activity结果启动器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getResultCode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RESULT_OK</span><span class="p">){</span><span class="w"> </span><span class="c1">// 检查结果码是否为RESULT_OK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getData</span><span class="p">();</span><span class="w"> </span><span class="c1">// 获取结果数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">picUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intent</span><span class="p">.</span><span class="na">getData</span><span class="p">();</span><span class="w"> </span><span class="c1">// 获取图片URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">picUri</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span><span class="w"> </span><span class="c1">// 如果URI不为空</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">iv_add_pic</span><span class="p">.</span><span class="na">setImageURI</span><span class="p">(</span><span class="n">picUri</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置ImageView显示图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">picUri</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"> </span><span class="c1">// 打印图片URI到日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// onClick方法，处理点击事件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">iv_add_pic</span><span class="p">){</span><span class="w"> </span><span class="c1">// 如果点击的是添加图片按钮</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_GET_CONTENT</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建Intent用于选择内容</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">intent</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="s">&#34;image/*&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置选择类型为图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">mResultLauncher</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w"> </span><span class="c1">// 启动选择图片的Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_send</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 如果点击的是发送按钮</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sendMms</span><span class="p">(</span><span class="n">et_phone_number</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 调用sendMms方法发送MMS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">et_title</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 获取标题文本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">et_desc</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w"> </span><span class="c1">// 获取描述文本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMms</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">phone</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">desc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// sendMms方法，用于发送MMS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_SEND</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建发送Intent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加新任务标志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加URI读权限标志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;address&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;subject&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;sms_body&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置描述</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">EXTRA_STREAM</span><span class="p">,</span><span class="w"> </span><span class="n">picUri</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加图片URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="s">&#34;image/*&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置类型为图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w"> </span><span class="c1">// 启动发送MMS的Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;从在弹窗中选择信息或短信应用&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 显示提示信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="fileprovider指定获取图片路径并发送短信">FileProvider指定获取图片路径并发送短信<a hidden class="anchor" aria-hidden="true" href="#fileprovider指定获取图片路径并发送短信">#</a></h2>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/FileProviderSMS.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/FileProviderSMS.gif" alt="FileProviderSMS"  />
        </a>
    </div>
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-13-1"><a class="lnlinks" href="#hl-13-1">  1</a>
</span><span class="lnt" id="hl-13-2"><a class="lnlinks" href="#hl-13-2">  2</a>
</span><span class="lnt" id="hl-13-3"><a class="lnlinks" href="#hl-13-3">  3</a>
</span><span class="lnt" id="hl-13-4"><a class="lnlinks" href="#hl-13-4">  4</a>
</span><span class="lnt" id="hl-13-5"><a class="lnlinks" href="#hl-13-5">  5</a>
</span><span class="lnt" id="hl-13-6"><a class="lnlinks" href="#hl-13-6">  6</a>
</span><span class="lnt" id="hl-13-7"><a class="lnlinks" href="#hl-13-7">  7</a>
</span><span class="lnt" id="hl-13-8"><a class="lnlinks" href="#hl-13-8">  8</a>
</span><span class="lnt" id="hl-13-9"><a class="lnlinks" href="#hl-13-9">  9</a>
</span><span class="lnt" id="hl-13-10"><a class="lnlinks" href="#hl-13-10"> 10</a>
</span><span class="lnt" id="hl-13-11"><a class="lnlinks" href="#hl-13-11"> 11</a>
</span><span class="lnt" id="hl-13-12"><a class="lnlinks" href="#hl-13-12"> 12</a>
</span><span class="lnt" id="hl-13-13"><a class="lnlinks" href="#hl-13-13"> 13</a>
</span><span class="lnt" id="hl-13-14"><a class="lnlinks" href="#hl-13-14"> 14</a>
</span><span class="lnt" id="hl-13-15"><a class="lnlinks" href="#hl-13-15"> 15</a>
</span><span class="lnt" id="hl-13-16"><a class="lnlinks" href="#hl-13-16"> 16</a>
</span><span class="lnt" id="hl-13-17"><a class="lnlinks" href="#hl-13-17"> 17</a>
</span><span class="lnt" id="hl-13-18"><a class="lnlinks" href="#hl-13-18"> 18</a>
</span><span class="lnt" id="hl-13-19"><a class="lnlinks" href="#hl-13-19"> 19</a>
</span><span class="lnt" id="hl-13-20"><a class="lnlinks" href="#hl-13-20"> 20</a>
</span><span class="lnt" id="hl-13-21"><a class="lnlinks" href="#hl-13-21"> 21</a>
</span><span class="lnt" id="hl-13-22"><a class="lnlinks" href="#hl-13-22"> 22</a>
</span><span class="lnt" id="hl-13-23"><a class="lnlinks" href="#hl-13-23"> 23</a>
</span><span class="lnt" id="hl-13-24"><a class="lnlinks" href="#hl-13-24"> 24</a>
</span><span class="lnt" id="hl-13-25"><a class="lnlinks" href="#hl-13-25"> 25</a>
</span><span class="lnt" id="hl-13-26"><a class="lnlinks" href="#hl-13-26"> 26</a>
</span><span class="lnt" id="hl-13-27"><a class="lnlinks" href="#hl-13-27"> 27</a>
</span><span class="lnt" id="hl-13-28"><a class="lnlinks" href="#hl-13-28"> 28</a>
</span><span class="lnt" id="hl-13-29"><a class="lnlinks" href="#hl-13-29"> 29</a>
</span><span class="lnt" id="hl-13-30"><a class="lnlinks" href="#hl-13-30"> 30</a>
</span><span class="lnt" id="hl-13-31"><a class="lnlinks" href="#hl-13-31"> 31</a>
</span><span class="lnt" id="hl-13-32"><a class="lnlinks" href="#hl-13-32"> 32</a>
</span><span class="lnt" id="hl-13-33"><a class="lnlinks" href="#hl-13-33"> 33</a>
</span><span class="lnt" id="hl-13-34"><a class="lnlinks" href="#hl-13-34"> 34</a>
</span><span class="lnt" id="hl-13-35"><a class="lnlinks" href="#hl-13-35"> 35</a>
</span><span class="lnt" id="hl-13-36"><a class="lnlinks" href="#hl-13-36"> 36</a>
</span><span class="lnt" id="hl-13-37"><a class="lnlinks" href="#hl-13-37"> 37</a>
</span><span class="lnt" id="hl-13-38"><a class="lnlinks" href="#hl-13-38"> 38</a>
</span><span class="lnt" id="hl-13-39"><a class="lnlinks" href="#hl-13-39"> 39</a>
</span><span class="lnt" id="hl-13-40"><a class="lnlinks" href="#hl-13-40"> 40</a>
</span><span class="lnt" id="hl-13-41"><a class="lnlinks" href="#hl-13-41"> 41</a>
</span><span class="lnt" id="hl-13-42"><a class="lnlinks" href="#hl-13-42"> 42</a>
</span><span class="lnt" id="hl-13-43"><a class="lnlinks" href="#hl-13-43"> 43</a>
</span><span class="lnt" id="hl-13-44"><a class="lnlinks" href="#hl-13-44"> 44</a>
</span><span class="lnt" id="hl-13-45"><a class="lnlinks" href="#hl-13-45"> 45</a>
</span><span class="lnt" id="hl-13-46"><a class="lnlinks" href="#hl-13-46"> 46</a>
</span><span class="lnt" id="hl-13-47"><a class="lnlinks" href="#hl-13-47"> 47</a>
</span><span class="lnt" id="hl-13-48"><a class="lnlinks" href="#hl-13-48"> 48</a>
</span><span class="lnt" id="hl-13-49"><a class="lnlinks" href="#hl-13-49"> 49</a>
</span><span class="lnt" id="hl-13-50"><a class="lnlinks" href="#hl-13-50"> 50</a>
</span><span class="lnt" id="hl-13-51"><a class="lnlinks" href="#hl-13-51"> 51</a>
</span><span class="lnt" id="hl-13-52"><a class="lnlinks" href="#hl-13-52"> 52</a>
</span><span class="lnt" id="hl-13-53"><a class="lnlinks" href="#hl-13-53"> 53</a>
</span><span class="lnt" id="hl-13-54"><a class="lnlinks" href="#hl-13-54"> 54</a>
</span><span class="lnt" id="hl-13-55"><a class="lnlinks" href="#hl-13-55"> 55</a>
</span><span class="lnt" id="hl-13-56"><a class="lnlinks" href="#hl-13-56"> 56</a>
</span><span class="lnt" id="hl-13-57"><a class="lnlinks" href="#hl-13-57"> 57</a>
</span><span class="lnt" id="hl-13-58"><a class="lnlinks" href="#hl-13-58"> 58</a>
</span><span class="lnt" id="hl-13-59"><a class="lnlinks" href="#hl-13-59"> 59</a>
</span><span class="lnt" id="hl-13-60"><a class="lnlinks" href="#hl-13-60"> 60</a>
</span><span class="lnt" id="hl-13-61"><a class="lnlinks" href="#hl-13-61"> 61</a>
</span><span class="lnt" id="hl-13-62"><a class="lnlinks" href="#hl-13-62"> 62</a>
</span><span class="lnt" id="hl-13-63"><a class="lnlinks" href="#hl-13-63"> 63</a>
</span><span class="lnt" id="hl-13-64"><a class="lnlinks" href="#hl-13-64"> 64</a>
</span><span class="lnt" id="hl-13-65"><a class="lnlinks" href="#hl-13-65"> 65</a>
</span><span class="lnt" id="hl-13-66"><a class="lnlinks" href="#hl-13-66"> 66</a>
</span><span class="lnt" id="hl-13-67"><a class="lnlinks" href="#hl-13-67"> 67</a>
</span><span class="lnt" id="hl-13-68"><a class="lnlinks" href="#hl-13-68"> 68</a>
</span><span class="lnt" id="hl-13-69"><a class="lnlinks" href="#hl-13-69"> 69</a>
</span><span class="lnt" id="hl-13-70"><a class="lnlinks" href="#hl-13-70"> 70</a>
</span><span class="lnt" id="hl-13-71"><a class="lnlinks" href="#hl-13-71"> 71</a>
</span><span class="lnt" id="hl-13-72"><a class="lnlinks" href="#hl-13-72"> 72</a>
</span><span class="lnt" id="hl-13-73"><a class="lnlinks" href="#hl-13-73"> 73</a>
</span><span class="lnt" id="hl-13-74"><a class="lnlinks" href="#hl-13-74"> 74</a>
</span><span class="lnt" id="hl-13-75"><a class="lnlinks" href="#hl-13-75"> 75</a>
</span><span class="lnt" id="hl-13-76"><a class="lnlinks" href="#hl-13-76"> 76</a>
</span><span class="lnt" id="hl-13-77"><a class="lnlinks" href="#hl-13-77"> 77</a>
</span><span class="lnt" id="hl-13-78"><a class="lnlinks" href="#hl-13-78"> 78</a>
</span><span class="lnt" id="hl-13-79"><a class="lnlinks" href="#hl-13-79"> 79</a>
</span><span class="lnt" id="hl-13-80"><a class="lnlinks" href="#hl-13-80"> 80</a>
</span><span class="lnt" id="hl-13-81"><a class="lnlinks" href="#hl-13-81"> 81</a>
</span><span class="lnt" id="hl-13-82"><a class="lnlinks" href="#hl-13-82"> 82</a>
</span><span class="lnt" id="hl-13-83"><a class="lnlinks" href="#hl-13-83"> 83</a>
</span><span class="lnt" id="hl-13-84"><a class="lnlinks" href="#hl-13-84"> 84</a>
</span><span class="lnt" id="hl-13-85"><a class="lnlinks" href="#hl-13-85"> 85</a>
</span><span class="lnt" id="hl-13-86"><a class="lnlinks" href="#hl-13-86"> 86</a>
</span><span class="lnt" id="hl-13-87"><a class="lnlinks" href="#hl-13-87"> 87</a>
</span><span class="lnt" id="hl-13-88"><a class="lnlinks" href="#hl-13-88"> 88</a>
</span><span class="lnt" id="hl-13-89"><a class="lnlinks" href="#hl-13-89"> 89</a>
</span><span class="lnt" id="hl-13-90"><a class="lnlinks" href="#hl-13-90"> 90</a>
</span><span class="lnt" id="hl-13-91"><a class="lnlinks" href="#hl-13-91"> 91</a>
</span><span class="lnt" id="hl-13-92"><a class="lnlinks" href="#hl-13-92"> 92</a>
</span><span class="lnt" id="hl-13-93"><a class="lnlinks" href="#hl-13-93"> 93</a>
</span><span class="lnt" id="hl-13-94"><a class="lnlinks" href="#hl-13-94"> 94</a>
</span><span class="lnt" id="hl-13-95"><a class="lnlinks" href="#hl-13-95"> 95</a>
</span><span class="lnt" id="hl-13-96"><a class="lnlinks" href="#hl-13-96"> 96</a>
</span><span class="lnt" id="hl-13-97"><a class="lnlinks" href="#hl-13-97"> 97</a>
</span><span class="lnt" id="hl-13-98"><a class="lnlinks" href="#hl-13-98"> 98</a>
</span><span class="lnt" id="hl-13-99"><a class="lnlinks" href="#hl-13-99"> 99</a>
</span><span class="lnt" id="hl-13-100"><a class="lnlinks" href="#hl-13-100">100</a>
</span><span class="lnt" id="hl-13-101"><a class="lnlinks" href="#hl-13-101">101</a>
</span><span class="lnt" id="hl-13-102"><a class="lnlinks" href="#hl-13-102">102</a>
</span><span class="lnt" id="hl-13-103"><a class="lnlinks" href="#hl-13-103">103</a>
</span><span class="lnt" id="hl-13-104"><a class="lnlinks" href="#hl-13-104">104</a>
</span><span class="lnt" id="hl-13-105"><a class="lnlinks" href="#hl-13-105">105</a>
</span><span class="lnt" id="hl-13-106"><a class="lnlinks" href="#hl-13-106">106</a>
</span><span class="lnt" id="hl-13-107"><a class="lnlinks" href="#hl-13-107">107</a>
</span><span class="lnt" id="hl-13-108"><a class="lnlinks" href="#hl-13-108">108</a>
</span><span class="lnt" id="hl-13-109"><a class="lnlinks" href="#hl-13-109">109</a>
</span><span class="lnt" id="hl-13-110"><a class="lnlinks" href="#hl-13-110">110</a>
</span><span class="lnt" id="hl-13-111"><a class="lnlinks" href="#hl-13-111">111</a>
</span><span class="lnt" id="hl-13-112"><a class="lnlinks" href="#hl-13-112">112</a>
</span><span class="lnt" id="hl-13-113"><a class="lnlinks" href="#hl-13-113">113</a>
</span><span class="lnt" id="hl-13-114"><a class="lnlinks" href="#hl-13-114">114</a>
</span><span class="lnt" id="hl-13-115"><a class="lnlinks" href="#hl-13-115">115</a>
</span><span class="lnt" id="hl-13-116"><a class="lnlinks" href="#hl-13-116">116</a>
</span><span class="lnt" id="hl-13-117"><a class="lnlinks" href="#hl-13-117">117</a>
</span><span class="lnt" id="hl-13-118"><a class="lnlinks" href="#hl-13-118">118</a>
</span><span class="lnt" id="hl-13-119"><a class="lnlinks" href="#hl-13-119">119</a>
</span><span class="lnt" id="hl-13-120"><a class="lnlinks" href="#hl-13-120">120</a>
</span><span class="lnt" id="hl-13-121"><a class="lnlinks" href="#hl-13-121">121</a>
</span><span class="lnt" id="hl-13-122"><a class="lnlinks" href="#hl-13-122">122</a>
</span><span class="lnt" id="hl-13-123"><a class="lnlinks" href="#hl-13-123">123</a>
</span><span class="lnt" id="hl-13-124"><a class="lnlinks" href="#hl-13-124">124</a>
</span><span class="lnt" id="hl-13-125"><a class="lnlinks" href="#hl-13-125">125</a>
</span><span class="lnt" id="hl-13-126"><a class="lnlinks" href="#hl-13-126">126</a>
</span><span class="lnt" id="hl-13-127"><a class="lnlinks" href="#hl-13-127">127</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义包名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProvideMmsActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 定义ProvideMmsActivity类，继承AppCompatActivity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义TAG用于日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ImageInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mImageList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// 定义用于存储图片信息的列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">GridLayout</span><span class="w"> </span><span class="n">gl_appendix</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义GridLayout用于显示图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">PERMISSION_STORAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w"> </span><span class="c1">// 定义存储权限数组</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PERMISSION_STORAGE_CODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义存储权限请求码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_phone_number</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText用于输入电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_message</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText用于输入消息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">et_title</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义EditText用于输入标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// onCreate方法，Activity创建时调用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w"> </span><span class="c1">// 调用父类onCreate方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_provide_mms</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置布局文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gl_appendix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">gl_appendix</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取GridLayout用于显示图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_title</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于输入标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_message</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于输入消息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">et_phone_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">et_phone_number</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取EditText用于输入电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MediaScannerConnection</span><span class="p">.</span><span class="na">scanFile</span><span class="p">(</span><span class="w"> </span><span class="c1">// 调用MediaScannerConnection扫描文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">Environment</span><span class="p">.</span><span class="na">getExternalStoragePublicDirectory</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="na">DIRECTORY_DOWNLOADS</span><span class="p">).</span><span class="na">toString</span><span class="p">()},</span><span class="w"> </span><span class="c1">// 扫描下载目录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSION_STORAGE</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSION_STORAGE_CODE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 检查存储权限</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">loadImageList</span><span class="p">();</span><span class="w"> </span><span class="c1">// 加载图片列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">showImageGrid</span><span class="p">();</span><span class="w"> </span><span class="c1">// 显示图片网格</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 权限请求结果回调</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span><span class="w"> </span><span class="c1">// 调用父类方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PERMISSION_STORAGE_CODE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 判断请求码是否为存储权限</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 检查权限是否被授予</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">loadImageList</span><span class="p">();</span><span class="w"> </span><span class="c1">// 加载图片列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">showImageGrid</span><span class="p">();</span><span class="w"> </span><span class="c1">// 显示图片网格</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showImageGrid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 显示图片网格的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gl_appendix</span><span class="p">.</span><span class="na">removeAllViews</span><span class="p">();</span><span class="w"> </span><span class="c1">// 移除所有视图</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ImageInfo</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">mImageList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 遍历图片列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ImageView</span><span class="w"> </span><span class="n">imageView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建ImageView</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Bitmap</span><span class="w"> </span><span class="n">bitmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">decodeFile</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="na">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// 解码图片文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">imageView</span><span class="p">.</span><span class="na">setImageBitmap</span><span class="p">(</span><span class="n">bitmap</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">imageView</span><span class="p">.</span><span class="na">setScaleType</span><span class="p">(</span><span class="n">ImageView</span><span class="p">.</span><span class="na">ScaleType</span><span class="p">.</span><span class="na">FIT_CENTER</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置缩放类型</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utils</span><span class="p">.</span><span class="na">dip2px</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">110</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将110dp转换为px</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ViewGroup</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="w"> </span><span class="n">px</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建布局参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">imageView</span><span class="p">.</span><span class="na">setLayoutParams</span><span class="p">(</span><span class="n">params</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置布局参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Utils</span><span class="p">.</span><span class="na">dip2px</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将5dp转换为px</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">imageView</span><span class="p">.</span><span class="na">setPadding</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置内边距</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">imageView</span><span class="p">.</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 设置点击监听器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">sendMms</span><span class="p">(</span><span class="n">et_phone_number</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 获取输入的电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">et_title</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 获取输入的标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">et_message</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// 获取输入的消息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">image</span><span class="p">.</span><span class="na">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取图片路径</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gl_appendix</span><span class="p">.</span><span class="na">addView</span><span class="p">(</span><span class="n">imageView</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将ImageView添加到GridLayout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMms</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">phone</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">desc</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 发送MMS的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将路径解析为Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 兼容Android 7.0 把访问文件的Uri方式改为FileProvider</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 判断是否为Android 7.0及以上</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileProvider</span><span class="p">.</span><span class="na">getUriForFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">file_Provider</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">));</span><span class="w"> </span><span class="c1">// 使用FileProvider获取Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;FileProvider Uri : %s&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">toString</span><span class="p">()));</span><span class="w"> </span><span class="c1">// 打印FileProvider的Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_SEND</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建发送Intent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加新任务标志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加读取URI权限标志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;address&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置电话号码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;subject&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&#34;sms_body&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置消息内容</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">EXTRA_STREAM</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">);</span><span class="w"> </span><span class="c1">// 添加图片Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="s">&#34;image/*&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 设置类型为图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w"> </span><span class="c1">// 启动Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;从在弹窗中选择信息或短信应用&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 显示提示信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&#34;Range&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadImageList</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 加载图片列表的方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w"> </span><span class="c1">// 定义要查询的列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">_ID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">TITLE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">SIZE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">DATA</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Cursor</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getContentResolver</span><span class="p">().</span><span class="na">query</span><span class="p">(</span><span class="w"> </span><span class="c1">// 查询图片媒体库</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="c1">// 查询外部图片URI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="c1">// 查询的列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;_size &lt; 307200&#34;</span><span class="p">,</span><span class="w"> </span><span class="c1">// 查询条件：大小小于300KB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// 查询参数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;_size DESC&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 排序方式：按大小降序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义计数器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cursor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 如果游标不为空</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">moveToNext</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 遍历查询结果，最多6个</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ImageInfo</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageInfo</span><span class="p">();</span><span class="w"> </span><span class="c1">// 创建ImageInfo对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">image</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cursor</span><span class="p">.</span><span class="na">getLong</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">_ID</span><span class="p">));</span><span class="w"> </span><span class="c1">// 获取图片ID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">image</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cursor</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">TITLE</span><span class="p">));</span><span class="w"> </span><span class="c1">// 获取图片标题</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">image</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cursor</span><span class="p">.</span><span class="na">getLong</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">SIZE</span><span class="p">));</span><span class="w"> </span><span class="c1">// 获取图片大小</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">image</span><span class="p">.</span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cursor</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getColumnIndex</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="na">Images</span><span class="p">.</span><span class="na">Media</span><span class="p">.</span><span class="na">DATA</span><span class="p">));</span><span class="w"> </span><span class="c1">// 获取图片路径</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FileUtil</span><span class="p">.</span><span class="na">checkFileUri</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="na">path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 检查文件URI是否有效</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 增加计数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">mImageList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">image</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将图片信息添加到列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"> </span><span class="c1">// 打印图片信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="xml">xml<a hidden class="anchor" aria-hidden="true" href="#xml">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-14-1"><a class="lnlinks" href="#hl-14-1">  1</a>
</span><span class="lnt" id="hl-14-2"><a class="lnlinks" href="#hl-14-2">  2</a>
</span><span class="lnt" id="hl-14-3"><a class="lnlinks" href="#hl-14-3">  3</a>
</span><span class="lnt" id="hl-14-4"><a class="lnlinks" href="#hl-14-4">  4</a>
</span><span class="lnt" id="hl-14-5"><a class="lnlinks" href="#hl-14-5">  5</a>
</span><span class="lnt" id="hl-14-6"><a class="lnlinks" href="#hl-14-6">  6</a>
</span><span class="lnt" id="hl-14-7"><a class="lnlinks" href="#hl-14-7">  7</a>
</span><span class="lnt" id="hl-14-8"><a class="lnlinks" href="#hl-14-8">  8</a>
</span><span class="lnt" id="hl-14-9"><a class="lnlinks" href="#hl-14-9">  9</a>
</span><span class="lnt" id="hl-14-10"><a class="lnlinks" href="#hl-14-10"> 10</a>
</span><span class="lnt" id="hl-14-11"><a class="lnlinks" href="#hl-14-11"> 11</a>
</span><span class="lnt" id="hl-14-12"><a class="lnlinks" href="#hl-14-12"> 12</a>
</span><span class="lnt" id="hl-14-13"><a class="lnlinks" href="#hl-14-13"> 13</a>
</span><span class="lnt" id="hl-14-14"><a class="lnlinks" href="#hl-14-14"> 14</a>
</span><span class="lnt" id="hl-14-15"><a class="lnlinks" href="#hl-14-15"> 15</a>
</span><span class="lnt" id="hl-14-16"><a class="lnlinks" href="#hl-14-16"> 16</a>
</span><span class="lnt" id="hl-14-17"><a class="lnlinks" href="#hl-14-17"> 17</a>
</span><span class="lnt" id="hl-14-18"><a class="lnlinks" href="#hl-14-18"> 18</a>
</span><span class="lnt" id="hl-14-19"><a class="lnlinks" href="#hl-14-19"> 19</a>
</span><span class="lnt" id="hl-14-20"><a class="lnlinks" href="#hl-14-20"> 20</a>
</span><span class="lnt" id="hl-14-21"><a class="lnlinks" href="#hl-14-21"> 21</a>
</span><span class="lnt" id="hl-14-22"><a class="lnlinks" href="#hl-14-22"> 22</a>
</span><span class="lnt" id="hl-14-23"><a class="lnlinks" href="#hl-14-23"> 23</a>
</span><span class="lnt" id="hl-14-24"><a class="lnlinks" href="#hl-14-24"> 24</a>
</span><span class="lnt" id="hl-14-25"><a class="lnlinks" href="#hl-14-25"> 25</a>
</span><span class="lnt" id="hl-14-26"><a class="lnlinks" href="#hl-14-26"> 26</a>
</span><span class="lnt" id="hl-14-27"><a class="lnlinks" href="#hl-14-27"> 27</a>
</span><span class="lnt" id="hl-14-28"><a class="lnlinks" href="#hl-14-28"> 28</a>
</span><span class="lnt" id="hl-14-29"><a class="lnlinks" href="#hl-14-29"> 29</a>
</span><span class="lnt" id="hl-14-30"><a class="lnlinks" href="#hl-14-30"> 30</a>
</span><span class="lnt" id="hl-14-31"><a class="lnlinks" href="#hl-14-31"> 31</a>
</span><span class="lnt" id="hl-14-32"><a class="lnlinks" href="#hl-14-32"> 32</a>
</span><span class="lnt" id="hl-14-33"><a class="lnlinks" href="#hl-14-33"> 33</a>
</span><span class="lnt" id="hl-14-34"><a class="lnlinks" href="#hl-14-34"> 34</a>
</span><span class="lnt" id="hl-14-35"><a class="lnlinks" href="#hl-14-35"> 35</a>
</span><span class="lnt" id="hl-14-36"><a class="lnlinks" href="#hl-14-36"> 36</a>
</span><span class="lnt" id="hl-14-37"><a class="lnlinks" href="#hl-14-37"> 37</a>
</span><span class="lnt" id="hl-14-38"><a class="lnlinks" href="#hl-14-38"> 38</a>
</span><span class="lnt" id="hl-14-39"><a class="lnlinks" href="#hl-14-39"> 39</a>
</span><span class="lnt" id="hl-14-40"><a class="lnlinks" href="#hl-14-40"> 40</a>
</span><span class="lnt" id="hl-14-41"><a class="lnlinks" href="#hl-14-41"> 41</a>
</span><span class="lnt" id="hl-14-42"><a class="lnlinks" href="#hl-14-42"> 42</a>
</span><span class="lnt" id="hl-14-43"><a class="lnlinks" href="#hl-14-43"> 43</a>
</span><span class="lnt" id="hl-14-44"><a class="lnlinks" href="#hl-14-44"> 44</a>
</span><span class="lnt" id="hl-14-45"><a class="lnlinks" href="#hl-14-45"> 45</a>
</span><span class="lnt" id="hl-14-46"><a class="lnlinks" href="#hl-14-46"> 46</a>
</span><span class="lnt" id="hl-14-47"><a class="lnlinks" href="#hl-14-47"> 47</a>
</span><span class="lnt" id="hl-14-48"><a class="lnlinks" href="#hl-14-48"> 48</a>
</span><span class="lnt" id="hl-14-49"><a class="lnlinks" href="#hl-14-49"> 49</a>
</span><span class="lnt" id="hl-14-50"><a class="lnlinks" href="#hl-14-50"> 50</a>
</span><span class="lnt" id="hl-14-51"><a class="lnlinks" href="#hl-14-51"> 51</a>
</span><span class="lnt" id="hl-14-52"><a class="lnlinks" href="#hl-14-52"> 52</a>
</span><span class="lnt" id="hl-14-53"><a class="lnlinks" href="#hl-14-53"> 53</a>
</span><span class="lnt" id="hl-14-54"><a class="lnlinks" href="#hl-14-54"> 54</a>
</span><span class="lnt" id="hl-14-55"><a class="lnlinks" href="#hl-14-55"> 55</a>
</span><span class="lnt" id="hl-14-56"><a class="lnlinks" href="#hl-14-56"> 56</a>
</span><span class="lnt" id="hl-14-57"><a class="lnlinks" href="#hl-14-57"> 57</a>
</span><span class="lnt" id="hl-14-58"><a class="lnlinks" href="#hl-14-58"> 58</a>
</span><span class="lnt" id="hl-14-59"><a class="lnlinks" href="#hl-14-59"> 59</a>
</span><span class="lnt" id="hl-14-60"><a class="lnlinks" href="#hl-14-60"> 60</a>
</span><span class="lnt" id="hl-14-61"><a class="lnlinks" href="#hl-14-61"> 61</a>
</span><span class="lnt" id="hl-14-62"><a class="lnlinks" href="#hl-14-62"> 62</a>
</span><span class="lnt" id="hl-14-63"><a class="lnlinks" href="#hl-14-63"> 63</a>
</span><span class="lnt" id="hl-14-64"><a class="lnlinks" href="#hl-14-64"> 64</a>
</span><span class="lnt" id="hl-14-65"><a class="lnlinks" href="#hl-14-65"> 65</a>
</span><span class="lnt" id="hl-14-66"><a class="lnlinks" href="#hl-14-66"> 66</a>
</span><span class="lnt" id="hl-14-67"><a class="lnlinks" href="#hl-14-67"> 67</a>
</span><span class="lnt" id="hl-14-68"><a class="lnlinks" href="#hl-14-68"> 68</a>
</span><span class="lnt" id="hl-14-69"><a class="lnlinks" href="#hl-14-69"> 69</a>
</span><span class="lnt" id="hl-14-70"><a class="lnlinks" href="#hl-14-70"> 70</a>
</span><span class="lnt" id="hl-14-71"><a class="lnlinks" href="#hl-14-71"> 71</a>
</span><span class="lnt" id="hl-14-72"><a class="lnlinks" href="#hl-14-72"> 72</a>
</span><span class="lnt" id="hl-14-73"><a class="lnlinks" href="#hl-14-73"> 73</a>
</span><span class="lnt" id="hl-14-74"><a class="lnlinks" href="#hl-14-74"> 74</a>
</span><span class="lnt" id="hl-14-75"><a class="lnlinks" href="#hl-14-75"> 75</a>
</span><span class="lnt" id="hl-14-76"><a class="lnlinks" href="#hl-14-76"> 76</a>
</span><span class="lnt" id="hl-14-77"><a class="lnlinks" href="#hl-14-77"> 77</a>
</span><span class="lnt" id="hl-14-78"><a class="lnlinks" href="#hl-14-78"> 78</a>
</span><span class="lnt" id="hl-14-79"><a class="lnlinks" href="#hl-14-79"> 79</a>
</span><span class="lnt" id="hl-14-80"><a class="lnlinks" href="#hl-14-80"> 80</a>
</span><span class="lnt" id="hl-14-81"><a class="lnlinks" href="#hl-14-81"> 81</a>
</span><span class="lnt" id="hl-14-82"><a class="lnlinks" href="#hl-14-82"> 82</a>
</span><span class="lnt" id="hl-14-83"><a class="lnlinks" href="#hl-14-83"> 83</a>
</span><span class="lnt" id="hl-14-84"><a class="lnlinks" href="#hl-14-84"> 84</a>
</span><span class="lnt" id="hl-14-85"><a class="lnlinks" href="#hl-14-85"> 85</a>
</span><span class="lnt" id="hl-14-86"><a class="lnlinks" href="#hl-14-86"> 86</a>
</span><span class="lnt" id="hl-14-87"><a class="lnlinks" href="#hl-14-87"> 87</a>
</span><span class="lnt" id="hl-14-88"><a class="lnlinks" href="#hl-14-88"> 88</a>
</span><span class="lnt" id="hl-14-89"><a class="lnlinks" href="#hl-14-89"> 89</a>
</span><span class="lnt" id="hl-14-90"><a class="lnlinks" href="#hl-14-90"> 90</a>
</span><span class="lnt" id="hl-14-91"><a class="lnlinks" href="#hl-14-91"> 91</a>
</span><span class="lnt" id="hl-14-92"><a class="lnlinks" href="#hl-14-92"> 92</a>
</span><span class="lnt" id="hl-14-93"><a class="lnlinks" href="#hl-14-93"> 93</a>
</span><span class="lnt" id="hl-14-94"><a class="lnlinks" href="#hl-14-94"> 94</a>
</span><span class="lnt" id="hl-14-95"><a class="lnlinks" href="#hl-14-95"> 95</a>
</span><span class="lnt" id="hl-14-96"><a class="lnlinks" href="#hl-14-96"> 96</a>
</span><span class="lnt" id="hl-14-97"><a class="lnlinks" href="#hl-14-97"> 97</a>
</span><span class="lnt" id="hl-14-98"><a class="lnlinks" href="#hl-14-98"> 98</a>
</span><span class="lnt" id="hl-14-99"><a class="lnlinks" href="#hl-14-99"> 99</a>
</span><span class="lnt" id="hl-14-100"><a class="lnlinks" href="#hl-14-100">100</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:orientation=</span><span class="s">&#34;vertical&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:padding=</span><span class="s">&#34;5dp&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;LinearLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;40dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:orientation=</span><span class="s">&#34;horizontal&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;TextView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;对方号码：&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;EditText</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/et_phone_number&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_margin=</span><span class="s">&#34;3dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_weight=</span><span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:background=</span><span class="s">&#34;@drawable/edittext_selector&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:inputType=</span><span class="s">&#34;number&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;10086&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/LinearLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;LinearLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;40dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:orientation=</span><span class="s">&#34;horizontal&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;TextView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;彩信标题：&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;EditText</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/et_title&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_margin=</span><span class="s">&#34;3dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_weight=</span><span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:background=</span><span class="s">&#34;@drawable/edittext_selector&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;Hallo&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/LinearLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;LinearLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;100dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:orientation=</span><span class="s">&#34;horizontal&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;TextView</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;彩信内容：&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;EditText</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:id=</span><span class="s">&#34;@+id/et_message&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_margin=</span><span class="s">&#34;3dp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:layout_weight=</span><span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:background=</span><span class="s">&#34;@drawable/edittext_selector&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:gravity=</span><span class="s">&#34;left|top&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="na">android:text=</span><span class="s">&#34;test&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/LinearLayout&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;TextView</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;30dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:text=</span><span class="s">&#34;点击下方图片开始发送彩信&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:textColor=</span><span class="s">&#34;@color/black&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:textSize=</span><span class="s">&#34;17sp&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;GridLayout</span>
</span></span><span class="line"><span class="cl">        <span class="na">andddroid:id=</span><span class="s">&#34;@+id/gl_appendix&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:columnCount=</span><span class="s">&#34;3&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/LinearLayout&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="fileprovider-安装apk">FileProvider 安装apk<a hidden class="anchor" aria-hidden="true" href="#fileprovider-安装apk">#</a></h2>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/kennems/blog-image/ApkProvider.gif">
            <img src="https://cdn.jsdelivr.net/gh/kennems/blog-image/ApkProvider.gif" alt="ApkProvider"  />
        </a>
    </div>
</p>
<h3 id="java-1">Java<a hidden class="anchor" aria-hidden="true" href="#java-1">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-15-1"><a class="lnlinks" href="#hl-15-1">  1</a>
</span><span class="lnt" id="hl-15-2"><a class="lnlinks" href="#hl-15-2">  2</a>
</span><span class="lnt" id="hl-15-3"><a class="lnlinks" href="#hl-15-3">  3</a>
</span><span class="lnt" id="hl-15-4"><a class="lnlinks" href="#hl-15-4">  4</a>
</span><span class="lnt" id="hl-15-5"><a class="lnlinks" href="#hl-15-5">  5</a>
</span><span class="lnt" id="hl-15-6"><a class="lnlinks" href="#hl-15-6">  6</a>
</span><span class="lnt" id="hl-15-7"><a class="lnlinks" href="#hl-15-7">  7</a>
</span><span class="lnt" id="hl-15-8"><a class="lnlinks" href="#hl-15-8">  8</a>
</span><span class="lnt" id="hl-15-9"><a class="lnlinks" href="#hl-15-9">  9</a>
</span><span class="lnt" id="hl-15-10"><a class="lnlinks" href="#hl-15-10"> 10</a>
</span><span class="lnt" id="hl-15-11"><a class="lnlinks" href="#hl-15-11"> 11</a>
</span><span class="lnt" id="hl-15-12"><a class="lnlinks" href="#hl-15-12"> 12</a>
</span><span class="lnt" id="hl-15-13"><a class="lnlinks" href="#hl-15-13"> 13</a>
</span><span class="lnt" id="hl-15-14"><a class="lnlinks" href="#hl-15-14"> 14</a>
</span><span class="lnt" id="hl-15-15"><a class="lnlinks" href="#hl-15-15"> 15</a>
</span><span class="lnt" id="hl-15-16"><a class="lnlinks" href="#hl-15-16"> 16</a>
</span><span class="lnt" id="hl-15-17"><a class="lnlinks" href="#hl-15-17"> 17</a>
</span><span class="lnt" id="hl-15-18"><a class="lnlinks" href="#hl-15-18"> 18</a>
</span><span class="lnt" id="hl-15-19"><a class="lnlinks" href="#hl-15-19"> 19</a>
</span><span class="lnt" id="hl-15-20"><a class="lnlinks" href="#hl-15-20"> 20</a>
</span><span class="lnt" id="hl-15-21"><a class="lnlinks" href="#hl-15-21"> 21</a>
</span><span class="lnt" id="hl-15-22"><a class="lnlinks" href="#hl-15-22"> 22</a>
</span><span class="lnt" id="hl-15-23"><a class="lnlinks" href="#hl-15-23"> 23</a>
</span><span class="lnt" id="hl-15-24"><a class="lnlinks" href="#hl-15-24"> 24</a>
</span><span class="lnt" id="hl-15-25"><a class="lnlinks" href="#hl-15-25"> 25</a>
</span><span class="lnt" id="hl-15-26"><a class="lnlinks" href="#hl-15-26"> 26</a>
</span><span class="lnt" id="hl-15-27"><a class="lnlinks" href="#hl-15-27"> 27</a>
</span><span class="lnt" id="hl-15-28"><a class="lnlinks" href="#hl-15-28"> 28</a>
</span><span class="lnt" id="hl-15-29"><a class="lnlinks" href="#hl-15-29"> 29</a>
</span><span class="lnt" id="hl-15-30"><a class="lnlinks" href="#hl-15-30"> 30</a>
</span><span class="lnt" id="hl-15-31"><a class="lnlinks" href="#hl-15-31"> 31</a>
</span><span class="lnt" id="hl-15-32"><a class="lnlinks" href="#hl-15-32"> 32</a>
</span><span class="lnt" id="hl-15-33"><a class="lnlinks" href="#hl-15-33"> 33</a>
</span><span class="lnt" id="hl-15-34"><a class="lnlinks" href="#hl-15-34"> 34</a>
</span><span class="lnt" id="hl-15-35"><a class="lnlinks" href="#hl-15-35"> 35</a>
</span><span class="lnt" id="hl-15-36"><a class="lnlinks" href="#hl-15-36"> 36</a>
</span><span class="lnt" id="hl-15-37"><a class="lnlinks" href="#hl-15-37"> 37</a>
</span><span class="lnt" id="hl-15-38"><a class="lnlinks" href="#hl-15-38"> 38</a>
</span><span class="lnt" id="hl-15-39"><a class="lnlinks" href="#hl-15-39"> 39</a>
</span><span class="lnt" id="hl-15-40"><a class="lnlinks" href="#hl-15-40"> 40</a>
</span><span class="lnt" id="hl-15-41"><a class="lnlinks" href="#hl-15-41"> 41</a>
</span><span class="lnt" id="hl-15-42"><a class="lnlinks" href="#hl-15-42"> 42</a>
</span><span class="lnt" id="hl-15-43"><a class="lnlinks" href="#hl-15-43"> 43</a>
</span><span class="lnt" id="hl-15-44"><a class="lnlinks" href="#hl-15-44"> 44</a>
</span><span class="lnt" id="hl-15-45"><a class="lnlinks" href="#hl-15-45"> 45</a>
</span><span class="lnt" id="hl-15-46"><a class="lnlinks" href="#hl-15-46"> 46</a>
</span><span class="lnt" id="hl-15-47"><a class="lnlinks" href="#hl-15-47"> 47</a>
</span><span class="lnt" id="hl-15-48"><a class="lnlinks" href="#hl-15-48"> 48</a>
</span><span class="lnt" id="hl-15-49"><a class="lnlinks" href="#hl-15-49"> 49</a>
</span><span class="lnt" id="hl-15-50"><a class="lnlinks" href="#hl-15-50"> 50</a>
</span><span class="lnt" id="hl-15-51"><a class="lnlinks" href="#hl-15-51"> 51</a>
</span><span class="lnt" id="hl-15-52"><a class="lnlinks" href="#hl-15-52"> 52</a>
</span><span class="lnt" id="hl-15-53"><a class="lnlinks" href="#hl-15-53"> 53</a>
</span><span class="lnt" id="hl-15-54"><a class="lnlinks" href="#hl-15-54"> 54</a>
</span><span class="lnt" id="hl-15-55"><a class="lnlinks" href="#hl-15-55"> 55</a>
</span><span class="lnt" id="hl-15-56"><a class="lnlinks" href="#hl-15-56"> 56</a>
</span><span class="lnt" id="hl-15-57"><a class="lnlinks" href="#hl-15-57"> 57</a>
</span><span class="lnt" id="hl-15-58"><a class="lnlinks" href="#hl-15-58"> 58</a>
</span><span class="lnt" id="hl-15-59"><a class="lnlinks" href="#hl-15-59"> 59</a>
</span><span class="lnt" id="hl-15-60"><a class="lnlinks" href="#hl-15-60"> 60</a>
</span><span class="lnt" id="hl-15-61"><a class="lnlinks" href="#hl-15-61"> 61</a>
</span><span class="lnt" id="hl-15-62"><a class="lnlinks" href="#hl-15-62"> 62</a>
</span><span class="lnt" id="hl-15-63"><a class="lnlinks" href="#hl-15-63"> 63</a>
</span><span class="lnt" id="hl-15-64"><a class="lnlinks" href="#hl-15-64"> 64</a>
</span><span class="lnt" id="hl-15-65"><a class="lnlinks" href="#hl-15-65"> 65</a>
</span><span class="lnt" id="hl-15-66"><a class="lnlinks" href="#hl-15-66"> 66</a>
</span><span class="lnt" id="hl-15-67"><a class="lnlinks" href="#hl-15-67"> 67</a>
</span><span class="lnt" id="hl-15-68"><a class="lnlinks" href="#hl-15-68"> 68</a>
</span><span class="lnt" id="hl-15-69"><a class="lnlinks" href="#hl-15-69"> 69</a>
</span><span class="lnt" id="hl-15-70"><a class="lnlinks" href="#hl-15-70"> 70</a>
</span><span class="lnt" id="hl-15-71"><a class="lnlinks" href="#hl-15-71"> 71</a>
</span><span class="lnt" id="hl-15-72"><a class="lnlinks" href="#hl-15-72"> 72</a>
</span><span class="lnt" id="hl-15-73"><a class="lnlinks" href="#hl-15-73"> 73</a>
</span><span class="lnt" id="hl-15-74"><a class="lnlinks" href="#hl-15-74"> 74</a>
</span><span class="lnt" id="hl-15-75"><a class="lnlinks" href="#hl-15-75"> 75</a>
</span><span class="lnt" id="hl-15-76"><a class="lnlinks" href="#hl-15-76"> 76</a>
</span><span class="lnt" id="hl-15-77"><a class="lnlinks" href="#hl-15-77"> 77</a>
</span><span class="lnt" id="hl-15-78"><a class="lnlinks" href="#hl-15-78"> 78</a>
</span><span class="lnt" id="hl-15-79"><a class="lnlinks" href="#hl-15-79"> 79</a>
</span><span class="lnt" id="hl-15-80"><a class="lnlinks" href="#hl-15-80"> 80</a>
</span><span class="lnt" id="hl-15-81"><a class="lnlinks" href="#hl-15-81"> 81</a>
</span><span class="lnt" id="hl-15-82"><a class="lnlinks" href="#hl-15-82"> 82</a>
</span><span class="lnt" id="hl-15-83"><a class="lnlinks" href="#hl-15-83"> 83</a>
</span><span class="lnt" id="hl-15-84"><a class="lnlinks" href="#hl-15-84"> 84</a>
</span><span class="lnt" id="hl-15-85"><a class="lnlinks" href="#hl-15-85"> 85</a>
</span><span class="lnt" id="hl-15-86"><a class="lnlinks" href="#hl-15-86"> 86</a>
</span><span class="lnt" id="hl-15-87"><a class="lnlinks" href="#hl-15-87"> 87</a>
</span><span class="lnt" id="hl-15-88"><a class="lnlinks" href="#hl-15-88"> 88</a>
</span><span class="lnt" id="hl-15-89"><a class="lnlinks" href="#hl-15-89"> 89</a>
</span><span class="lnt" id="hl-15-90"><a class="lnlinks" href="#hl-15-90"> 90</a>
</span><span class="lnt" id="hl-15-91"><a class="lnlinks" href="#hl-15-91"> 91</a>
</span><span class="lnt" id="hl-15-92"><a class="lnlinks" href="#hl-15-92"> 92</a>
</span><span class="lnt" id="hl-15-93"><a class="lnlinks" href="#hl-15-93"> 93</a>
</span><span class="lnt" id="hl-15-94"><a class="lnlinks" href="#hl-15-94"> 94</a>
</span><span class="lnt" id="hl-15-95"><a class="lnlinks" href="#hl-15-95"> 95</a>
</span><span class="lnt" id="hl-15-96"><a class="lnlinks" href="#hl-15-96"> 96</a>
</span><span class="lnt" id="hl-15-97"><a class="lnlinks" href="#hl-15-97"> 97</a>
</span><span class="lnt" id="hl-15-98"><a class="lnlinks" href="#hl-15-98"> 98</a>
</span><span class="lnt" id="hl-15-99"><a class="lnlinks" href="#hl-15-99"> 99</a>
</span><span class="lnt" id="hl-15-100"><a class="lnlinks" href="#hl-15-100">100</a>
</span><span class="lnt" id="hl-15-101"><a class="lnlinks" href="#hl-15-101">101</a>
</span><span class="lnt" id="hl-15-102"><a class="lnlinks" href="#hl-15-102">102</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.showguan.chapter07_client</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProviderApkActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Kennem&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 所需权限列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">PERMISSIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">REQUEST_INSTALL_PACKAGES</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 请求码，用于权限请求回调标识</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">REQUEST_CODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_provider_apk</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置按钮点击监听</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">btn_install</span><span class="p">).</span><span class="na">setOnClickListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 检查权限并安装APK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">checkAndInstall</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 检查权限并安装APK
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkAndInstall</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;android 11 + &#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 检查是否具有管理所有文件的权限</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Environment</span><span class="p">.</span><span class="na">isExternalStorageManager</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;checkisExternalStorageManager&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 跳转到设置页面请求权限</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Settings</span><span class="p">.</span><span class="na">ACTION_MANAGE_APP_ALL_FILES_ACCESS_PERMISSION</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">intent</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="na">fromParts</span><span class="p">(</span><span class="s">&#34;package&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">getPackageName</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 权限已授予，</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 安装APK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">installApk</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 检查所需权限是否已全部授予</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkPermission</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PERMISSIONS</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_CODE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// 权限已授予，安装APK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">installApk</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 安装APK文件
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">installApk</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 获取APK文件的路径</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">apkPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Environment</span><span class="p">.</span><span class="na">getExternalStoragePublicDirectory</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="na">DIRECTORY_DOWNLOADS</span><span class="p">).</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/chapter06-release.apk&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;apkPath:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">apkPath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 获取应用包管理器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PackageManager</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 获取APK文件的包信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PackageInfo</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm</span><span class="p">.</span><span class="na">getPackageArchiveInfo</span><span class="p">(</span><span class="n">apkPath</span><span class="p">,</span><span class="w"> </span><span class="n">PackageManager</span><span class="p">.</span><span class="na">GET_ACTIVITIES</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pi</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 如果包信息为空，显示文件损坏提示</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ToastUtil</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;安装文件已经损坏!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 获取APK文件的Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">apkPath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 兼容Android 7.0及以上版本，通过FileProvider获取Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 通过FileProvider获取文件的Uri</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileProvider</span><span class="p">.</span><span class="na">getUriForFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">file_provider</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">apkPath</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&#34;Kennem&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;new uri:%s&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">toString</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 创建Intent以启动APK安装程序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_VIEW</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">addFlags</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 设置Uri的数据类型为APK文件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">intent</span><span class="p">.</span><span class="na">setDataAndType</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;application/vnd.android.package-archive&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 启动系统自带的应用安装程序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRequestPermissionsResult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">grantResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onRequestPermissionsResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">grantResults</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 检查权限请求结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requestCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">REQUEST_CODE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">PermissionUtil</span><span class="p">.</span><span class="na">checkGranted</span><span class="p">(</span><span class="n">grantResults</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// 权限已授予，安装APK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">installApk</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="heading"><a hidden class="anchor" aria-hidden="true" href="#heading">#</a></h3>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kennems.github.io/tags/android/">Android</a></li>
    </ul>
        
    
    <ul id="categories">
      
        <li><a href="https://kennems.github.io/categories/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">Android学习笔记</a> </li>
      
    </ul>
    
    
<nav class="paginav">
  <a class="prev" href="https://kennems.github.io/posts/tech/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E9%A1%B9%E7%9B%AE%E5%9F%BA%E4%BA%8E%E5%A4%9A%E7%A7%8D%E6%BB%A4%E6%B3%A2%E5%99%A8%E7%9A%84%E5%9B%BE%E5%83%8F%E5%8E%BB%E5%99%AA%E7%AE%97%E6%B3%95%E6%AF%94%E8%BE%83%E4%B8%8E%E5%88%86%E6%9E%90/">
    <span class="title">« 上一页</span>
    <br>
    <span>《数字图像处理》课程综合项目(Matlab)</span>
  </a>
  <a class="next" href="https://kennems.github.io/posts/tech/android2/">
    <span class="title">下一页 »</span>
    <br>
    <span>Android（2）</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://kennems.github.io/">Kennem&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<footer class="footer">
    <script async src="https://busuanzi.sukap.cn/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        Visitors: <span id="busuanzi_value_page_uv"></span>
        Views: <span id="busuanzi_value_page_pv"></span>

        
    </span>
</footer>



</body>

</html>
