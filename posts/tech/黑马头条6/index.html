<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<meta name="msvalidate.01" content="DF5FE493CC759E62BFE073BEA8EFD472" />
<title>é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰ | Kennem&#39;s Blog</title>
<meta name="keywords" content="Java, Web">
<meta name="description" content="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">
<meta name="author" content="ShowGuan">
<link rel="canonical" href="https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A16/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1a7bc7e6d01b82c8ca2b2e53cfcf7e33d2fd9058f6b28245f94da0d91447c6a0.css" integrity="sha256-GnvH5tAbgsjKKy5Tz89&#43;M9L9kFj2soJF&#43;U2g2RRHxqA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://kennems.github.io/img/sun.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kennems.github.io/img/sun.png">
<link rel="apple-touch-icon" href="https://kennems.github.io/img/sun.png">
<link rel="mask-icon" href="https://kennems.github.io/img/sun.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A16/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>


<link rel="stylesheet" href="https://fonts.cdnfonts.com/css/code-new-roman">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

<meta property="og:url" content="https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A16/">
  <meta property="og:site_name" content="Kennem&#39;s Blog">
  <meta property="og:title" content="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">
  <meta property="og:description" content="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-31T15:37:01+08:00">
    <meta property="article:modified_time" content="2025-01-31T15:37:01+08:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">
<meta name="twitter:description" content="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://kennems.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ’»æŠ€æœ¯",
      "item": "https://kennems.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰",
      "item": "https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A16/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰",
  "name": "é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰",
  "description": "é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰",
  "keywords": [
    "Java", "Web"
  ],
  "articleBody": "é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰ Kafkaæ¦‚è¿° æ¶ˆæ¯ä¸­é—´ä»¶ å»ºè®® Kafka è¿½æ±‚é«˜ååé‡ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ RocketMQ å¯å¯é æ€§è¦æ±‚å¾ˆé«˜çš„é‡‘èäº’è”ç½‘é¢†åŸŸï¼Œç¨³å®šæ€§é«˜ï¼Œç»å†äº†å¤šæ¬¡é˜¿é‡ŒåŒ11è€ƒéªŒ RabbitMQ æ€§èƒ½è¾ƒå¥½ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼Œæ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„RabbitMQ Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµåª’ä½“å¹³å°ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¼ä¸šæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ\nproducer : å‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¸ºä¸»é¢˜ç”Ÿäº§è€…ï¼ˆKafka topic producerï¼‰ topic: Kafkaå°†æ¶ˆæ¯åˆ†é—¨åˆ«ç±»ï¼Œæ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰ consumerï¼šè®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ brokerï¼šå·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ã€‚ ç¯å¢ƒå‡†å¤‡ zookeeperå‡†å¤‡ 1 docker pull zookeeper:3.4.14 1 docker run -d --name zookeeper -p 2181:2181 zookeeper:3.4.14 Kafkaå‡†å¤‡ 1 docker pull wurstmeister/kafka:2.12-2.3.1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¯åŠ¨ä¸€ä¸ªæ–°çš„ Kafka å®¹å™¨ï¼ŒæŒ‡å®šå®¹å™¨åç§°ä¸º kafka docker run -d --name kafka \\ # è®¾ç½® Kafka å¹¿æ’­çš„ä¸»æœºåï¼Œä»¥ä¾¿å…¶ä»– Kafka å®¢æˆ·ç«¯èƒ½å¤Ÿè¿æ¥åˆ°æ­¤ä¸»æœº --env KAFKA_ADVERTISED_HOST_NAME=192.168.200.130 \\ # è®¾ç½® Kafka è¿æ¥çš„ ZooKeeper åœ°å€ï¼ŒZooKeeper æ˜¯ Kafka çš„åè°ƒæœåŠ¡ --env KAFKA_ZOOKEEPER_CONNECT=192.168.200.130:2181 \\ # è®¾ç½® Kafka å‘å¤–ç•Œå¹¿æ’­çš„ç›‘å¬åœ°å€ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€ --env KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.200.130:9092 \\ # è®¾ç½® Kafka æœ¬åœ°çš„ç›‘å¬åœ°å€ï¼ŒKafka ç›‘å¬åœ¨æ‰€æœ‰çš„ç½‘ç»œæ¥å£ä¸Š --env KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 \\ # è®¾ç½® Kafka è¿›ç¨‹çš„ Java å †å†…å­˜å‚æ•°ï¼Œåˆ†é…æœ€å¤§256Må’Œæœ€å°256Må†…å­˜ --env KAFKA_HEAP_OPTS=\"-Xmx256M -Xms256M\" \\ # è®¾ç½®ç½‘ç»œæ¨¡å¼ä¸ºä¸»æœºæ¨¡å¼ï¼Œå®¹å™¨å°†ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œé…ç½® --net host \\ # ä½¿ç”¨ wurstmeister/kafka é•œåƒï¼Œå¹¶æŒ‡å®šç‰ˆæœ¬ä¸º 2.12-2.3.1 wurstmeister/kafka:2.12-2.3.1 å…¥é—¨ ConsumerQuickStart.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public class ConsumerQuickStart { public static void main(String[] args) { Properties properties = new Properties(); properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"192.168.200.130:9092\"); properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\"); properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\"); properties.put(ConsumerConfig.GROUP_ID_CONFIG, \"group2\"); KafkaConsumer\u003cString, String\u003e consumer = new KafkaConsumer(properties); consumer.subscribe(Collections.singletonList(\"topic-first\")); while (true) { ConsumerRecords\u003cString, String\u003e consumerRecords = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord\u003cString, String\u003e consumerRecord : consumerRecords) { System.out.println(consumerRecord.key()); System.out.println(consumerRecord.value()); } } } } ProducerQuickStart.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class ProducerQuickStart { public static void main(String[] args) { Properties properties = new Properties(); properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"192.168.200.130:9092\"); properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\"); properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\"); // åˆ›å»ºkafkaç”Ÿäº§è€…å¯¹è±¡ KafkaProducer\u003cString, String\u003e producer = new KafkaProducer\u003cString, String\u003e(properties); ProducerRecord\u003cString, String\u003e kvProducerRecord = new ProducerRecord\u003c\u003e(\"topic-first\", \"key-001\", \"hello kafka\"); producer.send(kvProducerRecord); // å…³é—­é€šé“ï¼Œå¿…é¡»å…³é—­å¦åˆ™å‘é€ä¸æˆåŠŸ producer.close(); } } æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼ˆä¸€å¯¹å¤šï¼‰\n1 properties.put(ConsumerConfig.GROUP_ID_CONFIG, \"group2\"); åˆ†åŒºç­–ç•¥ Kafkaä¸­çš„åˆ†åŒºæœºåˆ¶æŒ‡çš„æ˜¯å°†æ¯ä¸ªä¸»é¢˜åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼ˆPartition)\nå¯ä»¥å¤„ç†æ›´å¤šçš„æ¶ˆæ¯ï¼Œä¸å—å•å°æœåŠ¡å™¨çš„é™åˆ¶ï¼Œå¯ä»¥ä¸å—é™çš„å¤„ç†æ›´å¤šæ˜¯æ•°æ®\nåˆ†åŒºç­–ç•¥ è¯´æ˜ è½®è¯¢ç­–ç•¥ æŒ‰é¡ºåºè½®æµå°†æ¯æ¡æ•°æ®åˆ†é…åˆ°æ¯ä¸ªåˆ†åŒºä¸­ éšæœºç­–ç•¥ æ¯æ¬¡éƒ½éšæœºåœ°å°†æ¶ˆæ¯åˆ†é…åˆ°æ¯ä¸ªåˆ†åŒº æŒ‰é”®ä¿å­˜ç­–ç•¥ ç”Ÿäº§è€…å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªkeyï¼Œè®¡ç®—è¿™ä¸ªkeyçš„hashCodeå€¼ï¼ŒæŒ‰ç…§hashCodeçš„å€¼å¯¹ä¸åŒæ¶ˆæ¯è¿›è¡Œå­˜å‚¨ â­Kafkaé«˜å¯ç”¨è®¾è®¡ é›†ç¾¤ Kafkaçš„æœåŠ¡ç«¯ç”±è¢«ç§°ä¸ºBrokerçš„æœåŠ¡è¿›ç¨‹æ„æˆï¼Œå³ä¸€ä¸ªKafkaé›†ç¾¤ç”±å¤šä¸ªBrokerç»„æˆ è¿™æ ·å¦‚æœé›†ç¾¤ä¸­æŸä¸€å°æœºå™¨å®•æœºï¼Œå…¶ä»–æœºå™¨ä¸Šçš„Brokerä¾ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰- åŒæ­¥æ–¹å¼ Kafkaä¸­çš„æ¶ˆæ¯çš„å¤‡ä»½åˆå«åšå‰¯æœ¬ ï¼ˆReplicaï¼‰\nKafkaå®šä¹‰äº†ä¸¤ç±»å‰¯æœ¬ï¼š\né¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰ è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰ è¿½éšè€…å‰¯æœ¬åˆåˆ†ä¸ºä¸¤ç±»ï¼š\nISRï¼ˆin-sync replicaï¼‰éœ€è¦åŒæ­¥å¤åˆ¶ä¿å­˜çš„follower æ™®é€šå‰¯æœ¬ï¼Œå¼‚æ­¥å¤åˆ¶ä¿å­˜ å¦‚æœ leader å¤±æ•ˆåï¼Œéœ€è¦é€‰å‡ºæ–°çš„leaderï¼Œé€‰ä¸¾çš„åŸåˆ™å¦‚ä¸‹ï¼š\nç¬¬ä¸€ï¼šé€‰ä¸¾æ—¶ä¼˜å…ˆä»ISRä¸­é€‰å®šï¼Œå› ä¸ºè¿™ä¸ªåˆ—è¡¨ä¸­followerçš„æ•°æ®æ˜¯ä¸leaderåŒæ­¥çš„ã€‚\nç¬¬äºŒï¼šå¦‚æœISRåˆ—è¡¨ä¸­çš„followeréƒ½ä¸è¡Œäº†ï¼Œå°±åªèƒ½ä»å…¶ä»–followerä¸­é€‰å–ã€‚\næç«¯æƒ…å†µä¸‹-æ‰€æœ‰å‰¯æœ¬éƒ½å¤±æ•ˆäº†ï¼Œä¸¤ç§æ–¹æ¡ˆ\nç¬¬ä¸€ï¼šç­‰å¾…ISRä¸­çš„ä¸€ä¸ªæ´»è¿‡æ¥ï¼Œé€‰ä¸ºLeaderï¼Œæ•°æ®å¯é ï¼Œä½†æ´»è¿‡æ¥çš„æ—¶é—´ä¸ç¡®å®š ç¬¬äºŒï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªæ´»è¿‡æ¥çš„Replicationï¼Œä¸ä¸€å®šæ˜¯ISRä¸­çš„ï¼Œé€‰ä¸ºleaderï¼Œä»¥æœ€å¿«é€Ÿåº¦æ¢å¤å¯ç”¨æ€§ï¼Œä½†æ•°æ®ä¸ä¸€å®šå®Œæ•´ã€‚ Kafkaç”Ÿäº§è€…è¯¦è§£ å‘é€ç±»å‹ åŒæ­¥å‘é€ ä½¿ç”¨send()æ–¹å¼å‘é€ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè°ƒç”¨get()æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå°±å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸ\n1 2 3 // åŒæ­¥æ–¹å¼ä¼šäº§ç”Ÿé˜»å¡ RecordMetadata recordMetadata = producer.send(kvProducerRecord).get(); System.out.println(recordMetadata.offset()); å¼‚æ­¥å‘é€ 1 2 3 4 5 6 7 // å¼‚æ­¥å‘é€æ¶ˆæ¯ producer.send(kvProducerRecord, (recordMetadata1, e) -\u003e { if (e != null) { System.out.println(\"è®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ—¥å¿—è¡¨ä¸­\"); } System.out.println(recordMetadata1.offset()); }); å‚æ•°è¯¦è§£ ack ç¡®è®¤æœºåˆ¶ è¯´æ˜ acks = 0 ç”Ÿäº§è€…åœ¨æˆåŠŸå†™å…¥æ¶ˆæ¯ä¹‹å‰ä¸ä¼šç­‰å¾…ä»»ä½•æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ï¼Œæ¶ˆæ¯æœ‰ä¸¢å¤±çš„é£é™©ï¼Œä½†æ˜¯é€Ÿåº¦æœ€å¿« acks = 1 ï¼ˆé»˜è®¤å€¼ï¼‰ åªè¦é›†ç¾¤é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº” acks = all åªæœ‰å½“æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹å…¨éƒ¨æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ‰ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº” retries ç”Ÿäº§è€…ä»æœåŠ¡å™¨æ”¶åˆ°çš„é”™è¯¯æœ‰å¯èƒ½æ—¶ä¸´æ—¶æ€§é”™è¯¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œretrieså‚æ•°çš„å€¼å†³å®šäº†ç”Ÿäº§è€…å¯ä»¥é‡å‘æ¶ˆæ¯çš„æ¬¡æ•°ï¼Œå¦‚æœè¾¾åˆ°è¿™ä¸ªæ¬¡æ•°ï¼Œç”Ÿäº§è€…ä¼šæ”¾å¼ƒé‡è¯•è¿”å›é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ä¼šåœ¨æ¯æ¬¡é‡è¯•ä¹‹é—´ç­‰å¾…100ms\n1 prop.put(ProducerConfig.RETRIES_CONFIG, 10); æ¶ˆæ¯å‹ç¼© é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å‘é€æ—¶ä¸ä¼šè¢«å‹ç¼©\n1 properties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, \"gzip\"); å‹ç¼©ç®—æ³• è¯´æ˜ snappy å ç”¨è¾ƒå°‘çš„ CPUï¼Œä½†èƒ½å¤Ÿæä¾›è¾ƒå¥½çš„æ€§èƒ½å’Œç›¸å½“å¯è§‚çš„å‹ç¼©æ¯”ã€‚å¦‚æœçœ‹é‡æ€§èƒ½å’Œç½‘ç»œå¸¦å®½ï¼Œå»ºè®®é‡‡ç”¨ã€‚ lz4 å ç”¨è¾ƒå°‘çš„ CPUï¼Œå‹ç¼©å’Œè§£å‹ç¼©é€Ÿåº¦è¾ƒå¿«ï¼Œå‹ç¼©æ¯”ä¹Ÿå¾ˆå¯è§‚ã€‚ gzip å ç”¨è¾ƒå¤šçš„ CPUï¼Œä½†ä¼šæä¾›æ›´é«˜çš„å‹ç¼©æ¯”ï¼Œç½‘ç»œå¸¦å®½æœ‰é™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§ç®—æ³•ã€‚ ä½¿ç”¨å‹ç¼©å¯ä»¥é™ä½ç½‘ç»œä¼ è¾“å¼€é”€å’Œå­˜å‚¨å¼€é”€ï¼Œè€Œè¿™å¾€å¾€æ—¶å‘Kafkaå‘é€æ¶ˆæ¯çš„ç“¶é¢ˆæ‰€åœ¨ã€‚\nKafkaæ¶ˆè´¹è€…è¯¦è§£ æ¶ˆè´¹è€…ç»„ æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šæŒ‡çš„å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„ç¾¤ä½“ ä¸€ä¸ªå‘å¸ƒåœ¨Topicä¸Šæ¶ˆæ¯è¢«åˆ†å‘ç»™æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€… æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æˆäº†queueæ¨¡å‹ æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸åŒçš„ç»„ä¸­ï¼Œé‚£ä¹ˆå°±å®Œå…¨æˆç«‹å‘å¸ƒ-è®¢é˜…æ¨¡å‹ æ¶ˆæ¯æœ‰åºæ€§ topicåˆ†åŒºä¸­æ¶ˆæ¯åªèƒ½ç”±æ¶ˆè´¹è€…ä¸­çš„å”¯ä¸€ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œæ‰€ä»¥æ¶ˆæ¯æ˜¯æŒ‰ç…§å…ˆåé¡ºåºè¿›è¡Œå¤„ç†çš„ã€‚ä½†æ˜¯å…¶ä»…ä»…ä¿è¯Topicçš„ä¸€ä¸ªåˆ†åŒºé¡ºåºå¤„ç†ï¼Œä¸èƒ½ä¿è¯è·¨åˆ†åŒºçš„æ¶ˆæ¯å…ˆåå¤„ç†é¡ºåºã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦é¡ºåºçš„å¤„ç†Topicçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé‚£å°±åªæä¾›ä¸€ä¸ªåˆ†åŒº\næäº¤å’Œåç§»é‡ kafkaä¸ä¼šåƒå…¶ä»– JMS é˜Ÿåˆ—é‚£æ ·éœ€è¦å¾—åˆ°æ¶ˆè´¹è€…çš„ç¡®è®¤ï¼Œæ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨\nkafka æ¥è¿½è¸ªæ¶ˆæ¯åœ¨åˆ†åŒºçš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼Œæ¶ˆè´¹è€…ä¼šå¾€ä¸€ä¸ªå«åš_consumer_offsetçš„ç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«äº†æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ã€‚å¦‚æœæ¶ˆè´¹è€…å‘ç”Ÿå´©æºƒæˆ–æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥ç¾¤ç»„ï¼Œå°±ä¼šè§¦å‘å†å‡è¡¡ã€‚\nåç§»é‡æäº¤æ–¹å¼ è‡ªåŠ¨æäº¤åç§»é‡ å½“enable.auto.commitè¢«è®¾ç½®ä¸ºtrueï¼Œæäº¤æ–¹å¼å°±æ˜¯è®©æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤åç§»é‡ï¼Œæ¯éš”5ç§’æ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æŠŠä»poll()æ–¹æ³•æ¥å—çš„æœ€å¤§åç§»é‡æäº¤ä¸Šå»\næ‰‹åŠ¨æäº¤ å½“enable.auto.commitè¢«è®¾ç½®æœªfalseå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§æäº¤æ–¹å¼\næäº¤å½“å‰åç§»é‡ï¼ˆåŒæ­¥æäº¤ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 while (true) { ConsumerRecords\u003cString, String\u003e consumerRecords = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord\u003cString, String\u003e consumerRecord : consumerRecords) { System.out.println(consumerRecord.key()); System.out.println(consumerRecord.value()); System.out.println(consumerRecord.offset()); System.out.println(consumerRecord.partition()); try{ // åŒæ­¥æäº¤åç§»é‡ consumer.commitSync(); }catch (CommitFailedException e){ System.out.println(\"è®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ—¥å¿—è¡¨ä¸­, å¼‚å¸¸ï¼š\" + e); } } } å¼‚æ­¥æäº¤ å¯èƒ½å¯¼è‡´åç§»é‡è¦†ç›–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 while (true) { ConsumerRecords\u003cString, String\u003e consumerRecords = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord\u003cString, String\u003e consumerRecord : consumerRecords) { System.out.println(consumerRecord.key()); System.out.println(consumerRecord.value()); System.out.println(consumerRecord.offset()); System.out.println(consumerRecord.partition()); // å¼‚æ­¥æ–¹å¼æäº¤åç§»é‡ consumer.commitAsync(new OffsetCommitCallback() { @Override public void onComplete(Map\u003cTopicPartition, OffsetAndMetadata\u003e map, Exception e) { if (e != null) { System.out.println(\"è®°å½•é”™è¯¯çš„æäº¤åç§»é‡ \" + map + \", å¼‚å¸¸ä¿¡æ¯ä¸º \" + e); } } }); } åŒæ­¥å’Œå¼‚æ­¥ç»„åˆæäº¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å¼‚æ­¥å’ŒåŒæ­¥æäº¤åç§»é‡åŒæ—¶ä½¿ç”¨ try { while (true) { ConsumerRecords\u003cString, String\u003e consumerRecords = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord\u003cString, String\u003e consumerRecord : consumerRecords) { System.out.println(consumerRecord.key()); System.out.println(consumerRecord.value()); System.out.println(consumerRecord.offset()); System.out.println(consumerRecord.partition()); } consumer.commitAsync(); } } catch (Exception e) { e.printStackTrace(); System.out.println(\"è®°å½•é”™è¯¯çš„ä¿¡æ¯\" + e); } finally { // åŒæ­¥æäº¤åç§»é‡ consumer.commitSync(); } ",
  "wordCount" : "3021",
  "inLanguage": "zh",
  "datePublished": "2025-01-31T15:37:01+08:00",
  "dateModified": "2025-01-31T15:37:01+08:00",
  "author":{
    "@type": "Person",
    "name": "ShowGuan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kennems.github.io/posts/tech/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A16/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kennem's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kennems.github.io/img/sun.png"
    }
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>




</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kennems.github.io/" accesskey="h" title="Kennem&#39;s Blog (Alt + H)">
                <img src="https://kennems.github.io/img/sun.png" alt="" aria-label="logo"
                    height="35">Kennem&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://kennems.github.io/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/archives" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/categories" title="ğŸ—‚ï¸åˆ†ç±»">
                    <span>ğŸ—‚ï¸åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://kennems.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://kennems.github.io/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://kennems.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://kennems.github.io/posts/tech/">ğŸ’»æŠ€æœ¯</a></div>
    <h1 class="post-title entry-hint-parent">
      é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰
    </h1>
    <div class="post-description">
      é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰
    </div>
    <div class="post-meta"><span title='2025-01-31 15:37:01 +0800 CST'>2025-01-31</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;3021 å­—&nbsp;Â·&nbsp;updated:&nbsp;2025-01-31&nbsp;Â·&nbsp;ShowGuan

</div>
    
     <div class="post-password">
        
    </div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e9%bb%91%e9%a9%ac%e5%a4%b4%e6%9d%a16" aria-label="é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰">é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰</a><ul>
                            
                    <li>
                        <a href="#kafka%e6%a6%82%e8%bf%b0" aria-label="Kafkaæ¦‚è¿°">Kafkaæ¦‚è¿°</a></li>
                    <li>
                        <a href="#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87" aria-label="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</a><ul>
                            
                    <li>
                        <a href="#zookeeper%e5%87%86%e5%a4%87" aria-label="zookeeperå‡†å¤‡">zookeeperå‡†å¤‡</a></li>
                    <li>
                        <a href="#kafka%e5%87%86%e5%a4%87" aria-label="Kafkaå‡†å¤‡">Kafkaå‡†å¤‡</a></li>
                    <li>
                        <a href="#%e5%85%a5%e9%97%a8" aria-label="å…¥é—¨">å…¥é—¨</a><ul>
                            
                    <li>
                        <a href="#consumerquickstartjava" aria-label="ConsumerQuickStart.java">ConsumerQuickStart.java</a></li>
                    <li>
                        <a href="#producerquickstartjava" aria-label="ProducerQuickStart.java">ProducerQuickStart.java</a><ul>
                            
                    <li>
                        <a href="#%e6%89%80%e6%ac%b2%e6%b6%88%e8%b4%b9%e8%80%85%e9%83%bd%e8%83%bd%e6%94%b6%e5%88%b0%e6%b6%88%e6%81%af" aria-label="æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯">æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯</a></li></ul>
                    </li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e5%88%86%e5%8c%ba%e7%ad%96%e7%95%a5" aria-label="åˆ†åŒºç­–ç•¥">åˆ†åŒºç­–ç•¥</a></li>
                    <li>
                        <a href="#kafka%e9%ab%98%e5%8f%af%e7%94%a8%e8%ae%be%e8%ae%a1" aria-label="â­Kafkaé«˜å¯ç”¨è®¾è®¡">â­Kafkaé«˜å¯ç”¨è®¾è®¡</a><ul>
                            
                    <li>
                        <a href="#%e9%9b%86%e7%be%a4" aria-label="é›†ç¾¤">é›†ç¾¤</a></li>
                    <li>
                        <a href="#%e5%a4%87%e4%bb%bd%e6%9c%ba%e5%88%b6replication--%e5%90%8c%e6%ad%a5%e6%96%b9%e5%bc%8f" aria-label="å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰- åŒæ­¥æ–¹å¼">å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰- åŒæ­¥æ–¹å¼</a></li></ul>
                    </li>
                    <li>
                        <a href="#kafka%e7%94%9f%e4%ba%a7%e8%80%85%e8%af%a6%e8%a7%a3" aria-label="Kafkaç”Ÿäº§è€…è¯¦è§£">Kafkaç”Ÿäº§è€…è¯¦è§£</a><ul>
                            
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e7%b1%bb%e5%9e%8b" aria-label="å‘é€ç±»å‹">å‘é€ç±»å‹</a></li>
                    <li>
                        <a href="#%e5%8f%82%e6%95%b0%e8%af%a6%e8%a7%a3" aria-label="å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£</a><ul>
                            
                    <li>
                        <a href="#ack" aria-label="ack">ack</a></li>
                    <li>
                        <a href="#retries" aria-label="retries">retries</a></li>
                    <li>
                        <a href="#%e6%b6%88%e6%81%af%e5%8e%8b%e7%bc%a9" aria-label="æ¶ˆæ¯å‹ç¼©">æ¶ˆæ¯å‹ç¼©</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#kafka%e6%b6%88%e8%b4%b9%e8%80%85%e8%af%a6%e8%a7%a3" aria-label="Kafkaæ¶ˆè´¹è€…è¯¦è§£">Kafkaæ¶ˆè´¹è€…è¯¦è§£</a><ul>
                            
                    <li>
                        <a href="#%e6%b6%88%e8%b4%b9%e8%80%85%e7%bb%84" aria-label="æ¶ˆè´¹è€…ç»„">æ¶ˆè´¹è€…ç»„</a></li>
                    <li>
                        <a href="#%e6%b6%88%e6%81%af%e6%9c%89%e5%ba%8f%e6%80%a7" aria-label="æ¶ˆæ¯æœ‰åºæ€§">æ¶ˆæ¯æœ‰åºæ€§</a></li>
                    <li>
                        <a href="#%e6%8f%90%e4%ba%a4%e5%92%8c%e5%81%8f%e7%a7%bb%e9%87%8f" aria-label="æäº¤å’Œåç§»é‡">æäº¤å’Œåç§»é‡</a></li>
                    <li>
                        <a href="#%e5%81%8f%e7%a7%bb%e9%87%8f%e6%8f%90%e4%ba%a4%e6%96%b9%e5%bc%8f" aria-label="åç§»é‡æäº¤æ–¹å¼">åç§»é‡æäº¤æ–¹å¼</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="é»‘é©¬å¤´æ¡6">é»‘é©¬å¤´æ¡ï¼ˆ6ï¼‰<a hidden class="anchor" aria-hidden="true" href="#é»‘é©¬å¤´æ¡6">#</a></h1>
<h2 id="kafkaæ¦‚è¿°">Kafkaæ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#kafkaæ¦‚è¿°">#</a></h2>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯ä¸­é—´ä»¶</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kafka</td>
<td>è¿½æ±‚é«˜ååé‡ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡</td>
</tr>
<tr>
<td>RocketMQ</td>
<td>å¯å¯é æ€§è¦æ±‚å¾ˆé«˜çš„é‡‘èäº’è”ç½‘é¢†åŸŸï¼Œç¨³å®šæ€§é«˜ï¼Œç»å†äº†å¤šæ¬¡é˜¿é‡ŒåŒ11è€ƒéªŒ</td>
</tr>
<tr>
<td>RabbitMQ</td>
<td>æ€§èƒ½è¾ƒå¥½ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼Œæ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„RabbitMQ</td>
</tr>
</tbody>
</table>
<p>Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµåª’ä½“å¹³å°ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—æˆ–ä¼ä¸šæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ</p>
<ul>
<li>producer : å‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¸ºä¸»é¢˜ç”Ÿäº§è€…ï¼ˆKafka topic producerï¼‰</li>
<li>topic: Kafkaå°†æ¶ˆæ¯åˆ†é—¨åˆ«ç±»ï¼Œæ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰</li>
<li>consumerï¼šè®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰</li>
<li>brokerï¼šå·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ã€‚</li>
</ul>
<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#ç¯å¢ƒå‡†å¤‡">#</a></h2>
<h3 id="zookeeperå‡†å¤‡">zookeeperå‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#zookeeperå‡†å¤‡">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker pull zookeeper:3.4.14
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker run -d --name zookeeper -p 2181:2181 zookeeper:3.4.14
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="kafkaå‡†å¤‡">Kafkaå‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#kafkaå‡†å¤‡">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-2-1"><a class="lnlinks" href="#hl-2-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull wurstmeister/kafka:2.12-2.3.1
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-3-1"><a class="lnlinks" href="#hl-3-1"> 1</a>
</span><span class="lnt" id="hl-3-2"><a class="lnlinks" href="#hl-3-2"> 2</a>
</span><span class="lnt" id="hl-3-3"><a class="lnlinks" href="#hl-3-3"> 3</a>
</span><span class="lnt" id="hl-3-4"><a class="lnlinks" href="#hl-3-4"> 4</a>
</span><span class="lnt" id="hl-3-5"><a class="lnlinks" href="#hl-3-5"> 5</a>
</span><span class="lnt" id="hl-3-6"><a class="lnlinks" href="#hl-3-6"> 6</a>
</span><span class="lnt" id="hl-3-7"><a class="lnlinks" href="#hl-3-7"> 7</a>
</span><span class="lnt" id="hl-3-8"><a class="lnlinks" href="#hl-3-8"> 8</a>
</span><span class="lnt" id="hl-3-9"><a class="lnlinks" href="#hl-3-9"> 9</a>
</span><span class="lnt" id="hl-3-10"><a class="lnlinks" href="#hl-3-10">10</a>
</span><span class="lnt" id="hl-3-11"><a class="lnlinks" href="#hl-3-11">11</a>
</span><span class="lnt" id="hl-3-12"><a class="lnlinks" href="#hl-3-12">12</a>
</span><span class="lnt" id="hl-3-13"><a class="lnlinks" href="#hl-3-13">13</a>
</span><span class="lnt" id="hl-3-14"><a class="lnlinks" href="#hl-3-14">14</a>
</span><span class="lnt" id="hl-3-15"><a class="lnlinks" href="#hl-3-15">15</a>
</span><span class="lnt" id="hl-3-16"><a class="lnlinks" href="#hl-3-16">16</a>
</span><span class="lnt" id="hl-3-17"><a class="lnlinks" href="#hl-3-17">17</a>
</span><span class="lnt" id="hl-3-18"><a class="lnlinks" href="#hl-3-18">18</a>
</span><span class="lnt" id="hl-3-19"><a class="lnlinks" href="#hl-3-19">19</a>
</span><span class="lnt" id="hl-3-20"><a class="lnlinks" href="#hl-3-20">20</a>
</span><span class="lnt" id="hl-3-21"><a class="lnlinks" href="#hl-3-21">21</a>
</span><span class="lnt" id="hl-3-22"><a class="lnlinks" href="#hl-3-22">22</a>
</span><span class="lnt" id="hl-3-23"><a class="lnlinks" href="#hl-3-23">23</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ä¸€ä¸ªæ–°çš„ Kafka å®¹å™¨ï¼ŒæŒ‡å®šå®¹å™¨åç§°ä¸º kafka</span>
</span></span><span class="line"><span class="cl">docker run -d --name kafka <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½® Kafka å¹¿æ’­çš„ä¸»æœºåï¼Œä»¥ä¾¿å…¶ä»– Kafka å®¢æˆ·ç«¯èƒ½å¤Ÿè¿æ¥åˆ°æ­¤ä¸»æœº</span>
</span></span><span class="line"><span class="cl">  --env <span class="nv">KAFKA_ADVERTISED_HOST_NAME</span><span class="o">=</span>192.168.200.130 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½® Kafka è¿æ¥çš„ ZooKeeper åœ°å€ï¼ŒZooKeeper æ˜¯ Kafka çš„åè°ƒæœåŠ¡</span>
</span></span><span class="line"><span class="cl">  --env <span class="nv">KAFKA_ZOOKEEPER_CONNECT</span><span class="o">=</span>192.168.200.130:2181 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½® Kafka å‘å¤–ç•Œå¹¿æ’­çš„ç›‘å¬åœ°å€ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€</span>
</span></span><span class="line"><span class="cl">  --env <span class="nv">KAFKA_ADVERTISED_LISTENERS</span><span class="o">=</span>PLAINTEXT://192.168.200.130:9092 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½® Kafka æœ¬åœ°çš„ç›‘å¬åœ°å€ï¼ŒKafka ç›‘å¬åœ¨æ‰€æœ‰çš„ç½‘ç»œæ¥å£ä¸Š</span>
</span></span><span class="line"><span class="cl">  --env <span class="nv">KAFKA_LISTENERS</span><span class="o">=</span>PLAINTEXT://0.0.0.0:9092 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½® Kafka è¿›ç¨‹çš„ Java å †å†…å­˜å‚æ•°ï¼Œåˆ†é…æœ€å¤§256Må’Œæœ€å°256Må†…å­˜</span>
</span></span><span class="line"><span class="cl">  --env <span class="nv">KAFKA_HEAP_OPTS</span><span class="o">=</span><span class="s2">&#34;-Xmx256M -Xms256M&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¾ç½®ç½‘ç»œæ¨¡å¼ä¸ºä¸»æœºæ¨¡å¼ï¼Œå®¹å™¨å°†ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œé…ç½®</span>
</span></span><span class="line"><span class="cl">  --net host <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  
</span></span><span class="line"><span class="cl">  <span class="c1"># ä½¿ç”¨ wurstmeister/kafka é•œåƒï¼Œå¹¶æŒ‡å®šç‰ˆæœ¬ä¸º 2.12-2.3.1</span>
</span></span><span class="line"><span class="cl">  wurstmeister/kafka:2.12-2.3.1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å…¥é—¨">å…¥é—¨<a hidden class="anchor" aria-hidden="true" href="#å…¥é—¨">#</a></h3>
<h4 id="consumerquickstartjava">ConsumerQuickStart.java<a hidden class="anchor" aria-hidden="true" href="#consumerquickstartjava">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-4-1"><a class="lnlinks" href="#hl-4-1"> 1</a>
</span><span class="lnt" id="hl-4-2"><a class="lnlinks" href="#hl-4-2"> 2</a>
</span><span class="lnt" id="hl-4-3"><a class="lnlinks" href="#hl-4-3"> 3</a>
</span><span class="lnt" id="hl-4-4"><a class="lnlinks" href="#hl-4-4"> 4</a>
</span><span class="lnt" id="hl-4-5"><a class="lnlinks" href="#hl-4-5"> 5</a>
</span><span class="lnt" id="hl-4-6"><a class="lnlinks" href="#hl-4-6"> 6</a>
</span><span class="lnt" id="hl-4-7"><a class="lnlinks" href="#hl-4-7"> 7</a>
</span><span class="lnt" id="hl-4-8"><a class="lnlinks" href="#hl-4-8"> 8</a>
</span><span class="lnt" id="hl-4-9"><a class="lnlinks" href="#hl-4-9"> 9</a>
</span><span class="lnt" id="hl-4-10"><a class="lnlinks" href="#hl-4-10">10</a>
</span><span class="lnt" id="hl-4-11"><a class="lnlinks" href="#hl-4-11">11</a>
</span><span class="lnt" id="hl-4-12"><a class="lnlinks" href="#hl-4-12">12</a>
</span><span class="lnt" id="hl-4-13"><a class="lnlinks" href="#hl-4-13">13</a>
</span><span class="lnt" id="hl-4-14"><a class="lnlinks" href="#hl-4-14">14</a>
</span><span class="lnt" id="hl-4-15"><a class="lnlinks" href="#hl-4-15">15</a>
</span><span class="lnt" id="hl-4-16"><a class="lnlinks" href="#hl-4-16">16</a>
</span><span class="lnt" id="hl-4-17"><a class="lnlinks" href="#hl-4-17">17</a>
</span><span class="lnt" id="hl-4-18"><a class="lnlinks" href="#hl-4-18">18</a>
</span><span class="lnt" id="hl-4-19"><a class="lnlinks" href="#hl-4-19">19</a>
</span><span class="lnt" id="hl-4-20"><a class="lnlinks" href="#hl-4-20">20</a>
</span><span class="lnt" id="hl-4-21"><a class="lnlinks" href="#hl-4-21">21</a>
</span><span class="lnt" id="hl-4-22"><a class="lnlinks" href="#hl-4-22">22</a>
</span><span class="lnt" id="hl-4-23"><a class="lnlinks" href="#hl-4-23">23</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumerQuickStart</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;192.168.200.130:9092&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;org.apache.kafka.common.serialization.StringDeserializer&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;org.apache.kafka.common.serialization.StringDeserializer&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">GROUP_ID_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;group2&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaConsumer</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">consumer</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&#34;topic-first&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="n">1000</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecord</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">consumerRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">key</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="producerquickstartjava">ProducerQuickStart.java<a hidden class="anchor" aria-hidden="true" href="#producerquickstartjava">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-5-1"><a class="lnlinks" href="#hl-5-1"> 1</a>
</span><span class="lnt" id="hl-5-2"><a class="lnlinks" href="#hl-5-2"> 2</a>
</span><span class="lnt" id="hl-5-3"><a class="lnlinks" href="#hl-5-3"> 3</a>
</span><span class="lnt" id="hl-5-4"><a class="lnlinks" href="#hl-5-4"> 4</a>
</span><span class="lnt" id="hl-5-5"><a class="lnlinks" href="#hl-5-5"> 5</a>
</span><span class="lnt" id="hl-5-6"><a class="lnlinks" href="#hl-5-6"> 6</a>
</span><span class="lnt" id="hl-5-7"><a class="lnlinks" href="#hl-5-7"> 7</a>
</span><span class="lnt" id="hl-5-8"><a class="lnlinks" href="#hl-5-8"> 8</a>
</span><span class="lnt" id="hl-5-9"><a class="lnlinks" href="#hl-5-9"> 9</a>
</span><span class="lnt" id="hl-5-10"><a class="lnlinks" href="#hl-5-10">10</a>
</span><span class="lnt" id="hl-5-11"><a class="lnlinks" href="#hl-5-11">11</a>
</span><span class="lnt" id="hl-5-12"><a class="lnlinks" href="#hl-5-12">12</a>
</span><span class="lnt" id="hl-5-13"><a class="lnlinks" href="#hl-5-13">13</a>
</span><span class="lnt" id="hl-5-14"><a class="lnlinks" href="#hl-5-14">14</a>
</span><span class="lnt" id="hl-5-15"><a class="lnlinks" href="#hl-5-15">15</a>
</span><span class="lnt" id="hl-5-16"><a class="lnlinks" href="#hl-5-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProducerQuickStart</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;192.168.200.130:9092&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;org.apache.kafka.common.serialization.StringSerializer&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;org.apache.kafka.common.serialization.StringSerializer&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// åˆ›å»ºkafkaç”Ÿäº§è€…å¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kvProducerRecord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProducerRecord</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&#34;topic-first&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;key-001&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello kafka&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">kvProducerRecord</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// å…³é—­é€šé“ï¼Œå¿…é¡»å…³é—­å¦åˆ™å‘é€ä¸æˆåŠŸ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131160202732.png">
            <img src="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131160202732.png" alt="image-20250131160202732"  />
        </a>
    </div>
</p>
<h5 id="æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯">æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯<a hidden class="anchor" aria-hidden="true" href="#æ‰€æ¬²æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯">#</a></h5>
<p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼ˆä¸€å¯¹å¤šï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-6-1"><a class="lnlinks" href="#hl-6-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">      </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ConsumerConfig</span><span class="p">.</span><span class="na">GROUP_ID_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;group2&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131160214855.png">
            <img src="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131160214855.png" alt="image-20250131160214855"  />
        </a>
    </div>
</p>
<h2 id="åˆ†åŒºç­–ç•¥">åˆ†åŒºç­–ç•¥<a hidden class="anchor" aria-hidden="true" href="#åˆ†åŒºç­–ç•¥">#</a></h2>
<p>Kafkaä¸­çš„åˆ†åŒºæœºåˆ¶æŒ‡çš„æ˜¯å°†æ¯ä¸ªä¸»é¢˜åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼ˆPartition)</p>
<p>å¯ä»¥å¤„ç†æ›´å¤šçš„æ¶ˆæ¯ï¼Œä¸å—å•å°æœåŠ¡å™¨çš„é™åˆ¶ï¼Œå¯ä»¥ä¸å—é™çš„å¤„ç†æ›´å¤šæ˜¯æ•°æ®</p>
<table>
<thead>
<tr>
<th style="text-align:center">åˆ†åŒºç­–ç•¥</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">è½®è¯¢ç­–ç•¥</td>
<td style="text-align:center">æŒ‰é¡ºåºè½®æµå°†æ¯æ¡æ•°æ®åˆ†é…åˆ°æ¯ä¸ªåˆ†åŒºä¸­</td>
</tr>
<tr>
<td style="text-align:center">éšæœºç­–ç•¥</td>
<td style="text-align:center">æ¯æ¬¡éƒ½éšæœºåœ°å°†æ¶ˆæ¯åˆ†é…åˆ°æ¯ä¸ªåˆ†åŒº</td>
</tr>
<tr>
<td style="text-align:center">æŒ‰é”®ä¿å­˜ç­–ç•¥</td>
<td style="text-align:center">ç”Ÿäº§è€…å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ª<code>key</code>ï¼Œè®¡ç®—è¿™ä¸ª<code>key</code>çš„<code>hashCode</code>å€¼ï¼ŒæŒ‰ç…§<code>hashCode</code>çš„å€¼å¯¹ä¸åŒæ¶ˆæ¯è¿›è¡Œå­˜å‚¨</td>
</tr>
</tbody>
</table>
<h2 id="kafkaé«˜å¯ç”¨è®¾è®¡">â­Kafkaé«˜å¯ç”¨è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#kafkaé«˜å¯ç”¨è®¾è®¡">#</a></h2>
<h3 id="é›†ç¾¤">é›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#é›†ç¾¤">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131171012379.png">
            <img src="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131171012379.png" alt="image-20250131171012379"  />
        </a>
    </div>
</p>
<ul>
<li>Kafkaçš„æœåŠ¡ç«¯ç”±è¢«ç§°ä¸ºBrokerçš„æœåŠ¡è¿›ç¨‹æ„æˆï¼Œå³ä¸€ä¸ªKafkaé›†ç¾¤ç”±å¤šä¸ªBrokerç»„æˆ</li>
<li>è¿™æ ·å¦‚æœé›†ç¾¤ä¸­æŸä¸€å°æœºå™¨å®•æœºï¼Œå…¶ä»–æœºå™¨ä¸Šçš„Brokerä¾ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡</li>
</ul>
<h3 id="å¤‡ä»½æœºåˆ¶replication--åŒæ­¥æ–¹å¼">å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰- åŒæ­¥æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#å¤‡ä»½æœºåˆ¶replication--åŒæ­¥æ–¹å¼">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131172027119.png">
            <img src="https://raw.githubusercontent.com/Kennems/blog-image/main/image-20250131172027119.png" alt="image-20250131172027119"  />
        </a>
    </div>
</p>
<p>Kafkaä¸­çš„æ¶ˆæ¯çš„å¤‡ä»½åˆå«åšå‰¯æœ¬ ï¼ˆReplicaï¼‰</p>
<p>Kafkaå®šä¹‰äº†ä¸¤ç±»å‰¯æœ¬ï¼š</p>
<ul>
<li>é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰</li>
<li>è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰</li>
</ul>
<p>è¿½éšè€…å‰¯æœ¬åˆåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131172726398.png">
            <img src="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131172726398.png" alt="image-20250131172726398"  />
        </a>
    </div>
</p>
<ul>
<li>ISRï¼ˆin-sync replicaï¼‰éœ€è¦åŒæ­¥å¤åˆ¶ä¿å­˜çš„follower</li>
<li>æ™®é€šå‰¯æœ¬ï¼Œå¼‚æ­¥å¤åˆ¶ä¿å­˜</li>
</ul>
<p>å¦‚æœ leader å¤±æ•ˆåï¼Œéœ€è¦é€‰å‡ºæ–°çš„leaderï¼Œé€‰ä¸¾çš„åŸåˆ™å¦‚ä¸‹ï¼š</p>
<p><strong>ç¬¬ä¸€</strong>ï¼šé€‰ä¸¾æ—¶ä¼˜å…ˆä»ISRä¸­é€‰å®šï¼Œå› ä¸ºè¿™ä¸ªåˆ—è¡¨ä¸­followerçš„æ•°æ®æ˜¯ä¸leaderåŒæ­¥çš„ã€‚</p>
<p><strong>ç¬¬äºŒ</strong>ï¼šå¦‚æœISRåˆ—è¡¨ä¸­çš„followeréƒ½ä¸è¡Œäº†ï¼Œå°±åªèƒ½ä»å…¶ä»–followerä¸­é€‰å–ã€‚</p>
<p>æç«¯æƒ…å†µä¸‹-æ‰€æœ‰å‰¯æœ¬éƒ½å¤±æ•ˆäº†ï¼Œä¸¤ç§æ–¹æ¡ˆ</p>
<ul>
<li>ç¬¬ä¸€ï¼šç­‰å¾…ISRä¸­çš„ä¸€ä¸ªæ´»è¿‡æ¥ï¼Œé€‰ä¸ºLeaderï¼Œæ•°æ®å¯é ï¼Œä½†æ´»è¿‡æ¥çš„æ—¶é—´ä¸ç¡®å®š</li>
<li>ç¬¬äºŒï¼šé€‰æ‹©ç¬¬ä¸€ä¸ªæ´»è¿‡æ¥çš„Replicationï¼Œä¸ä¸€å®šæ˜¯ISRä¸­çš„ï¼Œé€‰ä¸ºleaderï¼Œä»¥æœ€å¿«é€Ÿåº¦æ¢å¤å¯ç”¨æ€§ï¼Œä½†æ•°æ®ä¸ä¸€å®šå®Œæ•´ã€‚</li>
</ul>
<h2 id="kafkaç”Ÿäº§è€…è¯¦è§£">Kafkaç”Ÿäº§è€…è¯¦è§£<a hidden class="anchor" aria-hidden="true" href="#kafkaç”Ÿäº§è€…è¯¦è§£">#</a></h2>
<h3 id="å‘é€ç±»å‹">å‘é€ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#å‘é€ç±»å‹">#</a></h3>
<ul>
<li>åŒæ­¥å‘é€</li>
</ul>
<p>ä½¿ç”¨send()æ–¹å¼å‘é€ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè°ƒç”¨get()æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå°±å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-7-1"><a class="lnlinks" href="#hl-7-1">1</a>
</span><span class="lnt" id="hl-7-2"><a class="lnlinks" href="#hl-7-2">2</a>
</span><span class="lnt" id="hl-7-3"><a class="lnlinks" href="#hl-7-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// åŒæ­¥æ–¹å¼ä¼šäº§ç”Ÿé˜»å¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RecordMetadata</span><span class="w"> </span><span class="n">recordMetadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">kvProducerRecord</span><span class="p">).</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">recordMetadata</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¼‚æ­¥å‘é€</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-8-1"><a class="lnlinks" href="#hl-8-1">1</a>
</span><span class="lnt" id="hl-8-2"><a class="lnlinks" href="#hl-8-2">2</a>
</span><span class="lnt" id="hl-8-3"><a class="lnlinks" href="#hl-8-3">3</a>
</span><span class="lnt" id="hl-8-4"><a class="lnlinks" href="#hl-8-4">4</a>
</span><span class="lnt" id="hl-8-5"><a class="lnlinks" href="#hl-8-5">5</a>
</span><span class="lnt" id="hl-8-6"><a class="lnlinks" href="#hl-8-6">6</a>
</span><span class="lnt" id="hl-8-7"><a class="lnlinks" href="#hl-8-7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// å¼‚æ­¥å‘é€æ¶ˆæ¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">kvProducerRecord</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">recordMetadata1</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ—¥å¿—è¡¨ä¸­&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">recordMetadata1</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‚æ•°è¯¦è§£">å‚æ•°è¯¦è§£<a hidden class="anchor" aria-hidden="true" href="#å‚æ•°è¯¦è§£">#</a></h3>
<h4 id="ack">ack<a hidden class="anchor" aria-hidden="true" href="#ack">#</a></h4>
<table>
<thead>
<tr>
<th style="text-align:center">ç¡®è®¤æœºåˆ¶</th>
<th style="text-align:center">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">acks = 0</td>
<td style="text-align:center">ç”Ÿäº§è€…åœ¨æˆåŠŸå†™å…¥æ¶ˆæ¯ä¹‹å‰ä¸ä¼šç­‰å¾…ä»»ä½•æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ï¼Œæ¶ˆæ¯æœ‰ä¸¢å¤±çš„é£é™©ï¼Œä½†æ˜¯é€Ÿåº¦æœ€å¿«</td>
</tr>
<tr>
<td style="text-align:center">acks = 1 ï¼ˆé»˜è®¤å€¼ï¼‰</td>
<td style="text-align:center">åªè¦é›†ç¾¤é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº”</td>
</tr>
<tr>
<td style="text-align:center">acks = all</td>
<td style="text-align:center">åªæœ‰å½“æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹å…¨éƒ¨æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ‰ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº”</td>
</tr>
</tbody>
</table>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131174758533.png">
            <img src="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131174758533.png" alt="image-20250131174758533"  />
        </a>
    </div>
</p>
<h4 id="retries">retries<a hidden class="anchor" aria-hidden="true" href="#retries">#</a></h4>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131175255314.png">
            <img src="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131175255314.png" alt="image-20250131175255314"  />
        </a>
    </div>
</p>
<p>ç”Ÿäº§è€…ä»æœåŠ¡å™¨æ”¶åˆ°çš„é”™è¯¯æœ‰å¯èƒ½æ—¶ä¸´æ—¶æ€§é”™è¯¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>retries</code>å‚æ•°çš„å€¼å†³å®šäº†ç”Ÿäº§è€…å¯ä»¥é‡å‘æ¶ˆæ¯çš„æ¬¡æ•°ï¼Œå¦‚æœè¾¾åˆ°è¿™ä¸ªæ¬¡æ•°ï¼Œç”Ÿäº§è€…ä¼šæ”¾å¼ƒé‡è¯•è¿”å›é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ä¼šåœ¨æ¯æ¬¡é‡è¯•ä¹‹é—´ç­‰å¾…100ms</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-9-1"><a class="lnlinks" href="#hl-9-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">prop</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">RETRIES_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ¶ˆæ¯å‹ç¼©">æ¶ˆæ¯å‹ç¼©<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯å‹ç¼©">#</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å‘é€æ—¶ä¸ä¼šè¢«å‹ç¼©</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-10-1"><a class="lnlinks" href="#hl-10-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">COMPRESSION_TYPE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;gzip&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>å‹ç¼©ç®—æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>snappy</td>
<td>å ç”¨è¾ƒå°‘çš„ CPUï¼Œä½†èƒ½å¤Ÿæä¾›è¾ƒå¥½çš„æ€§èƒ½å’Œç›¸å½“å¯è§‚çš„å‹ç¼©æ¯”ã€‚å¦‚æœçœ‹é‡æ€§èƒ½å’Œç½‘ç»œå¸¦å®½ï¼Œå»ºè®®é‡‡ç”¨ã€‚</td>
</tr>
<tr>
<td>lz4</td>
<td>å ç”¨è¾ƒå°‘çš„ CPUï¼Œå‹ç¼©å’Œè§£å‹ç¼©é€Ÿåº¦è¾ƒå¿«ï¼Œå‹ç¼©æ¯”ä¹Ÿå¾ˆå¯è§‚ã€‚</td>
</tr>
<tr>
<td>gzip</td>
<td>å ç”¨è¾ƒå¤šçš„ CPUï¼Œä½†ä¼šæä¾›æ›´é«˜çš„å‹ç¼©æ¯”ï¼Œç½‘ç»œå¸¦å®½æœ‰é™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§ç®—æ³•ã€‚</td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨å‹ç¼©å¯ä»¥é™ä½ç½‘ç»œä¼ è¾“å¼€é”€å’Œå­˜å‚¨å¼€é”€ï¼Œè€Œè¿™å¾€å¾€æ—¶å‘Kafkaå‘é€æ¶ˆæ¯çš„ç“¶é¢ˆæ‰€åœ¨ã€‚</p>
<h2 id="kafkaæ¶ˆè´¹è€…è¯¦è§£">Kafkaæ¶ˆè´¹è€…è¯¦è§£<a hidden class="anchor" aria-hidden="true" href="#kafkaæ¶ˆè´¹è€…è¯¦è§£">#</a></h2>
<h3 id="æ¶ˆè´¹è€…ç»„">æ¶ˆè´¹è€…ç»„<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆè´¹è€…ç»„">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131213512275.png">
            <img src="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131213512275.png" alt="image-20250131213512275"  />
        </a>
    </div>
</p>
<ul>
<li>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šæŒ‡çš„å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆçš„ç¾¤ä½“</li>
<li>ä¸€ä¸ªå‘å¸ƒåœ¨Topicä¸Šæ¶ˆæ¯è¢«åˆ†å‘ç»™æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…
<ul>
<li>æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æˆäº†queueæ¨¡å‹</li>
<li>æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸åŒçš„ç»„ä¸­ï¼Œé‚£ä¹ˆå°±å®Œå…¨æˆç«‹å‘å¸ƒ-è®¢é˜…æ¨¡å‹</li>
</ul>
</li>
</ul>
<h3 id="æ¶ˆæ¯æœ‰åºæ€§">æ¶ˆæ¯æœ‰åºæ€§<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯æœ‰åºæ€§">#</a></h3>
<p>






    <div class="post-img-view">
        <a data-fancybox="gallery" href="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131215933616.png">
            <img src="C:%5cUsers%5cAcer%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250131215933616.png" alt="image-20250131215933616"  />
        </a>
    </div>
</p>
<p>topicåˆ†åŒºä¸­æ¶ˆæ¯åªèƒ½ç”±æ¶ˆè´¹è€…ä¸­çš„å”¯ä¸€ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œæ‰€ä»¥æ¶ˆæ¯æ˜¯æŒ‰ç…§å…ˆåé¡ºåºè¿›è¡Œå¤„ç†çš„ã€‚ä½†æ˜¯å…¶ä»…ä»…ä¿è¯Topicçš„ä¸€ä¸ªåˆ†åŒºé¡ºåºå¤„ç†ï¼Œä¸èƒ½ä¿è¯è·¨åˆ†åŒºçš„æ¶ˆæ¯å…ˆåå¤„ç†é¡ºåºã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦é¡ºåºçš„å¤„ç†Topicçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé‚£å°±åªæä¾›ä¸€ä¸ªåˆ†åŒº</p>
<h3 id="æäº¤å’Œåç§»é‡">æäº¤å’Œåç§»é‡<a hidden class="anchor" aria-hidden="true" href="#æäº¤å’Œåç§»é‡">#</a></h3>
<p>kafkaä¸ä¼šåƒå…¶ä»– JMS é˜Ÿåˆ—é‚£æ ·éœ€è¦å¾—åˆ°æ¶ˆè´¹è€…çš„ç¡®è®¤ï¼Œæ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨</p>
<p>kafka æ¥è¿½è¸ªæ¶ˆæ¯åœ¨åˆ†åŒºçš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼Œæ¶ˆè´¹è€…ä¼šå¾€ä¸€ä¸ªå«åš<code>_consumer_offset</code>çš„ç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…å«äº†æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ã€‚å¦‚æœæ¶ˆè´¹è€…å‘ç”Ÿå´©æºƒæˆ–æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥ç¾¤ç»„ï¼Œå°±ä¼šè§¦å‘å†å‡è¡¡ã€‚</p>
<h3 id="åç§»é‡æäº¤æ–¹å¼">åç§»é‡æäº¤æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#åç§»é‡æäº¤æ–¹å¼">#</a></h3>
<ul>
<li>è‡ªåŠ¨æäº¤åç§»é‡</li>
</ul>
<p>å½“<code>enable.auto.commit</code>è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œæäº¤æ–¹å¼å°±æ˜¯è®©æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤åç§»é‡ï¼Œæ¯éš”5ç§’æ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æŠŠä»<code>poll()</code>æ–¹æ³•æ¥å—çš„æœ€å¤§åç§»é‡æäº¤ä¸Šå»</p>
<ul>
<li>æ‰‹åŠ¨æäº¤</li>
</ul>
<p>å½“<code>enable.auto.commit</code>è¢«è®¾ç½®æœª<code>false</code>å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§æäº¤æ–¹å¼</p>
<ul>
<li>æäº¤å½“å‰åç§»é‡ï¼ˆåŒæ­¥æäº¤ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-11-1"><a class="lnlinks" href="#hl-11-1"> 1</a>
</span><span class="lnt" id="hl-11-2"><a class="lnlinks" href="#hl-11-2"> 2</a>
</span><span class="lnt" id="hl-11-3"><a class="lnlinks" href="#hl-11-3"> 3</a>
</span><span class="lnt" id="hl-11-4"><a class="lnlinks" href="#hl-11-4"> 4</a>
</span><span class="lnt" id="hl-11-5"><a class="lnlinks" href="#hl-11-5"> 5</a>
</span><span class="lnt" id="hl-11-6"><a class="lnlinks" href="#hl-11-6"> 6</a>
</span><span class="lnt" id="hl-11-7"><a class="lnlinks" href="#hl-11-7"> 7</a>
</span><span class="lnt" id="hl-11-8"><a class="lnlinks" href="#hl-11-8"> 8</a>
</span><span class="lnt" id="hl-11-9"><a class="lnlinks" href="#hl-11-9"> 9</a>
</span><span class="lnt" id="hl-11-10"><a class="lnlinks" href="#hl-11-10">10</a>
</span><span class="lnt" id="hl-11-11"><a class="lnlinks" href="#hl-11-11">11</a>
</span><span class="lnt" id="hl-11-12"><a class="lnlinks" href="#hl-11-12">12</a>
</span><span class="lnt" id="hl-11-13"><a class="lnlinks" href="#hl-11-13">13</a>
</span><span class="lnt" id="hl-11-14"><a class="lnlinks" href="#hl-11-14">14</a>
</span><span class="lnt" id="hl-11-15"><a class="lnlinks" href="#hl-11-15">15</a>
</span><span class="lnt" id="hl-11-16"><a class="lnlinks" href="#hl-11-16">16</a>
</span><span class="lnt" id="hl-11-17"><a class="lnlinks" href="#hl-11-17">17</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="n">1000</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecord</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">consumerRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">key</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">partition</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// åŒæ­¥æäº¤åç§»é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">CommitFailedException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ—¥å¿—è¡¨ä¸­, å¼‚å¸¸ï¼š&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¼‚æ­¥æäº¤</li>
</ul>
<p>å¯èƒ½å¯¼è‡´åç§»é‡è¦†ç›–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-12-1"><a class="lnlinks" href="#hl-12-1"> 1</a>
</span><span class="lnt" id="hl-12-2"><a class="lnlinks" href="#hl-12-2"> 2</a>
</span><span class="lnt" id="hl-12-3"><a class="lnlinks" href="#hl-12-3"> 3</a>
</span><span class="lnt" id="hl-12-4"><a class="lnlinks" href="#hl-12-4"> 4</a>
</span><span class="lnt" id="hl-12-5"><a class="lnlinks" href="#hl-12-5"> 5</a>
</span><span class="lnt" id="hl-12-6"><a class="lnlinks" href="#hl-12-6"> 6</a>
</span><span class="lnt" id="hl-12-7"><a class="lnlinks" href="#hl-12-7"> 7</a>
</span><span class="lnt" id="hl-12-8"><a class="lnlinks" href="#hl-12-8"> 8</a>
</span><span class="lnt" id="hl-12-9"><a class="lnlinks" href="#hl-12-9"> 9</a>
</span><span class="lnt" id="hl-12-10"><a class="lnlinks" href="#hl-12-10">10</a>
</span><span class="lnt" id="hl-12-11"><a class="lnlinks" href="#hl-12-11">11</a>
</span><span class="lnt" id="hl-12-12"><a class="lnlinks" href="#hl-12-12">12</a>
</span><span class="lnt" id="hl-12-13"><a class="lnlinks" href="#hl-12-13">13</a>
</span><span class="lnt" id="hl-12-14"><a class="lnlinks" href="#hl-12-14">14</a>
</span><span class="lnt" id="hl-12-15"><a class="lnlinks" href="#hl-12-15">15</a>
</span><span class="lnt" id="hl-12-16"><a class="lnlinks" href="#hl-12-16">16</a>
</span><span class="lnt" id="hl-12-17"><a class="lnlinks" href="#hl-12-17">17</a>
</span><span class="lnt" id="hl-12-18"><a class="lnlinks" href="#hl-12-18">18</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="n">1000</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecord</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">consumerRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">key</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">partition</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// å¼‚æ­¥æ–¹å¼æäº¤åç§»é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitAsync</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OffsetCommitCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onComplete</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">TopicPartition</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetAndMetadata</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è®°å½•é”™è¯¯çš„æäº¤åç§»é‡ &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;, å¼‚å¸¸ä¿¡æ¯ä¸º &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åŒæ­¥å’Œå¼‚æ­¥ç»„åˆæäº¤</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-13-1"><a class="lnlinks" href="#hl-13-1"> 1</a>
</span><span class="lnt" id="hl-13-2"><a class="lnlinks" href="#hl-13-2"> 2</a>
</span><span class="lnt" id="hl-13-3"><a class="lnlinks" href="#hl-13-3"> 3</a>
</span><span class="lnt" id="hl-13-4"><a class="lnlinks" href="#hl-13-4"> 4</a>
</span><span class="lnt" id="hl-13-5"><a class="lnlinks" href="#hl-13-5"> 5</a>
</span><span class="lnt" id="hl-13-6"><a class="lnlinks" href="#hl-13-6"> 6</a>
</span><span class="lnt" id="hl-13-7"><a class="lnlinks" href="#hl-13-7"> 7</a>
</span><span class="lnt" id="hl-13-8"><a class="lnlinks" href="#hl-13-8"> 8</a>
</span><span class="lnt" id="hl-13-9"><a class="lnlinks" href="#hl-13-9"> 9</a>
</span><span class="lnt" id="hl-13-10"><a class="lnlinks" href="#hl-13-10">10</a>
</span><span class="lnt" id="hl-13-11"><a class="lnlinks" href="#hl-13-11">11</a>
</span><span class="lnt" id="hl-13-12"><a class="lnlinks" href="#hl-13-12">12</a>
</span><span class="lnt" id="hl-13-13"><a class="lnlinks" href="#hl-13-13">13</a>
</span><span class="lnt" id="hl-13-14"><a class="lnlinks" href="#hl-13-14">14</a>
</span><span class="lnt" id="hl-13-15"><a class="lnlinks" href="#hl-13-15">15</a>
</span><span class="lnt" id="hl-13-16"><a class="lnlinks" href="#hl-13-16">16</a>
</span><span class="lnt" id="hl-13-17"><a class="lnlinks" href="#hl-13-17">17</a>
</span><span class="lnt" id="hl-13-18"><a class="lnlinks" href="#hl-13-18">18</a>
</span><span class="lnt" id="hl-13-19"><a class="lnlinks" href="#hl-13-19">19</a>
</span><span class="lnt" id="hl-13-20"><a class="lnlinks" href="#hl-13-20">20</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// å¼‚æ­¥å’ŒåŒæ­¥æäº¤åç§»é‡åŒæ—¶ä½¿ç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumer</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="n">1000</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">consumerRecord</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">consumerRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">key</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">offset</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">consumerRecord</span><span class="p">.</span><span class="na">partition</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitAsync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è®°å½•é”™è¯¯çš„ä¿¡æ¯&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// åŒæ­¥æäº¤åç§»é‡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="na">commitSync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kennems.github.io/tags/java/">Java</a></li>
      <li><a href="https://kennems.github.io/tags/web/">Web</a></li>
    </ul>
        
    
    <ul id="categories">
      
        <li><a href="https://kennems.github.io/categories/javaweb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">JavaWebå­¦ä¹ ç¬”è®°</a> </li>
      
    </ul>
    
    
<nav class="paginav">
  <a class="prev" href="https://kennems.github.io/posts/tech/leetcode%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98202502/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>LeetCodeæ¯æ—¥ä¸€é¢˜ï¼ˆ202502ï¼‰</span>
  </a>
  <a class="next" href="https://kennems.github.io/posts/tech/go-5/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Go å¼€å‘æ¡†æ¶ä¸‰ä»¶å¥—</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://kennems.github.io/">Kennem&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<footer class="footer">
    <script async src="https://busuanzi.sukap.cn/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        Visitors: <span id="busuanzi_value_page_uv"></span>
        Views: <span id="busuanzi_value_page_pv"></span>

        
    </span>
</footer>



</body>

</html>
